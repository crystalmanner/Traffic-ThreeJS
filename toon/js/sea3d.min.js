'use strict';var THREE,list,extensions,numDiv,data;THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b);this.type="MorphAnimMesh";this.mixer=new THREE.AnimationMixer(this);this.activeAction=null};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1};
THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var c=THREE.AnimationClip.findByName(this.geometry.animations,a);if(c){var d=this.mixer.clipAction(c);d.timeScale=c.tracks.length*b/c.duration;this.activeAction=d.play()}else throw Error("THREE.MorphAnimMesh: animations["+a+"] undefined in .playAnimation()");};THREE.MorphAnimMesh.prototype.updateAnimation=function(a){this.mixer.update(a)};
THREE.MorphAnimMesh.prototype.copy=function(a){THREE.Mesh.prototype.copy.call(this,a);this.mixer=new THREE.AnimationMixer(this);return this};THREE.Animation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};
THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(a,b){this.currentTime=void 0!==a?a:0;this.weight=void 0!==b?b:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)},reset:function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];void 0===c.animationCache&&(c.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});
var d=this.data.name,e=c.animationCache.animations,f=e[d];void 0===f&&(f={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:c.matrix},e[d]=f);for(c=0;3>c;c++){for(var d=this.keyTypes[c],e=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(d,a,1);g.time<this.currentTime&&g.index>e.index;)e=g,g=this.getNextKeyWith(d,a,g.index+1);f.prevKey[d]=e;f.nextKey[d]=g}}},resetBlendWeights:function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a].animationCache;void 0!==
c&&(c=c.blending,c.positionWeight=0,c.quaternionWeight=0,c.scaleWeight=0)}},update:function(){var a=[],b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Quaternion,e=function(a,b){var c=[],d=[],e,q,p,r,t,l;e=(a.length-1)*b;q=Math.floor(e);e-=q;c[0]=0===q?q:q-1;c[1]=q;c[2]=q>a.length-2?q:q+1;c[3]=q>a.length-3?q:q+2;q=a[c[0]];r=a[c[1]];t=a[c[2]];l=a[c[3]];c=e*e;p=e*c;d[0]=f(q[0],r[0],t[0],l[0],e,c,p);d[1]=f(q[1],r[1],t[1],l[1],e,c,p);d[2]=f(q[2],r[2],t[2],l[2],e,c,p);return d},f=function(a,b,c,d,
e,f,p){a=0.5*(c-a);d=0.5*(d-b);return(2*(b-c)+a+d)*p+(-3*(b-c)-2*a-d)*f+a*e+b};return function(f){if(!1!==this.isPlaying&&(this.currentTime+=f*this.timeScale,0!==this.weight)){f=this.data.length;if(this.currentTime>f||0>this.currentTime)this.loop?(this.currentTime%=f,0>this.currentTime&&(this.currentTime+=f),this.reset()):this.stop();f=0;for(var h=this.hierarchy.length;f<h;f++)for(var k=this.hierarchy[f],m=k.animationCache.animations[this.data.name],s=k.animationCache.blending,q=0;3>q;q++){var p=
this.keyTypes[q],r=m.prevKey[p],t=m.nextKey[p];if(0<this.timeScale&&t.time<=this.currentTime||0>this.timeScale&&r.time>=this.currentTime){r=this.data.hierarchy[f].keys[0];for(t=this.getNextKeyWith(p,f,1);t.time<this.currentTime&&t.index>r.index;)r=t,t=this.getNextKeyWith(p,f,t.index+1);m.prevKey[p]=r;m.nextKey[p]=t}var l=(this.currentTime-r.time)/(t.time-r.time),n=r[p],u=t[p];0>l&&(l=0);1<l&&(l=1);if("pos"===p)if(this.interpolationType===THREE.AnimationHandler.LINEAR)c.x=n[0]+(u[0]-n[0])*l,c.y=n[1]+
(u[1]-n[1])*l,c.z=n[2]+(u[2]-n[2])*l,r=this.weight/(this.weight+s.positionWeight),k.position.lerp(c,r),s.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)a[0]=this.getPrevKeyWith("pos",f,r.index-1).pos,a[1]=n,a[2]=u,a[3]=this.getNextKeyWith("pos",f,t.index+1).pos,l=0.33*l+0.33,t=e(a,l),r=this.weight/(this.weight+s.positionWeight),s.positionWeight+=this.weight,p=k.position,p.x+=(t[0]-p.x)*
r,p.y+=(t[1]-p.y)*r,p.z+=(t[2]-p.z)*r,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(l=e(a,1.01*l),b.set(l[0],l[1],l[2]),b.sub(p),b.y=0,b.normalize(),l=Math.atan2(b.x,b.z),k.rotation.set(0,l,0))}else"rot"===p?(THREE.Quaternion.slerp(n,u,d,l),0===s.quaternionWeight?(k.quaternion.copy(d),s.quaternionWeight=this.weight):(r=this.weight/(this.weight+s.quaternionWeight),THREE.Quaternion.slerp(k.quaternion,d,k.quaternion,r),s.quaternionWeight+=this.weight)):"scl"===p&&(c.x=n[0]+(u[0]-
n[0])*l,c.y=n[1]+(u[1]-n[1])*l,c.z=n[2]+(u[2]-n[2])*l,r=this.weight/(this.weight+s.scaleWeight),k.scale.lerp(c,r),s.scaleWeight+=this.weight)}return!0}}}(),getNextKeyWith:function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]},getPrevKeyWith:function(a,
b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]}};THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(a){if(!0===a.initialized)return a;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(0>a.hierarchy[b].keys[c].time&&(a.hierarchy[b].keys[c].time=
0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;a.hierarchy[b].keys[c].rot=(new THREE.Quaternion).fromArray(d)}if(a.hierarchy[b].keys.length&&void 0!==a.hierarchy[b].keys[0].morphTargets){d={};for(c=0;c<a.hierarchy[b].keys.length;c++)for(var e=0;e<a.hierarchy[b].keys[c].morphTargets.length;e++){var f=a.hierarchy[b].keys[c].morphTargets[e];d[f]=-1}a.hierarchy[b].usedMorphTargets=d;for(c=0;c<a.hierarchy[b].keys.length;c++){var g=
{};for(f in d){for(e=0;e<a.hierarchy[b].keys[c].morphTargets.length;e++)if(a.hierarchy[b].keys[c].morphTargets[e]===f){g[f]=a.hierarchy[b].keys[c].morphTargetsInfluences[e];break}e===a.hierarchy[b].keys[c].morphTargets.length&&(g[f]=0)}a.hierarchy[b].keys[c].morphTargetsInfluences=g}}for(c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}a.initialized=
!0;return a},parse:function(a){var b=function(a,c){c.push(a);for(var d=0;d<a.children.length;d++)b(a.children[d],c)},c=[];if(a instanceof THREE.SkinnedMesh)for(var d=0;d<a.skeleton.bones.length;d++)c.push(a.skeleton.bones[d]);else b(a,c);return c},play:function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)},stop:function(a){a=this.animations.indexOf(a);-1!==a&&this.animations.splice(a,1)},update:function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].resetBlendWeights();
for(b=0;b<this.animations.length;b++)this.animations[b].update(a)}};THREE.KeyFrameAnimation=function(a){this.root=a.node;this.data=THREE.AnimationHandler.init(a);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=0.001;this.isPlaying=!1;this.loop=this.isPaused=!0;a=0;for(var b=this.hierarchy.length;a<b;a++){var c=this.data.hierarchy[a].sids,d=this.hierarchy[a];if(this.data.hierarchy[a].keys.length&&c){for(var e=0;e<c.length;e++){var f=c[e],g=this.getNextKeyWith(f,a,0);g&&g.apply(f)}d.matrixAutoUpdate=!1;this.data.hierarchy[a].node.updateMatrix();
d.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(a){this.currentTime=void 0!==a?a:0;if(!1===this.isPlaying){this.isPlaying=!0;var b=this.hierarchy.length,c,d;for(a=0;a<b;a++)c=this.hierarchy[a],d=this.data.hierarchy[a],void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey=null,d.animationCache.nextKey=null,d.animationCache.originalMatrix=c.matrix),c=this.data.hierarchy[a].keys,1<c.length&&(d.animationCache.prevKey=c[0],d.animationCache.nextKey=
c[1],this.startTime=Math.min(c[0].time,this.startTime),this.endTime=Math.max(c[c.length-1].time,this.endTime));this.update(0)}this.isPaused=!1},stop:function(){this.isPaused=this.isPlaying=!1;for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],c=this.data.hierarchy[a];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;d.copy(b.matrix);b.matrix=d;delete c.animationCache}}},update:function(a){if(!1!==this.isPlaying){this.currentTime+=a*this.timeScale;a=this.data.length;
!0===this.loop&&this.currentTime>a&&(this.currentTime%=a);this.currentTime=Math.min(this.currentTime,a);a=0;for(var b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a],d=this.data.hierarchy[a],e=d.keys,d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=f;d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time);this.data.hierarchy[a].node.updateMatrix();
c.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(a,b,c){b=this.data.hierarchy[b].keys;for(c%=b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]},getPrevKeyWith:function(a,b,c){b=this.data.hierarchy[b].keys;for(c=0<=c?c:c+b.length;0<=c;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]}};var SEA3D={VERSION:17E3,getVersion:function(){var a=SEA3D.VERSION.toString(),b=a.length;return a.substring(0,b-4)+"."+a.substring(b-4,b-3)+"."+a.substring(b-3,b-2)+"."+parseFloat(a.substring(b-2,b)).toString()}};console.log("SEA3D "+SEA3D.getVersion());SEA3D.Stream=function(a){this.position=0;this.buffer=a||new ArrayBuffer};SEA3D.Stream.NONE=0;SEA3D.Stream.BOOLEAN=1;SEA3D.Stream.BYTE=2;SEA3D.Stream.UBYTE=3;SEA3D.Stream.SHORT=4;SEA3D.Stream.USHORT=5;SEA3D.Stream.INT24=6;SEA3D.Stream.UINT24=7;
SEA3D.Stream.INT=8;SEA3D.Stream.UINT=9;SEA3D.Stream.FLOAT=10;SEA3D.Stream.DOUBLE=11;SEA3D.Stream.DECIMAL=12;SEA3D.Stream.VECTOR3D=74;SEA3D.Stream.VECTOR4D=106;SEA3D.Stream.STRING_TINY=128;SEA3D.Stream.STRING_SHORT=129;SEA3D.Stream.STRING_LONG=130;SEA3D.Stream.ASSET=200;SEA3D.Stream.GROUP=255;SEA3D.Stream.BLEND_MODE="normal add subtract multiply dividing alpha screen darken overlay colorburn linearburn lighten colordodge lineardodge softlight hardlight pinlight spotlight spotlightblend hardmix average difference exclusion hue saturation color value".split(" ");
SEA3D.Stream.INTERPOLATION_TABLE="normal linear sine.in sine.out sine.inout cubic.in cubic.out cubic.inout quint.in quint.out quint.inout circ.in circ.out circ.inout back.in back.out back.inout quad.in quad.out quad.inout quart.in quart.out quart.inout expo.in expo.out expo.inout elastic.in elastic.out elastic.inout bounce.in bounce.out bounce.inout".split(" ");SEA3D.Stream.sizeOf=function(a){return 0==a?0:1<=a&&31>=a?1:32<=a&&63>=a?2:64<=a&&95>=a?3:96<=a&&125>=a?4:-1};
SEA3D.Stream.prototype={constructor:SEA3D.Stream,set buffer(a){this.buf=a;this.length=a.byteLength;this.data=new DataView(a)},get buffer(){return this.buf},get bytesAvailable(){return this.length-this.position}};SEA3D.Stream.prototype.getByte=function(a){return this.data.getInt8(a)};SEA3D.Stream.prototype.readBytes=function(a){var b=this.buf.slice(this.position,this.position+a);this.position+=a;return b};SEA3D.Stream.prototype.readByte=function(){return this.data.getInt8(this.position++)};
SEA3D.Stream.prototype.readUByte=function(){return this.data.getUint8(this.position++)};SEA3D.Stream.prototype.readBool=function(){return 0!=this.data.getInt8(this.position++)};SEA3D.Stream.prototype.readShort=function(){var a=this.data.getInt16(this.position,!0);this.position+=2;return a};SEA3D.Stream.prototype.readUShort=function(){var a=this.data.getUint16(this.position,!0);this.position+=2;return a};
SEA3D.Stream.prototype.readUInt24=function(){var a=this.data.getUint32(this.position,!0)&16777215;this.position+=3;return a};SEA3D.Stream.prototype.readUInt24F=function(){return this.readUShort()|this.readUByte()<<16};SEA3D.Stream.prototype.readInt=function(){var a=this.data.getInt32(this.position,!0);this.position+=4;return a};SEA3D.Stream.prototype.readUInt=function(){var a=this.data.getUint32(this.position,!0);this.position+=4;return a};
SEA3D.Stream.prototype.readFloat=function(){var a=this.data.getFloat32(this.position,!0);this.position+=4;return a};SEA3D.Stream.prototype.readUInteger=function(){var a=this.readUByte(),b=a&127;0!=(a&128)&&(a=this.readUByte(),b|=(a&127)<<7,0!=(a&128)&&(a=this.readUByte(),b|=(a&127)<<13));return b};SEA3D.Stream.prototype.readVector2=function(){return{x:this.readFloat(),y:this.readFloat()}};SEA3D.Stream.prototype.readVector3=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat()}};
SEA3D.Stream.prototype.readVector4=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat(),w:this.readFloat()}};
SEA3D.Stream.prototype.readMatrix=function(){var a=new Float32Array(16);a[0]=this.readFloat();a[1]=this.readFloat();a[2]=this.readFloat();a[3]=0;a[4]=this.readFloat();a[5]=this.readFloat();a[6]=this.readFloat();a[7]=0;a[8]=this.readFloat();a[9]=this.readFloat();a[10]=this.readFloat();a[11]=0;a[12]=this.readFloat();a[13]=this.readFloat();a[14]=this.readFloat();a[15]=1;return a};SEA3D.Stream.prototype.readUTF=function(a){return String.fromCharCode.apply(void 0,new Uint16Array(new Uint8Array(this.readBytes(a))))};
SEA3D.Stream.prototype.readExt=function(){return this.readUTF(4).replace(/\0/g,"")};SEA3D.Stream.prototype.readUTF8=function(){return this.readUTF(this.readUByte())};SEA3D.Stream.prototype.readUTF8Short=function(){return this.readUTF(this.readUShort())};SEA3D.Stream.prototype.readUTF8Long=function(){return this.readUTF(this.readUInt())};SEA3D.Stream.prototype.readUByteArray=function(a){var b=new Uint8Array(a);SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,a);this.position+=a;return b};
SEA3D.Stream.prototype.readUShortArray=function(a){var b=new Uint16Array(a);a*=2;SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,a);this.position+=a;return b};SEA3D.Stream.prototype.readUIntArray=function(a){var b=new Uint32Array(a);a*=2;SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,a);this.position+=a;return b};SEA3D.Stream.prototype.readFloatArray=function(a){var b=new Float32Array(a);a*=4;SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,a);this.position+=a;return b};
SEA3D.Stream.prototype.readBlendMode=function(){return SEA3D.Stream.BLEND_MODE[this.readUByte()]};SEA3D.Stream.prototype.readInterpolation=function(){return SEA3D.Stream.INTERPOLATION_TABLE[this.readUByte()]};SEA3D.Stream.prototype.readTags=function(a){for(var b=this.readUByte(),c=0;c<b;++c){var d=this.readUShort(),e=this.readUInt(),f=this.position;a(d,data,e);this.position=f+e}};
SEA3D.Stream.prototype.readProperties=function(a){var b=this.readUByte(),c={},d={};c.__type=d;for(var e=0;e<b;e++){var f=this.readUTF8(),g=this.readUByte();c[f]=this.readToken(g,a);d[f]=g}return c};SEA3D.Stream.prototype.readAnimationList=function(a){for(var b=[],c=this.readUByte(),d=0;d<c;){var e=this.readUByte(),f={};f.relative=0!=(e&1);e&2&&(f.timeScale=this.readFloat());f.tag=a.getObject(this.readUInt());b[d++]=f}return b};
SEA3D.Stream.prototype.readScriptList=function(a){for(var b=[],c=this.readUByte(),d=0;d<c;){var e=this.readUByte(),f={};f.priority=e&1|e&2;if(e&4){var g=this.readUByte();f.params={};for(var h=0;h<g;h++){var k=this.readUTF8();f.params[k]=this.readObject(a)}}e&8&&(f.method=this.readUTF8());f.tag=a.getObject(this.readUInt());b[d++]=f}return b};SEA3D.Stream.prototype.readObject=function(a){return this.readToken(this.readUByte(),a)};
SEA3D.Stream.prototype.readToken=function(a,b){switch(a){case SEA3D.Stream.BOOLEAN:return this.readBool();case SEA3D.Stream.UBYTE:return this.readUByte();case SEA3D.Stream.USHORT:return this.readUShort();case SEA3D.Stream.UINT24:return this.readUInt24();case SEA3D.Stream.INT:return this.readInt();case SEA3D.Stream.UINT:return this.readUInt();case SEA3D.Stream.FLOAT:return this.readFloat();case SEA3D.Stream.VECTOR3D:return this.readVector3();case SEA3D.Stream.VECTOR4D:return this.readVector4();case SEA3D.Stream.STRING_TINY:return this.readUTF8();
case SEA3D.Stream.STRING_SHORT:return this.readUTF8Short();case SEA3D.Stream.STRING_LONG:return this.readUTF8Long();case SEA3D.Stream.ASSET:var c=this.readUInt();return 0<c?b.getObject(c-1).tag:null;default:console.error("DataType not found!")}return null};
SEA3D.Stream.prototype.readVector=function(a,b,c){var d=SEA3D.Stream.sizeOf(a);b=c*d+b*d;switch(a){case SEA3D.Stream.BOOLEAN:return this.readUByteArray(b);case SEA3D.Stream.UBYTE:return this.readUByteArray(b);case SEA3D.Stream.USHORT:return this.readUShortArray(b);case SEA3D.Stream.UINT24:return this.readUInt24Array(b);case SEA3D.Stream.UINT:return this.readUIntArray(b);case SEA3D.Stream.FLOAT:return this.readFloatArray(b);case SEA3D.Stream.VECTOR3D:return this.readFloatArray(b);case SEA3D.Stream.VECTOR4D:return this.readFloatArray(b)}};
SEA3D.Stream.prototype.append=function(a){var b=new ArrayBuffer(this.data.byteLength+a.byteLength);b.set(new ArrayBuffer(this.data),0);b.set(new ArrayBuffer(a),this.data.byteLength);this.data=b};SEA3D.Stream.prototype.concat=function(a,b){return new SEA3D.Stream(this.buffer.slice(a,a+b))};SEA3D.Stream.memcpy=function(a,b,c,d,e){a=new Uint8Array(a,b,e);c=new Uint8Array(c,d,e);a.set(c)};SEA3D.UByteArray=function(){this.ubytes=[];this.length=0};
SEA3D.UByteArray.prototype={constructor:SEA3D.UByteArray,add:function(a){this.ubytes.push(a);this.length+=a.byteLength},toBuffer:function(){for(var a=new Uint8Array(this.length),b=0,c=0;b<this.ubytes.length;b++)a.set(this.ubytes[b],c),c+=this.ubytes[b].byteLength;return a.buffer}};SEA3D.Math={DEGREES:180/Math.PI,RADIANS:Math.PI/180};SEA3D.Math.angle=function(a){var b=0>a;a=(b?-a:a)%360;180<a&&(a=-180+(a-180));return b?-a:a};
SEA3D.Math.lerpAngle=function(a,b,c){180<Math.abs(a-b)&&(b=a>b?b+360:b-360);return SEA3D.Math.angle(a+(b-a)*c)};SEA3D.Math.lerpColor=function(a,b,c){var d=a>>24&255,e=a>>16&255,f=a>>8&255;a&=255;e+=((b>>16&255)-e)*c;f+=((b>>8&255)-f)*c;a+=((b&255)-a)*c;return d+((b>>24&255)-d)*c<<24|e<<16|f<<8|a};SEA3D.Math.lerp=function(a,b,c){return a+(b-a)*c};SEA3D.Math.lerp1x=function(a,b,c){a[0]+=(b[0]-a[0])*c};SEA3D.Math.lerp3x=function(a,b,c){a[0]+=(b[0]-a[0])*c;a[1]+=(b[1]-a[1])*c;a[2]+=(b[2]-a[2])*c};
SEA3D.Math.lerpAng1x=function(a,b,c){a[0]=SEA3D.Math.lerpAngle(a[0],b[0],c)};SEA3D.Math.lerpColor1x=function(a,b,c){a[0]=SEA3D.Math.lerpColor(a[0],b[0],c)};SEA3D.Math.lerpQuat4x=function(a,b,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=b[0],k=b[1],m=b[2];b=b[3];0>d*h+e*k+f*m+g*b&&(h=-h,k=-k,m=-m,b=-b);d+=c*(h-d);e+=c*(k-e);f+=c*(m-f);c=g+c*(b-g);g=1/Math.sqrt(c*c+d*d+e*e+f*f);a[0]=d*g;a[1]=e*g;a[2]=f*g;a[3]=c*g};SEA3D.Timer=function(){this.time=this.start=Date.now()};
SEA3D.Timer.prototype={constructor:SEA3D.Timer,get now(){return Date.now()},get deltaTime(){return Date.now()-this.time},get elapsedTime(){return Date.now()-this.start},update:function(){this.time=Date.now()}};SEA3D.AnimationBlendMethod={LINEAR:"linear",EASING:"easing"};SEA3D.Domain=function(a){this.id=a;this.scripts=[];this.global={};this.events=new SEA3D.EventDispatcher};
SEA3D.Domain.prototype={constructor:SEA3D.Domain,add:function(a){this.scripts.push(a)},remove:function(a){this.scripts.splice(this.scripts.indexOf(a),1)},contains:function(a){return-1!=this.scripts.indexOf(a)},addEvent:function(a,b){this.events.addEventListener(a,b)},hasEvent:function(a,b){return this.events.hasEventListener(a,b)},removeEvent:function(a,b){this.events.removeEventListener(a,b)},print:function(){console.log.apply(console,arguments)},watch:function(){console.log.apply(console,"watch:",
arguments)},getReference:function(a){return eval(a)},dispatchEvent:function(a){a.domain=this;for(var b=this.scripts.concat(),c=b.length;c--;)b[c].dispatchEvent(a);this.events.dispatchEvent(a)},dispose:function(){for(var a=this.scripts.concat(),b=a.length;b--;)a[b].dispose();this.dispatchEvent({type:"dispose"})}};SEA3D.DomainManager=function(a){this.domains=[];this.autoDisposeRootDomain=void 0==a?!0:!1};
SEA3D.DomainManager.prototype={constructor:SEA3D.DomainManager,onDisposeDomain:function(a){this.remove(a.domain);this.autoDisposeRootDomain&&1==this.domains.length&&this.dispose()},add:function(a){this._onDisposeDomain=this._onDisposeDomain||this.onDisposeDomain.bind(this);a.addEvent("dispose",this._onDisposeDomain);this.domains.push(a)},remove:function(a){a.removeEvent("dispose",this._onDisposeDomain);this.domains.splice(this.domains.indexOf(a),1)},contains:function(a){return-1!=this.domains.indexOf(a)},
dispose:function(){for(var a=this.domains.concat(),b=a.length;b--;)a[b].dispose()}};
SEA3D.Script=function(a,b){a=a||new SEA3D.Domain;a.add(this);var c=new SEA3D.EventDispatcher;this.getId=function(){return a.id};this.isRoot=function(){return b};this.addEvent=function(a,b){c.addEventListener(a,b)};this.hasEvent=function(a,b){return c.hasEventListener(a,b)};this.removeEvent=function(a,b){c.removeEventListener(a,b)};this.dispatchEvent=function(a){a.script=this;c.dispatchEvent(a)};this.dispose=function(){a.remove(this);b&&a.dispose();this.dispatchEvent({type:"dispose"})}};
SEA3D.ScriptManager=function(){this.scripts=[];var a=function(a){this.remove(a.script)}.bind(this);this.add=function(b){b.addEvent("dispose",a);this.scripts.push(b)};this.remove=function(b){b.removeEvent("dispose",a);this.scripts.splice(this.scripts.indexOf(b),1)};this.contains=function(a){return-1<this.scripts.indexOf(a)};this.dispatchEvent=function(a){for(var c=this.scripts.concat(),d=c.length;d--;)c[d].dispatchEvent(a)}};SEA3D.AnimationFrame=function(){this.data=[0,0,0,0]};
SEA3D.AnimationFrame.prototype.toVector=function(){return{x:this.data[0],y:this.data[1],z:this.data[2],w:this.data[3]}};SEA3D.AnimationFrame.prototype.toAngles=function(a){var b=this.data[0],c=this.data[1],d=this.data[2],e=this.data[3],f=2*(e*c-d*b);-1>f?f=-1:1<f&&(f=1);return{x:Math.atan2(2*(e*b+c*d),1-2*(b*b+c*c))*a,y:Math.asin(f)*a,z:Math.atan2(2*(e*d+b*c),1-2*(c*c+d*d))*a}};SEA3D.AnimationFrame.prototype.toEuler=function(){return this.toAngles(SEA3D.Math.DEGREES)};
SEA3D.AnimationFrame.prototype.toRadians=function(){return this.toAngles(1)};SEA3D.AnimationFrame.prototype.setX=function(a){this.data[0]=a};SEA3D.AnimationFrame.prototype.getX=function(){return this.data[0]};SEA3D.AnimationFrame.prototype.setY=function(a){this.data[1]=a};SEA3D.AnimationFrame.prototype.getY=function(){return this.data[1]};SEA3D.AnimationFrame.prototype.setZ=function(a){this.data[2]=a};SEA3D.AnimationFrame.prototype.getZ=function(){return this.data[2]};
SEA3D.AnimationFrame.prototype.setW=function(a){this.data[3]=a};SEA3D.AnimationFrame.prototype.getW=function(){return this.data[3]};SEA3D.AnimationData=function(a,b,c,d){this.kind=a;this.type=b;this.blockLength=SEA3D.Stream.sizeOf(b);this.data=c;this.offset=void 0==d?0:d;switch(this.blockLength){case 1:this.getData=this.getData1x;break;case 2:this.getData=this.getData2x;break;case 3:this.getData=this.getData3x;break;case 4:this.getData=this.getData4x}};
SEA3D.AnimationData.prototype.getData1x=function(a,b){a=this.offset+a*this.blockLength;b[0]=this.data[a]};SEA3D.AnimationData.prototype.getData2x=function(a,b){a=this.offset+a*this.blockLength;b[0]=this.data[a];b[1]=this.data[a+1]};SEA3D.AnimationData.prototype.getData3x=function(a,b){a=this.offset+a*this.blockLength;b[0]=this.data[a];b[1]=this.data[a+1];b[2]=this.data[a+2]};
SEA3D.AnimationData.prototype.getData4x=function(a,b){a=this.offset+a*this.blockLength;b[0]=this.data[a];b[1]=this.data[a+1];b[2]=this.data[a+2];b[3]=this.data[a+3]};
SEA3D.AnimationNode=function(a,b,c,d,e){this.name=a;this.frameRate=b;this.frameMill=1E3/b;this.numFrames=c;this.length=c-1;this.time=0;this.duration=this.length*this.frameMill;this.repeat=d;this.intrpl=e;this.invalidState=!0;this.dataList=[];this.dataListId={};this.buffer=new SEA3D.AnimationFrame;this.frame=this.nextFrame=this.prevFrame=this.percent=0};
SEA3D.AnimationNode.prototype.setTime=function(a){this.frame=this.validFrame(a/this.frameMill);this.time=this.frame*this.frameRate;this.invalidState=!0};SEA3D.AnimationNode.prototype.getTime=function(){return this.time};SEA3D.AnimationNode.prototype.setFrame=function(a){this.setTime(a*this.frameMill)};SEA3D.AnimationNode.prototype.getRealFrame=function(){return Math.floor(this.frame)};SEA3D.AnimationNode.prototype.getFrame=function(){return this.frame};
SEA3D.AnimationNode.prototype.setPosition=function(a){this.setFrame(a*(this.numFrames-1))};SEA3D.AnimationNode.prototype.getPosition=function(){return this.frame/(this.numFrames-1)};SEA3D.AnimationNode.prototype.validFrame=function(a){var b=0>a;b&&(a=-a);a>this.length&&(a=this.repeat?a%this.length:this.length);b&&(a=this.length-a);return a};SEA3D.AnimationNode.prototype.addData=function(a){this.dataListId[a.kind]=a;this.dataList[this.dataList.length]=a};
SEA3D.AnimationNode.prototype.removeData=function(a){delete this.dataListId[a.kind];this.dataList.splice(this.dataList.indexOf(a),1)};SEA3D.AnimationNode.prototype.getDataByKind=function(a){return this.dataListId[a]};SEA3D.AnimationNode.prototype.getFrameAt=function(a,b){this.dataListId[b].getFrameData(a,this.buffer.data);return this.buffer};SEA3D.AnimationNode.prototype.getFrame=function(a){this.dataListId[a].getFrameData(this.getRealFrame(),this.buffer.data);return this.buffer};
SEA3D.AnimationNode.prototype.getInterpolationFrame=function(a,b){if(0==this.numFrames)return this.buffer;this.invalidState&&(this.prevFrame=this.getRealFrame(),this.nextFrame=this.validFrame(this.prevFrame+1),this.percent=this.frame-this.prevFrame,this.invalidState=!1);a.getData(this.prevFrame,this.buffer.data);0<this.percent&&(a.getData(this.nextFrame,SEA3D.AnimationNode.FRAME_BUFFER),b(this.buffer.data,SEA3D.AnimationNode.FRAME_BUFFER,this.percent));return this.buffer};
SEA3D.AnimationNode.FRAME_BUFFER=[0,0,0,0];SEA3D.AnimationSet=function(){this.animations=[];this.dataCount=-1};SEA3D.AnimationSet.prototype.addAnimation=function(a){-1==this.dataCount&&(this.dataCount=a.dataList.length);this.animations[a.name]=a;this.animations.push(a)};SEA3D.AnimationSet.prototype.getAnimationByName=function(a){return this.animations[a]};SEA3D.AnimationState=function(a){this.node=a;this.time=this.weight=this.offset=0};
SEA3D.AnimationState.prototype.setTime=function(a){this.node.time=this.time=a};SEA3D.AnimationState.prototype.getTime=function(){return this.time};SEA3D.AnimationState.prototype.setFrame=function(a){this.node.setFrame(a);this.time=this.node.time};SEA3D.AnimationState.prototype.getFrame=function(){this.update();return this.node.getFrame()};SEA3D.AnimationState.prototype.setPosition=function(a){this.node.setPosition(a);this.time=this.node.time};
SEA3D.AnimationState.prototype.getPosition=function(){this.update();return this.node.getPosition()};SEA3D.AnimationState.prototype.update=function(){this.node.time!=this.time&&this.node.setTime(this.time)};
SEA3D.AnimationHandler=function(a){this.animationSet=a;this.states=SEA3D.AnimationHandler.stateFromAnimations(a.animations);this.timeScale=1;this.time=0;this.numAnimation=a.animations.length;this.playing=this.relative=!1;this.delta=0;this.easeSpeed=2;this.crossfade=0;this.updateAllStates=!1;this.blendMethod=SEA3D.AnimationBlendMethod.LINEAR};SEA3D.AnimationHandler.prototype.update=function(a){this.delta=a;this.time+=a*this.timeScale;this.updateState();this.updateAnimation()};
SEA3D.AnimationHandler.prototype.updateState=function(){var a,b,c;this.currentState.node.setTime(this.time-this.currentState.offset);if(1>this.currentState.weight&&0<this.crossfade){var d=Math.abs(this.delta)/(1E3*this.crossfade),e=1;this.blendMethod===SEA3D.AnimationBlendMethod.EASING&&(d*=this.easeSpeed);a=0;for(b=this.states.length;a<b;++a)c=this.states[a],0<c.weight&&c!==this.currentState&&(this.blendMethod===SEA3D.AnimationBlendMethod.LINEAR?c.weight-=d:this.blendMethod===SEA3D.AnimationBlendMethod.EASING&&
(c.weight-=c.weight*d),0>c.weight&&(c.weight=0),e-=c.weight,this.updateAllStates&&c.node.setTime(this.time-c.offset));0>e&&(e=0);this.currentState.weight=e}else for(a=0;a<this.states.length;++a)c=this.states[a],c===this.currentState?c.weight=1:(c.weight=0,this.updateAllStates&&c.node.setTime(this.time))};
SEA3D.AnimationHandler.prototype.updateAnimation=function(){for(var a=this.animationSet.dataCount,b=this.animationSet.animations,c=this.currentState.node,d=0;d<a;d++)for(var e=0;e<b.length;e++){var f=b[e],g=this.states[e],h=f.dataList[d],k=SEA3D.Animation.DefaultLerpFuncs[h.kind],m;if(0==e&&(m=c.getInterpolationFrame(c.dataList[d],k),!c.repeat&&c.frame==c.numFrames-1&&this.onComplete))this.onComplete(this);f!=c&&0<g.weight&&k(m.data,f.getInterpolationFrame(h,k).data,g.weight);this.updateAnimationFrame&&
this.updateAnimationFrame(m,h.kind)}};SEA3D.AnimationHandler.prototype.getStateByName=function(a){return this.states[a]};SEA3D.AnimationHandler.prototype.getStateNameByIndex=function(a){return this.animationSet.animations[a].name};
SEA3D.AnimationHandler.prototype.play=function(a,b,c){this.currentState=this.getStateByName(a);if(!this.currentState)throw Error('Animation "'+a+'" not found.');this.crossfade=b;this.currentState.offset=this.time;void 0!==c&&(this.currentState.time=c);this.playing||(SEA3D.AnimationHandler.add(this),this.playing=!0)};SEA3D.AnimationHandler.prototype.resume=function(){this.playing||(SEA3D.AnimationHandler.add(this),this.playing=!0)};
SEA3D.AnimationHandler.prototype.pause=function(){this.playing&&(SEA3D.AnimationHandler.remove(this),this.playing=!1)};SEA3D.AnimationHandler.prototype.stop=function(){this.time=0;this.pause()};SEA3D.AnimationHandler.prototype.setRelative=function(a){this.relative=a};SEA3D.AnimationHandler.prototype.getRelative=function(){return this.relative};SEA3D.AnimationHandler.add=function(a){SEA3D.AnimationHandler.animations.push(a)};
SEA3D.AnimationHandler.remove=function(a){SEA3D.AnimationHandler.animations.splice(SEA3D.AnimationHandler.animations.indexOf(a),1)};SEA3D.AnimationHandler.stateFromAnimations=function(a){for(var b=[],c=0;c<a.length;c++)b[a[c].name]=b[c]=new SEA3D.AnimationState(a[c]);return b};SEA3D.AnimationHandler.update=function(a){for(var b=0,c=SEA3D.AnimationHandler.animations.length;b<c;b++)SEA3D.AnimationHandler.animations[b].update(1E3*a)};
SEA3D.AnimationHandler.setTime=function(a){for(var b=0,c=SEA3D.AnimationHandler.animations.length;b<c;b++)SEA3D.AnimationHandler.animations[b].time=a};SEA3D.AnimationHandler.stop=function(){for(;SEA3D.AnimationHandler.animations.length;)SEA3D.AnimationHandler.animations[0].stop()};SEA3D.AnimationHandler.animations=[];SEA3D.Object=function(a,b,c,d){this.name=a;this.data=b;this.type=c;this.sea3d=d};
SEA3D.GeometryBase=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUShort();this.isBig=0!=(this.attrib&1);b.readVInt=this.isBig?b.readUInt:b.readUShort;this.numVertex=b.readVInt();this.length=3*this.numVertex};
SEA3D.Geometry=function(a,b,c){SEA3D.GeometryBase.call(this,a,b,c);var d;this.attrib&4&&(this.normal=b.readFloatArray(this.length));this.attrib&8&&(this.tangent=b.readFloatArray(this.length));if(this.attrib&32)for(this.uv=[],this.uv.length=b.readUByte(),d=2*this.numVertex,a=0;a<this.uv.length;)this.uv[a++]=b.readFloatArray(d);this.attrib&64&&(this.jointPerVertex=b.readUByte(),a=this.numVertex*this.jointPerVertex,this.joint=b.readUShortArray(a),this.weight=b.readFloatArray(a));if(this.attrib&128)for(c=
b.readUByte(),this.numColor=((c&64)>>6|(c&128)>>6)+1,this.color=[],a=0,d=c&15;a<d;a++)this.color.push(b.readFloatArray(this.numVertex*this.numColor));this.vertex=b.readFloatArray(this.length);var e=b.readUByte();this.groups=[];if(this.attrib&1024){for(d=a=0;a<e;a++)c=3*b.readVInt(),this.groups.push({start:d,count:c}),d+=c;this.indexes=this.isBig?b.readUIntArray(d):b.readUShortArray(d)}else{var f=this.isBig?4:2,g=new SEA3D.UByteArray;for(c=a=0;a<e;a++)d=3*b.readVInt(),this.groups.push({start:c,count:d}),
c+=d,g.add(b.readUByteArray(d*f));this.indexes=this.isBig?new Uint32Array(g.toBuffer()):new Uint16Array(g.toBuffer())}};SEA3D.Geometry.prototype=Object.create(SEA3D.GeometryBase.prototype);SEA3D.Geometry.prototype.constructor=SEA3D.Geometry;SEA3D.Geometry.prototype.type="geo";
SEA3D.GeometryDeltaBase=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUShort();this.numVertex=b.readUInteger();this.length=3*this.numVertex;this.attrib&1?(b.readNumber=b.readByte,this.numDiv=127.5):(b.readNumber=b.readShort,numDiv=32767.5)};
SEA3D.GeometryDelta=function(a,b,c){SEA3D.GeometryDeltaBase.call(this,a,b,c);var d,e,f;if(this.attrib&4)for(d=b.readFloat(),this.normal=new Float32Array(this.length),a=0;a<this.length;)this.normal[a++]=b.readNumber()/this.numDiv*d;if(this.attrib&8)for(d=b.readFloat(),this.tangent=new Float32Array(this.length),a=0;a<this.length;)this.tangent[a++]=b.readNumber()/this.numDiv*d;if(this.attrib&32)for(this.uv=[],this.uv.length=b.readUByte(),e=2*this.numVertex,a=0;a<this.uv.length;)for(d=b.readFloat(),this.uv[a++]=
f=new Float32Array(e),c=0;c<e;)f[c++]=b.readNumber()/this.numDiv*d;if(this.attrib&64){this.jointPerVertex=b.readUByte();c=this.numVertex*this.jointPerVertex;this.joint=new Uint16Array(c);this.weight=new Float32Array(c);for(a=0;a<c;)this.joint[a++]=b.readUInteger();for(a=0;a<c;)this.weight[a++]=b.readNumber()/this.numDiv*1}if(this.attrib&128)for(a=b.readUByte(),f=((a&64)>>6|(a&128)>>6)+1,d=4*this.numVertex,this.color=[],this.color.length=a&15,this.numColor=4,a=0;a<this.color.length;a++){e=new Float32Array(d);
switch(f){case 1:for(c=0;c<d;)e[c++]=b.readUByte()/255,e[c++]=0,e[c++]=0,e[c++]=1;break;case 2:for(c=0;c<d;)e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255,e[c++]=0,e[c++]=1;break;case 3:for(c=0;c<d;)e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255,e[c++]=1;break;case 4:for(c=0;c<d;)e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255,e[c++]=b.readUByte()/255}this.color[a]=e}d=b.readFloat();this.vertex=new Float32Array(this.length);for(a=0;a<this.length;)this.vertex[a++]=
b.readNumber()/this.numDiv*d;var g=b.readUByte();this.indexes=f=[];this.groups=[];for(a=c=0;a<g;a++)for(e=3*b.readVInt(),this.groups.push({start:c,count:e}),e+=c;c<e;)f[c++]=b.readVInt();g=b.readUByte();this.indexes=f=[];this.groups=[];if(this.attrib&2)for(a=0;a<g;a++){e=b.readUInteger();d=f.length;for(c=0;c<e;c++){var h=b.readUInteger(),k=b.readUInteger(),m=b.readUInteger(),s=b.readUInteger();f.push(h);f.push(k);f.push(m);0<s&&(f.push(m),f.push(s+1),f.push(h))}this.groups.push({start:d,count:f.length-
d})}else for(a=c=0;a<g;a++)for(e=3*b.readUInteger(),this.groups.push({start:c,count:e}),e+=c;c<e;)f[c++]=b.readUInteger()};SEA3D.GeometryDeltaBase.prototype=Object.create(SEA3D.GeometryDeltaBase.prototype);SEA3D.GeometryDeltaBase.prototype.constructor=SEA3D.GeometryDelta;SEA3D.GeometryDelta.prototype.type="geDL";
SEA3D.Object3D=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.isStatic=!1;this.visible=!0;this.attrib=b.readUShort();this.attrib&1&&(this.parent=c.getObject(b.readUInt()));this.attrib&2&&(this.animations=b.readAnimationList(c));this.attrib&4&&(this.scripts=b.readScriptList(c));this.attrib&16&&(this.properties=c.getObject(b.readUInt()));this.attrib&32&&(a=b.readUByte(),this.isStatic=0!=(a&1),this.visible=0!=(a&2))};SEA3D.Object3D.prototype.readTag=function(a,b,c){};
SEA3D.Entity3D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.castShadows=!0;this.attrib&64&&(this.castShadows=0==(b.readUByte()&1))};SEA3D.Entity3D.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Entity3D.prototype.constructor=SEA3D.Entity3D;SEA3D.Sound3D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.autoPlay=0!=(this.attrib&64);this.attrib&128&&(this.mixer=c.getObject(b.readUInt()));this.sound=c.getObject(b.readUInt());this.volume=b.readFloat()};SEA3D.Sound3D.prototype=Object.create(SEA3D.Object3D.prototype);
SEA3D.Sound3D.prototype.constructor=SEA3D.Sound3D;SEA3D.SoundPoint=function(a,b,c){SEA3D.Sound3D.call(this,a,b,c);this.position=b.readVector3();this.distance=b.readFloat();b.readTags(this.readTag.bind(this))};SEA3D.SoundPoint.prototype=Object.create(SEA3D.Sound3D.prototype);SEA3D.SoundPoint.prototype.constructor=SEA3D.SoundPoint;SEA3D.SoundPoint.prototype.type="sp";SEA3D.Container3D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.transform=b.readMatrix();b.readTags(this.readTag.bind(this))};
SEA3D.Container3D.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Container3D.prototype.constructor=SEA3D.Container3D;SEA3D.Container3D.prototype.type="c3d";SEA3D.TextureURL=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.url=b.readUTF(b.length)};SEA3D.TextureURL.prototype.type="urlT";
SEA3D.Actions=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.count=b.readUInt();this.actions=[];for(a=0;a<this.count;a++){var d=b.readUByte(),e=b.readUShort(),f=b.readUShort(),g=b.position,h=this.actions[a]={kind:e};d&1&&(h.range=[b.readUInt(),b.readUInt()]);d&2&&(h.time=b.readUInt());d&4&&(h.intrpl=b.readInterpolation(),0==h.intrpl.indexOf("back.")?h.intrplParam0=b.readFloat():0==h.intrpl.indexOf("elastic.")&&(h.intrplParam0=b.readFloat(),h.intrplParam1=b.readFloat()));switch(e){case SEA3D.Actions.RTT_TARGET:h.source=
c.getObject(b.readUInt());h.target=c.getObject(b.readUInt());break;case SEA3D.Actions.LOOK_AT:h.source=c.getObject(b.readUInt());h.target=c.getObject(b.readUInt());break;case SEA3D.Actions.PLAY_SOUND:h.sound=c.getObject(b.readUInt());h.offset=b.readUInt();break;case SEA3D.Actions.PLAY_ANIMATION:h.object=c.getObject(b.readUInt());h.name=b.readUTF8();break;case SEA3D.Actions.FOG:h.color=b.readUInt24();h.min=b.readFloat();h.max=b.readFloat();break;case SEA3D.Actions.ENVIRONMENT:h.texture=c.getObject(b.readUInt());
break;case SEA3D.Actions.ENVIRONMENT_COLOR:h.color=b.readUInt24F();break;case SEA3D.Actions.CAMERA:h.camera=c.getObject(b.readUInt());break;case SEA3D.Actions.SCRIPTS:h.scripts=b.readScriptList(c);break;case SEA3D.Actions.CLASS_OF:h.classof=c.getObject(b.readUInt());break;default:console.log('Action "'+e+'" not found.')}b.position=g+f}};SEA3D.Actions.SCENE=0;SEA3D.Actions.ENVIRONMENT_COLOR=1;SEA3D.Actions.ENVIRONMENT=2;SEA3D.Actions.FOG=3;SEA3D.Actions.PLAY_ANIMATION=4;SEA3D.Actions.PLAY_SOUND=5;
SEA3D.Actions.ANIMATION_AUDIO_SYNC=6;SEA3D.Actions.LOOK_AT=7;SEA3D.Actions.RTT_TARGET=8;SEA3D.Actions.CAMERA=9;SEA3D.Actions.SCRIPTS=10;SEA3D.Actions.CLASS_OF=11;SEA3D.Actions.prototype.type="act";SEA3D.Properties=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.tag=b.readProperties(c);this.tag.__name=a};SEA3D.Properties.prototype.type="prop";SEA3D.FileInfo=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.tag=b.readProperties(c);this.tag.__name=a;c.info=this.tag};
SEA3D.FileInfo.prototype.type="info";SEA3D.JavaScript=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.src=b.readUTF(b.length)};SEA3D.JavaScript.prototype.type="js";SEA3D.JavaScriptMethod=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;a=b.readUShort();this.methods={};for(c=0;c<a;c++){b.readUByte();var d=b.readUTF8();this.methods[d]={src:b.readUTF8Long()}}};SEA3D.JavaScriptMethod.prototype.type="jsm";SEA3D.GLSL=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.src=b.readUTF(b.length)};
SEA3D.GLSL.prototype.type="glsl";SEA3D.Dummy=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.transform=b.readMatrix();this.width=b.readFloat();this.height=b.readFloat();this.depth=b.readFloat();b.readTags(this.readTag.bind(this))};SEA3D.Dummy.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Dummy.prototype.constructor=SEA3D.Dummy;SEA3D.Dummy.prototype.type="dmy";
SEA3D.Line=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.count=3*(this.attrib&64?b.readUInt():b.readUShort());this.closed=0!=(this.attrib&128);this.transform=b.readMatrix();this.vertex=[];for(a=0;a<this.count;)this.vertex[a++]=b.readFloat();b.readTags(this.readTag.bind(this))};SEA3D.Line.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Line.prototype.constructor=SEA3D.Line;SEA3D.Line.prototype.type="line";
SEA3D.Mesh2D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.attrib&256&&(this.material=c.getObject(b.readUInt()));this.position=b.readVector3();this.width=b.readFloat();this.height=b.readFloat();b.readTags(this.readTag.bind(this))};SEA3D.Mesh2D.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Mesh2D.prototype.constructor=SEA3D.Mesh2D;SEA3D.Mesh2D.prototype.type="m2d";
SEA3D.Mesh=function(a,b,c){SEA3D.Entity3D.call(this,a,b,c);if(this.attrib&256)if(this.material=[],a=b.readUByte(),1==a)this.material[0]=c.getObject(b.readUInt());else for(var d=0;d<a;){var e=b.readUInt();0<e?this.material[d++]=c.getObject(e-1):this.material[d++]=void 0}if(this.attrib&512)for(this.modifiers=[],a=b.readUByte(),d=0;d<a;d++)this.modifiers[d]=c.getObject(b.readUInt());this.attrib&1024&&(this.reference={type:b.readUByte(),ref:c.getObject(b.readUInt())});this.transform=b.readMatrix();this.geometry=
c.getObject(b.readUInt());b.readTags(this.readTag.bind(this))};SEA3D.Mesh.prototype=Object.create(SEA3D.Entity3D.prototype);SEA3D.Mesh.prototype.constructor=SEA3D.Mesh;SEA3D.Mesh.prototype.type="m3d";SEA3D.Skeleton=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;a=b.readUShort();this.joint=[];for(c=0;c<a;c++)this.joint[c]={name:b.readUTF8(),parentIndex:b.readUShort()-1,inverseBindMatrix:b.readMatrix()}};SEA3D.Skeleton.prototype.type="skl";
SEA3D.SkeletonLocal=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;a=b.readUShort();this.joint=[];for(c=0;c<a;c++)this.joint[c]={name:b.readUTF8(),parentIndex:b.readUShort()-1,x:b.readFloat(),y:b.readFloat(),z:b.readFloat(),qx:b.readFloat(),qy:b.readFloat(),qz:b.readFloat(),qw:b.readFloat()}};SEA3D.SkeletonLocal.prototype.type="sklq";
SEA3D.AnimationBase=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;a=b.readUByte();this.sequence=[];if(a&1){c=b.readUShort();for(var d=0;d<c;d++)a=b.readUByte(),this.sequence[d]={name:b.readUTF8(),start:b.readUInt(),count:b.readUInt(),repeat:0!=(a&1),intrpl:0!=(a&2)}}this.frameRate=b.readUByte();this.numFrames=b.readUInt();0==this.sequence.length&&(this.sequence[0]={name:"root",start:0,count:this.numFrames,repeat:!0,intrpl:!0})};
SEA3D.Animation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c);this.dataList=[];a=0;for(c=b.readUByte();a<c;a++){var d=b.readUShort(),e=b.readUByte(),f=b.readVector(e,this.numFrames,0);this.dataList.push({kind:d,type:e,blockSize:SEA3D.Stream.sizeOf(e),data:f})}};SEA3D.Animation.POSITION=0;SEA3D.Animation.ROTATION=1;SEA3D.Animation.SCALE=2;SEA3D.Animation.COLOR=3;SEA3D.Animation.MULTIPLIER=4;SEA3D.Animation.ATTENUATION_START=5;SEA3D.Animation.ATTENUATION_END=6;SEA3D.Animation.FOV=7;
SEA3D.Animation.OFFSET_U=8;SEA3D.Animation.OFFSET_V=9;SEA3D.Animation.SCALE_U=10;SEA3D.Animation.SCALE_V=11;SEA3D.Animation.ANGLE=12;SEA3D.Animation.ALPHA=13;SEA3D.Animation.VOLUME=14;SEA3D.Animation.DefaultLerpFuncs=[SEA3D.Math.lerp3x,SEA3D.Math.lerpQuat4x,SEA3D.Math.lerp3x,SEA3D.Math.lerpColor1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerpAng1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x];
SEA3D.Animation.prototype=Object.create(SEA3D.AnimationBase.prototype);SEA3D.Animation.prototype.constructor=SEA3D.Animation;SEA3D.Animation.prototype.type="anm";SEA3D.SkeletonAnimation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c);this.name=a;this.data=b;this.sea3d=c;this.numJoints=b.readUShort();this.raw=b.readFloatArray(this.numFrames*this.numJoints*7)};SEA3D.SkeletonAnimation.prototype.type="skla";
SEA3D.Morph=function(a,b,c){SEA3D.GeometryBase.call(this,a,b,c);a=0!=(this.attrib&2);c=0!=(this.attrib&4);var d=b.readUShort();this.node=[];for(var e=0;e<d;e++){var f=b.readUTF8(),g,h;a&&(g=b.readFloatArray(this.length));c&&(h=b.readFloatArray(this.length));this.node[e]={vertex:g,normal:h,name:f}}};SEA3D.Morph.prototype=Object.create(SEA3D.GeometryBase.prototype);SEA3D.Morph.prototype.constructor=SEA3D.Morph;SEA3D.Morph.prototype.type="mph";
SEA3D.VertexAnimation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c);c=b.readUByte();this.isBig=0!=(c&1);b.readVInt=this.isBig?b.readUInt:b.readUShort;this.numVertex=b.readVInt();this.length=3*this.numVertex;a=0!=(c&2);c=0!=(c&4);this.frame=[];var d,e,f;for(d=0;d<this.numFrames;d++)a&&(e=b.readFloatArray(this.length)),c&&(f=b.readFloatArray(this.length)),this.frame[d]={vertex:e,normal:f}};SEA3D.VertexAnimation.prototype=Object.create(SEA3D.AnimationBase.prototype);
SEA3D.VertexAnimation.prototype.constructor=SEA3D.VertexAnimation;SEA3D.VertexAnimation.prototype.type="vtxa";SEA3D.Camera=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.attrib&64&&(this.dof={distance:b.readFloat(),range:b.readFloat()});this.transform=b.readMatrix();this.fov=b.readFloat();b.readTags(this.readTag.bind(this))};SEA3D.Camera.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Camera.prototype.constructor=SEA3D.Camera;SEA3D.Camera.prototype.type="cam";
SEA3D.JointObject=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.target=c.getObject(b.readUInt());this.joint=b.readUShort();b.readTags(this.readTag.bind(this))};SEA3D.JointObject.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.JointObject.prototype.constructor=SEA3D.JointObject;SEA3D.JointObject.prototype.type="jnt";
SEA3D.Light=function(a,b,c){SEA3D.Object3D.call(this,a,b,c);this.attenEnd=this.attenStart=Number.MAX_VALUE;this.attrib&64&&(a=b.readUByte(),this.shadow={},this.shadow.opacity=a&1?b.readFloat():1,this.shadow.color=a&2?b.readUInt24():0);this.attrib&512&&(this.attenStart=b.readFloat(),this.attenEnd=b.readFloat());this.color=b.readUInt24();this.multiplier=b.readFloat()};SEA3D.Light.prototype=Object.create(SEA3D.Object3D.prototype);SEA3D.Light.prototype.constructor=SEA3D.Light;
SEA3D.PointLight=function(a,b,c){SEA3D.Light.call(this,a,b,c);this.attrib&128&&(this.attenuation={start:b.readFloat(),end:b.readFloat()});this.position=b.readVector3();b.readTags(this.readTag.bind(this))};SEA3D.PointLight.prototype=Object.create(SEA3D.Light.prototype);SEA3D.PointLight.prototype.constructor=SEA3D.PointLight;SEA3D.PointLight.prototype.type="plht";
SEA3D.HemisphereLight=function(a,b,c){SEA3D.Light.call(this,a,b,c);this.attrib&128&&(this.attenuation={start:b.readFloat(),end:b.readFloat()});this.secondColor=b.readUInt24();b.readTags(this.readTag.bind(this))};SEA3D.HemisphereLight.prototype=Object.create(SEA3D.Light.prototype);SEA3D.HemisphereLight.prototype.constructor=SEA3D.HemisphereLight;SEA3D.HemisphereLight.prototype.type="hlht";SEA3D.DirectionalLight=function(a,b,c){SEA3D.Light.call(this,a,b,c);this.transform=b.readMatrix();b.readTags(this.readTag.bind(this))};
SEA3D.DirectionalLight.prototype=Object.create(SEA3D.Light.prototype);SEA3D.DirectionalLight.prototype.constructor=SEA3D.DirectionalLight;SEA3D.DirectionalLight.prototype.type="dlht";
SEA3D.Material=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.technique=[];this.attrib=b.readUShort();this.alpha=1;this.blendMode="normal";this.alphaThreshold=0.5;this.bothSides=0!=(this.attrib&1);this.receiveLights=0==(this.attrib&2);this.receiveShadows=0==(this.attrib&4);this.receiveFog=0==(this.attrib&8);this.smooth=0==(this.attrib&16);this.attrib&32&&(this.alpha=b.readFloat());this.attrib&64&&(this.blendMode=b.readBlendMode());this.attrib&128&&(this.animations=b.readAnimationList(c));
this.depthMask=0==(this.attrib&256);a=b.readUByte();for(var d=0;d<a;++d){var e=b.readUShort(),f=b.readUShort(),g=b.position,h,k;switch(e){case SEA3D.Material.DEFAULT:h={ambientColor:b.readUInt24(),diffuseColor:b.readUInt24(),specularColor:b.readUInt24(),specular:b.readFloat(),gloss:b.readFloat()};break;case SEA3D.Material.COMPOSITE_TEXTURE:h={composite:c.getObject(b.readUInt())};break;case SEA3D.Material.DIFFUSE_MAP:h={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.SPECULAR_MAP:h={texture:c.getObject(b.readUInt())};
break;case SEA3D.Material.NORMAL_MAP:h={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.REFLECTION:case SEA3D.Material.FRESNEL_REFLECTION:h={texture:c.getObject(b.readUInt()),alpha:b.readFloat()};e==SEA3D.Material.FRESNEL_REFLECTION&&(h.power=b.readFloat(),h.normal=b.readFloat());break;case SEA3D.Material.REFRACTION:h={texture:c.getObject(b.readUInt()),alpha:b.readFloat(),ior:b.readFloat()};break;case SEA3D.Material.RIM:h={color:b.readUInt24(),strength:b.readFloat(),power:b.readFloat(),
blendMode:b.readBlendMode()};break;case SEA3D.Material.LIGHT_MAP:h={texture:c.getObject(b.readUInt()),channel:b.readUByte(),blendMode:b.readBlendMode()};break;case SEA3D.Material.DETAIL_MAP:h={texture:c.getObject(b.readUInt()),scale:b.readFloat(),blendMode:b.readBlendMode()};break;case SEA3D.Material.CEL:h={color:b.readUInt24(),levels:b.readUByte(),size:b.readFloat(),specularCutOff:b.readFloat(),smoothness:b.readFloat()};break;case SEA3D.Material.TRANSLUCENT:h={color:b.readUInt24(),translucency:b.readFloat(),
scattering:b.readFloat()};break;case SEA3D.Material.BLEND_NORMAL_MAP:k=b.readUByte();h={texture:c.getObject(b.readUInt()),secondaryTexture:c.getObject(b.readUInt())};k&1?(h.offsetX0=b.readFloat(),h.offsetY0=b.readFloat(),h.offsetX1=b.readFloat(),h.offsetY1=b.readFloat()):h.offsetX0=h.offsetY0=h.offsetX1=h.offsetY1=0;h.animate=k&2;break;case SEA3D.Material.MIRROR_REFLECTION:h={texture:c.getObject(b.readUInt()),alpha:b.readFloat()};break;case SEA3D.Material.AMBIENT_MAP:h={texture:c.getObject(b.readUInt())};
break;case SEA3D.Material.ALPHA_MAP:h={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.EMISSIVE_MAP:h={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.VERTEX_COLOR:h={blendMode:b.readBlendMode()};break;case SEA3D.Material.WRAP_LIGHTING:h={color:b.readUInt24(),strength:b.readFloat()};break;case SEA3D.Material.COLOR_REPLACE:k=b.readUByte();h={red:b.readUInt24(),green:b.readUInt24(),blue:b.readUInt24()};k&1&&(h.mask=c.getObject(b.readUInt()));k&2&&(h.alpha=b.readFloat());break;
case SEA3D.Material.REFLECTION_SPHERICAL:h={texture:c.getObject(b.readUInt()),alpha:b.readFloat()};break;default:console.warn("SEA3D: MaterialTechnique not found:",e.toString(16));b.position=g+f;continue}h.kind=e;this.technique.push(h);b.position=g+f}};SEA3D.Material.DEFAULT=0;SEA3D.Material.COMPOSITE_TEXTURE=1;SEA3D.Material.DIFFUSE_MAP=2;SEA3D.Material.SPECULAR_MAP=3;SEA3D.Material.REFLECTION=4;SEA3D.Material.REFRACTION=5;SEA3D.Material.NORMAL_MAP=6;SEA3D.Material.FRESNEL_REFLECTION=7;
SEA3D.Material.RIM=8;SEA3D.Material.LIGHT_MAP=9;SEA3D.Material.DETAIL_MAP=10;SEA3D.Material.CEL=11;SEA3D.Material.TRANSLUCENT=12;SEA3D.Material.BLEND_NORMAL_MAP=13;SEA3D.Material.MIRROR_REFLECTION=14;SEA3D.Material.AMBIENT_MAP=15;SEA3D.Material.ALPHA_MAP=16;SEA3D.Material.EMISSIVE_MAP=17;SEA3D.Material.VERTEX_COLOR=18;SEA3D.Material.WRAP_LIGHTING=19;SEA3D.Material.COLOR_REPLACE=20;SEA3D.Material.REFLECTION_SPHERICAL=21;SEA3D.Material.prototype.type="mat";
SEA3D.Composite=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;a=b.readUByte();this.layer=[];for(var d=0;d<a;d++)this.layer[d]=new SEA3D.Composite.prototype.Layer(b,c)};SEA3D.Composite.prototype.getLayerByName=function(a){for(var b=0;b<this.layer.length;b++)if(this.layer[b].name==a)return this.layer[b]};
SEA3D.Composite.prototype.Layer=function(a,b){var c=a.readUShort();c&1?this.texture=new SEA3D.Composite.LayerBitmap(a,b):this.color=a.readUInt24();c&2&&(this.mask=new SEA3D.Composite.LayerBitmap(a,b));c&4&&(this.name=a.readUTF8());this.blendMode=c&8?a.readBlendMode():"normal";this.opacity=c&16?a.readFloat():1};
SEA3D.Composite.LayerBitmap=function(a,b){this.map=b.getObject(a.readUInt());var c=a.readUShort();this.channel=c&1?a.readUByte():0;this.repeat=c&0;this.offsetU=c&4?a.readFloat():0;this.offsetV=c&8?a.readFloat():0;this.scaleU=c&16?a.readFloat():1;this.scaleV=c&32?a.readFloat():1;this.rotation=c&64?a.readFloat():0;c&128&&(this.animation=a.readAnimationList(b))};SEA3D.Composite.prototype.type="ctex";SEA3D.Sphere=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.radius=b.readFloat()};
SEA3D.Sphere.prototype.type="sph";SEA3D.Box=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.width=b.readFloat();this.height=b.readFloat();this.depth=b.readFloat()};SEA3D.Box.prototype.type="box";SEA3D.Cone=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.radius=b.readFloat();this.height=b.readFloat()};SEA3D.Cone.prototype.type="cone";SEA3D.Capsule=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.radius=b.readFloat();this.height=b.readFloat()};
SEA3D.Capsule.prototype.type="cap";SEA3D.Cylinder=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.radius=b.readFloat();this.height=b.readFloat()};SEA3D.Cylinder.prototype.type="cyl";SEA3D.ConvexGeometry=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.geometry=c.getObject(b.readUInt());this.subGeometryIndex=b.readUByte()};SEA3D.ConvexGeometry.prototype.type="gs";
SEA3D.TriangleGeometry=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.geometry=c.getObject(b.readUInt());this.subGeometryIndex=b.readUByte()};SEA3D.TriangleGeometry.prototype.type="sgs";SEA3D.Compound=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.compounds=[];a=b.readUByte();for(var d=0;d<a;d++)this.compounds.push({shape:c.getObject(b.readUInt()),transform:b.readMatrix()})};SEA3D.Compound.prototype.type="cmps";
SEA3D.Physics=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUShort();this.shape=c.getObject(b.readUInt());this.attrib&1?this.target=c.getObject(b.readUInt()):this.transform=b.readMatrix()};SEA3D.Physics.prototype.readTag=function(a,b,c){};
SEA3D.RigidBodyBase=function(a,b,c){SEA3D.Physics.call(this,a,b,c);this.attrib&32?(this.linearDamping=b.readFloat(),this.angularDamping=b.readFloat()):this.angularDamping=this.linearDamping=0;this.mass=b.readFloat();this.friction=b.readFloat();this.restitution=b.readFloat()};SEA3D.RigidBodyBase.prototype=Object.create(SEA3D.Physics.prototype);SEA3D.RigidBodyBase.prototype.constructor=SEA3D.RigidBodyBase;SEA3D.RigidBody=function(a,b,c){SEA3D.RigidBodyBase.call(this,a,b,c);b.readTags(this.readTag.bind(this))};
SEA3D.RigidBody.prototype=Object.create(SEA3D.RigidBodyBase.prototype);SEA3D.RigidBody.prototype.constructor=SEA3D.RigidBody;SEA3D.RigidBody.prototype.type="rb";
SEA3D.CarController=function(a,b,c){SEA3D.RigidBodyBase.call(this,a,b,c);this.suspensionStiffness=b.readFloat();this.suspensionCompression=b.readFloat();this.suspensionDamping=b.readFloat();this.maxSuspensionTravelCm=b.readFloat();this.frictionSlip=b.readFloat();this.maxSuspensionForce=b.readFloat();this.dampingCompression=b.readFloat();this.dampingRelaxation=b.readFloat();a=b.readUByte();this.wheel=[];for(var d=0;d<a;d++)this.wheel[d]=new SEA3D.CarController.Wheel(b,c);b.readTags(this.readTag.bind(this))};
SEA3D.CarController.Wheel=function(a,b){this.data=a;this.sea3d=b;this.isFront=0!=(a.readUShort()&1);this.target=b.getObject(a.readUInt());this.pos=a.readVector3();this.dir=a.readVector3();this.axle=a.readVector3();this.radius=a.readFloat();this.suspensionRestLength=a.readFloat()};SEA3D.CarController.prototype=Object.create(SEA3D.RigidBodyBase.prototype);SEA3D.CarController.prototype.constructor=SEA3D.CarController;SEA3D.CarController.prototype.type="carc";
SEA3D.Constraints=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUShort();this.disableCollisionsBetweenBodies=this.attrib&1;this.targetA=c.getObject(b.readUInt());this.pointA=b.readVector3();this.attrib&2&&(this.targetB=c.getObject(b.readUInt()),this.pointB=b.readVector3())};SEA3D.P2PConstraint=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;SEA3D.Constraints.call(this,a,b,c)};SEA3D.P2PConstraint.prototype=Object.create(SEA3D.Constraints.prototype);
SEA3D.P2PConstraint.prototype.constructor=SEA3D.P2PConstraint;SEA3D.P2PConstraint.prototype.type="p2pc";SEA3D.HingeConstraint=function(a,b,c){SEA3D.Constraints.call(this,a,b,c);this.axisA=b.readVector3();this.attrib&1&&(this.axisB=b.readVector3());this.attrib&4&&(this.limit={low:b.readFloat(),high:b.readFloat(),softness:b.readFloat(),biasFactor:b.readFloat(),relaxationFactor:b.readFloat()});this.attrib&8&&(this.angularMotor={velocity:b.readFloat(),impulse:b.readFloat()})};
SEA3D.HingeConstraint.prototype=Object.create(SEA3D.Constraints.prototype);SEA3D.HingeConstraint.prototype.constructor=SEA3D.HingeConstraint;SEA3D.HingeConstraint.prototype.type="hnec";SEA3D.ConeTwistConstraint=function(a,b,c){SEA3D.Constraints.call(this,a,b,c);this.axisA=b.readVector3();this.attrib&1&&(this.axisB=b.readVector3());this.attrib&4&&(this.limit={swingSpan1:b.readFloat(),swingSpan2:b.readFloat(),twistSpan:b.readFloat(),softness:b.readFloat(),biasFactor:b.readFloat(),relaxationFactor:b.readFloat()})};
SEA3D.ConeTwistConstraint.prototype=Object.create(SEA3D.Constraints.prototype);SEA3D.ConeTwistConstraint.prototype.constructor=SEA3D.ConeTwistConstraint;SEA3D.ConeTwistConstraint.prototype.type="ctwc";SEA3D.PlanarRender=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUByte();this.quality=this.attrib&1|this.attrib&2;this.transform=b.readMatrix()};SEA3D.PlanarRender.prototype.type="rttp";
SEA3D.CubeRender=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.attrib=b.readUByte();this.quality=this.attrib&1|this.attrib&2;this.position=b.readVector3()};SEA3D.CubeRender.prototype.type="rttc";SEA3D.CubeMap=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.transparent=!1;b.readExt();this.faces=[];for(a=0;6>a;a++)c=b.readUInt(),this.faces[a]=b.concat(b.position,c),b.position+=c};SEA3D.CubeMap.prototype.type="cmap";
SEA3D.JPEG=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.transparent=!1};SEA3D.JPEG.prototype.type="jpg";SEA3D.JPEG_XR=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.transparent=!0};SEA3D.JPEG_XR.prototype.type="wdp";SEA3D.PNG=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.transparent=6==b.getByte(25)};SEA3D.PNG.prototype.type="png";SEA3D.GIF=function(a,b,c){this.name=a;this.data=b;this.sea3d=c;this.transparent=0<b.getByte(11)};SEA3D.GIF.prototype.type="gif";
SEA3D.OGG=function(a,b,c){this.name=a;this.data=b;this.sea3d=c};SEA3D.OGG.prototype.type="ogg";SEA3D.MP3=function(a,b,c){this.name=a;this.data=b;this.sea3d=c};SEA3D.MP3.prototype.type="mp3";
SEA3D.File=function(a){this.version=SEA3D.VERSION;this.objects=[];this.typeClass={};this.typeRead={};this.typeUnique={};this.position=this.dataPosition=0;this.scope=this;this.streaming=!0;this.timeLimit=60;this.addClass(SEA3D.FileInfo,!0);this.addClass(SEA3D.Geometry,!0);this.addClass(SEA3D.GeometryDelta,!0);this.addClass(SEA3D.Mesh);this.addClass(SEA3D.Mesh2D);this.addClass(SEA3D.Material);this.addClass(SEA3D.Composite);this.addClass(SEA3D.PointLight);this.addClass(SEA3D.DirectionalLight);this.addClass(SEA3D.HemisphereLight);
this.addClass(SEA3D.Skeleton,!0);this.addClass(SEA3D.SkeletonLocal,!0);this.addClass(SEA3D.SkeletonAnimation,!0);this.addClass(SEA3D.JointObject);this.addClass(SEA3D.Camera);this.addClass(SEA3D.Morph,!0);this.addClass(SEA3D.VertexAnimation,!0);this.addClass(SEA3D.CubeMap,!0);this.addClass(SEA3D.Animation);this.addClass(SEA3D.Dummy);this.addClass(SEA3D.Line);this.addClass(SEA3D.SoundPoint);this.addClass(SEA3D.PlanarRender);this.addClass(SEA3D.CubeRender);this.addClass(SEA3D.Actions);this.addClass(SEA3D.Container3D);
this.addClass(SEA3D.Properties);this.addClass(SEA3D.TextureURL,!0);this.addClass(SEA3D.Sphere);this.addClass(SEA3D.Box);this.addClass(SEA3D.Cone);this.addClass(SEA3D.Capsule);this.addClass(SEA3D.Cylinder);this.addClass(SEA3D.ConvexGeometry);this.addClass(SEA3D.TriangleGeometry);this.addClass(SEA3D.Compound);this.addClass(SEA3D.RigidBody);this.addClass(SEA3D.P2PConstraint);this.addClass(SEA3D.HingeConstraint);this.addClass(SEA3D.ConeTwistConstraint);this.addClass(SEA3D.CarController);this.addClass(SEA3D.JPEG,
!0);this.addClass(SEA3D.JPEG_XR,!0);this.addClass(SEA3D.PNG,!0);this.addClass(SEA3D.GIF,!0);this.addClass(SEA3D.OGG,!0);this.addClass(SEA3D.MP3,!0);this.addClass(SEA3D.JavaScript,!0);this.addClass(SEA3D.JavaScriptMethod,!0);this.addClass(SEA3D.GLSL,!0)};SEA3D.File.CompressionLibs={};SEA3D.File.DecompressionMethod={};SEA3D.File.setDecompressionEngine=function(a,b,c){SEA3D.File.CompressionLibs[a]=b;SEA3D.File.DecompressionMethod[a]=c};
SEA3D.File.prototype.addClass=function(a,b){this.typeClass[a.prototype.type]=a;this.typeUnique[a.prototype.type]=!0===b};
SEA3D.File.prototype.readHead=function(){if(16>this.stream.bytesAvailable)return!1;if("SEA"!=this.stream.readUTF(3))throw Error("Invalid SEA3D format.");this.sign=this.stream.readUTF(3);this.version=this.stream.readUInt24();if(0!=this.stream.readUByte())throw Error("Protection algorithm not compatible.");this.compressionID=this.stream.readUByte();this.compressionAlgorithm=SEA3D.File.CompressionLibs[this.compressionID];this.decompressionMethod=SEA3D.File.DecompressionMethod[this.compressionID];if(0<
this.compressionID&&!this.decompressionMethod)throw Error("Compression algorithm not compatible.");this.length=this.stream.readUInt();this.dataPosition=this.stream.position;this.objects.length=0;this.state=this.readBody;if(this.onHead)this.onHead({file:this,sign:this.sign});return!0};SEA3D.File.prototype.getObject=function(a){return this.objects[a]};
SEA3D.File.prototype.readSEAObject=function(){if(4>this.stream.bytesAvailable)return null;var a=this.stream.readUInt(),b=this.stream.position;if(this.stream.bytesAvailable<a)return null;var c=this.stream.readUByte(),d=this.stream.readExt(),e=null,f=c&1?this.stream.readUTF8():"",g=0!=(c&2),h=0!=(c&4);c&8&&(e=this.stream.readUShort(),c=this.stream.concat(this.stream.position,e),this.stream.position+=e,g&&this.decompressionMethod&&c.set(this.decompressionMethod(c.buffer)),e=c.readProperties(this));a-=
this.stream.position-b;b=this.stream.position;c=this.stream.concat(b,a);this.typeClass[d]?(g&&this.decompressionMethod&&(c.buffer=this.decompressionMethod(c.buffer)),g=new this.typeClass[d](f,c,this),this.streaming&&h&&this.typeRead[d]&&this.typeRead[d].call(this.scope,g)):(g=new SEA3D.Object(f,c,d,this),console.warn('SEA3D: Unknown format "'+d+'" of file "'+f+'". Add a module referring for this format.'));g.streaming=h;g.metadata=e;this.objects.push(this.objects[g.type+"/"+g.name]=g);this.dataPosition=
b+a;++this.position;return g};SEA3D.File.prototype.readBody=function(){for(this.timer.update();this.position<this.length;)if(this.timer.deltaTime<this.timeLimit){this.stream.position=this.dataPosition;var a=this.readSEAObject();if(a)this.dispatchCompleteObject(a);else return!1}else return!1;this.state=this.readComplete;return!0};SEA3D.File.prototype.parse=function(){this.timer=new SEA3D.Timer;this.position=0;setTimeout(this.parseObject.bind(this),10)};
SEA3D.File.prototype.parseObject=function(){for(this.timer.update();this.position<this.length&&this.timer.deltaTime<this.timeLimit;){var a=this.objects[this.position++],b=a.type;this.typeUnique[b]||delete a.tag;a.streaming&&this.typeRead[b]&&void 0==a.tag&&this.typeRead[b].call(this.scope,a)}if(this.position==this.length)if(a=this.timer.elapsedTime,b=a+"ms, "+this.objects.length+" objects",this.onParseComplete)this.onParseComplete({file:this,timeTotal:a,message:b});else console.log("SEA3D Parse Complete:",
b);else{if(this.onParseProgress)this.onParseProgress({file:this,loaded:this.position,total:this.length,progress:this.position/this.length});setTimeout(this.parseObject.bind(this),10)}};SEA3D.File.prototype.readComplete=function(){this.stream.position=this.dataPosition;6202321!=this.stream.readUInt24F()&&console.warn("SEA3D file is corrupted.");delete this.state;this.dispatchComplete()};
SEA3D.File.prototype.readState=function(){for(;this.state&&this.state(););this.state&&(setTimeout(this.readState.bind(this),10),this.dispatchProgress())};SEA3D.File.prototype.read=function(a){this.stream=new SEA3D.Stream(a);this.timer=new SEA3D.Timer;this.state=this.readHead;this.readState()};SEA3D.File.prototype.dispatchCompleteObject=function(a){if(this.onCompleteObject)this.onCompleteObject({file:this,object:a})};
SEA3D.File.prototype.dispatchProgress=function(){if(this.onProgress)this.onProgress({file:this,loaded:this.position,total:this.length,progress:this.position/this.length})};SEA3D.File.prototype.dispatchDownloadProgress=function(a,b){if(this.onDownloadProgress)this.onDownloadProgress({file:this,loaded:a,total:b,progress:a/b})};
SEA3D.File.prototype.dispatchComplete=function(){var a=this.timer.elapsedTime,b=a+"ms, "+this.objects.length+" objects";if(this.onComplete)this.onComplete({file:this,timeTotal:a,message:b});else console.log("SEA3D:",b)};SEA3D.File.prototype.dispatchError=function(a,b){if(this.onError)this.onError({file:this,id:a,message:b});else console.error("SEA3D: #"+a,b)};
SEA3D.File.prototype.load=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onprogress=function(a){a.lengthComputable&&b.dispatchDownloadProgress(a.loaded,a.total)};c.onreadystatechange=function(){2!==c.readyState&&3!==c.readyState&&4===c.readyState&&(200===c.status||0===c.status?b.read(this.response):this.dispatchError(1001,"Couldn't load ["+a+"] ["+c.status+"]"))};c.send()};SEA3D.EventDispatcher=function(){};
SEA3D.EventDispatcher.prototype={constructor:SEA3D.EventDispatcher,addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,
1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};SEA3D.EventDispatcher.apply=function(a){a.addEventListener=SEA3D.EventDispatcher.prototype.addEvenListener;a.hasEventListener=SEA3D.EventDispatcher.prototype.hasEventListener;a.removeEventListener=SEA3D.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=SEA3D.EventDispatcher.prototype.dispatchEvent};THREE.SEA3D=function(a){this.config=a||{};void 0==this.config.script&&(this.config.script=!0);void 0==this.config.autoPlay&&(this.config.autoPlay=!1);void 0==this.config.multiplier&&(this.config.multiplier=1);void 0==this.config.bounding&&(this.config.bounding=!0);void 0==this.config.standardMaterial&&(this.config.standardMaterial=!0);void 0==this.config.audioRolloffFactor&&(this.config.audioRolloffFactor=10);void 0==this.config.timeLimit&&(this.config.timeLimit=10);void 0==this.config.streaming&&
(this.config.streaming=!0);void 0==this.config.lights&&(this.config.lights=!0);void 0==this.config.useVertexTexture&&(this.config.useVertexTexture=!0)};
THREE.SEA3D.prototype={constructor:THREE.SEA3D,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,set container(a){this.config.container=a},get container(){return this.config.container}};THREE.SEA3D.BACKGROUND_COLOR=3355443;THREE.SEA3D.HELPER_COLOR=10140133;THREE.SEA3D.RTT_SIZE=512;
THREE.SEA3D.ShaderLib={};THREE.SEA3D.ShaderLib.replaceCode=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d],f=c[d],g=a.indexOf(e);-1<g&&(a=a.substring(0,g)+f+a.substring(g+e.length))}return a};
THREE.SEA3D.ShaderLib.fragStdMtl=THREE.SEA3D.ShaderLib.replaceCode(THREE.ShaderLib.phong.fragmentShader,["vec3 outgoingLight = ( reflectedLight.directDiffuse + reflectedLight.indirectDiffuse ) * specular + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;"],["vec3 outgoingLight = ( reflectedLight.directDiffuse + reflectedLight.indirectDiffuse ) * specular + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight * specular;",
"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight * diffuse;"]);THREE.SEA3D.StandardMaterial=function(){THREE.MeshPhongMaterial.call(this)};THREE.SEA3D.StandardMaterial.prototype=Object.create(THREE.MeshPhongMaterial.prototype);THREE.SEA3D.StandardMaterial.prototype.constructor=THREE.SEA3D.StandardMaterial;THREE.SEA3D.StandardMaterial.prototype.lightMapUV=1;
THREE.SEA3D.StandardMaterial.prototype.__defineSetter__("__webglShader",function(a){a.fragmentShader=THREE.SEA3D.ShaderLib.fragStdMtl;0==this.lightMapUV&&(a.fragmentShader=THREE.SEA3D.ShaderLib.replaceCode(a.fragmentShader,"texture2D( aoMap, vUv2 )","texture2D( aoMap, vUv )"));this.__webglShader__=a});THREE.SEA3D.StandardMaterial.prototype.__defineGetter__("__webglShader",function(){return this.__webglShader__});
THREE.SEA3D.StandardMaterial.prototype.copy=function(a){THREE.MeshPhongMaterial.prototype.copy.call(this,a);return this};THREE.SEA3D.StandardMaterial.prototype.clone=function(){return(new this.constructor).copy(this)};THREE.SEA3D.Object3D=function(){THREE.Object3D.call(this)};THREE.SEA3D.Object3D.prototype=Object.create(THREE.Object3D.prototype);THREE.SEA3D.Object3D.prototype.constructor=THREE.SEA3D.Object3D;
THREE.SEA3D.Object3D.prototype.updateAnimateMatrix=function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.animateMatrix.compose(this.animatePosition,this.animateQuaternion,this.animateScale),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.animateMatrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<
c;b++)this.children[b].updateMatrixWorld(a)};
THREE.SEA3D.Object3D.prototype.setAnimateMatrix=function(a){this.getAnimateMatrix()!=a&&(a?(this.animateMatrix=new THREE.Matrix4,this.animatePosition=new THREE.Vector3,this.animateQuaternion=new THREE.Quaternion,this.animateScale=new THREE.Vector3(1,1,1),this.updateMatrixWorld=THREE.SEA3D.Object3D.prototype.updateAnimateMatrix):(delete this.animateMatrix,delete this.animatePosition,delete this.animateQuaternion,delete this.animateScale,this.updateMatrixWorld=THREE.Object3D.prototype.updateMatrixWorld),
this.matrixWorldNeedsUpdate=!0)};THREE.SEA3D.Object3D.prototype.getAnimateMatrix=function(){return void 0!=this.animateMatrix};THREE.SEA3D.Dummy=function(a,b,c){this.width=void 0!=a?a:100;this.height=void 0!=b?b:100;this.depth=void 0!=c?c:100;a=new THREE.BoxGeometry(this.width,this.height,this.depth,1,1,1);THREE.Mesh.call(this,a,THREE.SEA3D.Dummy.MATERIAL)};THREE.SEA3D.Dummy.prototype=Object.create(THREE.Mesh.prototype);THREE.SEA3D.Dummy.prototype.constructor=THREE.Dummy;
THREE.SEA3D.Dummy.prototype.setAnimateMatrix=THREE.SEA3D.Object3D.prototype.setAnimateMatrix;THREE.SEA3D.Dummy.prototype.getAnimateMatrix=THREE.SEA3D.Object3D.prototype.getAnimateMatrix;THREE.SEA3D.Dummy.MATERIAL=new THREE.MeshBasicMaterial({wireframe:!0,color:THREE.SEA3D.HELPER_COLOR});THREE.SEA3D.Dummy.prototype.clone=function(a){return(new this.constructor(this.width,this.height,this.depth)).copy(this)};THREE.SEA3D.Dummy.prototype.dispose=function(){this.geometry.dispose()};
THREE.SEA3D.Mesh=function(a,b){THREE.Mesh.call(this,a,b)};THREE.SEA3D.Mesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SEA3D.Mesh.prototype.constructor=THREE.Mesh;THREE.SEA3D.Mesh.prototype.setAnimateMatrix=THREE.SEA3D.Object3D.prototype.setAnimateMatrix;THREE.SEA3D.Mesh.prototype.getAnimateMatrix=THREE.SEA3D.Object3D.prototype.getAnimateMatrix;THREE.SEA3D.Mesh.prototype.setWeight=function(a,b){this.morphTargetInfluences[this.morphTargetDictionary[a]]=b};
THREE.SEA3D.Mesh.prototype.getWeight=function(a){return this.morphTargetInfluences[this.morphTargetDictionary[a]]};THREE.SEA3D.Mesh.prototype.copy=function(a){THREE.Mesh.prototype.copy.call(this,a);this.animation&&(this.animation=a.animation.clone(this));return this};THREE.SEA3D.Mesh.prototype.clone=function(a){return(new this.constructor(this.geometry,this.material)).copy(this)};THREE.SEA3D.SkinnedMesh=function(a,b,c){THREE.SkinnedMesh.call(this,a,b,c)};THREE.SEA3D.SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype);
THREE.SEA3D.SkinnedMesh.prototype.constructor=THREE.SEA3D.SkinnedMesh;THREE.SEA3D.SkinnedMesh.prototype.setAnimateMatrix=THREE.SEA3D.Object3D.prototype.setAnimateMatrix;THREE.SEA3D.SkinnedMesh.prototype.getAnimateMatrix=THREE.SEA3D.Object3D.prototype.getAnimateMatrix;THREE.SEA3D.SkinnedMesh.prototype.setWeight=THREE.SEA3D.Mesh.prototype.setWeight;THREE.SEA3D.SkinnedMesh.prototype.getWeight=THREE.SEA3D.Mesh.prototype.getWeight;THREE.SEA3D.SkinnedMesh.prototype.isPlaying=!1;
THREE.SEA3D.SkinnedMesh.prototype.stop=function(){this.currentAnimation&&(this.currentAnimation.stop(),delete this.currentAnimation,this.isPlaying=!1)};THREE.SEA3D.SkinnedMesh.prototype.pause=function(){this.isPlaying&&(this.currentAnimation.pause(),this.isPlaying=!1)};THREE.SEA3D.SkinnedMesh.prototype.resume=function(){!this.isPlaying&&this.currentAnimation&&(this.currentAnimation.pause(),this.isPlaying=!0)};
THREE.SEA3D.SkinnedMesh.prototype.play=function(a,b,c){var d=this.animations[a];if(!d)throw Error('Animation "'+a+'" not found.');d.play(void 0!==c?c:d.currentTime,d.weight);this.currentAnimation=d;this.isPlaying=!0;THREE.SEA3D.AnimationHandler.addCrossfade(this,void 0!==b?b:0)};
THREE.SEA3D.SkinnedMesh.prototype.setAnimations=function(a){var b=a[0].name.indexOf("/")+1;this.animations=[];this.easeSpeed=2;this.blendMethod=SEA3D.AnimationBlendMethod.LINEAR;this.animationNamespace=a[0].name.substring(0,b);for(var c=0;c<a.length;c++){var d=a[c].name.substring(b);this.animations[c]=new THREE.SEA3D.Animation(this,a[c]);this.animations[c].loop=a[c].repeat;this.animations[c].name=d;this.animations[d]=this.animations[c]}};
THREE.SEA3D.SkinnedMesh.prototype.boneByName=function(a){for(var b=this.skeleton.bones,c=0,d=b.length;c<d;c++)if(a==b[c].name)return b[c]};THREE.SEA3D.SkinnedMesh.prototype.copy=function(a){THREE.SkinnedMesh.prototype.copy.call(this,a);this.animation&&(this.animation=a.animation.clone(this));this.geometry.animations&&this.setAnimations(this.geometry.animations);return this};THREE.SEA3D.SkinnedMesh.prototype.clone=function(a){return(new this.constructor(this.geometry,this.material,this.useVertexTexture)).copy(this)};
THREE.SEA3D.VertexAnimationMesh=function(a,b,c){THREE.MorphAnimMesh.call(this,a,b);this.fps=void 0!==c?c:30;this.animations=a.animations;this.isPlaying=!1;this.totalTime=0;this.playingCallback=this.updateAnimation.bind(this)};THREE.SEA3D.VertexAnimationMesh.prototype=Object.create(THREE.MorphAnimMesh.prototype);THREE.SEA3D.VertexAnimationMesh.prototype.constructor=THREE.SEA3D.VertexAnimationMesh;THREE.SEA3D.VertexAnimationMesh.prototype.setAnimateMatrix=THREE.SEA3D.Object3D.prototype.setAnimateMatrix;
THREE.SEA3D.VertexAnimationMesh.prototype.getAnimateMatrix=THREE.SEA3D.Object3D.prototype.getAnimateMatrix;THREE.SEA3D.VertexAnimationMesh.prototype.play=function(a,b){var c=this.animations[a];this.setFrameRange(c.start?c.start:1,c.end-1);this.duration=(c.end-c.start)/this.fps;this.time=void 0!==b?b:this.time;this.resume()};THREE.SEA3D.VertexAnimationMesh.prototype.pause=function(){this.isPlaying&&(this.isPlaying=!1,THREE.SEA3D.AnimationHandler.removeUpdate(this.playingCallback))};
THREE.SEA3D.VertexAnimationMesh.prototype.resume=function(){this.isPlaying||(this.isPlaying=!0,THREE.SEA3D.AnimationHandler.addUpdate(this.playingCallback))};THREE.SEA3D.VertexAnimationMesh.prototype.stop=function(){this.pause();this.time=0};THREE.SEA3D.VertexAnimationMesh.prototype.clone=function(a){return(new this.constructor(this.geometry,this.material,this.fps)).copy(this)};THREE.SEA3D.Camera=function(a,b,c,d){THREE.PerspectiveCamera.call(this,a,b,c,d)};THREE.SEA3D.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);
THREE.SEA3D.Camera.prototype.constructor=THREE.SEA3D.Camera;THREE.SEA3D.Camera.prototype.setAnimateMatrix=THREE.SEA3D.Object3D.prototype.setAnimateMatrix;THREE.SEA3D.Camera.prototype.getAnimateMatrix=THREE.SEA3D.Object3D.prototype.getAnimateMatrix;THREE.SEA3D.Camera.prototype.copy=function(a){THREE.PerspectiveCamera.prototype.copy.call(this,a);return this};
THREE.SEA3D.AnimationHandler={crossfade:[],updates:[],update:function(a){var b,c=THREE.SEA3D.AnimationHandler.crossfade,d=THREE.SEA3D.AnimationHandler.updates;for(b=0;b<c.length;){var e=c[b],f=e.animations.length,g=1,h=Math.abs(a)/e.crossfade;for(e.blendMethod===SEA3D.AnimationBlendMethod.EASING&&(h*=e.easeSpeed);f;){var k=e.animations[--f];0<k.weight&&k!=e.currentAnimation&&(e.blendMethod===SEA3D.AnimationBlendMethod.LINEAR?k.weight-=h:e.blendMethod===SEA3D.AnimationBlendMethod.EASING&&(k.weight-=
k.weight*h),0>k.weight&&(k.weight=0),g-=k.weight)}0>g&&(g=0);e.currentAnimation.weight=g;if(1==g){if(c.splice(b,1),delete e.crossfade,e.onCrossfadeComplete)e.onCrossfadeComplete(e)}else++b}for(b=0;b<d.length;)d[b++](a);SEA3D.AnimationHandler.update(a)},addCrossfade:function(a,b){var c=THREE.SEA3D.AnimationHandler.crossfade;if(0<b)a.crossfade||c.push(a),a.crossfade=b;else{for(var d=a.animations.length;d;)a.animations[--d].weight=0;if(a.crossfade&&(c.splice(c.indexOf(a),1),delete a.crossfade,a.onCrossfadeComplete))a.onCrossfadeComplete(a);
a.currentAnimation.weight=1}},addUpdate:function(a){THREE.SEA3D.AnimationHandler.updates.push(a)},removeUpdate:function(a){-1!==THREE.SEA3D.AnimationHandler.updates.indexOf(a)&&THREE.SEA3D.AnimationHandler.updates.splice(THREE.SEA3D.AnimationHandler.updates.indexOf(a),1)}};THREE.SEA3D.Animation=function(a,b){THREE.Animation.call(this,a,b)};THREE.SEA3D.Animation.prototype=Object.create(THREE.Animation.prototype);THREE.SEA3D.Animation.prototype.constructor=THREE.SEA3D.Animation;
THREE.SEA3D.Animation.prototype.stop=function(){if(this.onComplete)this.onComplete(this);THREE.Animation.prototype.stop.call(this)};THREE.SEA3D.Animation.prototype.reset=function(){if(this.onReset)this.onReset(this);THREE.Animation.prototype.reset.call(this)};THREE.SEA3D.MTXBUF=new THREE.Matrix4;THREE.SEA3D.VECBUF=new THREE.Vector3;THREE.SEA3D.QUABUF=new THREE.Quaternion;
THREE.SEA3D.prototype.setShadowMap=function(a,b){a.shadowMapWidth=a.shadowMapHeight=2048;a.castShadow=!0;a.shadowDarkness=void 0==b?1:b};THREE.SEA3D.prototype.getMesh=function(a){return this.objects["m3d/"+a]};THREE.SEA3D.prototype.getDummy=function(a){return this.objects["dmy/"+a]};THREE.SEA3D.prototype.getLine=function(a){return this.objects["line/"+a]};THREE.SEA3D.prototype.getSound3D=function(a){return this.objects["sn3d/"+a]};
THREE.SEA3D.prototype.getMaterial=function(a){return this.objects["mat/"+a]};THREE.SEA3D.prototype.getLight=function(a){return this.objects["lht/"+a]};THREE.SEA3D.prototype.getGLSL=function(a){return this.objects["glsl/"+a]};THREE.SEA3D.prototype.getCamera=function(a){return this.objects["cam/"+a]};THREE.SEA3D.prototype.getTexture=function(a){return this.objects["tex/"+a]};THREE.SEA3D.prototype.getCubeMap=function(a){return this.objects["cmap/"+a]};
THREE.SEA3D.prototype.getJointObject=function(a){return this.objects["jnt/"+a]};THREE.SEA3D.prototype.getContainer3D=function(a){return this.objects["c3d/"+a]};THREE.SEA3D.prototype.getSprite=function(a){return this.objects["m2d/"+a]};THREE.SEA3D.prototype.getProperty=function(a){return this.objects["prop/"+a]};THREE.SEA3D.prototype.isPowerOfTwo=function(a){return a?(a&-a)==a:!1};THREE.SEA3D.prototype.nearestPowerOfTwo=function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))};
THREE.SEA3D.prototype.updateTransform=function(a,b){var c=THREE.SEA3D.MTXBUF,d=THREE.SEA3D.VECBUF;b.transform?c.elements.set(b.transform):c.makeTranslation(b.position.x,b.position.y,b.position.z);a.position.setFromMatrixPosition(c);a.scale.setFromMatrixScale(c);c.scale(d.set(1/a.scale.x,1/a.scale.y,1/a.scale.z));a.rotation.setFromRotationMatrix(c);b.isStatic&&(a.updateMatrixWorld(),a.matrixAutoUpdate=!1)};THREE.SEA3D.prototype.toVector3=function(a){return new THREE.Vector3(a.x,a.y,a.z)};
THREE.SEA3D.prototype.scaleColor=function(a,b){return(a>>16)*b<<16|(a>>8&255)*b<<8|(a&255)*b};THREE.SEA3D.prototype.updateScene=function(){if(void 0!=this.materials)for(var a=0,b=this.materials.length;a<b;++a)this.materials[a].needsUpdate=!0};THREE.SEA3D.prototype.addSceneObject=function(a){var b=a.tag;b.userData=a.properties;this.config.script&&a.scripts&&this.runJSMList(b,a.scripts);a.parent?a.parent.tag.add(b):this.config.container&&this.config.container.add(b);b.visible=a.visible};
THREE.SEA3D.prototype.createObjectURL=function(a,b){return(window.URL||window.webkitURL).createObjectURL(new Blob([a],{type:b}))};THREE.SEA3D.prototype.bufferToTexture=function(a){return this.createObjectURL(a,"image")};THREE.SEA3D.prototype.bufferToSound=function(a){return this.createObjectURL(a,"audio")};
THREE.SEA3D.prototype.applyDefaultAnimation=function(a,b){for(var c=a.tag,d=0,e=a.animations?a.animations.length:0;d<e;d++){var f=a.animations[d];switch(f.tag.type){case SEA3D.Animation.prototype.type:return c.animation=new b(c,f.tag.tag),c.animation.setRelative(f.relative),this.config.autoPlay&&c.animation.play(c.animation.getStateNameByIndex(0)),c.animation}}};
THREE.SEA3D.prototype.readAnimation=function(a){for(var b=new SEA3D.AnimationSet,c=0;c<a.sequence.length;c++){for(var d=a.sequence[c],e=new SEA3D.AnimationNode(d.name,a.frameRate,d.count,d.repeat,d.intrpl),f=0;f<a.dataList.length;f++){var g=a.dataList[f];e.addData(new SEA3D.AnimationData(g.kind,g.type,g.data,d.start*g.blockSize))}b.addAnimation(e)}this.domain.animationSets=this.animationSets=this.animationSets||[];this.animationSets.push(this.objects[a.name+".#anm"]=a.tag=b)};
THREE.SEA3D.Object3DAnimator=function(a,b){SEA3D.AnimationHandler.call(this,b);this.object3d=a};THREE.SEA3D.Object3DAnimator.prototype=Object.create(SEA3D.AnimationHandler.prototype);THREE.SEA3D.Object3DAnimator.prototype.constructor=THREE.SEA3D.Object3DAnimator;THREE.SEA3D.Object3DAnimator.prototype.stop=function(){this.relative&&(this.object3d.animatePosition=new THREE.Vector3,this.object3d.animateQuaternion=new THREE.Quaternion,this.object3d.animateScale=new THREE.Vector3(1,1,1));SEA3D.AnimationHandler.prototype.stop.call(this)};
THREE.SEA3D.Object3DAnimator.prototype.setRelative=function(a){this.object3d.setAnimateMatrix(this.relative=a)};
THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame=function(a,b){if(this.relative){switch(b){case SEA3D.Animation.POSITION:var c=a.toVector();this.object3d.animatePosition.set(c.x,c.y,c.z);break;case SEA3D.Animation.ROTATION:c=a.toVector();this.object3d.animateQuaternion.set(c.x,c.y,c.z,c.w);break;case SEA3D.Animation.SCALE:c=a.toVector(),this.object3d.animateScale.set(c.x,c.y,c.z)}this.object3d.matrixWorldNeedsUpdate=!0}else switch(b){case SEA3D.Animation.POSITION:c=a.toVector();this.object3d.position.set(c.x,
c.y,c.z);break;case SEA3D.Animation.ROTATION:c=a.toVector();this.object3d.quaternion.set(c.x,c.y,c.z,c.w);break;case SEA3D.Animation.SCALE:c=a.toVector(),this.object3d.scale.set(c.x,c.y,c.z)}};THREE.SEA3D.CameraAnimator=function(a,b){THREE.SEA3D.Object3DAnimator.call(this,a,b)};THREE.SEA3D.CameraAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype);THREE.SEA3D.CameraAnimator.prototype.constructor=THREE.SEA3D.Object3DAnimator;
THREE.SEA3D.CameraAnimator.prototype.updateAnimationFrame=function(a,b){switch(b){case SEA3D.Animation.FOV:this.object3d.fov=a.getX();break;default:THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame.call(this,a,b)}};THREE.SEA3D.LightAnimator=function(a,b){THREE.SEA3D.Object3DAnimator.call(this,a,b)};THREE.SEA3D.LightAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype);THREE.SEA3D.LightAnimator.prototype.constructor=THREE.SEA3D.Object3DAnimator;
THREE.SEA3D.LightAnimator.prototype.updateAnimationFrame=function(a,b){switch(b){case SEA3D.Animation.COLOR:this.object3d.color.setHex(a.getX());break;case SEA3D.Animation.MULTIPLIER:this.object3d.intensity=a.getX();break;default:THREE.SEA3D.Object3DAnimator.prototype.updateAnimationFrame.call(this,a,b)}};
THREE.SEA3D.prototype.readGeometryBuffer=function(a){for(var b=new THREE.BufferGeometry,c=0;c<a.groups.length;c++){var d=a.groups[c];b.addGroup(d.start,d.count,c)}b.setIndex(new THREE.BufferAttribute(a.indexes,1));b.addAttribute("position",new THREE.BufferAttribute(a.vertex,3));a.uv&&(b.addAttribute("uv",new THREE.BufferAttribute(a.uv[0],2)),1<a.uv.length&&b.addAttribute("uv2",new THREE.BufferAttribute(a.uv[1],2)));a.normal?b.addAttribute("normal",new THREE.BufferAttribute(a.normal,3)):b.computeVertexNormals();
a.tangent4&&b.addAttribute("tangent",new THREE.BufferAttribute(a.tangent4,4));a.color&&b.addAttribute("color",new THREE.BufferAttribute(a.color[0],a.numColor));a.joint&&(b.addAttribute("skinIndex",new THREE.Float32Attribute(a.joint,a.jointPerVertex)),b.addAttribute("skinWeight",new THREE.Float32Attribute(a.weight,a.jointPerVertex)));this.config.bounding&&(b.computeBoundingBox(),b.computeBoundingSphere());b.name=a.name;this.domain.geometries=this.geometries=this.geometries||[];this.geometries.push(this.objects["geo/"+
a.name]=a.tag=b)};THREE.SEA3D.prototype.readDummy=function(a){var b=new THREE.SEA3D.Dummy(a.width,a.height,a.depth);b.name=a.name;this.domain.dummys=this.dummys=this.dummys||[];this.dummys.push(this.objects["dmy/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};
THREE.SEA3D.prototype.readLine=function(a){var b=new THREE.BufferGeometry;a.closed&&a.vertex.push(a.vertex[0],a.vertex[1],a.vertex[2]);b.addAttribute("position",new THREE.BufferAttribute(new Float32Array(a.vertex),3));b=new THREE.Line(b,new THREE.LineBasicMaterial({color:THREE.SEA3D.HELPER_COLOR,linewidth:3}));b.name=a.name;this.lines=this.lines||[];this.lines.push(this.objects["line/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};
THREE.SEA3D.prototype.readContainer3D=function(a){var b=new THREE.SEA3D.Object3D;this.domain.containers=this.containers=this.containers||[];this.containers.push(this.objects["c3d/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};
THREE.SEA3D.prototype.readMesh2D=function(a){var b;a.material&&(a.material.tag.sprite?b=a.material.tag.sprite:(b=a.material.tag.sprite=new THREE.SpriteMaterial,b.map=a.material.tag.map,b.map.flipY=!0,b.color=a.material.tag.emissive,b.opacity=a.material.tag.opacity,b.blending=a.material.tag.blending));b=new THREE.Sprite(b);b.name=a.name;this.domain.sprites=this.sprites=this.sprites||[];this.sprites.push(this.objects["m2d/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);b.scale.set(a.width,
a.height,1)};
THREE.SEA3D.prototype.readMesh=function(a){var b,c,d=a.geometry.tag,e,f,g,h,k;b=0;for(c=a.modifiers?a.modifiers.length:0;b<c;b++){var m=a.modifiers[b];switch(m.type){case SEA3D.Skeleton.prototype.type:case SEA3D.SkeletonLocal.prototype.type:f=m;d.bones=f.tag;break;case SEA3D.Morph.prototype.type:k=m,d.morphAttributes=k.tag.attribs,d.morphTargets=k.tag.targets}}b=0;for(c=a.animations?a.animations.length:0;b<c;b++)switch(m=a.animations[b],m.tag.type){case SEA3D.SkeletonAnimation.prototype.type:g=m.tag;
d.animations=this.getSkeletonAnimation(g,f);break;case SEA3D.VertexAnimation.prototype.type:h=m.tag,d.morphAttributes=h.tag.attribs,d.morphTargets=h.tag.targets,d.animations=h.tag.animations}c=void 0!=k||void 0!=h;k=k&&void 0!=k.tag.attribs.normal||h&&void 0!=h.tag.attribs.normal;if(a.material)if(1<a.material.length){e=[];for(b=0;b<a.material.length;b++)e[b]=a.material[b].tag,e[b].skinning=void 0!=f,e[b].morphTargets=c,e[b].morphNormals=k,e[b].vertexColors=a.geometry.color?THREE.VertexColors:THREE.NoColors;
e=new THREE.MultiMaterial(e)}else e=a.material[0].tag,e.skinning=void 0!=f,e.morphTargets=c,e.morphNormals=k,e.vertexColors=a.geometry.color?THREE.VertexColors:THREE.NoColors;f?(b=new THREE.SEA3D.SkinnedMesh(d,e,this.config.useVertexTexture),g&&(b.setAnimations(d.animations),this.config.autoPlay&&b.play(b.animations[0].name))):h?(b=new THREE.SEA3D.VertexAnimationMesh(d,e,h.frameRate),this.config.autoPlay&&b.play(b.animations[0].name)):b=new THREE.SEA3D.Mesh(d,e);b.name=a.name;b.castShadow=a.castShadows;
b.receiveShadow=a.material?a.material[0].receiveShadows:!0;this.domain.meshes=this.meshes=this.meshes||[];this.meshes.push(this.objects["m3d/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};
THREE.SEA3D.prototype.readSoundPoint=function(a){this.audioListener||(this.audioListener=new THREE.AudioListener,this.config.container&&this.config.container.add(this.audioListener));var b=new THREE.PositionalAudio(this.audioListener);b.load(a.sound.tag);b.autoplay=a.autoPlay;b.setLoop(a.autoPlay);b.setVolume(a.volume);b.setRefDistance(a.distance);b.setRolloffFactor(this.config.audioRolloffFactor);b.name=a.name;this.domain.sounds3d=this.sounds3d=this.sounds3d||[];this.sounds3d.push(this.objects["sn3d/"+
a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};THREE.SEA3D.prototype.readCubeRender=function(a){var b=new THREE.CubeCamera(0.1,5E3,THREE.SEA3D.RTT_SIZE);b.renderTarget.cubeCamera=b;this.domain.cubeRenderers=this.cubeRenderers=this.cubeRenderers||[];this.cubeRenderers.push(this.objects["rttc/"+a.name]=a.tag=b.renderTarget);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)};
THREE.SEA3D.prototype.readImage=function(a){var b=new Image,c=new THREE.Texture;b.src=this.bufferToTexture(a.data.buffer);c.name=a.name;c.wrapS=c.wrapT=THREE.RepeatWrapping;c.flipY=!1;c.image=b;c.needsUpdate=!0;this.domain.textures=this.textures=this.textures||[];this.textures.push(this.objects["tex/"+a.name]=a.tag=c)};
THREE.SEA3D.prototype.readCubeMap=function(a){var b=[],c=new THREE.Texture,d=[];d[0]=a.faces[1];d[1]=a.faces[0];d[2]=a.faces[3];d[3]=a.faces[2];d[4]=a.faces[5];d[5]=a.faces[4];b.loadedCount=0;c.name=a.name;c.image=b;c.flipY=!1;for(var e=0,f=d.length;e<f;++e){var g=new Image;b[e]=g;g.onload=function(){6==++b.loadedCount&&(c.needsUpdate=!0)};g.src=this.bufferToTexture(d[e].buffer)}this.domain.cubemaps=this.cubemaps=this.cubemaps||[];this.cubemaps.push(this.objects["cmap/"+a.name]=a.tag=c)};
THREE.SEA3D.prototype.readSound=function(a){var b=this.bufferToSound(a.data.buffer);this.domain.sounds=this.sounds=this.sounds||[];this.sounds.push(this.objects["snd/"+a.name]=a.tag=b)};THREE.SEA3D.prototype.readTextureURL=function(a){var b=(new THREE.TextureLoader).load(a.url);b.name=a.name;b.wrapS=b.wrapT=THREE.RepeatWrapping;b.flipY=!1;this.domain.textures=this.textures=this.textures||[];this.textures.push(this.objects["tex/"+a.name]=a.tag=b)};THREE.SEA3D.SCRIPT=new SEA3D.ScriptManager;
THREE.SEA3D.SCRIPT.dispatchUpdate=function(a){this.dispatchEvent({type:"update",delta:a})};THREE.SEA3D.Domain=function(a,b,c,d){SEA3D.Domain.call(this,a);this.objects=b;this.container=c;this.extensions=d||[]};THREE.SEA3D.Domain.prototype=Object.create(SEA3D.Domain.prototype);THREE.SEA3D.Domain.prototype.constructor=THREE.SEA3D.Domain;THREE.SEA3D.Domain.prototype.disposeExtensions=function(){extensions=extensions.concat();for(var a=list.length;a--;)list[a].dispose()};
THREE.SEA3D.Domain.prototype.disposeList=function(a){if(a&&a.length){a=a.concat();for(var b=a.length;b--;)a[b].dispose()}};THREE.SEA3D.Domain.prototype.dispose=function(){for(SEA3D.Domain.prototype.dispose.call(this);this.container.children.length;)this.container.remove(this.container.children[0]);for(var a=this.extensions.length;a--;)this.extensions[a].dispose.call(this);this.disposeList(this.materials);this.disposeList(this.dummys)};SEA3D.Domain.prototype.getMesh=THREE.SEA3D.prototype.getMesh;
SEA3D.Domain.prototype.getDummy=THREE.SEA3D.prototype.getDummy;SEA3D.Domain.prototype.getLine=THREE.SEA3D.prototype.getLine;SEA3D.Domain.prototype.getSound3D=THREE.SEA3D.prototype.getSound3D;SEA3D.Domain.prototype.getMaterial=THREE.SEA3D.prototype.getMaterial;SEA3D.Domain.prototype.getLight=THREE.SEA3D.prototype.getLight;SEA3D.Domain.prototype.getGLSL=THREE.SEA3D.prototype.getGLSL;SEA3D.Domain.prototype.getCamera=THREE.SEA3D.prototype.getCamera;SEA3D.Domain.prototype.getTexture=THREE.SEA3D.prototype.getTexture;
SEA3D.Domain.prototype.getCubeMap=THREE.SEA3D.prototype.getCubeMap;SEA3D.Domain.prototype.getJointObject=THREE.SEA3D.prototype.getJointObject;SEA3D.Domain.prototype.getContainer3D=THREE.SEA3D.prototype.getContainer3D;SEA3D.Domain.prototype.getSprite=THREE.SEA3D.prototype.getSprite;SEA3D.Domain.prototype.getProperty=THREE.SEA3D.prototype.getProperty;THREE.SEA3D.DomainManager=function(a){SEA3D.DomainManager.call(this,a)};THREE.SEA3D.DomainManager.prototype=Object.create(SEA3D.DomainManager.prototype);
THREE.SEA3D.DomainManager.prototype.constructor=THREE.SEA3D.DomainManager;THREE.SEA3D.DomainManager.prototype.add=function(a){SEA3D.DomainManager.prototype.add.call(this,a);this.textures=this.textures||a.textures;this.cubemaps=this.cubemaps||a.cubemaps;this.geometries=this.geometries||a.geometries};THREE.SEA3D.DomainManager.prototype.disposeList=THREE.SEA3D.Domain.prototype.disposeList;
THREE.SEA3D.DomainManager.prototype.dispose=function(){SEA3D.DomainManager.prototype.dispose.call(this);this.disposeList(this.textures);this.disposeList(this.cubemaps);this.disposeList(this.geometries)};THREE.SEA3D.prototype.runJSMList=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];e.tag.type==SEA3D.JavaScriptMethod.prototype.type&&this.runJSM(a,e,c)}};
THREE.SEA3D.prototype.runJSM=function(a,b,c){void 0==a.local&&(a.local={});c={print:this.domain.print,watch:this.domain.watch,sea3d:this.domain,scene:this.config.container,source:new SEA3D.Script(this.domain,!0==c)};Object.freeze(c.source);THREE.SEA3D.SCRIPT.add(c.source);try{this.script[b.method](c,this.domain.getReference,this.domain.global,a.local,a,b.params)}catch(d){console.error('SEA3D JavaScript: Error running method "'+b.method+'".'),console.error(d)}};
THREE.SEA3D.prototype.readJavaScriptMethod=function(a){try{var b="(function() {\nvar $METHOD = {}\n",c='function($INC, $REF, global, local, $his, $PARAM) {\nvar watch = $INC["watch"],\nscene = $INC["scene"],\nsea3d = $INC["sea3d"],\nprint = $INC["print"];\n',c=c+'var $SRC = $INC["source"],\naddEvent = $SRC.addEvent.bind( $SRC ),\nhasEvent = $SRC.hasEvent.bind( $SRC ),\ndispatchEvent = $SRC.dispatchEvent.bind( $SRC ),\nremoveEvent = $SRC.removeEvent.bind( $SRC ),\ndispose = $SRC.dispose.bind( $SRC );\n',
d;for(d in a.methods)b+='$METHOD["'+d+'"] = '+c+a.methods[d].src+"}\n";this.script=eval(b+"return $METHOD; })")()}catch(e){console.error('SEA3D JavaScriptMethod: Error running "'+a.name+'".'),console.error(e)}};THREE.SEA3D.prototype.readGLSL=function(a){this.domain.glsl=this.glsl=this.glsl||[];this.glsl.push(this.objects["glsl/"+a.name]=a.tag=a.src)};
THREE.SEA3D.prototype.blendMode={normal:THREE.NormalBlending,add:THREE.AdditiveBlending,subtract:THREE.SubtractiveBlending,multiply:THREE.MultiplyBlending,screen:THREE.AdditiveBlending};
THREE.SEA3D.prototype.materialTechnique=function(){var a={};a[SEA3D.Material.DEFAULT]=function(a,c){c.emissive.setHex(a.ambientColor);c.color.setHex(a.diffuseColor);c.specular.setHex(this.scaleColor(a.specularColor,a.specular));c.shininess=a.gloss};a[SEA3D.Material.DIFFUSE_MAP]=function(a,c){c.map=a.texture.tag;c.transparent=a.texture.transparent;c.color.setHex(16777215)};a[SEA3D.Material.SPECULAR_MAP]=function(a,c){c.specularMap=a.texture.tag};a[SEA3D.Material.NORMAL_MAP]=function(a,c){c.normalMap=
a.texture.tag};a[SEA3D.Material.REFLECTION]=a[SEA3D.Material.FRESNEL_REFLECTION]=function(a,c){c.envMap=a.texture.tag;c.envMap.mapping=THREE.CubeReflectionMapping;c.combine=THREE.MixOperation;c.reflectivity=a.alpha};a[SEA3D.Material.REFLECTION_SPHERICAL]=function(a,c){c.envMap=a.texture.tag;c.envMap.mapping=THREE.SphericalReflectionMapping;c.combine=THREE.MixOperation;c.reflectivity=a.alpha};a[SEA3D.Material.REFRACTION_MAP]=function(a,c){c.envMap=a.texture.tag;c.envMap.mapping=THREE.CubeRefractionMapping();
c.refractionRatio=a.ior;c.reflectivity=a.alpha};a[SEA3D.Material.LIGHT_MAP]=function(a,c){"multiply"==a.blendMode?c.aoMap=a.texture.tag:c.lightMap=a.texture.tag;c.lightMapUV=a.channel};return a}();
THREE.SEA3D.prototype.readMaterial=function(a){var b=this.config.standardMaterial?new THREE.SEA3D.StandardMaterial:new THREE.MeshPhongMaterial;b.emissiveToAmbientColor=this.config.ambientColor;b.name=a.name;b.side=a.bothSides?THREE.DoubleSide:THREE.FrontSide;b.shading=a.smooth?THREE.SmoothShading:THREE.FlatShading;"normal"!=a.blendMode&&this.blendMode[a.blendMode]&&(b.blending=this.blendMode[a.blendMode]);if(1>a.alpha||b.blending>THREE.NormalBlending)b.opacity=a.alpha,b.transparent=!0;for(var c=0;c<
a.technique.length;c++){var d=a.technique[c];this.materialTechnique[d.kind]&&this.materialTechnique[d.kind].call(this,d,b)}b.transparent&&(b.alphaTest=a.alphaThreshold);this.domain.materials=this.materials=this.materials||[];this.materials.push(this.objects["mat/"+a.name]=a.tag=b)};
THREE.SEA3D.prototype.readPointLight=function(a){var b=new THREE.PointLight(a.color,a.multiplier*this.config.multiplier);b.name=a.name;a.attenuation&&(b.distance=a.attenuation.end);a.shadow&&this.setShadowMap(b,a.shadow.opacity);this.domain.lights=this.lights=this.lights||[];this.lights.push(this.objects["lht/"+a.name]=a.tag=b);this.config.lights&&this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator);this.updateScene()};
THREE.SEA3D.prototype.readHemisphereLight=function(a){var b=new THREE.HemisphereLight(a.color,a.secondColor,a.multiplier*this.config.multiplier);b.name=a.name;this.domain.lights=this.lights=this.lights||[];this.lights.push(this.objects["lht/"+a.name]=a.tag=b);this.config.lights&&this.addSceneObject(a);this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator);this.updateScene()};
THREE.SEA3D.prototype.readDirectionalLight=function(a){var b=new THREE.DirectionalLight(a.color,a.multiplier*this.config.multiplier);b.name=a.name;a.shadow&&this.setShadowMap(b,a.shadow.opacity);this.domain.lights=this.lights=this.lights||[];this.lights.push(this.objects["lht/"+a.name]=a.tag=b);this.config.lights&&this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator);this.updateScene()};
THREE.SEA3D.prototype.readCamera=function(a){var b=new THREE.SEA3D.Camera(a.fov);b.name=a.name;this.domain.cameras=this.cameras=this.cameras||[];this.cameras.push(this.objects["cam/"+a.name]=a.tag=b);this.addSceneObject(a);this.updateTransform(b,a);this.applyDefaultAnimation(a,THREE.SEA3D.CameraAnimator)};
THREE.SEA3D.prototype.readSkeletonLocal=function(a){for(var b=[],c=0;c<a.joint.length;c++){var d=a.joint[c];b[c]={name:d.name,pos:[d.x,d.y,d.z],rotq:[d.qx,d.qy,d.qz,d.qw],parent:d.parentIndex}}a.tag=b};THREE.SEA3D.prototype.readJointObject=function(a){var b=a.target.tag.skeleton.bones[a.joint];this.domain.joints=this.joints=this.joints||[];this.joints.push(this.objects["jnt/"+a.name]=a.tag=b)};
THREE.SEA3D.prototype.getSkeletonAnimation=function(a,b){if(a.tag)return a.tag;for(var c=[],d=1E3/a.frameRate/1E3,e=0;e<a.sequence.length;e++){for(var f=a.sequence[e],g=f.start,h=g+f.count,f={name:a.name+"/"+f.name,repeat:f.repeat,fps:a.frameRate,JIT:0,length:d*(f.count-1),hierarchy:[]},k=a.numJoints,m=a.raw,s=0;s<k;s++){for(var q={parent:b.joint[s].parentIndex,keys:[]},p=q.keys,r=0,t=g;t<h;t++){var l=t*k*7+7*s;p.push({time:r,pos:[m[l],m[l+1],m[l+2]],rot:[m[l+3],m[l+4],m[l+5],m[l+6]],scl:[1,1,1]});
r+=d}f.hierarchy[s]=q}c.push(f)}return a.tag=c};THREE.SEA3D.prototype.readMorpher=function(a){for(var b={position:[]},c=[],d=0;d<a.node.length;d++){var e=a.node[d];b.position[d]=new THREE.Float32Attribute(new Float32Array(e.vertex),3);e.normal&&(b.normal=b.normal||[],b.normal[d]=new THREE.Float32Attribute(new Float32Array(e.normal),3));c[d]={name:e.name}}a.tag={attribs:b,targets:c}};
THREE.SEA3D.prototype.readVertexAnimation=function(a){for(var b={position:[]},c=[],d=[],e=0,f=a.frame.length;e<f;e++){var g=a.frame[e];b.position[e]=new THREE.Float32Attribute(new Float32Array(g.vertex),3);g.normal&&(b.normal=b.normal||[],b.normal[e]=new THREE.Float32Attribute(new Float32Array(g.normal),3));c[e]={name:e}}for(e=0;e<a.sequence.length;e++)f=a.sequence[e],d[e]=d[f.name]={name:f.name,start:f.start,end:f.start+f.count,repeat:f.repeat};a.tag={attribs:b,targets:c,animations:d,frameRate:a.frameRate}};
THREE.SEA3D.prototype.readActions=function(a){for(var b=0;b<a.actions.length;b++){var c=a.actions[b];switch(c.kind){case SEA3D.Actions.SCRIPTS:this.runJSMList(this.domain,c.scripts,!0)}}};THREE.SEA3D.Event={LOAD_PROGRESS:"sea3d_progress",DOWNLOAD_PROGRESS:"sea3d_download",COMPLETE:"sea3d_complete",OBJECT_COMPLETE:"sea3d_object",PARSE_PROGRESS:"parse_progress",PARSE_COMPLETE:"parse_complete",ERROR:"sea3d_error"};THREE.SEA3D.prototype.onProgress=void 0;
THREE.SEA3D.prototype.onComplete=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.COMPLETE;a.file.dispatchEvent(a)};THREE.SEA3D.prototype.onLoadProgress=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.LOAD_PROGRESS;a.file.dispatchEvent(a);if(a.file.onProgress)a.file.onProgress(a)};THREE.SEA3D.prototype.onDownloadProgress=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.DOWNLOAD_PROGRESS;a.file.dispatchEvent(a);if(a.file.onProgress)a.file.onProgress(a)};
THREE.SEA3D.prototype.onCompleteObject=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.OBJECT_COMPLETE;a.file.dispatchEvent(a)};THREE.SEA3D.prototype.onParseProgress=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.PARSE_PROGRESS;a.file.dispatchEvent(a)};THREE.SEA3D.prototype.onParseComplete=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.PARSE_COMPLETE;a.file.dispatchEvent(a)};THREE.SEA3D.prototype.onError=function(a){a.file=this.scope;a.type=THREE.SEA3D.Event.ERROR;a.file.dispatchEvent(a)};
THREE.SEA3D.prototype.newDomain=function(){this.domain=new THREE.SEA3D.Domain(this.config.id,this.objects={},this.config.container,THREE.SEA3D.EXTENSIONS_DOMAIN)};
THREE.SEA3D.prototype.parse=function(a,b){delete this.cameras;delete this.containers;delete this.lights;delete this.joints;delete this.meshes;delete this.materials;delete this.animationSets;delete this.sprites;delete this.sounds3d;delete this.cubeRenderers;delete this.sounds;delete this.glsl;delete this.dummy;delete this.domain;this.newDomain();this.file.onParseComplete=function(b){this.config.manager&&this.config.manager.add(this.domain);(a||this.onParseComplete).call(this.file,b)}.bind(this);this.file.onParseProgress=
b||this.onParseProgress;for(var c=0;c<THREE.SEA3D.EXTENSIONS_PARSE.length;c++)THREE.SEA3D.EXTENSIONS_PARSE[c].call(this);this.file.parse();return this};THREE.SEA3D.prototype.load=function(a){this.loadBytes();this.file.load(a)};THREE.SEA3D.prototype.onHead=function(a){if("TJS"!=a.sign)throw Error("Sign '"+a.sign+"' not supported! Use SEA3D Studio to publish or SEA3DLegacy.js");};THREE.SEA3D.EXTENSIONS=[];THREE.SEA3D.EXTENSIONS_PARSE=[];THREE.SEA3D.EXTENSIONS_DOMAIN=[];
THREE.SEA3D.prototype.loadBytes=function(a){this.file=new SEA3D.File;this.file.scope=this;this.file.config=this.config;this.file.streaming=this.config.streaming;this.file.timeLimit=this.config.timeLimit;this.file.onProgress=this.onLoadProgress;this.file.onCompleteObject=this.onCompleteObject;this.file.onDownloadProgress=this.onDownloadProgress;this.file.onParseProgress=this.onParseProgress;this.file.onParseComplete=this.onParseComplete;this.file.onError=this.onError;this.file.onHead=this.onHead;this.file.onComplete=
function(a){this.config.manager&&this.config.manager.add(this.domain);this.onComplete.call(this.file,a)}.bind(this);this.newDomain();this.file.typeRead[SEA3D.Geometry.prototype.type]=this.file.typeRead[SEA3D.GeometryDelta.prototype.type]=this.readGeometryBuffer;this.file.typeRead[SEA3D.Mesh.prototype.type]=this.readMesh;this.file.typeRead[SEA3D.Mesh2D.prototype.type]=this.readMesh2D;this.file.typeRead[SEA3D.Container3D.prototype.type]=this.readContainer3D;this.file.typeRead[SEA3D.Dummy.prototype.type]=
this.readDummy;this.file.typeRead[SEA3D.Line.prototype.type]=this.readLine;this.file.typeRead[SEA3D.Material.prototype.type]=this.readMaterial;this.file.typeRead[SEA3D.Camera.prototype.type]=this.readCamera;this.file.typeRead[SEA3D.SkeletonLocal.prototype.type]=this.readSkeletonLocal;this.file.typeRead[SEA3D.JointObject.prototype.type]=this.readJointObject;this.file.typeRead[SEA3D.CubeMap.prototype.type]=this.readCubeMap;this.file.typeRead[SEA3D.CubeRender.prototype.type]=this.readCubeRender;this.file.typeRead[SEA3D.Animation.prototype.type]=
this.readAnimation;this.file.typeRead[SEA3D.SoundPoint.prototype.type]=this.readSoundPoint;this.file.typeRead[SEA3D.TextureURL.prototype.type]=this.readTextureURL;this.file.typeRead[SEA3D.Morph.prototype.type]=this.readMorpher;this.file.typeRead[SEA3D.VertexAnimation.prototype.type]=this.readVertexAnimation;this.file.typeRead[SEA3D.PointLight.prototype.type]=this.readPointLight;this.file.typeRead[SEA3D.DirectionalLight.prototype.type]=this.readDirectionalLight;this.file.typeRead[SEA3D.HemisphereLight.prototype.type]=
this.readHemisphereLight;this.file.typeRead[SEA3D.Actions.prototype.type]=this.readActions;this.file.typeRead[SEA3D.JPEG.prototype.type]=this.file.typeRead[SEA3D.JPEG_XR.prototype.type]=this.file.typeRead[SEA3D.PNG.prototype.type]=this.file.typeRead[SEA3D.GIF.prototype.type]=this.readImage;this.file.typeRead[SEA3D.MP3.prototype.type]=this.readSound;this.file.typeRead[SEA3D.GLSL.prototype.type]=this.readGLSL;this.file.typeRead[SEA3D.JavaScriptMethod.prototype.type]=this.readJavaScriptMethod;for(var b=
0;b<THREE.SEA3D.EXTENSIONS.length;b++)THREE.SEA3D.EXTENSIONS[b].call(this);this.file.read(a)};THREE.SEA3D.prototype._onHead=THREE.SEA3D.prototype.onHead;THREE.SEA3D.prototype._updateTransform=THREE.SEA3D.prototype.updateTransform;THREE.SEA3D.prototype._readVertexAnimation=THREE.SEA3D.prototype.readVertexAnimation;THREE.SEA3D.prototype._readGeometryBuffer=THREE.SEA3D.prototype.readGeometryBuffer;THREE.SEA3D.prototype._readLine=THREE.SEA3D.prototype.readLine;THREE.SEA3D.prototype._getSkeletonAnimation=THREE.SEA3D.prototype.getSkeletonAnimation;THREE.SEA3D.prototype._applyDefaultAnimation=THREE.SEA3D.prototype.applyDefaultAnimation;
THREE.SEA3D.prototype.isLegacy=function(a){var b=a.sea3d;return"S3D"!=b.sign||a._legacy?!1:(a._legacy=!0==b.typeUnique[a.type],b.config.legacy)};THREE.SEA3D.prototype.flipZVec3=function(a){if(a){for(var b=2;b<a.length;)a[b]=-a[b],b+=3;return a}};
THREE.SEA3D.prototype.expandJoints=function(a){for(var b=4*a.numVertex,c=a.isBig?new Uint32Array(b):new Uint16Array(b),b=new Float32Array(b),d=0,e=a.jointPerVertex,f=0;f<a.numVertex;f++){var g=4*f,d=f*e;c[g]=a.joint[d];1<e&&(c[g+1]=a.joint[d+1]);2<e&&(c[g+2]=a.joint[d+2]);3<e&&(c[g+3]=a.joint[d+3]);b[g]=a.weight[d];1<e&&(b[g+1]=a.weight[d+1]);2<e&&(b[g+2]=a.weight[d+2]);3<e&&(b[g+3]=a.weight[d+3]);d=b[g]+b[g+1]+b[g+2]+b[g+3];b[g]+=1-d}a.joint=c;a.weight=b;a.jointPerVertex=4};
THREE.SEA3D.prototype.compressJoints=function(a){for(var b=4*a.numVertex,c=a.isBig?new Uint32Array(b):new Uint16Array(b),b=new Float32Array(b),d=0,e=a.jointPerVertex,f=0;f<a.numVertex;f++){var g=4*f,d=f*e;c[g]=a.joint[d];c[g+1]=a.joint[d+1];c[g+2]=a.joint[d+2];c[g+3]=a.joint[d+3];b[g]=a.weight[d];b[g+1]=a.weight[d+1];b[g+2]=a.weight[d+2];b[g+3]=a.weight[d+3];d=b[g]+b[g+1]+b[g+2]+b[g+3];b[g]+=1-d}a.joint=c;a.weight=b;a.jointPerVertex=4};
THREE.SEA3D.prototype.flipZIndex=function(a){for(var b=1;b<a.length;){var c=a[b+1];a[b+1]=a[b];a[b]=c;b+=3}return a};THREE.SEA3D.prototype.flipMatrixBone=function(a){var b=new THREE.Vector3,c=new THREE.Matrix4;return function(a){c.copy(a);a.setPosition(b);a.multiplyMatrices(THREE.SEA3D.MTXBUF.makeRotationZ(THREE.Math.degToRad(180)),a);a.makeRotationFromQuaternion(THREE.SEA3D.QUABUF.setFromRotationMatrix(a));var e=THREE.SEA3D.VECBUF.setFromMatrixPosition(c);e.z=-e.z;a.setPosition(e);return a}}();
THREE.SEA3D.prototype.flipMatrixScale=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Quaternion,g=new THREE.Vector3;return function(a,b,c,d){c&&a.multiplyMatrices(c,a);a.decompose(e,f,g);g.z=-g.z;b&&(g.y=-g.y,g.x=-g.x);a.compose(e,f,g);c&&(c=c.clone(),this.flipMatrixScale(c,d),a.multiplyMatrices(c.getInverse(c),a));return a}}();
THREE.SEA3D.prototype.updateAnimationSet=function(a){var b=new THREE.Matrix4,c=new THREE.Matrix4,d=new THREE.Vector3,e=new THREE.Quaternion,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Quaternion,k=new THREE.Vector3;return function(a){var s=a.animation.animationSet,q=s.animations;if(!s.flip||q.length){for(var p=q[0].dataList,q=[],r=0;r<p.length;r++){var t=p[r],l=p[r].data,n=t.kind,t=l.length/t.blockLength;switch(n){case SEA3D.Animation.POSITION:case SEA3D.Animation.ROTATION:case SEA3D.Animation.SCALE:q.push({kind:n,
numFrames:t,raw:l})}}if(0<q.length)for(t=q[0].numFrames,l=void 0,a.animation.relative?(b.identity(),this.flipMatrixScale(c.copy(a.matrixWorld))):(a.parent&&(l=this.flipMatrixScale(c.copy(a.parent.matrixWorld))),this.flipMatrixScale(b.copy(a.matrix),!1,l)),b.decompose(d,e,f),a=0;a<t;a++){for(p=0;p<q.length;p++)switch(l=q[p].raw,n=q[p].kind,n){case SEA3D.Animation.POSITION:n=3*a;d.set(l[n],l[n+1],l[n+2]);break;case SEA3D.Animation.ROTATION:n=4*a;e.set(l[n],l[n+1],l[n+2],l[n+3]);break;case SEA3D.Animation.SCALE:n=
4*a,f.set(l[n],l[n+1],l[n+2])}b.compose(d,e,f);this.flipMatrixScale(b,!1,c);b.decompose(g,h,k);for(p=0;p<q.length;p++)switch(l=q[p].raw,n=q[p].kind,n){case SEA3D.Animation.POSITION:n=3*a;l[n]=g.x;l[n+1]=g.y;l[n+2]=g.z;break;case SEA3D.Animation.ROTATION:n=4*a;l[n]=h.x;l[n+1]=h.y;l[n+2]=h.z;l[n+3]=h.w;break;case SEA3D.Animation.SCALE:n=3*a,l[n]=k.x,l[n+1]=k.y,l[n+2]=k.z}}s.flip=!0}}}();
THREE.SEA3D.prototype.applyDefaultAnimation=function(a,b){this._applyDefaultAnimation(a,b);this.isLegacy(a)&&a.tag.animation&&this.updateAnimationSet(a.tag)};
THREE.SEA3D.prototype.updateTransform=function(a,b){var c=new THREE.Matrix4,d=new THREE.Matrix4;return function(a,b){this.isLegacy(b)?(b.transform?c.elements.set(b.transform):c.makeTranslation(b.position.x,b.position.y,b.position.z),this.flipMatrixScale(c,!1,a.parent?a.parent.matrixWorld:d,a.parent instanceof THREE.Bone),a.position.setFromMatrixPosition(c),a.scale.setFromMatrixScale(c),c.scale(THREE.SEA3D.VECBUF.set(1/a.scale.x,1/a.scale.y,1/a.scale.z)),a.rotation.setFromRotationMatrix(c),a.updateMatrixWorld()):
this._updateTransform(a,b)}}();
THREE.SEA3D.prototype.readSkeleton=function(a){var b=new THREE.Matrix4,c=new THREE.Matrix4,d=new THREE.Matrix4,e=new THREE.Vector3,f=new THREE.Quaternion;return function(a){for(var h=[],k=a.sea3d.config.legacy,m=0;m<a.joint.length;m++){var s=a.joint[m];b.elements=s.inverseBindMatrix;c.getInverse(b);k&&this.flipMatrixBone(c);-1<s.parentIndex&&(b.elements=a.joint[s.parentIndex].inverseBindMatrix,d.getInverse(b),k&&this.flipMatrixBone(d),d.getInverse(d),c.multiplyMatrices(d,c));e.setFromMatrixPosition(c);
f.setFromRotationMatrix(c);h[m]={name:s.name,pos:[e.x,e.y,e.z],rotq:[f.x,f.y,f.z,f.w],parent:s.parentIndex}}return a.tag=h}}();THREE.SEA3D.prototype.getSkeletonAnimation=function(a,b){return this.isLegacy(a)?this.getSkeletonAnimationLegacy(a,b):this._getSkeletonAnimation(a,b)};
THREE.SEA3D.prototype.getSkeletonAnimationLegacy=function(a,b){var c=new THREE.Matrix4,d=new THREE.Matrix4,e=new THREE.Matrix4,f=new THREE.Matrix4;return function(a,b){if(a.tag)return a.tag;for(var k=[],m=a.frameRate/1E3,s=[1,1,1],q=0;q<a.sequence.length;q++){for(var p=a.sequence[q],r=p.start,t=r+p.count,p={name:a.name+"/"+p.name,repeat:p.repeat,fps:a.frameRate,JIT:0,length:m*(p.count-1),hierarchy:[]},l=a.numJoints,n=a.raw,u=0;u<l;u++){for(var x=b.joint[u],A={parent:x.parentIndex,keys:[]},B=A.keys,
y=0,z=r;z<t;z++){var v=z*l*7+7*u;d.makeRotationFromQuaternion(THREE.SEA3D.QUABUF.set(n[v+3],n[v+4],n[v+5],n[v+6]));d.setPosition(THREE.SEA3D.VECBUF.set(n[v],n[v+1],n[v+2]));-1<x.parentIndex?(c.elements=b.joint[x.parentIndex].inverseBindMatrix,f.getInverse(c),e.multiplyMatrices(f,d),this.flipMatrixBone(e),this.flipMatrixBone(f),f.getInverse(f),d.multiplyMatrices(f,e)):this.flipMatrixBone(d);var v=THREE.SEA3D.VECBUF.setFromMatrixPosition(d),w=THREE.SEA3D.QUABUF.setFromRotationMatrix(d);B.push({time:y,
pos:[v.x,v.y,v.z],rot:[w.x,w.y,w.z,w.w],scl:s});y+=m}p.hierarchy[u]=A}k.push(p)}return a.tag=k}}();THREE.SEA3D.prototype.readVertexAnimation=function(a){if(this.isLegacy(a))for(var b=0,c=a.frame.length;b<c;b++){var d=a.frame[b];this.flipZVec3(d.vertex);this.flipZVec3(d.normal)}this._readVertexAnimation(a)};
THREE.SEA3D.prototype.readGeometryBuffer=function(a){this.isLegacy(a)&&(this.flipZVec3(a.vertex),this.flipZVec3(a.normal),this.flipZIndex(a.indexes),4<a.jointPerVertex?this.compressJoints(a):4>a.jointPerVertex&&this.expandJoints(a));this._readGeometryBuffer(a)};THREE.SEA3D.prototype.readLines=function(a){this.isLegacy(a)&&this.flipZVec3(a.vertex);this._readLines(a)};THREE.SEA3D.prototype.onHead=function(a){};
THREE.SEA3D.EXTENSIONS.push(function(){this.config.legacy=void 0==this.config.legacy?!0:this.config.legacy;this.file.typeRead[SEA3D.Skeleton.prototype.type]=this.readSkeleton});var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]);this._windowSize=a;this._streamPos=this._pos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0);this._streamPos=this._pos}};
LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){a||(this._pos=this._streamPos=0)};LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(0>c&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()};
LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.getByte=function(a){a=this._pos-a-1;0>a&&(a+=this._windowSize);return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};
LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;for(this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()};LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b=0,c;a--;)this._range>>>=1,c=this._code-this._range>>>31,this._code-=this._range&c-1,b=b<<1|1-c,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b};
LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;if((this._code^2147483648)<(d^2147483648))return this._range=d,a[b]+=2048-c>>>5,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0;this._range-=d;this._code-=d;a[b]-=c>>>5;0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return 1};LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024};
LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b=1,c=0,d=0,e;d<this._numBitLevels;++d)e=a.decodeBit(this._models,b),b=b<<1|e,c|=e<<d;return c};
LZMA.reverseDecode2=function(a,b,c,d){for(var e=1,f=0,g=0,h;g<d;++g)h=c.decodeBit(a,b+e),e=e<<1|h,f|=h<<g;return f};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)};
LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};
LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c=1,d,e;do if(d=b>>7&1,b<<=1,e=a.decodeBit(this._decoders,(1+d<<8)+c),c=c<<1|e,d!==e){for(;256>c;)c=c<<1|a.decodeBit(this._decoders,c);break}while(256>c);return c&255};LZMA.LiteralDecoder=function(){};
LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2};LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()};
LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((b&255)>>>8-this._numPrevBits)]};
LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow;this._rangeDecoder=new LZMA.RangeDecoder;this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder;this._repLenDecoder=new LZMA.LenDecoder;this._literalDecoder=new LZMA.LiteralDecoder;this._dictionarySizeCheck=this._dictionarySize=
-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(0>a)return!1;this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096)));return!0};
LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;if(8<a||4<b||4<c)return!1;this._literalDecoder.create(b,a);this._lenDecoder.create(d);this._repLenDecoder.create(d);this._posStateMask=d-1;return!0};
LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(!1);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);for(this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init();this._repLenDecoder.init();
this._posAlignDecoder.init();this._rangeDecoder.init()};
LZMA.Decoder.prototype.decode=function(a,b,c){var d=0,e=0,f=0,g=0,h=0,k=0,m=0;this._rangeDecoder.setStream(a);this._outWindow.setStream(b);for(this.init();0>c||k<c;)if(a=k&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+a))m=this._literalDecoder.getDecoder(k++,m),m=7<=d?m.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(e)):m.decodeNormal(this._rangeDecoder),this._outWindow.putByte(m),d=4>d?0:d-(10>d?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,
d))m=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+a)&&(d=7>d?9:11,m=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?b=f:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?b=g:(b=h,h=g),g=f),f=e,e=b),0===m&&(m=2+this._repLenDecoder.decode(this._rangeDecoder,a),d=7>d?8:11);else if(h=g,g=f,f=e,m=2+this._lenDecoder.decode(this._rangeDecoder,a),d=7>d?7:10,a=this._posSlotDecoder[5>=m?m-2:3].decode(this._rangeDecoder),
4<=a)if(b=(a>>1)-1,e=(2|a&1)<<b,14>a)e+=LZMA.reverseDecode2(this._posDecoders,e-a-1,this._rangeDecoder,b);else{if(e+=this._rangeDecoder.decodeDirectBits(b-4)<<4,e+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>e){if(-1===e)break;return!1}}else e=a;if(e>=k||e>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(e,m);k+=m;m=this._outWindow.getByte(0)}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return!0};
LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c;if(5>a.size)return!1;b=a.readByte();c=b%9;b=~~(b/9);if(!this.setLcLpPb(c,b%5,~~(b/5)))return!1;b=a.readByte();b|=a.readByte()<<8;b|=a.readByte()<<16;b+=16777216*a.readByte();return this.setDictionarySize(b)};LZMA.decompress=function(a,b,c,d){var e=new LZMA.Decoder;if(!e.setDecoderProperties(a))throw"Incorrect stream properties";if(!e.decode(b,c,d))throw"Error in data stream";return!0};
LZMA.decompressFile=function(a,b){var c=new LZMA.Decoder,d;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";d=a.readByte();d|=a.readByte()<<8;d|=a.readByte()<<16;d+=16777216*a.readByte();a.readByte();a.readByte();a.readByte();a.readByte();if(!c.decode(a,b,d))throw"Error in data stream";return!0};
SEA3D.File.LZMAUncompress=function(a){a=new Uint8Array(a);var b={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};LZMA.decompressFile({data:a,position:0,readByte:function(){return this.data[this.position++]}},b);return(new Uint8Array(b.data)).buffer};SEA3D.File.setDecompressionEngine(2,"lzma",SEA3D.File.LZMAUncompress);
