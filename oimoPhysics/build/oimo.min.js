!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i():"function"==typeof define&&define.amd?define(i):i()}(0,function(){"use strict";!function(){function t(t,i){function a(){}a.prototype=t;var n=new a;for(var o in i)n[o]=i[o];return i.toString!==Object.prototype.toString&&(n.toString=i.toString),n}var i=function(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new o,this._aabb=new s,this.identity=new F,this.zero=new E,this.rayCastHit=new Z};i.prototype={createProxy:function(t,i){return null},destroyProxy:function(t){},moveProxy:function(t,i,a){},isOverlapping:function(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ},collectPairs:function(){},getProxyPairList:function(){return this._proxyPairList},isIncremental:function(){return this._incremental},getTestCount:function(){return this._testCount},rayCast:function(t,i,a){},convexCast:function(t,i,a,n){},aabbTest:function(t,i){}};var a=function(t){this._type=t,this._volume=0};a.prototype={_updateMass:function(){},_computeAabb:function(t,i){},_rayCastLocal:function(t,i,a,n,o,s,r){return!1},getType:function(){return this._type},getVolume:function(){return this._volume},rayCast:function(t,i,a,n){var o,s,r,_,e,h,l=t;o=l.x,s=l.y,r=l.z;var v,c,m,b,f,p,u=i;if(_=u.x,e=u.y,h=u.z,o-=a._positionX,s-=a._positionY,r-=a._positionZ,_-=a._positionX,e-=a._positionY,h-=a._positionZ,v=a._rotation00*o+a._rotation10*s+a._rotation20*r,c=a._rotation01*o+a._rotation11*s+a._rotation21*r,m=a._rotation02*o+a._rotation12*s+a._rotation22*r,o=v,s=c,r=m,b=a._rotation00*_+a._rotation10*e+a._rotation20*h,f=a._rotation01*_+a._rotation11*e+a._rotation21*h,p=a._rotation02*_+a._rotation12*e+a._rotation22*h,_=b,e=f,h=p,this._rayCastLocal(o,s,r,_,e,h,n)){var x,X,M,g,Y,Z,I=n.position;x=I.x,X=I.y,M=I.z;var y,d,L,z,w,B,A=n.normal;g=A.x,Y=A.y,Z=A.z,y=a._rotation00*x+a._rotation01*X+a._rotation02*M,d=a._rotation10*x+a._rotation11*X+a._rotation12*M,L=a._rotation20*x+a._rotation21*X+a._rotation22*M,x=y,X=d,M=L,z=a._rotation00*g+a._rotation01*Y+a._rotation02*Z,w=a._rotation10*g+a._rotation11*Y+a._rotation12*Z,B=a._rotation20*g+a._rotation21*Y+a._rotation22*Z,g=z,Y=w,Z=B,x+=a._positionX,X+=a._positionY,M+=a._positionZ;var P=n.position;P.x=x,P.y=X,P.z=M;var T=n.normal;return T.x=g,T.y=Y,T.z=Z,!0}return!1}};var n=function(t){a.call(this,t),this._gjkMargin=D.defaultGJKMargin,this._useGjkRayCast=!1};n.__super__=a,n.prototype=t(a.prototype,{getGjkMergin:function(){return this._gjkMargin},setGjkMergin:function(t){t<0&&(t=0),this._gjkMargin=t},computeLocalSupportingVertex:function(t,i){},rayCast:function(t,i,n,o){return this._useGjkRayCast?N.instance.rayCast(this,n,t,i,o):a.prototype.rayCast.call(this,t,i,n,o)}});var o=function(){n.call(this,-1)};o.__super__=n,o.prototype=t(n.prototype,{init:function(t,i,a){var n,o,s;this.c=t;var r,_,e,h=a;n=h.x,o=h.y,s=h.z,r=i._rotation00*n+i._rotation10*o+i._rotation20*s,_=i._rotation01*n+i._rotation11*o+i._rotation21*s,e=i._rotation02*n+i._rotation12*o+i._rotation22*s,this.localTranslation=new E;var l=this.localTranslation;l.x=r,l.y=_,l.z=e,this._gjkMargin=t._gjkMargin},computeLocalSupportingVertex:function(t,i){this.c.computeLocalSupportingVertex(t,i);var a=this.localTranslation;if(t.x*a.x+t.y*a.y+t.z*a.z>0){var n=this.localTranslation,o=i.x+n.x,s=i.y+n.y,r=i.z+n.z;i.x=o,i.y=s,i.z=r}}});var s=function(){n.call(this,-1),this.min=new E,this.max=new E};s.__super__=n,s.prototype=t(n.prototype,{computeLocalSupportingVertex:function(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}});var r=function(){};r.prototype={process:function(t){}};var _=function(){},e=function(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0};e.prototype={getId:function(){return this._id},getFatAabb:function(){var t=new p;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t},getFatAabbTo:function(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};var h=function(){this._p1=null,this._p2=null};h.prototype={getProxy1:function(){return this._p1},getProxy2:function(){return this._p2},getNext:function(){return this._next}};var l=function(){i.call(this,1),this._incremental=!1};l.__super__=i,l.prototype=t(i.prototype,{createProxy:function(t,i){var a=new e(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ,a},destroyProxy:function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null},moveProxy:function(t,i,a){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ},collectPairs:function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;for(var i=this._proxyList;null!=i;){for(var a=i._next,n=i._next;null!=n;){var o=n._next;if(this._testCount++,i._aabbMinX<n._aabbMaxX&&i._aabbMaxX>n._aabbMinX&&i._aabbMinY<n._aabbMaxY&&i._aabbMaxY>n._aabbMinY&&i._aabbMinZ<n._aabbMaxZ&&i._aabbMaxZ>n._aabbMinZ){var s=this._proxyPairPool;null!=s?(this._proxyPairPool=s._next,s._next=null):s=new h;var r=s;null==this._proxyPairList?this._proxyPairList=r:(r._next=this._proxyPairList,this._proxyPairList=r),r._p1=i,r._p2=n}n=o}i=a}},rayCast:function(t,i,a){var n,o,s,r,_,e,h=t;n=h.x,o=h.y,s=h.z;var l=i;r=l.x,_=l.y,e=l.z;for(var v=this._proxyList;null!=v;){var c,m=v._next,b=n,f=o,p=s,u=r,x=_,X=e,M=b<u?b:u,g=f<x?f:x,Y=p<X?p:X,Z=b>u?b:u,I=f>x?f:x,y=p>X?p:X,d=v._aabbMinX,L=v._aabbMinY,z=v._aabbMinZ,w=v._aabbMaxX,B=v._aabbMaxY,A=v._aabbMaxZ;if(d>Z||w<M||L>I||B<g||z>y||A<Y)c=!1;else{var P,T,S=u-b,V=x-f,k=X-p,C=S<0?-S:S,q=V<0?-V:V,R=k<0?-k:k,j=.5*(w-d),O=.5*(B-L),E=.5*(A-z),F=b-.5*(w+d),D=f-.5*(B+L),N=p-.5*(A+z),W=D*k-N*V;if((W<0?-W:W)-(O*R+E*q)>0)T=!0;else{var G=N*S-F*k;T=(G<0?-G:G)-(E*C+j*R)>0}if(T)P=!0;else{var U=F*V-D*S;P=(U<0?-U:U)-(j*q+O*C)>0}c=!P}c&&a.process(v),v=m}},convexCast:function(t,i,a,n){for(var o=this._proxyList;null!=o;){var s=o._next,r=this._aabb.min;r.x=o._aabbMinX,r.y=o._aabbMinY,r.z=o._aabbMinZ;var _=this._aabb.max;_.x=o._aabbMaxX,_.y=o._aabbMaxY,_.z=o._aabbMaxZ,this._convexSweep.init(t,i,a);var e=N.instance;0==e.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&e.distance<=0&&n.process(o),o=s}},aabbTest:function(t,i){for(var a=this._proxyList;null!=a;){var n=a._next;t._minX<a._aabbMaxX&&t._maxX>a._aabbMinX&&t._minY<a._aabbMaxY&&t._maxY>a._aabbMinY&&t._minZ<a._aabbMaxZ&&t._maxZ>a._aabbMinZ&&i.process(a),a=n}}});var v=function(){i.call(this,2),this._incremental=!0,this._tree=new f;var t=new Array(1024);this.movedProxies=t,this.numMovedProxies=0};v.__super__=i,v.prototype=t(i.prototype,{collide:function(t,i){this._testCount++;var a=0==t._height,n=0==i._height;if(t==i){if(a)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(a&&n){var o=t._proxy,s=i._proxy,r=this._proxyPairPool;null!=r?(this._proxyPairPool=r._next,r._next=null):r=new h;var _=r;return null==this._proxyPairList?this._proxyPairList=_:(_._next=this._proxyPairList,this._proxyPairList=_),_._p1=o,void(_._p2=s)}n||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}},rayCastRecursive:function(t,i,a,n,o,s,r,_){var e,h,l,v,c,m,b,f=e=i,p=h=a,u=l=n,x=v=o,X=c=s,M=m=r,g=f<x?f:x,Y=p<X?p:X,Z=u<M?u:M,I=f>x?f:x,y=p>X?p:X,d=u>M?u:M,L=t._aabbMinX,z=t._aabbMinY,w=t._aabbMinZ,B=t._aabbMaxX,A=t._aabbMaxY,P=t._aabbMaxZ;if(L>I||B<g||z>y||A<Y||w>d||P<Z)b=!1;else{var T,S,V=x-f,k=X-p,C=M-u,q=V<0?-V:V,R=k<0?-k:k,j=C<0?-C:C,O=.5*(B-L),E=.5*(A-z),F=.5*(P-w),D=f-.5*(B+L),N=p-.5*(A+z),W=u-.5*(P+w),G=N*C-W*k;if((G<0?-G:G)-(E*j+F*R)>0)S=!0;else{var U=W*V-D*C;S=(U<0?-U:U)-(F*q+O*j)>0}if(S)T=!0;else{var J=D*k-N*V;T=(J<0?-J:J)-(O*R+E*q)>0}b=!T}b&&(0!=t._height?(this.rayCastRecursive(t._children[0],e,h,l,v,c,m,_),this.rayCastRecursive(t._children[1],e,h,l,v,c,m,_)):_.process(t._proxy))},convexCastRecursive:function(t,i,a,n,o){var s=this._aabb.min;s.x=t._aabbMinX,s.y=t._aabbMinY,s.z=t._aabbMinZ;var r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(i,a,n);var _=N.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,!1)&&_.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,a,n,o),this.convexCastRecursive(t._children[1],i,a,n,o)):o.process(t._proxy))},aabbTestRecursive:function(t,i,a){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,a),this.aabbTestRecursive(t._children[1],i,a)):a.process(t._proxy))},createProxy:function(t,i){var a=new m(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=a,this._proxyListLast=a):(this._proxyListLast._next=a,a._prev=this._proxyListLast,this._proxyListLast=a),a._aabbMinX=i._minX,a._aabbMinY=i._minY,a._aabbMinZ=i._minZ,a._aabbMaxX=i._maxX,a._aabbMaxY=i._maxY,a._aabbMaxZ=i._maxZ;var n,o,s,r=D.bvhProxyPadding;n=r,o=r,s=r,a._aabbMinX-=n,a._aabbMinY-=o,a._aabbMinZ-=s,a._aabbMaxX+=n,a._aabbMaxY+=o,a._aabbMaxZ+=s;var _=this._tree,e=_._nodePool;null!=e?(_._nodePool=e._next,e._next=null):e=new c;var h=e;if(h._proxy=a,a._leaf=h,h._aabbMinX=a._aabbMinX,h._aabbMinY=a._aabbMinY,h._aabbMinZ=a._aabbMinZ,h._aabbMaxX=a._aabbMaxX,h._aabbMaxY=a._aabbMaxY,h._aabbMaxZ=a._aabbMaxZ,_._numLeaves++,null==_.leafList?(_.leafList=h,_.leafListLast=h):(_.leafListLast._nextLeaf=h,h._prevLeaf=_.leafListLast,_.leafListLast=h),null==_._root)_._root=h;else{for(var l=_._root;l._height>0;){var v=_._strategy._decideInsertion(l,h);if(-1==v)break;l=l._children[v]}var b=l._parent,f=_._nodePool;null!=f?(_._nodePool=f._next,f._next=null):f=new c;var p=f;if(null==b)_._root=p;else{var u=l._childIndex;b._children[u]=p,p._parent=b,p._childIndex=u}var x=l._childIndex;p._children[x]=l,l._parent=p,l._childIndex=x;var X=1^l._childIndex;for(p._children[X]=h,h._parent=p,h._childIndex=X;null!=p;){if(_._strategy._balancingEnabled)if(p._height<2)p=p;else{var M=p._parent,g=p._children[0],Y=p._children[1],Z=g._height-Y._height,I=p._childIndex;if(Z>1){var y=g._children[0],d=g._children[1];if(y._height>d._height){g._children[1]=p,p._parent=g,p._childIndex=1,p._children[0]=d,d._parent=p,d._childIndex=0;var L=g._children[0],z=g._children[1];g._aabbMinX=L._aabbMinX<z._aabbMinX?L._aabbMinX:z._aabbMinX,g._aabbMinY=L._aabbMinY<z._aabbMinY?L._aabbMinY:z._aabbMinY,g._aabbMinZ=L._aabbMinZ<z._aabbMinZ?L._aabbMinZ:z._aabbMinZ,g._aabbMaxX=L._aabbMaxX>z._aabbMaxX?L._aabbMaxX:z._aabbMaxX,g._aabbMaxY=L._aabbMaxY>z._aabbMaxY?L._aabbMaxY:z._aabbMaxY,g._aabbMaxZ=L._aabbMaxZ>z._aabbMaxZ?L._aabbMaxZ:z._aabbMaxZ;var w=g._children[0]._height,B=g._children[1]._height;g._height=(w>B?w:B)+1;var A=p._children[0],P=p._children[1];p._aabbMinX=A._aabbMinX<P._aabbMinX?A._aabbMinX:P._aabbMinX,p._aabbMinY=A._aabbMinY<P._aabbMinY?A._aabbMinY:P._aabbMinY,p._aabbMinZ=A._aabbMinZ<P._aabbMinZ?A._aabbMinZ:P._aabbMinZ,p._aabbMaxX=A._aabbMaxX>P._aabbMaxX?A._aabbMaxX:P._aabbMaxX,p._aabbMaxY=A._aabbMaxY>P._aabbMaxY?A._aabbMaxY:P._aabbMaxY,p._aabbMaxZ=A._aabbMaxZ>P._aabbMaxZ?A._aabbMaxZ:P._aabbMaxZ;var T=p._children[0]._height,S=p._children[1]._height;p._height=(T>S?T:S)+1}else{g._children[0]=p,p._parent=g,p._childIndex=0,p._children[0]=y,y._parent=p,y._childIndex=0;var V=g._children[0],k=g._children[1];g._aabbMinX=V._aabbMinX<k._aabbMinX?V._aabbMinX:k._aabbMinX,g._aabbMinY=V._aabbMinY<k._aabbMinY?V._aabbMinY:k._aabbMinY,g._aabbMinZ=V._aabbMinZ<k._aabbMinZ?V._aabbMinZ:k._aabbMinZ,g._aabbMaxX=V._aabbMaxX>k._aabbMaxX?V._aabbMaxX:k._aabbMaxX,g._aabbMaxY=V._aabbMaxY>k._aabbMaxY?V._aabbMaxY:k._aabbMaxY,g._aabbMaxZ=V._aabbMaxZ>k._aabbMaxZ?V._aabbMaxZ:k._aabbMaxZ;var C=g._children[0]._height,q=g._children[1]._height;g._height=(C>q?C:q)+1;var R=p._children[0],j=p._children[1];p._aabbMinX=R._aabbMinX<j._aabbMinX?R._aabbMinX:j._aabbMinX,p._aabbMinY=R._aabbMinY<j._aabbMinY?R._aabbMinY:j._aabbMinY,p._aabbMinZ=R._aabbMinZ<j._aabbMinZ?R._aabbMinZ:j._aabbMinZ,p._aabbMaxX=R._aabbMaxX>j._aabbMaxX?R._aabbMaxX:j._aabbMaxX,p._aabbMaxY=R._aabbMaxY>j._aabbMaxY?R._aabbMaxY:j._aabbMaxY,p._aabbMaxZ=R._aabbMaxZ>j._aabbMaxZ?R._aabbMaxZ:j._aabbMaxZ;var O=p._children[0]._height,E=p._children[1]._height;p._height=(O>E?O:E)+1}null!=M?(M._children[I]=g,g._parent=M,g._childIndex=I):(_._root=g,g._parent=null),p=g}else if(Z<-1){var F=Y._children[0],N=Y._children[1];if(F._height>N._height){Y._children[1]=p,p._parent=Y,p._childIndex=1,p._children[1]=N,N._parent=p,N._childIndex=1;var W=Y._children[0],G=Y._children[1];Y._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX,Y._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY,Y._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ,Y._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX,Y._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY,Y._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var U=Y._children[0]._height,J=Y._children[1]._height;Y._height=(U>J?U:J)+1;var H=p._children[0],Q=p._children[1];p._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,p._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,p._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,p._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,p._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,p._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var K=p._children[0]._height,$=p._children[1]._height;p._height=(K>$?K:$)+1}else{Y._children[0]=p,p._parent=Y,p._childIndex=0,p._children[1]=F,F._parent=p,F._childIndex=1;var tt=Y._children[0],it=Y._children[1];Y._aabbMinX=tt._aabbMinX<it._aabbMinX?tt._aabbMinX:it._aabbMinX,Y._aabbMinY=tt._aabbMinY<it._aabbMinY?tt._aabbMinY:it._aabbMinY,Y._aabbMinZ=tt._aabbMinZ<it._aabbMinZ?tt._aabbMinZ:it._aabbMinZ,Y._aabbMaxX=tt._aabbMaxX>it._aabbMaxX?tt._aabbMaxX:it._aabbMaxX,Y._aabbMaxY=tt._aabbMaxY>it._aabbMaxY?tt._aabbMaxY:it._aabbMaxY,Y._aabbMaxZ=tt._aabbMaxZ>it._aabbMaxZ?tt._aabbMaxZ:it._aabbMaxZ;var at=Y._children[0]._height,nt=Y._children[1]._height;Y._height=(at>nt?at:nt)+1;var ot=p._children[0],st=p._children[1];p._aabbMinX=ot._aabbMinX<st._aabbMinX?ot._aabbMinX:st._aabbMinX,p._aabbMinY=ot._aabbMinY<st._aabbMinY?ot._aabbMinY:st._aabbMinY,p._aabbMinZ=ot._aabbMinZ<st._aabbMinZ?ot._aabbMinZ:st._aabbMinZ,p._aabbMaxX=ot._aabbMaxX>st._aabbMaxX?ot._aabbMaxX:st._aabbMaxX,p._aabbMaxY=ot._aabbMaxY>st._aabbMaxY?ot._aabbMaxY:st._aabbMaxY,p._aabbMaxZ=ot._aabbMaxZ>st._aabbMaxZ?ot._aabbMaxZ:st._aabbMaxZ;var rt=p._children[0]._height,_t=p._children[1]._height;p._height=(rt>_t?rt:_t)+1}null!=M?(M._children[I]=Y,Y._parent=M,Y._childIndex=I):(_._root=Y,Y._parent=null),p=Y}else p=p}var et=p._children[0]._height,ht=p._children[1]._height;p._height=(et>ht?et:ht)+1;var lt=p._children[0],vt=p._children[1];p._aabbMinX=lt._aabbMinX<vt._aabbMinX?lt._aabbMinX:vt._aabbMinX,p._aabbMinY=lt._aabbMinY<vt._aabbMinY?lt._aabbMinY:vt._aabbMinY,p._aabbMinZ=lt._aabbMinZ<vt._aabbMinZ?lt._aabbMinZ:vt._aabbMinZ,p._aabbMaxX=lt._aabbMaxX>vt._aabbMaxX?lt._aabbMaxX:vt._aabbMaxX,p._aabbMaxY=lt._aabbMaxY>vt._aabbMaxY?lt._aabbMaxY:vt._aabbMaxY,p._aabbMaxZ=lt._aabbMaxZ>vt._aabbMaxZ?lt._aabbMaxZ:vt._aabbMaxZ,p=p._parent}}if(!a._moved){if(a._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var ct=this.numMovedProxies<<1,mt=new Array(ct),bt=0,ft=this.numMovedProxies;bt<ft;){var pt=bt++;mt[pt]=this.movedProxies[pt],this.movedProxies[pt]=null}this.movedProxies=mt}this.movedProxies[this.numMovedProxies++]=a}return a},destroyProxy:function(t){this._numProxies--;var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;var n=t,o=this._tree,s=n._leaf;o._numLeaves--;var r=s._prevLeaf,_=s._nextLeaf;if(null!=r&&(r._nextLeaf=_),null!=_&&(_._prevLeaf=r),s==o.leafList&&(o.leafList=o.leafList._nextLeaf),s==o.leafListLast&&(o.leafListLast=o.leafListLast._prevLeaf),s._nextLeaf=null,s._prevLeaf=null,o._root==s)o._root=null;else{var e=s._parent,h=e._children[1^s._childIndex],l=e._parent;if(null==l)h._parent=null,h._childIndex=0,o._root=h,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=o._nodePool,o._nodePool=e;else{h._parent=l;var v=e._childIndex;l._children[v]=h,h._parent=l,h._childIndex=v,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=o._nodePool,o._nodePool=e;for(var c=l;null!=c;){if(o._strategy._balancingEnabled)if(c._height<2)c=c;else{var m=c._parent,b=c._children[0],f=c._children[1],p=b._height-f._height,u=c._childIndex;if(p>1){var x=b._children[0],X=b._children[1];if(x._height>X._height){b._children[1]=c,c._parent=b,c._childIndex=1,c._children[0]=X,X._parent=c,X._childIndex=0;var M=b._children[0],g=b._children[1];b._aabbMinX=M._aabbMinX<g._aabbMinX?M._aabbMinX:g._aabbMinX,b._aabbMinY=M._aabbMinY<g._aabbMinY?M._aabbMinY:g._aabbMinY,b._aabbMinZ=M._aabbMinZ<g._aabbMinZ?M._aabbMinZ:g._aabbMinZ,b._aabbMaxX=M._aabbMaxX>g._aabbMaxX?M._aabbMaxX:g._aabbMaxX,b._aabbMaxY=M._aabbMaxY>g._aabbMaxY?M._aabbMaxY:g._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>g._aabbMaxZ?M._aabbMaxZ:g._aabbMaxZ;var Y=b._children[0]._height,Z=b._children[1]._height;b._height=(Y>Z?Y:Z)+1;var I=c._children[0],y=c._children[1];c._aabbMinX=I._aabbMinX<y._aabbMinX?I._aabbMinX:y._aabbMinX,c._aabbMinY=I._aabbMinY<y._aabbMinY?I._aabbMinY:y._aabbMinY,c._aabbMinZ=I._aabbMinZ<y._aabbMinZ?I._aabbMinZ:y._aabbMinZ,c._aabbMaxX=I._aabbMaxX>y._aabbMaxX?I._aabbMaxX:y._aabbMaxX,c._aabbMaxY=I._aabbMaxY>y._aabbMaxY?I._aabbMaxY:y._aabbMaxY,c._aabbMaxZ=I._aabbMaxZ>y._aabbMaxZ?I._aabbMaxZ:y._aabbMaxZ;var d=c._children[0]._height,L=c._children[1]._height;c._height=(d>L?d:L)+1}else{b._children[0]=c,c._parent=b,c._childIndex=0,c._children[0]=x,x._parent=c,x._childIndex=0;var z=b._children[0],w=b._children[1];b._aabbMinX=z._aabbMinX<w._aabbMinX?z._aabbMinX:w._aabbMinX,b._aabbMinY=z._aabbMinY<w._aabbMinY?z._aabbMinY:w._aabbMinY,b._aabbMinZ=z._aabbMinZ<w._aabbMinZ?z._aabbMinZ:w._aabbMinZ,b._aabbMaxX=z._aabbMaxX>w._aabbMaxX?z._aabbMaxX:w._aabbMaxX,b._aabbMaxY=z._aabbMaxY>w._aabbMaxY?z._aabbMaxY:w._aabbMaxY,b._aabbMaxZ=z._aabbMaxZ>w._aabbMaxZ?z._aabbMaxZ:w._aabbMaxZ;var B=b._children[0]._height,A=b._children[1]._height;b._height=(B>A?B:A)+1;var P=c._children[0],T=c._children[1];c._aabbMinX=P._aabbMinX<T._aabbMinX?P._aabbMinX:T._aabbMinX,c._aabbMinY=P._aabbMinY<T._aabbMinY?P._aabbMinY:T._aabbMinY,c._aabbMinZ=P._aabbMinZ<T._aabbMinZ?P._aabbMinZ:T._aabbMinZ,c._aabbMaxX=P._aabbMaxX>T._aabbMaxX?P._aabbMaxX:T._aabbMaxX,c._aabbMaxY=P._aabbMaxY>T._aabbMaxY?P._aabbMaxY:T._aabbMaxY,c._aabbMaxZ=P._aabbMaxZ>T._aabbMaxZ?P._aabbMaxZ:T._aabbMaxZ;var S=c._children[0]._height,V=c._children[1]._height;c._height=(S>V?S:V)+1}null!=m?(m._children[u]=b,b._parent=m,b._childIndex=u):(o._root=b,b._parent=null),c=b}else if(p<-1){var k=f._children[0],C=f._children[1];if(k._height>C._height){f._children[1]=c,c._parent=f,c._childIndex=1,c._children[1]=C,C._parent=c,C._childIndex=1;var q=f._children[0],R=f._children[1];f._aabbMinX=q._aabbMinX<R._aabbMinX?q._aabbMinX:R._aabbMinX,f._aabbMinY=q._aabbMinY<R._aabbMinY?q._aabbMinY:R._aabbMinY,f._aabbMinZ=q._aabbMinZ<R._aabbMinZ?q._aabbMinZ:R._aabbMinZ,f._aabbMaxX=q._aabbMaxX>R._aabbMaxX?q._aabbMaxX:R._aabbMaxX,f._aabbMaxY=q._aabbMaxY>R._aabbMaxY?q._aabbMaxY:R._aabbMaxY,f._aabbMaxZ=q._aabbMaxZ>R._aabbMaxZ?q._aabbMaxZ:R._aabbMaxZ;var j=f._children[0]._height,O=f._children[1]._height;f._height=(j>O?j:O)+1;var E=c._children[0],F=c._children[1];c._aabbMinX=E._aabbMinX<F._aabbMinX?E._aabbMinX:F._aabbMinX,c._aabbMinY=E._aabbMinY<F._aabbMinY?E._aabbMinY:F._aabbMinY,c._aabbMinZ=E._aabbMinZ<F._aabbMinZ?E._aabbMinZ:F._aabbMinZ,c._aabbMaxX=E._aabbMaxX>F._aabbMaxX?E._aabbMaxX:F._aabbMaxX,c._aabbMaxY=E._aabbMaxY>F._aabbMaxY?E._aabbMaxY:F._aabbMaxY,c._aabbMaxZ=E._aabbMaxZ>F._aabbMaxZ?E._aabbMaxZ:F._aabbMaxZ;var D=c._children[0]._height,N=c._children[1]._height;c._height=(D>N?D:N)+1}else{f._children[0]=c,c._parent=f,c._childIndex=0,c._children[1]=k,k._parent=c,k._childIndex=1;var W=f._children[0],G=f._children[1];f._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX,f._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY,f._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ,f._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX,f._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY,f._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var U=f._children[0]._height,J=f._children[1]._height;f._height=(U>J?U:J)+1;var H=c._children[0],Q=c._children[1];c._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,c._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,c._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,c._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,c._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,c._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var K=c._children[0]._height,$=c._children[1]._height;c._height=(K>$?K:$)+1}null!=m?(m._children[u]=f,f._parent=m,f._childIndex=u):(o._root=f,f._parent=null),c=f}else c=c}var tt=c._children[0]._height,it=c._children[1]._height;c._height=(tt>it?tt:it)+1;var at=c._children[0],nt=c._children[1];c._aabbMinX=at._aabbMinX<nt._aabbMinX?at._aabbMinX:nt._aabbMinX,c._aabbMinY=at._aabbMinY<nt._aabbMinY?at._aabbMinY:nt._aabbMinY,c._aabbMinZ=at._aabbMinZ<nt._aabbMinZ?at._aabbMinZ:nt._aabbMinZ,c._aabbMaxX=at._aabbMaxX>nt._aabbMaxX?at._aabbMaxX:nt._aabbMaxX,c._aabbMaxY=at._aabbMaxY>nt._aabbMaxY?at._aabbMaxY:nt._aabbMaxY,c._aabbMaxZ=at._aabbMaxZ>nt._aabbMaxZ?at._aabbMaxZ:nt._aabbMaxZ,c=c._parent}}}n._leaf=null,s._next=null,s._childIndex=0,s._children[0]=null,s._children[1]=null,s._childIndex=0,s._parent=null,s._height=0,s._proxy=null,s._next=o._nodePool,o._nodePool=s,n.userData=null,n._next=null,n._prev=null,n._moved&&(n._moved=!1)},moveProxy:function(t,i,a){var n=t;if(!(n._aabbMinX<=i._minX&&n._aabbMaxX>=i._maxX&&n._aabbMinY<=i._minY&&n._aabbMaxY>=i._maxY&&n._aabbMinZ<=i._minZ&&n._aabbMaxZ>=i._maxZ)){n._aabbMinX=i._minX,n._aabbMinY=i._minY,n._aabbMinZ=i._minZ,n._aabbMaxX=i._maxX,n._aabbMaxY=i._maxY,n._aabbMaxZ=i._maxZ;var o,s,r,_=D.bvhProxyPadding;if(o=_,s=_,r=_,n._aabbMinX-=o,n._aabbMinY-=s,n._aabbMinZ-=r,n._aabbMaxX+=o,n._aabbMaxY+=s,n._aabbMaxZ+=r,null!=a){var e,h,l,v,c,m,b,f,p;0,0,0;var u=a;e=u.x,h=u.y,l=u.z,v=0<e?0:e,c=0<h?0:h,m=0<l?0:l,b=0>e?0:e,f=0>h?0:h,p=0>l?0:l,n._aabbMinX+=v,n._aabbMinY+=c,n._aabbMinZ+=m,n._aabbMaxX+=b,n._aabbMaxY+=f,n._aabbMaxZ+=p}if(!n._moved){if(n._moved=!0,this.movedProxies.length==this.numMovedProxies){for(var x=this.numMovedProxies<<1,X=new Array(x),M=0,g=this.numMovedProxies;M<g;){var Y=M++;X[Y]=this.movedProxies[Y],this.movedProxies[Y]=null}this.movedProxies=X}this.movedProxies[this.numMovedProxies++]=n}}},collectPairs:function(){var t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,null!=(t=t._next););this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,!(this._numProxies<2)){for(var i=this.numMovedProxies/this._numProxies<D.bvhIncrementalCollisionThreshold,a=0,n=this.numMovedProxies;a<n;){var o=a++,s=this.movedProxies[o];if(s._moved){var r=this._tree,_=s._leaf;r._numLeaves--;var e=_._prevLeaf,h=_._nextLeaf;if(null!=e&&(e._nextLeaf=h),null!=h&&(h._prevLeaf=e),_==r.leafList&&(r.leafList=r.leafList._nextLeaf),_==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,r._root==_)r._root=null;else{var l=_._parent,v=l._children[1^_._childIndex],m=l._parent;if(null==m)v._parent=null,v._childIndex=0,r._root=v,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;else{v._parent=m;var b=l._childIndex;m._children[b]=v,v._parent=m,v._childIndex=b,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=r._nodePool,r._nodePool=l;for(var f=m;null!=f;){if(r._strategy._balancingEnabled)if(f._height<2)f=f;else{var p=f._parent,u=f._children[0],x=f._children[1],X=u._height-x._height,M=f._childIndex;if(X>1){var g=u._children[0],Y=u._children[1];if(g._height>Y._height){u._children[1]=f,f._parent=u,f._childIndex=1,f._children[0]=Y,Y._parent=f,Y._childIndex=0;var Z=u._children[0],I=u._children[1];u._aabbMinX=Z._aabbMinX<I._aabbMinX?Z._aabbMinX:I._aabbMinX,u._aabbMinY=Z._aabbMinY<I._aabbMinY?Z._aabbMinY:I._aabbMinY,u._aabbMinZ=Z._aabbMinZ<I._aabbMinZ?Z._aabbMinZ:I._aabbMinZ,u._aabbMaxX=Z._aabbMaxX>I._aabbMaxX?Z._aabbMaxX:I._aabbMaxX,u._aabbMaxY=Z._aabbMaxY>I._aabbMaxY?Z._aabbMaxY:I._aabbMaxY,u._aabbMaxZ=Z._aabbMaxZ>I._aabbMaxZ?Z._aabbMaxZ:I._aabbMaxZ;var y=u._children[0]._height,d=u._children[1]._height;u._height=(y>d?y:d)+1;var L=f._children[0],z=f._children[1];f._aabbMinX=L._aabbMinX<z._aabbMinX?L._aabbMinX:z._aabbMinX,f._aabbMinY=L._aabbMinY<z._aabbMinY?L._aabbMinY:z._aabbMinY,f._aabbMinZ=L._aabbMinZ<z._aabbMinZ?L._aabbMinZ:z._aabbMinZ,f._aabbMaxX=L._aabbMaxX>z._aabbMaxX?L._aabbMaxX:z._aabbMaxX,f._aabbMaxY=L._aabbMaxY>z._aabbMaxY?L._aabbMaxY:z._aabbMaxY,f._aabbMaxZ=L._aabbMaxZ>z._aabbMaxZ?L._aabbMaxZ:z._aabbMaxZ;var w=f._children[0]._height,B=f._children[1]._height;f._height=(w>B?w:B)+1}else{u._children[0]=f,f._parent=u,f._childIndex=0,f._children[0]=g,g._parent=f,g._childIndex=0;var A=u._children[0],P=u._children[1];u._aabbMinX=A._aabbMinX<P._aabbMinX?A._aabbMinX:P._aabbMinX,u._aabbMinY=A._aabbMinY<P._aabbMinY?A._aabbMinY:P._aabbMinY,u._aabbMinZ=A._aabbMinZ<P._aabbMinZ?A._aabbMinZ:P._aabbMinZ,u._aabbMaxX=A._aabbMaxX>P._aabbMaxX?A._aabbMaxX:P._aabbMaxX,u._aabbMaxY=A._aabbMaxY>P._aabbMaxY?A._aabbMaxY:P._aabbMaxY,u._aabbMaxZ=A._aabbMaxZ>P._aabbMaxZ?A._aabbMaxZ:P._aabbMaxZ;var T=u._children[0]._height,S=u._children[1]._height;u._height=(T>S?T:S)+1;var V=f._children[0],k=f._children[1];f._aabbMinX=V._aabbMinX<k._aabbMinX?V._aabbMinX:k._aabbMinX,f._aabbMinY=V._aabbMinY<k._aabbMinY?V._aabbMinY:k._aabbMinY,f._aabbMinZ=V._aabbMinZ<k._aabbMinZ?V._aabbMinZ:k._aabbMinZ,f._aabbMaxX=V._aabbMaxX>k._aabbMaxX?V._aabbMaxX:k._aabbMaxX,f._aabbMaxY=V._aabbMaxY>k._aabbMaxY?V._aabbMaxY:k._aabbMaxY,f._aabbMaxZ=V._aabbMaxZ>k._aabbMaxZ?V._aabbMaxZ:k._aabbMaxZ;var C=f._children[0]._height,q=f._children[1]._height;f._height=(C>q?C:q)+1}null!=p?(p._children[M]=u,u._parent=p,u._childIndex=M):(r._root=u,u._parent=null),f=u}else if(X<-1){var R=x._children[0],j=x._children[1];if(R._height>j._height){x._children[1]=f,f._parent=x,f._childIndex=1,f._children[1]=j,j._parent=f,j._childIndex=1;var O=x._children[0],E=x._children[1];x._aabbMinX=O._aabbMinX<E._aabbMinX?O._aabbMinX:E._aabbMinX,x._aabbMinY=O._aabbMinY<E._aabbMinY?O._aabbMinY:E._aabbMinY,x._aabbMinZ=O._aabbMinZ<E._aabbMinZ?O._aabbMinZ:E._aabbMinZ,x._aabbMaxX=O._aabbMaxX>E._aabbMaxX?O._aabbMaxX:E._aabbMaxX,x._aabbMaxY=O._aabbMaxY>E._aabbMaxY?O._aabbMaxY:E._aabbMaxY,x._aabbMaxZ=O._aabbMaxZ>E._aabbMaxZ?O._aabbMaxZ:E._aabbMaxZ;var F=x._children[0]._height,N=x._children[1]._height;x._height=(F>N?F:N)+1;var W=f._children[0],G=f._children[1];f._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX,f._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY,f._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ,f._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX,f._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY,f._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var U=f._children[0]._height,J=f._children[1]._height;f._height=(U>J?U:J)+1}else{x._children[0]=f,f._parent=x,f._childIndex=0,f._children[1]=R,R._parent=f,R._childIndex=1;var H=x._children[0],Q=x._children[1];x._aabbMinX=H._aabbMinX<Q._aabbMinX?H._aabbMinX:Q._aabbMinX,x._aabbMinY=H._aabbMinY<Q._aabbMinY?H._aabbMinY:Q._aabbMinY,x._aabbMinZ=H._aabbMinZ<Q._aabbMinZ?H._aabbMinZ:Q._aabbMinZ,x._aabbMaxX=H._aabbMaxX>Q._aabbMaxX?H._aabbMaxX:Q._aabbMaxX,x._aabbMaxY=H._aabbMaxY>Q._aabbMaxY?H._aabbMaxY:Q._aabbMaxY,x._aabbMaxZ=H._aabbMaxZ>Q._aabbMaxZ?H._aabbMaxZ:Q._aabbMaxZ;var K=x._children[0]._height,$=x._children[1]._height;x._height=(K>$?K:$)+1;var tt=f._children[0],it=f._children[1];f._aabbMinX=tt._aabbMinX<it._aabbMinX?tt._aabbMinX:it._aabbMinX,f._aabbMinY=tt._aabbMinY<it._aabbMinY?tt._aabbMinY:it._aabbMinY,f._aabbMinZ=tt._aabbMinZ<it._aabbMinZ?tt._aabbMinZ:it._aabbMinZ,f._aabbMaxX=tt._aabbMaxX>it._aabbMaxX?tt._aabbMaxX:it._aabbMaxX,f._aabbMaxY=tt._aabbMaxY>it._aabbMaxY?tt._aabbMaxY:it._aabbMaxY,f._aabbMaxZ=tt._aabbMaxZ>it._aabbMaxZ?tt._aabbMaxZ:it._aabbMaxZ;var at=f._children[0]._height,nt=f._children[1]._height;f._height=(at>nt?at:nt)+1}null!=p?(p._children[M]=x,x._parent=p,x._childIndex=M):(r._root=x,x._parent=null),f=x}else f=f}var ot=f._children[0]._height,st=f._children[1]._height;f._height=(ot>st?ot:st)+1;var rt=f._children[0],_t=f._children[1];f._aabbMinX=rt._aabbMinX<_t._aabbMinX?rt._aabbMinX:_t._aabbMinX,f._aabbMinY=rt._aabbMinY<_t._aabbMinY?rt._aabbMinY:_t._aabbMinY,f._aabbMinZ=rt._aabbMinZ<_t._aabbMinZ?rt._aabbMinZ:_t._aabbMinZ,f._aabbMaxX=rt._aabbMaxX>_t._aabbMaxX?rt._aabbMaxX:_t._aabbMaxX,f._aabbMaxY=rt._aabbMaxY>_t._aabbMaxY?rt._aabbMaxY:_t._aabbMaxY,f._aabbMaxZ=rt._aabbMaxZ>_t._aabbMaxZ?rt._aabbMaxZ:_t._aabbMaxZ,f=f._parent}}}s._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=r._nodePool,r._nodePool=_;var et=this._tree,ht=et._nodePool;null!=ht?(et._nodePool=ht._next,ht._next=null):ht=new c;var lt=ht;if(lt._proxy=s,s._leaf=lt,lt._aabbMinX=s._aabbMinX,lt._aabbMinY=s._aabbMinY,lt._aabbMinZ=s._aabbMinZ,lt._aabbMaxX=s._aabbMaxX,lt._aabbMaxY=s._aabbMaxY,lt._aabbMaxZ=s._aabbMaxZ,et._numLeaves++,null==et.leafList?(et.leafList=lt,et.leafListLast=lt):(et.leafListLast._nextLeaf=lt,lt._prevLeaf=et.leafListLast,et.leafListLast=lt),null==et._root)et._root=lt;else{for(var vt=et._root;vt._height>0;){var ct=et._strategy._decideInsertion(vt,lt);if(-1==ct)break;vt=vt._children[ct]}var mt=vt._parent,bt=et._nodePool;null!=bt?(et._nodePool=bt._next,bt._next=null):bt=new c;var ft=bt;if(null==mt)et._root=ft;else{var pt=vt._childIndex;mt._children[pt]=ft,ft._parent=mt,ft._childIndex=pt}var ut=vt._childIndex;ft._children[ut]=vt,vt._parent=ft,vt._childIndex=ut;var xt=1^vt._childIndex;for(ft._children[xt]=lt,lt._parent=ft,lt._childIndex=xt;null!=ft;){if(et._strategy._balancingEnabled)if(ft._height<2)ft=ft;else{var Xt=ft._parent,Mt=ft._children[0],gt=ft._children[1],Yt=Mt._height-gt._height,Zt=ft._childIndex;if(Yt>1){var It=Mt._children[0],yt=Mt._children[1];if(It._height>yt._height){Mt._children[1]=ft,ft._parent=Mt,ft._childIndex=1,ft._children[0]=yt,yt._parent=ft,yt._childIndex=0;var dt=Mt._children[0],Lt=Mt._children[1];Mt._aabbMinX=dt._aabbMinX<Lt._aabbMinX?dt._aabbMinX:Lt._aabbMinX,Mt._aabbMinY=dt._aabbMinY<Lt._aabbMinY?dt._aabbMinY:Lt._aabbMinY,Mt._aabbMinZ=dt._aabbMinZ<Lt._aabbMinZ?dt._aabbMinZ:Lt._aabbMinZ,Mt._aabbMaxX=dt._aabbMaxX>Lt._aabbMaxX?dt._aabbMaxX:Lt._aabbMaxX,Mt._aabbMaxY=dt._aabbMaxY>Lt._aabbMaxY?dt._aabbMaxY:Lt._aabbMaxY,Mt._aabbMaxZ=dt._aabbMaxZ>Lt._aabbMaxZ?dt._aabbMaxZ:Lt._aabbMaxZ;var zt=Mt._children[0]._height,wt=Mt._children[1]._height;Mt._height=(zt>wt?zt:wt)+1;var Bt=ft._children[0],At=ft._children[1];ft._aabbMinX=Bt._aabbMinX<At._aabbMinX?Bt._aabbMinX:At._aabbMinX,ft._aabbMinY=Bt._aabbMinY<At._aabbMinY?Bt._aabbMinY:At._aabbMinY,ft._aabbMinZ=Bt._aabbMinZ<At._aabbMinZ?Bt._aabbMinZ:At._aabbMinZ,ft._aabbMaxX=Bt._aabbMaxX>At._aabbMaxX?Bt._aabbMaxX:At._aabbMaxX,ft._aabbMaxY=Bt._aabbMaxY>At._aabbMaxY?Bt._aabbMaxY:At._aabbMaxY,ft._aabbMaxZ=Bt._aabbMaxZ>At._aabbMaxZ?Bt._aabbMaxZ:At._aabbMaxZ;var Pt=ft._children[0]._height,Tt=ft._children[1]._height;ft._height=(Pt>Tt?Pt:Tt)+1}else{Mt._children[0]=ft,ft._parent=Mt,ft._childIndex=0,ft._children[0]=It,It._parent=ft,It._childIndex=0;var St=Mt._children[0],Vt=Mt._children[1];Mt._aabbMinX=St._aabbMinX<Vt._aabbMinX?St._aabbMinX:Vt._aabbMinX,Mt._aabbMinY=St._aabbMinY<Vt._aabbMinY?St._aabbMinY:Vt._aabbMinY,Mt._aabbMinZ=St._aabbMinZ<Vt._aabbMinZ?St._aabbMinZ:Vt._aabbMinZ,Mt._aabbMaxX=St._aabbMaxX>Vt._aabbMaxX?St._aabbMaxX:Vt._aabbMaxX,Mt._aabbMaxY=St._aabbMaxY>Vt._aabbMaxY?St._aabbMaxY:Vt._aabbMaxY,Mt._aabbMaxZ=St._aabbMaxZ>Vt._aabbMaxZ?St._aabbMaxZ:Vt._aabbMaxZ;var kt=Mt._children[0]._height,Ct=Mt._children[1]._height;Mt._height=(kt>Ct?kt:Ct)+1;var qt=ft._children[0],Rt=ft._children[1];ft._aabbMinX=qt._aabbMinX<Rt._aabbMinX?qt._aabbMinX:Rt._aabbMinX,ft._aabbMinY=qt._aabbMinY<Rt._aabbMinY?qt._aabbMinY:Rt._aabbMinY,ft._aabbMinZ=qt._aabbMinZ<Rt._aabbMinZ?qt._aabbMinZ:Rt._aabbMinZ,ft._aabbMaxX=qt._aabbMaxX>Rt._aabbMaxX?qt._aabbMaxX:Rt._aabbMaxX,ft._aabbMaxY=qt._aabbMaxY>Rt._aabbMaxY?qt._aabbMaxY:Rt._aabbMaxY,ft._aabbMaxZ=qt._aabbMaxZ>Rt._aabbMaxZ?qt._aabbMaxZ:Rt._aabbMaxZ;var jt=ft._children[0]._height,Ot=ft._children[1]._height;ft._height=(jt>Ot?jt:Ot)+1}null!=Xt?(Xt._children[Zt]=Mt,Mt._parent=Xt,Mt._childIndex=Zt):(et._root=Mt,Mt._parent=null),ft=Mt}else if(Yt<-1){var Et=gt._children[0],Ft=gt._children[1];if(Et._height>Ft._height){gt._children[1]=ft,ft._parent=gt,ft._childIndex=1,ft._children[1]=Ft,Ft._parent=ft,Ft._childIndex=1;var Dt=gt._children[0],Nt=gt._children[1];gt._aabbMinX=Dt._aabbMinX<Nt._aabbMinX?Dt._aabbMinX:Nt._aabbMinX,gt._aabbMinY=Dt._aabbMinY<Nt._aabbMinY?Dt._aabbMinY:Nt._aabbMinY,gt._aabbMinZ=Dt._aabbMinZ<Nt._aabbMinZ?Dt._aabbMinZ:Nt._aabbMinZ,gt._aabbMaxX=Dt._aabbMaxX>Nt._aabbMaxX?Dt._aabbMaxX:Nt._aabbMaxX,gt._aabbMaxY=Dt._aabbMaxY>Nt._aabbMaxY?Dt._aabbMaxY:Nt._aabbMaxY,gt._aabbMaxZ=Dt._aabbMaxZ>Nt._aabbMaxZ?Dt._aabbMaxZ:Nt._aabbMaxZ;var Wt=gt._children[0]._height,Gt=gt._children[1]._height;gt._height=(Wt>Gt?Wt:Gt)+1;var Ut=ft._children[0],Jt=ft._children[1];ft._aabbMinX=Ut._aabbMinX<Jt._aabbMinX?Ut._aabbMinX:Jt._aabbMinX,ft._aabbMinY=Ut._aabbMinY<Jt._aabbMinY?Ut._aabbMinY:Jt._aabbMinY,ft._aabbMinZ=Ut._aabbMinZ<Jt._aabbMinZ?Ut._aabbMinZ:Jt._aabbMinZ,ft._aabbMaxX=Ut._aabbMaxX>Jt._aabbMaxX?Ut._aabbMaxX:Jt._aabbMaxX,ft._aabbMaxY=Ut._aabbMaxY>Jt._aabbMaxY?Ut._aabbMaxY:Jt._aabbMaxY,ft._aabbMaxZ=Ut._aabbMaxZ>Jt._aabbMaxZ?Ut._aabbMaxZ:Jt._aabbMaxZ;var Ht=ft._children[0]._height,Qt=ft._children[1]._height;ft._height=(Ht>Qt?Ht:Qt)+1}else{gt._children[0]=ft,ft._parent=gt,ft._childIndex=0,ft._children[1]=Et,Et._parent=ft,Et._childIndex=1;var Kt=gt._children[0],$t=gt._children[1];gt._aabbMinX=Kt._aabbMinX<$t._aabbMinX?Kt._aabbMinX:$t._aabbMinX,gt._aabbMinY=Kt._aabbMinY<$t._aabbMinY?Kt._aabbMinY:$t._aabbMinY,gt._aabbMinZ=Kt._aabbMinZ<$t._aabbMinZ?Kt._aabbMinZ:$t._aabbMinZ,gt._aabbMaxX=Kt._aabbMaxX>$t._aabbMaxX?Kt._aabbMaxX:$t._aabbMaxX,gt._aabbMaxY=Kt._aabbMaxY>$t._aabbMaxY?Kt._aabbMaxY:$t._aabbMaxY,gt._aabbMaxZ=Kt._aabbMaxZ>$t._aabbMaxZ?Kt._aabbMaxZ:$t._aabbMaxZ;var ti=gt._children[0]._height,ii=gt._children[1]._height;gt._height=(ti>ii?ti:ii)+1;var ai=ft._children[0],ni=ft._children[1];ft._aabbMinX=ai._aabbMinX<ni._aabbMinX?ai._aabbMinX:ni._aabbMinX,ft._aabbMinY=ai._aabbMinY<ni._aabbMinY?ai._aabbMinY:ni._aabbMinY,ft._aabbMinZ=ai._aabbMinZ<ni._aabbMinZ?ai._aabbMinZ:ni._aabbMinZ,ft._aabbMaxX=ai._aabbMaxX>ni._aabbMaxX?ai._aabbMaxX:ni._aabbMaxX,ft._aabbMaxY=ai._aabbMaxY>ni._aabbMaxY?ai._aabbMaxY:ni._aabbMaxY,ft._aabbMaxZ=ai._aabbMaxZ>ni._aabbMaxZ?ai._aabbMaxZ:ni._aabbMaxZ;var oi=ft._children[0]._height,si=ft._children[1]._height;ft._height=(oi>si?oi:si)+1}null!=Xt?(Xt._children[Zt]=gt,gt._parent=Xt,gt._childIndex=Zt):(et._root=gt,gt._parent=null),ft=gt}else ft=ft}var ri=ft._children[0]._height,_i=ft._children[1]._height;ft._height=(ri>_i?ri:_i)+1;var ei=ft._children[0],hi=ft._children[1];ft._aabbMinX=ei._aabbMinX<hi._aabbMinX?ei._aabbMinX:hi._aabbMinX,ft._aabbMinY=ei._aabbMinY<hi._aabbMinY?ei._aabbMinY:hi._aabbMinY,ft._aabbMinZ=ei._aabbMinZ<hi._aabbMinZ?ei._aabbMinZ:hi._aabbMinZ,ft._aabbMaxX=ei._aabbMaxX>hi._aabbMaxX?ei._aabbMaxX:hi._aabbMaxX,ft._aabbMaxY=ei._aabbMaxY>hi._aabbMaxY?ei._aabbMaxY:hi._aabbMaxY,ft._aabbMaxZ=ei._aabbMaxZ>hi._aabbMaxZ?ei._aabbMaxZ:hi._aabbMaxZ,ft=ft._parent}}i&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[o]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}},rayCast:function(t,i,a){if(null!=this._tree._root){var n,o,s,r,_,e,h=t;n=h.x,o=h.y,s=h.z;var l=i;r=l.x,_=l.y,e=l.z,this.rayCastRecursive(this._tree._root,n,o,s,r,_,e,a)}},convexCast:function(t,i,a,n){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,a,n)},aabbTest:function(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)},getTreeBalance:function(){return this._tree._getBalance()}});var c=function(){this._next=null,this._prevLeaf=null,this._nextLeaf=null;var t=new Array(2);this._children=t,this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0},m=function(t,i){e.call(this,t,i),this._leaf=null,this._moved=!1};m.__super__=e,m.prototype=t(e.prototype,{});var b=function(){this._insertionStrategy=0,this._balancingEnabled=!1};b.prototype={_decideInsertion:function(t,i){switch(this._insertionStrategy){case 0:var a,n,o;a=i._aabbMinX+i._aabbMaxX,n=i._aabbMinY+i._aabbMaxY,o=i._aabbMinZ+i._aabbMaxZ;var s,r,_,e,h,l,v=t._children[0],c=t._children[1];return s=v._aabbMinX+v._aabbMaxX,r=v._aabbMinY+v._aabbMaxY,_=v._aabbMinZ+v._aabbMaxZ,e=c._aabbMinX+c._aabbMaxX,h=c._aabbMinY+c._aabbMaxY,l=c._aabbMinZ+c._aabbMaxZ,(s-=a)*s+(r-=n)*r+(_-=o)*_<(e-=a)*e+(h-=n)*h+(l-=o)*l?0:1;case 1:var m,b,f,p,u,x,X=t._children[0],M=t._children[1],g=t._aabbMaxX-t._aabbMinX,Y=t._aabbMaxY-t._aabbMinY,Z=t._aabbMaxZ-t._aabbMinZ,I=2*(g*(Y+Z)+Y*Z);m=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,b=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,f=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,p=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX;var y=(u=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY)-b,d=(x=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ)-f,L=2*((p-m)*(y+d)+y*d),z=2*L,w=2*(L-I),B=w;if(m=X._aabbMinX<i._aabbMinX?X._aabbMinX:i._aabbMinX,b=X._aabbMinY<i._aabbMinY?X._aabbMinY:i._aabbMinY,f=X._aabbMinZ<i._aabbMinZ?X._aabbMinZ:i._aabbMinZ,p=X._aabbMaxX>i._aabbMaxX?X._aabbMaxX:i._aabbMaxX,u=X._aabbMaxY>i._aabbMaxY?X._aabbMaxY:i._aabbMaxY,x=X._aabbMaxZ>i._aabbMaxZ?X._aabbMaxZ:i._aabbMaxZ,0==X._height){var A=u-b,P=x-f;B+=2*((p-m)*(A+P)+A*P)}else{var T=p-m,S=u-b,V=x-f,k=X._aabbMaxX-X._aabbMinX,C=X._aabbMaxY-X._aabbMinY,q=X._aabbMaxZ-X._aabbMinZ;B+=2*(T*(S+V)+S*V)-2*(k*(C+q)+C*q)}var R=w;if(m=M._aabbMinX<i._aabbMinX?M._aabbMinX:i._aabbMinX,b=M._aabbMinY<i._aabbMinY?M._aabbMinY:i._aabbMinY,f=M._aabbMinZ<i._aabbMinZ?M._aabbMinZ:i._aabbMinZ,p=M._aabbMaxX>i._aabbMaxX?M._aabbMaxX:i._aabbMaxX,u=M._aabbMaxY>i._aabbMaxY?M._aabbMaxY:i._aabbMaxY,x=M._aabbMaxZ>i._aabbMaxZ?M._aabbMaxZ:i._aabbMaxZ,0==M._height){var j=u-b,O=x-f;R+=2*((p-m)*(j+O)+j*O)}else{var E=p-m,F=u-b,D=x-f,N=M._aabbMaxX-M._aabbMinX,W=M._aabbMaxY-M._aabbMinY,G=M._aabbMaxZ-M._aabbMinZ;R+=2*(E*(F+D)+F*D)-2*(N*(W+G)+W*G)}return z<B?z<R?-1:1:B<R?0:1;default:return console.log("BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}},_splitLeaves:function(t,i,a){var n,o,s,r=1/(a-i);n=0,o=0,s=0;for(var _,e,h,l=i,v=a;l<v;){var c=t[l++];c._tmpX=c._aabbMaxX+c._aabbMinX,c._tmpY=c._aabbMaxY+c._aabbMinY,c._tmpZ=c._aabbMaxZ+c._aabbMinZ,n+=c._tmpX,o+=c._tmpY,s+=c._tmpZ}n*=r,o*=r,s*=r,_=0,e=0,h=0;for(var m=i,b=a;m<b;){var f,p,u,x=t[m++];f=x._tmpX-n,p=x._tmpY-o,u=x._tmpZ-s,_+=f*=f,e+=p*=p,h+=u*=u}var X=e,M=h,g=i,Y=a-1;if(_>X)if(_>M)for(var Z=n;;){for(;;){if(t[g]._tmpX<=Z)break;++g}for(;;){if(t[Y]._tmpX>=Z)break;--Y}if(g>=Y)break;var I=t[g];t[g]=t[Y],t[Y]=I,++g,--Y}else for(var y=s;;){for(;;){if(t[g]._tmpZ<=y)break;++g}for(;;){if(t[Y]._tmpZ>=y)break;--Y}if(g>=Y)break;var d=t[g];t[g]=t[Y],t[Y]=d,++g,--Y}else if(X>M)for(var L=o;;){for(;;){if(t[g]._tmpY<=L)break;++g}for(;;){if(t[Y]._tmpY>=L)break;--Y}if(g>=Y)break;var z=t[g];t[g]=t[Y],t[Y]=z,++g,--Y}else for(var w=s;;){for(;;){if(t[g]._tmpZ<=w)break;++g}for(;;){if(t[Y]._tmpZ>=w)break;--Y}if(g>=Y)break;var B=t[g];t[g]=t[Y],t[Y]=B,++g,--Y}return g}};var f=function(){this._root=null,this._numLeaves=0,this._strategy=new b,this._nodePool=null,this.leafList=null,this.leafListLast=null;var t=new Array(1024);this.tmp=t};f.prototype={_print:function(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("BvhTree.hx:39:",i+t._proxy._id);else{var a,n,o,s;this._print(t._children[0],i+"  "),n=t._aabbMaxX-t._aabbMinX;o=t._aabbMaxY-t._aabbMinY,s=t._aabbMaxZ-t._aabbMinZ;if(n*(o+s)+o*s>0){var r,_,e;r=t._aabbMaxX-t._aabbMinX;_=t._aabbMaxY-t._aabbMinY,e=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(r*(_+e)+_*e)+.5|0)/1e3}else{var h,l,v;h=t._aabbMaxX-t._aabbMinX;l=t._aabbMaxY-t._aabbMinY,v=t._aabbMaxZ-t._aabbMinZ;a=(1e3*(h*(l+v)+l*v)-.5|0)/1e3}console.log("BvhTree.hx:42:",i+"#"+t._height+", "+a),this._print(t._children[1],i+"  ")}},_getBalance:function(){return this.getBalanceRecursive(this._root)},deleteRecursive:function(t){if(0==t._height){var i=t._prevLeaf,a=t._nextLeaf;return null!=i&&(i._nextLeaf=a),null!=a&&(a._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},decomposeRecursive:function(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t},buildTopDownRecursive:function(t,i,a){if(1==a-i){var n=t[i],o=n._proxy;return n._aabbMinX=o._aabbMinX,n._aabbMinY=o._aabbMinY,n._aabbMinZ=o._aabbMinZ,n._aabbMaxX=o._aabbMaxX,n._aabbMaxY=o._aabbMaxY,n._aabbMaxZ=o._aabbMaxZ,n}var s=this._strategy._splitLeaves(t,i,a),r=this.buildTopDownRecursive(t,i,s),_=this.buildTopDownRecursive(t,s,a),e=this._nodePool;null!=e?(this._nodePool=e._next,e._next=null):e=new c;var h=e;h._children[0]=r,r._parent=h,r._childIndex=0,h._children[1]=_,_._parent=h,_._childIndex=1;var l=h._children[0],v=h._children[1];h._aabbMinX=l._aabbMinX<v._aabbMinX?l._aabbMinX:v._aabbMinX,h._aabbMinY=l._aabbMinY<v._aabbMinY?l._aabbMinY:v._aabbMinY,h._aabbMinZ=l._aabbMinZ<v._aabbMinZ?l._aabbMinZ:v._aabbMinZ,h._aabbMaxX=l._aabbMaxX>v._aabbMaxX?l._aabbMaxX:v._aabbMaxX,h._aabbMaxY=l._aabbMaxY>v._aabbMaxY?l._aabbMaxY:v._aabbMaxY,h._aabbMaxZ=l._aabbMaxZ>v._aabbMaxZ?l._aabbMaxZ:v._aabbMaxZ;var m=h._children[0]._height,b=h._children[1]._height;return h._height=(m>b?m:b)+1,h},getBalanceRecursive:function(t){if(null==t||0==t._height)return 0;var i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};var p=function(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0};p.prototype={init:function(t,i){var a=t;this._minX=a.x,this._minY=a.y,this._minZ=a.z;var n=i;return this._maxX=n.x,this._maxY=n.y,this._maxZ=n.z,this},getMin:function(){var t=new E,i=t;return i.x=this._minX,i.y=this._minY,i.z=this._minZ,t},getMinTo:function(t){var i=t;i.x=this._minX,i.y=this._minY,i.z=this._minZ},setMin:function(t){var i=t;return this._minX=i.x,this._minY=i.y,this._minZ=i.z,this},getMax:function(){var t=new E,i=t;return i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ,t},getMaxTo:function(t){var i=t;i.x=this._maxX,i.y=this._maxY,i.z=this._maxZ},setMax:function(t){var i=t;return this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this},getCenter:function(){var t,i,a,n=new E;t=this._minX+this._maxX,i=this._minY+this._maxY,a=this._minZ+this._maxZ,t*=.5,i*=.5,a*=.5;var o=n;return o.x=t,o.y=i,o.z=a,n},getCenterTo:function(t){var i,a,n;i=this._minX+this._maxX,a=this._minY+this._maxY,n=this._minZ+this._maxZ,i*=.5,a*=.5,n*=.5;var o=t;o.x=i,o.y=a,o.z=n},getExtents:function(){var t,i,a,n=new E;t=this._maxX-this._minX,i=this._maxY-this._minY,a=this._maxZ-this._minZ,t*=.5,i*=.5,a*=.5;var o=n;return o.x=t,o.y=i,o.z=a,n},getExtentsTo:function(t){var i,a,n;i=this._maxX-this._minX,a=this._maxY-this._minY,n=this._maxZ-this._minZ,i*=.5,a*=.5,n*=.5;var o=t;o.x=i,o.y=a,o.z=n},combine:function(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this},combined:function(t){var i=new p;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i},overlap:function(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ},getIntersection:function(t){var i=new p;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i},getIntersectionTo:function(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ},copyFrom:function(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this},clone:function(){var t=new p;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};var u=function(t){n.call(this,1);var i=t;this._halfExtentsX=i.x,this._halfExtentsY=i.y,this._halfExtentsZ=i.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();var a=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*a&&(this._gjkMargin=.2*a)};u.__super__=n,u.prototype=t(n.prototype,{getHalfExtents:function(){var t=new E,i=t;return i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ,t},getHalfExtentsTo:function(t){var i=t;i.x=this._halfExtentsX,i.y=this._halfExtentsY,i.z=this._halfExtentsZ},_updateMass:function(){var t,i,a;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,a=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+a),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(a+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)},_computeAabb:function(t,i){var a,n,o,s,r,_,e,h,l,v,c,m;a=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,n=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,o=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,r=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,_=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,e=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,h=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,l=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,a=a<0?-a:a,n=n<0?-n:n,o=o<0?-o:o,v=a+(s=s<0?-s:s),c=n+(r=r<0?-r:r),m=o+(_=_<0?-_:_),v+=e=e<0?-e:e,c+=h=h<0?-h:h,m+=l=l<0?-l:l,t._minX=i._positionX-v,t._minY=i._positionY-c,t._minZ=i._positionZ-m,t._maxX=i._positionX+v,t._maxY=i._positionY+c,t._maxZ=i._positionZ+m},computeLocalSupportingVertex:function(t,i){var a,n,o,s,r,_;a=this._gjkMargin,n=this._gjkMargin,o=this._gjkMargin,a=a<this._halfExtentsX?a:this._halfExtentsX,n=n<this._halfExtentsY?n:this._halfExtentsY,o=o<this._halfExtentsZ?o:this._halfExtentsZ,s=this._halfExtentsX-a,r=this._halfExtentsY-n,_=this._halfExtentsZ-o,i.x=t.x>0?s:-s,i.y=t.y>0?r:-r,i.z=t.z>0?_:-_},_rayCastLocal:function(t,i,a,n,o,s,r){var _=t,e=i,h=a,l=n,v=o,c=s,m=this._halfExtentsX,b=this._halfExtentsY,f=this._halfExtentsZ,p=l-_,u=v-e,x=c-h,X=0,M=0,g=0,Y=1,Z=1,I=1;if(p>-1e-6&&p<1e-6){if(_<=-m||_>=m)return!1}else{var y=1/p,d=(-m-_)*y,L=(m-_)*y;if(d>L){var z=d;d=L,L=z}d>0&&(X=d),L<1&&(Y=L)}if(u>-1e-6&&u<1e-6){if(e<=-b||e>=b)return!1}else{var w=1/u,B=(-b-e)*w,A=(b-e)*w;if(B>A){var P=B;B=A,A=P}B>0&&(M=B),A<1&&(Z=A)}if(x>-1e-6&&x<1e-6){if(h<=-f||h>=f)return!1}else{var T=1/x,S=(-f-h)*T,V=(f-h)*T;if(S>V){var k=S;S=V,V=k}S>0&&(g=S),V<1&&(I=V)}if(X>=1||M>=1||g>=1||Y<=0||Z<=0||I<=0)return!1;var C=X,q=Y,R=0;if(M>C&&(C=M,R=1),g>C&&(C=g,R=2),Z<q&&(q=Z),I<q&&(q=I),C>q)return!1;if(0==C)return!1;switch(R){case 0:r.normal.init(p>0?-1:1,0,0);break;case 1:r.normal.init(0,u>0?-1:1,0);break;case 2:r.normal.init(0,0,x>0?-1:1)}return r.position.init(_+C*p,e+C*u,h+C*x),r.fraction=C,!0}});var x=function(t,i){n.call(this,4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()};x.__super__=n,x.prototype=t(n.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,a=6.28318530717958*t*this._halfHeight,n=3.14159265358979*t*this._radius*4/3;this._volume=a+n;var o=0==this._volume?0:1/this._volume,s=o*(a*t*.5+n*t*.4),r=o*(a*(.25*t+i/3)+n*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=r,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=r},_computeAabb:function(t,i){var a,n,o,s,r,_;a=this._radius,n=this._radius,o=this._radius,s=i._rotation01,r=i._rotation11,_=i._rotation21,s=s<0?-s:s,r=r<0?-r:r,_=_<0?-_:_,a+=s*=this._halfHeight,n+=r*=this._halfHeight,o+=_*=this._halfHeight,t._minX=i._positionX-a,t._minY=i._positionY-n,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+n,t._maxZ=i._positionZ+o},computeLocalSupportingVertex:function(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)},_rayCastLocal:function(t,i,a,n,o,s,r){var _=t,e=i,h=a,l=n,v=o,c=s,m=this._halfHeight,b=l-_,f=v-e,p=c-h,u=0,x=1,X=b*b+p*p,M=_*b+h*p,g=_*_+h*h-this._radius*this._radius,Y=M*M-X*g;if(Y<0)return!1;if(X>0){var Z=Math.sqrt(Y);if(x=(-M+Z)/X,(u=(-M-Z)/X)>=1||x<=0)return!1}else{if(g>=0)return!1;u=0,x=1}var I,y,d,L,z,w,B,A,P=e+f*u;if(P>-m&&P<m){if(u>0){I=u;var T=r.normal.init(_+b*I,0,h+p*I),S=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);S>0&&(S=1/S);var V=T.x*S,k=T.y*S,C=T.z*S;return T.x=V,T.y=k,T.z=C,r.position.init(_+I*b,P,h+I*p),r.fraction=I,!0}return!1}if(0,0,(Y=(M=(d=t-0)*(w=n-t)+(L=i-(y=P<0?-m:m))*(B=o-i)+(z=a-0)*(A=s-a))*M-(X=w*w+B*B+A*A)*(g=d*d+L*L+z*z-this._radius*this._radius))<0)return!1;var q,R,j,O,E,F,D=(-M-Math.sqrt(Y))/X;if(D<0||D>1)return!1;var N=(q=d+w*D)*q+(R=L+B*D)*R+(j=z+A*D)*j;N>0&&(N=1/Math.sqrt(N)),O=q*N,E=R*N,F=j*N,q+=0,R+=y,j+=0;var W=r.position;W.x=q,W.y=R,W.z=j;var G=r.normal;return G.x=O,G.y=E,G.z=F,r.fraction=D,!0}});var X=function(t,i){n.call(this,3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()};X.__super__=n,X.prototype=t(n.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+2*i)},_computeAabb:function(t,i){var a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=(a=i._rotation01)*a,I=(n=i._rotation11)*n,y=(o=i._rotation21)*o;e=Math.sqrt(1-Z),h=Math.sqrt(1-I),l=Math.sqrt(1-y),e*=this._radius,h*=this._radius,l*=this._radius,v=-(s=a*this._halfHeight),c=-(r=n*this._halfHeight),m=-(_=o*this._halfHeight),c-=h,m-=l,b=-s,f=-r,p=-_,f+=h,p+=l,u=(v-=e)>(b+=e)?v:b,x=c>f?c:f,X=m>p?m:p,u=u>s?u:s,x=x>r?x:r,X=X>_?X:_,M=v<b?v:b,g=c<f?c:f,Y=m<p?m:p,M=M<s?M:s,g=g<r?g:r,Y=Y<_?Y:_,t._minX=i._positionX+M,t._minY=i._positionY+g,t._minZ=i._positionZ+Y,t._maxX=i._positionX+u,t._maxY=i._positionY+x,t._maxZ=i._positionZ+X},computeLocalSupportingVertex:function(t,i){var a=t.x,n=t.y,o=t.z;if(n>0&&n*n>this.sinTheta*this.sinTheta*(a*a+n*n+o*o))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));var s=t.x,r=t.z,_=s*s+r*r,e=2*this._halfHeight,h=(e-this._gjkMargin)/e*this._radius-this._gjkMargin/this.cosTheta;h<0&&(h=0);var l=_>0?h/Math.sqrt(_):0,v=this._halfHeight-this._gjkMargin;v<0&&(v=0),i.x=s*l,i.y=-v,i.z=r*l},_rayCastLocal:function(t,i,a,n,o,s,r){var _=t,e=i,h=a,l=n,v=o,c=s,m=this._halfHeight,b=l-_,f=v-e,p=c-h,u=0,x=1;if(f>-1e-6&&f<1e-6){if(e<=-m||e>=m)return!1}else{var X=1/f,M=(-m-e)*X,g=(m-e)*X;if(M>g){var Y=M;M=g,g=Y}M>0&&(u=M),g<1&&(x=g)}if(u>=1||x<=0)return!1;var Z=0,I=0;e-=m;var y,d=this.cosTheta*this.cosTheta,L=d*(b*b+f*f+p*p)-f*f,z=d*(_*b+e*f+h*p)-e*f,w=d*(_*_+e*e+h*h)-e*e,B=z*z-L*w;if(0!=L){if(B<0)return!1;var A=Math.sqrt(B);if(L<0){if(f>0){if(Z=0,(I=(-z+A)/L)<=0)return!1}else if(I=1,(Z=(-z-A)/L)>=1)return!1}else if(I=(-z+A)/L,(Z=(-z-A)/L)>=1||I<=0)return!1}else{var P=-w/(2*z);if(z>0){if(Z=0,I=P,P<=0)return!1}else if(Z=P,I=1,P>=1)return!1}if(e+=m,I<=u||x<=Z)return!1;if(Z<u){if(0==(y=u))return!1;r.normal.init(0,f>0?-1:1,0)}else{if(0==(y=Z))return!1;var T=r.normal.init(_+b*y,0,h+p*y),S=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);S>0&&(S=1/S);var V=T.x*S,k=T.y*S,C=T.z*S;T.x=V,T.y=k,T.z=C;var q=T,R=this.cosTheta,j=q.x*R,O=q.y*R,E=q.z*R;q.x=j,q.y=O,q.z=E,r.normal.y+=this.sinTheta}return r.position.init(_+y*b,e+y*f,h+y*p),r.fraction=y,!0}});var M=function(t){n.call(this,5),this._numVertices=t.length;var i=this._numVertices,a=new Array(i);this._vertices=a;var o=this._numVertices,s=new Array(o);this._tmpVertices=s;for(var r=0,_=this._numVertices;r<_;){var e=r++;this._vertices[e]=t[e],this._tmpVertices[e]=new E}this._useGjkRayCast=!0,this._updateMass()};M.__super__=n,M.prototype=t(n.prototype,{getVertices:function(){return this._vertices},_updateMass:function(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;for(var t=this._vertices[0].x,i=this._vertices[0].y,a=this._vertices[0].z,n=this._vertices[0].x,o=this._vertices[0].y,s=this._vertices[0].z,r=1,_=this._numVertices;r<_;){var e=r++,h=this._vertices[e].x,l=this._vertices[e].y,v=this._vertices[e].z;h<t?t=h:h>n&&(n=h),l<i?i=l:l>o&&(o=l),v<a?a=v:v>s&&(s=v)}var c=n-t,m=o-i,b=s-a;this._volume=c*m*b;var f=.25*((t+n)*(t+n)+(i+o)*(i+o)+(a+s)*(a+s));c=c*c*.25,m=m*m*.25,b=b*b*.25,this._inertiaCoeff00=.3333333333333333*(m+b)+f,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(b+c)+f,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(c+m)+f},_computeAabb:function(t,i){var a,n,o,s,r,_,e,h,l,v,c,m;e=this._gjkMargin,h=this._gjkMargin,l=this._gjkMargin;var b,f,p,u=this._vertices[0];v=u.x,c=u.y,m=u.z,b=i._rotation00*v+i._rotation01*c+i._rotation02*m,f=i._rotation10*v+i._rotation11*c+i._rotation12*m,p=i._rotation20*v+i._rotation21*c+i._rotation22*m,a=b+=i._positionX,n=f+=i._positionY,o=p+=i._positionZ,s=b,r=f,_=p;for(var x=1,X=this._numVertices;x<X;){var M=x++,g=this._vertices[M];v=g.x,c=g.y,m=g.z,b=i._rotation00*v+i._rotation01*c+i._rotation02*m,f=i._rotation10*v+i._rotation11*c+i._rotation12*m,p=i._rotation20*v+i._rotation21*c+i._rotation22*m,b+=i._positionX,f+=i._positionY,p+=i._positionZ,a=a<b?a:b,n=n<f?n:f,o=o<p?o:p,s=s>b?s:b,r=r>f?r:f,_=_>p?_:p}t._minX=a-e,t._minY=n-h,t._minZ=o-l,t._maxX=s+e,t._maxY=r+h,t._maxZ=_+l},computeLocalSupportingVertex:function(t,i){for(var a=this._vertices[0],n=a.x*t.x+a.y*t.y+a.z*t.z,o=0,s=1,r=this._numVertices;s<r;){var _=s++,e=this._vertices[_],h=e.x*t.x+e.y*t.y+e.z*t.z;h>n&&(n=h,o=_)}var l=this._vertices[o];i.x=l.x,i.y=l.y,i.z=l.z}});var g=function(t,i){n.call(this,2),this._radius=t,this._halfHeight=i,this._updateMass()};g.__super__=n,g.prototype=t(n.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)},_computeAabb:function(t,i){var a,n,o,s,r,_;a=i._rotation01,n=i._rotation11,o=i._rotation21;var e,h,l,v=(a=a<0?-a:a)*a,c=(n=n<0?-n:n)*n,m=(o=o<0?-o:o)*o;s=Math.sqrt(1-v),r=Math.sqrt(1-c),_=Math.sqrt(1-m),s*=this._radius,r*=this._radius,_*=this._radius,e=s+a*this._halfHeight,h=r+n*this._halfHeight,l=_+o*this._halfHeight,t._minX=i._positionX-e,t._minY=i._positionY-h,t._minZ=i._positionZ-l,t._maxX=i._positionX+e,t._maxY=i._positionY+h,t._maxZ=i._positionZ+l},computeLocalSupportingVertex:function(t,i){var a=t.x,n=t.z,o=a*a+n*n,s=this._radius-this._gjkMargin;s<0&&(s=0);var r=o>0?s/Math.sqrt(o):0,_=this._halfHeight-this._gjkMargin;_<0&&(_=0),i.x=a*r,i.y=t.y>0?_:-_,i.z=n*r},_rayCastLocal:function(t,i,a,n,o,s,r){var _=t,e=i,h=a,l=n,v=o,c=s,m=this._halfHeight,b=l-_,f=v-e,p=c-h,u=0,x=1;if(f>-1e-6&&f<1e-6){if(e<=-m||e>=m)return!1}else{var X=1/f,M=(-m-e)*X,g=(m-e)*X;if(M>g){var Y=M;M=g,g=Y}M>0&&(u=M),g<1&&(x=g)}if(u>=1||x<=0)return!1;var Z,I=0,y=1,d=b*b+p*p,L=_*b+h*p,z=_*_+h*h-this._radius*this._radius,w=L*L-d*z;if(w<0)return!1;if(d>0){var B=Math.sqrt(w);if(y=(-L+B)/d,(I=(-L-B)/d)>=1||y<=0)return!1}else{if(z>=0)return!1;I=0,y=1}if(y<=u||x<=I)return!1;if(I<u){if(0==(Z=u))return!1;r.normal.init(0,f>0?-1:1,0)}else{if(0==(Z=I))return!1;var A=r.normal.init(_+b*Z,0,h+p*Z),P=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);P>0&&(P=1/P);var T=A.x*P,S=A.y*P,V=A.z*P;A.x=T,A.y=S,A.z=V}return r.position.init(_+Z*b,e+Z*f,h+Z*p),r.fraction=Z,!0}});var Y=function(){},Z=function(){this.position=new E,this.normal=new E,this.fraction=0},I=function(t){n.call(this,0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()};I.__super__=n,I.prototype=t(n.prototype,{getRadius:function(){return this._radius},_updateMass:function(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius},_computeAabb:function(t,i){var a,n,o;a=this._radius,n=this._radius,o=this._radius,t._minX=i._positionX-a,t._minY=i._positionY-n,t._minZ=i._positionZ-o,t._maxX=i._positionX+a,t._maxY=i._positionY+n,t._maxZ=i._positionZ+o},computeLocalSupportingVertex:function(t,i){i.zero()},_rayCastLocal:function(t,i,a,n,o,s,r){var _,e,h,l=(_=n-t)*_+(e=o-i)*e+(h=s-a)*h,v=t*_+i*e+a*h,c=v*v-l*(t*t+i*i+a*a-this._radius*this._radius);if(c<0)return!1;var m,b,f,p,u,x,X=(-v-Math.sqrt(c))/l;if(X<0||X>1)return!1;var M=(m=t+_*X)*m+(b=i+e*X)*b+(f=a+h*X)*f;M>0&&(M=1/Math.sqrt(M)),p=m*M,u=b*M,x=f*M;var g=r.position;g.x=m,g.y=b,g.z=f;var Y=r.normal;return Y.x=p,Y.y=u,Y.z=x,r.fraction=X,!0}});var y=function(){var t=new Array(8);this.detectors=t;for(var i=0;i<6;){var a=i++,n=this.detectors,o=new Array(8);n[a]=o}var s=new S;this.detectors[0][0]=new C,this.detectors[0][1]=new V(!1),this.detectors[0][2]=s,this.detectors[0][3]=s,this.detectors[0][4]=new k(!1),this.detectors[0][5]=s,this.detectors[1][0]=new V(!0),this.detectors[1][1]=new w,this.detectors[1][2]=s,this.detectors[1][3]=s,this.detectors[1][4]=s,this.detectors[1][5]=s,this.detectors[2][0]=s,this.detectors[2][1]=s,this.detectors[2][2]=s,this.detectors[2][3]=s,this.detectors[2][4]=s,this.detectors[2][5]=s,this.detectors[3][0]=s,this.detectors[3][1]=s,this.detectors[3][2]=s,this.detectors[3][3]=s,this.detectors[3][4]=s,this.detectors[3][5]=s,this.detectors[4][0]=new k(!0),this.detectors[4][1]=s,this.detectors[4][2]=s,this.detectors[4][3]=s,this.detectors[4][4]=new T,this.detectors[4][5]=s,this.detectors[5][0]=s,this.detectors[5][1]=s,this.detectors[5][2]=s,this.detectors[5][3]=s,this.detectors[5][4]=s,this.detectors[5][5]=s};y.prototype={getDetector:function(t,i){return this.detectors[t][i]}};var d=function(){this.numPoints=0,this.normal=new E;var t=D.maxManifoldPoints,i=new Array(t);this.points=i,this.incremental=!1;for(var a=0,n=D.maxManifoldPoints;a<n;){var o=a++;this.points[o]=new L}};d.prototype={getMaxDepth:function(){for(var t=0,i=0,a=this.numPoints;i<a;){var n=i++;this.points[n].depth>t&&(t=this.points[n].depth)}return t},clear:function(){this.numPoints=0;for(var t=0,i=this.points;t<i.length;){var a=i[t];++t,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}this.normal.zero()}};var L=function(){this.position1=new E,this.position2=new E,this.depth=0,this.id=0},z=function(t){this.swapped=t};z.prototype={setNormal:function(t,i,a,n){var o=t.normal;if(o.x=i,o.y=a,o.z=n,this.swapped){var s=t.normal,r=-s.x,_=-s.y,e=-s.z;s.x=r,s.y=_,s.z=e}},addPoint:function(t,i,a,n,o,s,r,_,e){var h=t.points[t.numPoints++];if(h.depth=_,h.id=e,this.swapped){var l=h.position1;l.x=o,l.y=s,l.z=r;var v=h.position2;v.x=i,v.y=a,v.z=n}else{var c=h.position1;c.x=i,c.y=a,c.z=n;var m=h.position2;m.x=o,m.y=s,m.z=r}},detectImpl:function(t,i,a,n,o,s){},detect:function(t,i,a,n,o,s){t.numPoints=0;for(var r=0,_=t.points;r<_.length;){var e=_[r];++r,e.position1.zero(),e.position2.zero(),e.depth=0,e.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,a,i,o,n,s):this.detectImpl(t,i,a,n,o,s)}};var w=function(){z.call(this,!1),this.clipper=new A};w.__super__=z,w.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T=i,S=a;t.incremental=!1,r=n._positionX,_=n._positionY,e=n._positionZ,c=(h=o._positionX)-r,m=(l=o._positionY)-_,b=(v=o._positionZ)-e,f=n._rotation00,p=n._rotation10,u=n._rotation20,x=n._rotation01,X=n._rotation11,M=n._rotation21,g=n._rotation02,Y=n._rotation12,Z=n._rotation22,I=o._rotation00,y=o._rotation10,d=o._rotation20,L=o._rotation01,z=o._rotation11,w=o._rotation21,B=o._rotation02,A=o._rotation12,P=o._rotation22;var V,k,C,q,R,j,O,E,F,N,W,G,U,J,H,Q,K,$,tt=T._halfExtentsX,it=T._halfExtentsY,at=T._halfExtentsZ,nt=S._halfExtentsX,ot=S._halfExtentsY,st=S._halfExtentsZ;V=f*tt,k=p*tt,C=u*tt,q=x*it,R=X*it,j=M*it,O=g*at,E=Y*at,F=Z*at;var rt,_t,et,ht=1/0,lt=-1,vt=0;rt=0,_t=0,et=0;var ct=tt,mt=f*(N=I*nt)+p*(W=y*nt)+u*(G=d*nt),bt=f*(U=L*ot)+p*(J=z*ot)+u*(H=w*ot),ft=f*(Q=B*st)+p*(K=A*st)+u*($=P*st);mt<0&&(mt=-mt),bt<0&&(bt=-bt),ft<0&&(ft=-ft);var pt=mt+bt+ft,ut=f*c+p*m+u*b,xt=ct+pt,Xt=ut<0,Mt=Xt?-ut:ut;if(Mt<xt){var gt=xt-Mt;gt<ht&&(ht=gt,lt=0,rt=f,_t=p,et=u,vt=Xt?-1:1),ct=it;var Yt=x*N+X*W+M*G,Zt=x*U+X*J+M*H,It=x*Q+X*K+M*$;Yt<0&&(Yt=-Yt),Zt<0&&(Zt=-Zt),It<0&&(It=-It);var yt=ct+(pt=Yt+Zt+It),dt=(ut=x*c+X*m+M*b)<0,Lt=dt?-ut:ut;if(Lt<yt){var zt=yt-Lt;zt<ht&&(ht=zt,lt=1,rt=x,_t=X,et=M,vt=dt?-1:1),ct=at;var wt=g*N+Y*W+Z*G,Bt=g*U+Y*J+Z*H,At=g*Q+Y*K+Z*$;wt<0&&(wt=-wt),Bt<0&&(Bt=-Bt),At<0&&(At=-At);var Pt=ct+(pt=wt+Bt+At),Tt=(ut=g*c+Y*m+Z*b)<0,St=Tt?-ut:ut;if(St<Pt){var Vt=Pt-St;Vt<ht&&(ht=Vt,lt=2,rt=g,_t=Y,et=Z,vt=Tt?-1:1),ht>D.linearSlop?ht-=D.linearSlop:ht=0;var kt=I*V+y*k+d*C,Ct=I*q+y*R+d*j,qt=I*O+y*E+d*F;kt<0&&(kt=-kt),Ct<0&&(Ct=-Ct),qt<0&&(qt=-qt);var Rt=(ct=kt+Ct+qt)+(pt=nt),jt=(ut=I*c+y*m+d*b)<0,Ot=jt?-ut:ut;if(Ot<Rt){var Et=Rt-Ot;Et<ht&&(ht=Et,lt=3,rt=I,_t=y,et=d,vt=jt?-1:1);var Ft=L*V+z*k+w*C,Dt=L*q+z*R+w*j,Nt=L*O+z*E+w*F;Ft<0&&(Ft=-Ft),Dt<0&&(Dt=-Dt),Nt<0&&(Nt=-Nt);var Wt=(ct=Ft+Dt+Nt)+(pt=ot),Gt=(ut=L*c+z*m+w*b)<0,Ut=Gt?-ut:ut;if(Ut<Wt){var Jt=Wt-Ut;Jt<ht&&(ht=Jt,lt=4,rt=L,_t=z,et=w,vt=Gt?-1:1);var Ht=B*V+A*k+P*C,Qt=B*q+A*R+P*j,Kt=B*O+A*E+P*F;Ht<0&&(Ht=-Ht),Qt<0&&(Qt=-Qt),Kt<0&&(Kt=-Kt);var $t=(ct=Ht+Qt+Kt)+(pt=st),ti=(ut=B*c+A*m+P*b)<0,ii=ti?-ut:ut;if(ii<$t){var ai,ni,oi,si,ri,_i,ei,hi,li,vi,ci,mi,bi,fi,pi,ui,xi,Xi,Mi,gi,Yi,Zi=$t-ii;if(Zi<ht&&(ht=Zi,lt=5,rt=B,_t=A,et=P,vt=ti?-1:1),ht>D.linearSlop?ht-=D.linearSlop:ht=0,ni=u*I-f*d,oi=f*y-p*I,0!=(ai=p*d-u*y)||0!=ni||0!=oi){var Ii=ai*ai+ni*ni+oi*oi;Ii>0&&(Ii=1/Math.sqrt(Ii));var yi=(ai*=Ii)*q+(ni*=Ii)*R+(oi*=Ii)*j,di=ai*O+ni*E+oi*F;yi<0&&(yi=-yi),di<0&&(di=-di),ct=yi+di;var Li=ai*U+ni*J+oi*H,zi=ai*Q+ni*K+oi*$;Li<0&&(Li=-Li),zi<0&&(zi=-zi);var wi=ct+(pt=Li+zi),Bi=(ut=ai*c+ni*m+oi*b)<0,Ai=Bi?-ut:ut;if(!(Ai<wi))return;var Pi=wi-Ai;Pi<ht&&(ht=Pi,lt=6,rt=ai,_t=ni,et=oi,vt=Bi?-1:1)}if(ni=u*L-f*w,oi=f*z-p*L,0!=(ai=p*w-u*z)||0!=ni||0!=oi){var Ti=ai*ai+ni*ni+oi*oi;Ti>0&&(Ti=1/Math.sqrt(Ti));var Si=(ai*=Ti)*q+(ni*=Ti)*R+(oi*=Ti)*j,Vi=ai*O+ni*E+oi*F;Si<0&&(Si=-Si),Vi<0&&(Vi=-Vi),ct=Si+Vi;var ki=ai*N+ni*W+oi*G,Ci=ai*Q+ni*K+oi*$;ki<0&&(ki=-ki),Ci<0&&(Ci=-Ci);var qi=ct+(pt=ki+Ci),Ri=(ut=ai*c+ni*m+oi*b)<0,ji=Ri?-ut:ut;if(!(ji<qi))return;var Oi=qi-ji;Oi<ht&&(ht=Oi,lt=7,rt=ai,_t=ni,et=oi,vt=Ri?-1:1)}if(ni=u*B-f*P,oi=f*A-p*B,0!=(ai=p*P-u*A)||0!=ni||0!=oi){var Ei=ai*ai+ni*ni+oi*oi;Ei>0&&(Ei=1/Math.sqrt(Ei));var Fi=(ai*=Ei)*q+(ni*=Ei)*R+(oi*=Ei)*j,Di=ai*O+ni*E+oi*F;Fi<0&&(Fi=-Fi),Di<0&&(Di=-Di),ct=Fi+Di;var Ni=ai*N+ni*W+oi*G,Wi=ai*U+ni*J+oi*H;Ni<0&&(Ni=-Ni),Wi<0&&(Wi=-Wi);var Gi=ct+(pt=Ni+Wi),Ui=(ut=ai*c+ni*m+oi*b)<0,Ji=Ui?-ut:ut;if(!(Ji<Gi))return;var Hi=Gi-Ji;Hi<ht&&(ht=Hi,lt=8,rt=ai,_t=ni,et=oi,vt=Ui?-1:1)}if(ni=M*I-x*d,oi=x*y-X*I,0!=(ai=X*d-M*y)||0!=ni||0!=oi){var Qi=ai*ai+ni*ni+oi*oi;Qi>0&&(Qi=1/Math.sqrt(Qi));var Ki=(ai*=Qi)*V+(ni*=Qi)*k+(oi*=Qi)*C,$i=ai*O+ni*E+oi*F;Ki<0&&(Ki=-Ki),$i<0&&($i=-$i),ct=Ki+$i;var ta=ai*U+ni*J+oi*H,ia=ai*Q+ni*K+oi*$;ta<0&&(ta=-ta),ia<0&&(ia=-ia);var aa=ct+(pt=ta+ia),na=(ut=ai*c+ni*m+oi*b)<0,oa=na?-ut:ut;if(!(oa<aa))return;var sa=aa-oa;sa<ht&&(ht=sa,lt=9,rt=ai,_t=ni,et=oi,vt=na?-1:1)}if(ni=M*L-x*w,oi=x*z-X*L,0!=(ai=X*w-M*z)||0!=ni||0!=oi){var ra=ai*ai+ni*ni+oi*oi;ra>0&&(ra=1/Math.sqrt(ra));var _a=(ai*=ra)*V+(ni*=ra)*k+(oi*=ra)*C,ea=ai*O+ni*E+oi*F;_a<0&&(_a=-_a),ea<0&&(ea=-ea),ct=_a+ea;var ha=ai*N+ni*W+oi*G,la=ai*Q+ni*K+oi*$;ha<0&&(ha=-ha),la<0&&(la=-la);var va=ct+(pt=ha+la),ca=(ut=ai*c+ni*m+oi*b)<0,ma=ca?-ut:ut;if(!(ma<va))return;var ba=va-ma;ba<ht&&(ht=ba,lt=10,rt=ai,_t=ni,et=oi,vt=ca?-1:1)}if(ni=M*B-x*P,oi=x*A-X*B,0!=(ai=X*P-M*A)||0!=ni||0!=oi){var fa=ai*ai+ni*ni+oi*oi;fa>0&&(fa=1/Math.sqrt(fa));var pa=(ai*=fa)*V+(ni*=fa)*k+(oi*=fa)*C,ua=ai*O+ni*E+oi*F;pa<0&&(pa=-pa),ua<0&&(ua=-ua),ct=pa+ua;var xa=ai*N+ni*W+oi*G,Xa=ai*U+ni*J+oi*H;xa<0&&(xa=-xa),Xa<0&&(Xa=-Xa);var Ma=ct+(pt=xa+Xa),ga=(ut=ai*c+ni*m+oi*b)<0,Ya=ga?-ut:ut;if(!(Ya<Ma))return;var Za=Ma-Ya;Za<ht&&(ht=Za,lt=11,rt=ai,_t=ni,et=oi,vt=ga?-1:1)}if(ni=Z*I-g*d,oi=g*y-Y*I,0!=(ai=Y*d-Z*y)||0!=ni||0!=oi){var Ia=ai*ai+ni*ni+oi*oi;Ia>0&&(Ia=1/Math.sqrt(Ia));var ya=(ai*=Ia)*V+(ni*=Ia)*k+(oi*=Ia)*C,da=ai*q+ni*R+oi*j;ya<0&&(ya=-ya),da<0&&(da=-da),ct=ya+da;var La=ai*U+ni*J+oi*H,za=ai*Q+ni*K+oi*$;La<0&&(La=-La),za<0&&(za=-za);var wa=ct+(pt=La+za),Ba=(ut=ai*c+ni*m+oi*b)<0,Aa=Ba?-ut:ut;if(!(Aa<wa))return;var Pa=wa-Aa;Pa<ht&&(ht=Pa,lt=12,rt=ai,_t=ni,et=oi,vt=Ba?-1:1)}if(ni=Z*L-g*w,oi=g*z-Y*L,0!=(ai=Y*w-Z*z)||0!=ni||0!=oi){var Ta=ai*ai+ni*ni+oi*oi;Ta>0&&(Ta=1/Math.sqrt(Ta));var Sa=(ai*=Ta)*V+(ni*=Ta)*k+(oi*=Ta)*C,Va=ai*q+ni*R+oi*j;Sa<0&&(Sa=-Sa),Va<0&&(Va=-Va),ct=Sa+Va;var ka=ai*N+ni*W+oi*G,Ca=ai*Q+ni*K+oi*$;ka<0&&(ka=-ka),Ca<0&&(Ca=-Ca);var qa=ct+(pt=ka+Ca),Ra=(ut=ai*c+ni*m+oi*b)<0,ja=Ra?-ut:ut;if(!(ja<qa))return;var Oa=qa-ja;Oa<ht&&(ht=Oa,lt=13,rt=ai,_t=ni,et=oi,vt=Ra?-1:1)}if(ni=Z*B-g*P,oi=g*A-Y*B,0!=(ai=Y*P-Z*A)||0!=ni||0!=oi){var Ea=ai*ai+ni*ni+oi*oi;Ea>0&&(Ea=1/Math.sqrt(Ea));var Fa=(ai*=Ea)*V+(ni*=Ea)*k+(oi*=Ea)*C,Da=ai*q+ni*R+oi*j;Fa<0&&(Fa=-Fa),Da<0&&(Da=-Da),ct=Fa+Da;var Na=ai*N+ni*W+oi*G,Wa=ai*U+ni*J+oi*H;Na<0&&(Na=-Na),Wa<0&&(Wa=-Wa);var Ga=ct+(pt=Na+Wa),Ua=(ut=ai*c+ni*m+oi*b)<0,Ja=Ua?-ut:ut;if(!(Ja<Ga))return;var Ha=Ga-Ja;Ha<ht&&(ht=Ha,lt=14,rt=ai,_t=ni,et=oi,vt=Ua?-1:1)}if(lt>=6){rt*=vt,_t*=vt,et*=vt;var Qa,Ka,$a,tn,an,nn,on,sn,rn,_n,en,hn,ln,vn,cn,mn=(lt-6)/3|0,bn=lt-6-3*mn;switch(mn){case 0:on=f,sn=p,rn=u;var fn=O*rt+E*_t+F*et>0;q*rt+R*_t+j*et>0?fn?(Qa=q+O,Ka=R+E,$a=j+F):(Qa=q-O,Ka=R-E,$a=j-F):fn?(Qa=O-q,Ka=E-R,$a=F-j):(Qa=-(Qa=q+O),Ka=-(Ka=R+E),$a=-($a=j+F));break;case 1:on=x,sn=X,rn=M;var pn=O*rt+E*_t+F*et>0;V*rt+k*_t+C*et>0?pn?(Qa=V+O,Ka=k+E,$a=C+F):(Qa=V-O,Ka=k-E,$a=C-F):pn?(Qa=O-V,Ka=E-k,$a=F-C):(Qa=-(Qa=V+O),Ka=-(Ka=k+E),$a=-($a=C+F));break;default:on=g,sn=Y,rn=Z;var un=q*rt+R*_t+j*et>0;V*rt+k*_t+C*et>0?un?(Qa=V+q,Ka=k+R,$a=C+j):(Qa=V-q,Ka=k-R,$a=C-j):un?(Qa=q-V,Ka=R-k,$a=j-C):(Qa=-(Qa=V+q),Ka=-(Ka=k+R),$a=-($a=C+j))}switch(Qa=r+Qa,Ka=_+Ka,$a=e+$a,bn){case 0:_n=I,en=y,hn=d;var xn=Q*rt+K*_t+$*et>0;U*rt+J*_t+H*et>0?xn?(tn=U+Q,an=J+K,nn=H+$):(tn=U-Q,an=J-K,nn=H-$):xn?(tn=Q-U,an=K-J,nn=$-H):(tn=-(tn=U+Q),an=-(an=J+K),nn=-(nn=H+$));break;case 1:_n=L,en=z,hn=w;var Xn=Q*rt+K*_t+$*et>0;N*rt+W*_t+G*et>0?Xn?(tn=N+Q,an=W+K,nn=G+$):(tn=N-Q,an=W-K,nn=G-$):Xn?(tn=Q-N,an=K-W,nn=$-G):(tn=-(tn=N+Q),an=-(an=W+K),nn=-(nn=G+$));break;default:_n=B,en=A,hn=P;var Mn=U*rt+J*_t+H*et>0;N*rt+W*_t+G*et>0?Mn?(tn=N+U,an=W+J,nn=G+H):(tn=N-U,an=W-J,nn=G-H):Mn?(tn=U-N,an=J-W,nn=H-G):(tn=-(tn=N+U),an=-(an=W+J),nn=-(nn=G+H))}var gn,Yn,Zn,In,yn,dn,Ln,zn,wn,Bn=on*_n+sn*en+rn*hn,An=on*(ln=Qa-(tn=h-tn))+sn*(vn=Ka-(an=l-an))+rn*(cn=$a-(nn=v-nn)),Pn=_n*ln+en*vn+hn*cn,Tn=1/(1-Bn*Bn),Sn=(Bn*Pn-An)*Tn,Vn=(Pn-Bn*An)*Tn;return gn=Qa+on*Sn,Yn=Ka+sn*Sn,Zn=$a+rn*Sn,In=tn+_n*Vn,yn=an+en*Vn,dn=nn+hn*Vn,Ln=-rt,zn=-_t,wn=-et,this.setNormal(t,Ln,zn,wn),void this.addPoint(t,gn,Yn,Zn,In,yn,dn,ht,4)}if(lt>=3){vt=-vt,c=-c,m=-m,b=-b;var kn=T;T=S,S=kn;var Cn=tt;tt=nt,nt=Cn;var qn=it;it=ot,ot=qn;var Rn=at;at=st,st=Rn,si=r,ri=_,_i=e,r=h,_=l,e=v,h=si,l=ri,v=_i,si=f,ri=p,_i=u,f=I,p=y,u=d,I=si,y=ri,d=_i,si=x,ri=X,_i=M,x=L,X=z,M=w,L=si,z=ri,w=_i,si=g,ri=Y,_i=Z,g=B,Y=A,Z=P,B=si,A=ri,P=_i,si=V,ri=k,_i=C,V=N,k=W,C=G,N=si,W=ri,G=_i,si=q,ri=R,_i=j,q=U,R=J,j=H,U=si,J=ri,H=_i,si=O,ri=E,_i=F,O=Q,E=K,F=$,Q=si,K=ri,$=_i,lt-=3,ei=!0}else ei=!1;switch(lt){case 0:hi=V,li=k,vi=C,ci=f,mi=p,bi=u,fi=x,pi=X,ui=M,xi=g,Xi=Y,Mi=Z,gi=it,Yi=at;break;case 1:hi=q,li=R,vi=j,ci=x,mi=X,bi=M,fi=g,pi=Y,ui=Z,xi=f,Xi=p,Mi=u,gi=at,Yi=tt;break;default:hi=O,li=E,vi=F,ci=g,mi=Y,bi=Z,fi=f,pi=p,ui=u,xi=x,Xi=X,Mi=M,gi=tt,Yi=it}if(vt<0){hi=-hi,li=-li,vi=-vi,ci=-ci,mi=-mi,bi=-bi,si=fi,ri=pi,_i=ui,fi=xi,pi=Xi,ui=Mi,xi=si,Xi=ri,Mi=_i;var jn=gi;gi=Yi,Yi=jn}hi+=r,li+=_,vi+=e;var On,En,Fn,Dn,Nn,Wn,Gn,Un,Jn,Hn,Qn,Kn,$n=1,to=0,io=ci*I+mi*y+bi*d;switch(io<$n&&($n=io,to=0),-io<$n&&($n=-io,to=1),(io=ci*L+mi*z+bi*w)<$n&&($n=io,to=2),-io<$n&&($n=-io,to=3),(io=ci*B+mi*A+bi*P)<$n&&($n=io,to=4),-io<$n&&($n=-io,to=5),to){case 0:On=N+U,En=W+J,Fn=G+H,On+=Q,En+=K,Fn+=$,Dn=N-U,Nn=W-J,Wn=G-H,Dn+=Q,Nn+=K,Wn+=$,Gn=N-U,Un=W-J,Jn=G-H,Gn-=Q,Un-=K,Jn-=$,Hn=N+U,Qn=W+J,Kn=G+H,Hn-=Q,Qn-=K,Kn-=$;break;case 1:On=U-N,En=J-W,Fn=H-G,On+=Q,En+=K,Fn+=$,Dn=U-N,Nn=J-W,Wn=H-G,Dn-=Q,Nn-=K,Wn-=$,Gn=-(Gn=N+U),Un=-(Un=W+J),Jn=-(Jn=G+H),Gn-=Q,Un-=K,Jn-=$,Hn=-(Hn=N+U),Qn=-(Qn=W+J),Kn=-(Kn=G+H),Hn+=Q,Qn+=K,Kn+=$;break;case 2:On=N+U,En=W+J,Fn=G+H,On+=Q,En+=K,Fn+=$,Dn=N+U,Nn=W+J,Wn=G+H,Dn-=Q,Nn-=K,Wn-=$,Gn=U-N,Un=J-W,Jn=H-G,Gn-=Q,Un-=K,Jn-=$,Hn=U-N,Qn=J-W,Kn=H-G,Hn+=Q,Qn+=K,Kn+=$;break;case 3:On=N-U,En=W-J,Fn=G-H,On+=Q,En+=K,Fn+=$,Dn=-(Dn=N+U),Nn=-(Nn=W+J),Wn=-(Wn=G+H),Dn+=Q,Nn+=K,Wn+=$,Gn=-(Gn=N+U),Un=-(Un=W+J),Jn=-(Jn=G+H),Gn-=Q,Un-=K,Jn-=$,Hn=N-U,Qn=W-J,Kn=G-H,Hn-=Q,Qn-=K,Kn-=$;break;case 4:On=N+U,En=W+J,Fn=G+H,On+=Q,En+=K,Fn+=$,Dn=U-N,Nn=J-W,Wn=H-G,Dn+=Q,Nn+=K,Wn+=$,Gn=-(Gn=N+U),Un=-(Un=W+J),Jn=-(Jn=G+H),Gn+=Q,Un+=K,Jn+=$,Hn=N-U,Qn=W-J,Kn=G-H,Hn+=Q,Qn+=K,Kn+=$;break;default:On=N+U,En=W+J,Fn=G+H,On-=Q,En-=K,Fn-=$,Dn=N-U,Nn=W-J,Wn=G-H,Dn-=Q,Nn-=K,Wn-=$,Gn=-(Gn=N+U),Un=-(Un=W+J),Jn=-(Jn=G+H),Gn-=Q,Un-=K,Jn-=$,Hn=U-N,Qn=J-W,Kn=H-G,Hn-=Q,Qn-=K,Kn-=$}On+=c,En+=m,Fn+=b,Dn+=c,Nn+=m,Wn+=b,Gn+=c,Un+=m,Jn+=b,Hn+=c,Qn+=m,Kn+=b;var ao=this.clipper;ao.w=gi,ao.h=Yi,ao.numVertices=0,ao.numTmpVertices=0;var no=this.clipper,oo=no.vertices[no.numVertices++];oo.x=On*fi+En*pi+Fn*ui,oo.y=On*xi+En*Xi+Fn*Mi,oo.wx=On,oo.wy=En,oo.wz=Fn;var so=this.clipper,ro=so.vertices[so.numVertices++];ro.x=Dn*fi+Nn*pi+Wn*ui,ro.y=Dn*xi+Nn*Xi+Wn*Mi,ro.wx=Dn,ro.wy=Nn,ro.wz=Wn;var _o=this.clipper,eo=_o.vertices[_o.numVertices++];eo.x=Gn*fi+Un*pi+Jn*ui,eo.y=Gn*xi+Un*Xi+Jn*Mi,eo.wx=Gn,eo.wy=Un,eo.wz=Jn;var ho,lo,vo,co=this.clipper,mo=co.vertices[co.numVertices++];mo.x=Hn*fi+Qn*pi+Kn*ui,mo.y=Hn*xi+Qn*Xi+Kn*Mi,mo.wx=Hn,mo.wy=Qn,mo.wz=Kn,this.clipper.clip(),this.clipper.reduce(),ei?(ho=ci,lo=mi,vo=bi):(ho=-ci,lo=-mi,vo=-bi),this.setNormal(t,ho,lo,vo);for(var bo=0,fo=this.clipper.numVertices;bo<fo;){var po,uo,xo,Xo=bo++,Mo=this.clipper.vertices[Xo];po=Mo.wx,uo=Mo.wy,xo=Mo.wz;var go,Yo,Zo,Io=(hi-(po+=r))*ci+(li-(uo+=_))*mi+(vi-(xo+=e))*bi;go=po+ci*Io,Yo=uo+mi*Io,Zo=xo+bi*Io,Io>-D.contactPersistenceThreshold&&(ei?this.addPoint(t,po,uo,xo,go,Yo,Zo,Io,Xo):this.addPoint(t,go,Yo,Zo,po,uo,xo,Io,Xo))}}}}}}}}});var B=function(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0},A=function(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0;var t=new Array(8);this.vertices=t;var i=new Array(8);this.tmpVertices=i;for(var a=0;a<8;){var n=a++;this.vertices[n]=new B,this.tmpVertices[n]=new B}};A.prototype={clip:function(){for(var t=0,i=this.numVertices;t<i;){var a=t++,n=this.vertices[a],o=this.vertices[(a+1)%this.numVertices],s=this.w+n.x,r=this.w+o.x;if(s>0&&r>0){var _=this.tmpVertices[this.numTmpVertices++];_.x=n.x,_.y=n.y,_.wx=n.wx,_.wy=n.wy,_.wz=n.wz}else if(s>0&&r<=0){var e=this.tmpVertices[this.numTmpVertices++];e.x=n.x,e.y=n.y,e.wx=n.wx,e.wy=n.wy,e.wz=n.wz;var h=s/(s-r),l=this.tmpVertices[this.numTmpVertices++];l.x=n.x+(o.x-n.x)*h,l.y=n.y+(o.y-n.y)*h,l.wx=n.wx+(o.wx-n.wx)*h,l.wy=n.wy+(o.wy-n.wy)*h,l.wz=n.wz+(o.wz-n.wz)*h}else if(s<=0&&r>0){var v=s/(s-r),c=this.tmpVertices[this.numTmpVertices++];c.x=n.x+(o.x-n.x)*v,c.y=n.y+(o.y-n.y)*v,c.wx=n.wx+(o.wx-n.wx)*v,c.wy=n.wy+(o.wy-n.wy)*v,c.wz=n.wz+(o.wz-n.wz)*v}}var m=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=m,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var b=0,f=this.numVertices;b<f;){var p=b++,u=this.vertices[p],x=this.vertices[(p+1)%this.numVertices],X=this.w-u.x,M=this.w-x.x;if(X>0&&M>0){var g=this.tmpVertices[this.numTmpVertices++];g.x=u.x,g.y=u.y,g.wx=u.wx,g.wy=u.wy,g.wz=u.wz}else if(X>0&&M<=0){var Y=this.tmpVertices[this.numTmpVertices++];Y.x=u.x,Y.y=u.y,Y.wx=u.wx,Y.wy=u.wy,Y.wz=u.wz;var Z=X/(X-M),I=this.tmpVertices[this.numTmpVertices++];I.x=u.x+(x.x-u.x)*Z,I.y=u.y+(x.y-u.y)*Z,I.wx=u.wx+(x.wx-u.wx)*Z,I.wy=u.wy+(x.wy-u.wy)*Z,I.wz=u.wz+(x.wz-u.wz)*Z}else if(X<=0&&M>0){var y=X/(X-M),d=this.tmpVertices[this.numTmpVertices++];d.x=u.x+(x.x-u.x)*y,d.y=u.y+(x.y-u.y)*y,d.wx=u.wx+(x.wx-u.wx)*y,d.wy=u.wy+(x.wy-u.wy)*y,d.wz=u.wz+(x.wz-u.wz)*y}}var L=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=L,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var z=0,w=this.numVertices;z<w;){var B=z++,A=this.vertices[B],P=this.vertices[(B+1)%this.numVertices],T=this.h+A.y,S=this.h+P.y;if(T>0&&S>0){var V=this.tmpVertices[this.numTmpVertices++];V.x=A.x,V.y=A.y,V.wx=A.wx,V.wy=A.wy,V.wz=A.wz}else if(T>0&&S<=0){var k=this.tmpVertices[this.numTmpVertices++];k.x=A.x,k.y=A.y,k.wx=A.wx,k.wy=A.wy,k.wz=A.wz;var C=T/(T-S),q=this.tmpVertices[this.numTmpVertices++];q.x=A.x+(P.x-A.x)*C,q.y=A.y+(P.y-A.y)*C,q.wx=A.wx+(P.wx-A.wx)*C,q.wy=A.wy+(P.wy-A.wy)*C,q.wz=A.wz+(P.wz-A.wz)*C}else if(T<=0&&S>0){var R=T/(T-S),j=this.tmpVertices[this.numTmpVertices++];j.x=A.x+(P.x-A.x)*R,j.y=A.y+(P.y-A.y)*R,j.wx=A.wx+(P.wx-A.wx)*R,j.wy=A.wy+(P.wy-A.wy)*R,j.wz=A.wz+(P.wz-A.wz)*R}}var O=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=O,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;for(var E=0,F=this.numVertices;E<F;){var D=E++,N=this.vertices[D],W=this.vertices[(D+1)%this.numVertices],G=this.h-N.y,U=this.h-W.y;if(G>0&&U>0){var J=this.tmpVertices[this.numTmpVertices++];J.x=N.x,J.y=N.y,J.wx=N.wx,J.wy=N.wy,J.wz=N.wz}else if(G>0&&U<=0){var H=this.tmpVertices[this.numTmpVertices++];H.x=N.x,H.y=N.y,H.wx=N.wx,H.wy=N.wy,H.wz=N.wz;var Q=G/(G-U),K=this.tmpVertices[this.numTmpVertices++];K.x=N.x+(W.x-N.x)*Q,K.y=N.y+(W.y-N.y)*Q,K.wx=N.wx+(W.wx-N.wx)*Q,K.wy=N.wy+(W.wy-N.wy)*Q,K.wz=N.wz+(W.wz-N.wz)*Q}else if(G<=0&&U>0){var $=G/(G-U),tt=this.tmpVertices[this.numTmpVertices++];tt.x=N.x+(W.x-N.x)*$,tt.y=N.y+(W.y-N.y)*$,tt.wx=N.wx+(W.wx-N.wx)*$,tt.wy=N.wy+(W.wy-N.wy)*$,tt.wz=N.wz+(W.wz-N.wz)*$}}var it=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=it,this.numVertices=this.numTmpVertices,this.numTmpVertices=0},reduce:function(){if(!(this.numVertices<4)){for(var t=-1/0,i=1/0,a=-1/0,n=1/0,o=null,s=null,r=null,_=null,e=0,h=this.numVertices;e<h;){var l=e++,v=this.vertices[l],c=1*v.x+1*v.y,m=-1*v.x+1*v.y;c>t&&(t=c,o=v),c<i&&(i=c,s=v),m>a&&(a=m,r=v),m<n&&(n=m,_=v)}var b=this.tmpVertices[this.numTmpVertices++];b.x=o.x,b.y=o.y,b.wx=o.wx,b.wy=o.wy,b.wz=o.wz;var f=this.tmpVertices[this.numTmpVertices++];f.x=r.x,f.y=r.y,f.wx=r.wx,f.wy=r.wy,f.wz=r.wz;var p=this.tmpVertices[this.numTmpVertices++];p.x=s.x,p.y=s.y,p.wx=s.wx,p.wy=s.wy,p.wz=s.wz;var u=this.tmpVertices[this.numTmpVertices++];u.x=_.x,u.y=_.y,u.wx=_.wx,u.wy=_.wy,u.wz=_.wz;var x=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=x,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}}};var P=function(){};P.prototype={_clear:function(){null!=this._gjkCache&&this._gjkCache.clear()}};var T=function(){z.call(this,!1)};T.__super__=z,T.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r,_,e,h,l,v,c=i,m=a;t.incremental=!1,r=n._rotation01,_=n._rotation11,e=n._rotation21,h=o._rotation01,l=o._rotation11,v=o._rotation21;var b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V=c._halfHeight,k=m._halfHeight,C=c._radius,q=m._radius;b=n._positionX+r*-V,f=n._positionY+_*-V,p=n._positionZ+e*-V,u=n._positionX+r*V,x=n._positionY+_*V,X=n._positionZ+e*V,M=o._positionX+h*-k,g=o._positionY+l*-k,Y=o._positionZ+v*-k,Z=o._positionX+h*k,I=o._positionY+l*k,y=o._positionZ+v*k;var R,j,O,E,F,D,N,W,G,U,J,H=-((d=b-M)*(w=u-b)+(L=f-g)*(B=x-f)+(z=p-Y)*(A=X-p)),Q=d*(P=Z-M)+L*(T=I-g)+z*(S=y-Y),K=V*V*4,$=w*P+B*T+A*S,tt=k*k*4;if(0==K&&0==tt)R=0,j=0;else if(0==K)R=0,(j=Q)<0?j=0:j>tt?j=1:j/=tt;else if(0==tt)j=0,(R=H)<0?R=0:R>K?R=1:R/=K;else{var it=K*tt-$*$;0==it?R=0:(R=$*Q+tt*H)<0?R=0:R>it?R=1:R/=it,(j=R*$+Q)<0?(j=0,(R=H)<0?R=0:R>K?R=1:R/=K):j>tt?(j=1,(R=$+H)<0?R=0:R>K?R=1:R/=K):j/=tt}var at=(G=(O=b+w*R)-(D=M+P*j))*G+(U=(E=f+B*R)-(N=g+T*j))*U+(J=(F=p+A*R)-(W=Y+S*j))*J;if(!(at>=(C+q)*(C+q))){var nt,ot,st,rt,_t,et,ht,lt,vt,ct=Math.sqrt(at);ct>0?(nt=G*(1/ct),ot=U*(1/ct),st=J*(1/ct)):(nt=1,ot=0,st=0),this.setNormal(t,nt,ot,st),rt=O+nt*-C,_t=E+ot*-C,et=F+st*-C,ht=D+nt*q,lt=N+ot*q,vt=W+st*q,this.addPoint(t,rt,_t,et,ht,lt,vt,C+q-ct,0)}}});var S=function(){z.call(this,!1)};S.__super__=z,S.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r=N.instance,_=i,e=a,h=r.computeClosestPointsImpl(_,e,n,o,D.enableGJKCaching?s:null,!0);if(t.incremental=!0,h==W.SUCCEEDED){var l=_._gjkMargin,v=e._gjkMargin;if(!(r.distance>l+v)){var c,m,b,f,p,u,x=r.closestPoint1;c=x.x,m=x.y,b=x.z;var X,M,g,Y=r.closestPoint2;if(f=Y.x,p=Y.y,u=Y.z,(X=c-f)*X+(M=m-p)*M+(g=b-u)*g!=0){r.distance<0&&(X=-X,M=-M,g=-g);var Z=X*X+M*M+g*g;Z>0&&(Z=1/Math.sqrt(Z)),X*=Z,M*=Z,g*=Z,this.setNormal(t,X,M,g),c+=X*-_._gjkMargin,m+=M*-_._gjkMargin,b+=g*-_._gjkMargin,f+=X*e._gjkMargin,p+=M*e._gjkMargin,u+=g*e._gjkMargin,this.addPoint(t,c,m,b,f,p,u,_._gjkMargin+e._gjkMargin-r.distance,0)}}}else console.log("GjkEpaDetector.hx:28:","GJK/EPA failed: status="+h)}});var V=function(t){z.call(this,t)};V.__super__=z,V.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r,_,e,h,l,v,c=i,m=a;t.incremental=!1,h=-(r=m._halfExtentsX),l=-(_=m._halfExtentsY),v=-(e=m._halfExtentsZ);var b,f,p,u,x,X,M,g,Y,Z,I=c._radius;if(b=n._positionX-o._positionX,f=n._positionY-o._positionY,p=n._positionZ-o._positionZ,M=o._rotation00*b+o._rotation10*f+o._rotation20*p,x=o._rotation01*b+o._rotation11*f+o._rotation21*p,X=o._rotation02*b+o._rotation12*f+o._rotation22*p,h<(u=M)&&r>u&&l<x&&_>x&&v<X&&e>X){var y,d,L,z,w,B,A,P,T,S,V,k,C,q,R,j,O,E,F,D,N,W,G,U,J;y=r-(y=u<0?-u:u),d=_-(d=x<0?-x:x),L=e-(L=X<0?-X:X);return y<d?y<L?(u>0?(z=1,w=0,B=0):(z=-1,w=0,B=0),P=0,T=1,S=1,A=y):(X>0?(z=0,w=0,B=1):(z=0,w=0,B=-1),P=1,T=1,S=0,A=L):d<L?(x>0?(z=0,w=1,B=0):(z=0,w=-1,B=0),P=1,T=0,S=1,A=d):(X>0?(z=0,w=0,B=1):(z=0,w=0,B=-1),P=1,T=1,S=0,A=L),V=z*r,k=w*_,C=B*e,V+=P*u,k+=T*x,C+=S*X,q=o._rotation00*V+o._rotation01*k+o._rotation02*C,R=o._rotation10*V+o._rotation11*k+o._rotation12*C,j=o._rotation20*V+o._rotation21*k+o._rotation22*C,O=o._rotation00*z+o._rotation01*w+o._rotation02*B,E=o._rotation10*z+o._rotation11*w+o._rotation12*B,F=o._rotation20*z+o._rotation21*w+o._rotation22*B,this.setNormal(t,O,E,F),D=n._positionX+O*-I,N=n._positionY+E*-I,W=n._positionZ+F*-I,G=o._positionX+q,U=o._positionY+R,J=o._positionZ+j,void this.addPoint(t,D,N,W,G,U,J,A,0)}var H,Q,K;_-=1e-9,e-=1e-9,h+=1e-9,l+=1e-9,v+=1e-9,g=u<(r-=1e-9)?u:r,Y=x<_?x:_,Z=X<e?X:e;var $=(H=u-(g=g>h?g:h))*H+(Q=x-(Y=Y>l?Y:l))*Q+(K=X-(Z=Z>v?Z:v))*K;if(!($>=I*I)){var tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt;$=Math.sqrt($),tt=o._rotation00*g+o._rotation01*Y+o._rotation02*Z,it=o._rotation10*g+o._rotation11*Y+o._rotation12*Z,at=o._rotation20*g+o._rotation21*Y+o._rotation22*Z,rt=o._rotation00*H+o._rotation01*Q+o._rotation02*K,_t=o._rotation10*H+o._rotation11*Q+o._rotation12*K,et=o._rotation20*H+o._rotation21*Q+o._rotation22*K;var ct,mt,bt,ft,pt,ut,xt=(nt=rt)*nt+(ot=_t)*ot+(st=et)*st;xt>0&&(xt=1/Math.sqrt(xt)),ht=nt*xt,lt=ot*xt,vt=st*xt,this.setNormal(t,ht,lt,vt),ct=n._positionX+ht*-I,mt=n._positionY+lt*-I,bt=n._positionZ+vt*-I,ft=o._positionX+tt,pt=o._positionY+it,ut=o._positionZ+at,this.addPoint(t,ct,mt,bt,ft,pt,ut,I-$,0)}}});var k=function(t){z.call(this,t)};k.__super__=z,k.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r=i,_=a;t.incremental=!1;var e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=_._halfHeight,I=r._radius,y=_._radius;e=o._rotation01,h=o._rotation11,l=o._rotation21,v=n._positionX,c=n._positionY,m=n._positionZ,b=o._positionX+e*-Z,f=o._positionY+h*-Z,p=o._positionZ+l*-Z,u=o._positionX+e*Z,x=o._positionY+h*Z,X=o._positionZ+l*Z;var d,L,z,w,B,A,P=Z*Z*4,T=(v-b)*(M=u-b)+(c-f)*(g=x-f)+(m-p)*(Y=X-p);T<0?T=0:T>P?T=1:T/=P;var S=(w=v-(d=b+M*T))*w+(B=c-(L=f+g*T))*B+(A=m-(z=p+Y*T))*A;if(!(S>=(I+y)*(I+y))){var V,k,C,q,R,j,O,E,F,D=Math.sqrt(S);D>0?(V=w*(1/D),k=B*(1/D),C=A*(1/D)):(V=1,k=0,C=0),this.setNormal(t,V,k,C),q=v+V*-I,R=c+k*-I,j=m+C*-I,O=d+V*y,E=L+k*y,F=z+C*y,this.addPoint(t,q,R,j,O,E,F,I+y-D,0)}}});var C=function(){z.call(this,!1)};C.__super__=z,C.prototype=t(z.prototype,{detectImpl:function(t,i,a,n,o,s){var r,_,e,h=i,l=a;t.incremental=!1,r=n._positionX-o._positionX,_=n._positionY-o._positionY,e=n._positionZ-o._positionZ;var v=h._radius,c=l._radius,m=r*r+_*_+e*e;if(!(m>=(v+c)*(v+c))){var b,f,p,u,x,X,M,g,Y,Z=Math.sqrt(m);Z>0?(b=r*(1/Z),f=_*(1/Z),p=e*(1/Z)):(b=1,f=0,p=0),this.setNormal(t,b,f,p),u=n._positionX+b*-v,x=n._positionY+f*-v,X=n._positionZ+p*-v,M=o._positionX+b*c,g=o._positionY+f*c,Y=o._positionZ+p*c,this.addPoint(t,u,x,X,M,g,Y,v+c-Z,0)}}});var q=function(){var t=D.maxEPAVertices,i=new Array(t);this._vertices=i,this._center=new E,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null};q.prototype={dumpHoleEdge:function(t){},validate:function(){for(var t=this._triangleList;null!=t;){for(var i=t._next,a=0;a<3;){var n=a++;if(t._vertices[n]._tmpEdgeLoopOuterTriangle=null,t._vertices[n]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[n])return this._status=2,!1;if(null==t._adjacentTriangles[n])return this._status=3,!1}t=i}return!0},findEdgeLoop:function(t,i,a){if(i._tmpDfsId!=t){i._tmpDfsId=t;var n=i.tmp;n.x=a.x,n.y=a.y,n.z=a.z;var o=n,s=i._vertices[0].v,r=o.x-s.x,_=o.y-s.y,e=o.z-s.z;o.x=r,o.y=_,o.z=e;var h=i.tmp,l=i._normal;if(i._tmpDfsVisible=h.x*l.x+h.y*l.y+h.z*l.z>0,i._tmpDfsVisible){for(var v=0;v<3;){var c=v++,m=i._adjacentTriangles[c];if(null!=m){var b=m.tmp;b.x=a.x,b.y=a.y,b.z=a.z;var f=b,p=m._vertices[0].v,u=f.x-p.x,x=f.y-p.y,X=f.z-p.z;f.x=u,f.y=x,f.z=X;var M=m.tmp,g=m._normal;if(m._tmpDfsVisible=M.x*g.x+M.y*g.y+M.z*g.z>0,m._tmpDfsVisible)this.findEdgeLoop(t,m,a);else{var Y=i._nextIndex[c],Z=i._vertices[c],I=i._vertices[Y];Z._tmpEdgeLoopNext=I,Z._tmpEdgeLoopOuterTriangle=m}}}for(var y=0;y<3;){var d=y++,L=i._adjacentTriangles[d];if(null!=L){var z=i._adjacentPairIndex[d];L._adjacentTriangles[z]=null,L._adjacentPairIndex[z]=-1,i._adjacentTriangles[d]=null,i._adjacentPairIndex[d]=-1}}this._numTriangles--;var w=i._prev,B=i._next;null!=w&&(w._next=B),null!=B&&(B._prev=w),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}else this._status=6}},_init:function(t,i,a,n){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a,this._vertices[3]=n;var o=this._center,s=t.v;o.x=s.x,o.y=s.y,o.z=s.z;var r=o,_=i.v,e=r.x+_.x,h=r.y+_.y,l=r.z+_.z;r.x=e,r.y=h,r.z=l;var v=r,c=a.v,m=v.x+c.x,b=v.y+c.y,f=v.z+c.z;v.x=m,v.y=b,v.z=f;var p=v,u=n.v,x=p.x+u.x,X=p.y+u.y,M=p.z+u.z;p.x=x,p.y=X,p.z=M;var g=p,Y=.25*g.x,Z=.25*g.y,I=.25*g.z;g.x=Y,g.y=Z,g.z=I;var y=this._trianglePool;null!=y?(this._trianglePool=y._next,y._next=null):y=new R;var d=y,L=this._trianglePool;null!=L?(this._trianglePool=L._next,L._next=null):L=new R;var z=L,w=this._trianglePool;null!=w?(this._trianglePool=w._next,w._next=null):w=new R;var B=w,A=this._trianglePool;null!=A?(this._trianglePool=A._next,A._next=null):A=new R;var P=A;return d.init(t,i,a,this._center,!0)||(this._status=1),z.init(t,i,n,this._center,!0)||(this._status=1),B.init(t,a,n,this._center,!0)||(this._status=1),P.init(i,a,n,this._center,!0)||(this._status=1),d.setAdjacentTriangle(z)||(this._status=1),d.setAdjacentTriangle(B)||(this._status=1),d.setAdjacentTriangle(P)||(this._status=1),z.setAdjacentTriangle(B)||(this._status=1),z.setAdjacentTriangle(P)||(this._status=1),B.setAdjacentTriangle(P)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=d,this._triangleListLast=d):(this._triangleListLast._next=d,d._prev=this._triangleListLast,this._triangleListLast=d),this._numTriangles++,null==this._triangleList?(this._triangleList=z,this._triangleListLast=z):(this._triangleListLast._next=z,z._prev=this._triangleListLast,this._triangleListLast=z),this._numTriangles++,null==this._triangleList?(this._triangleList=B,this._triangleListLast=B):(this._triangleListLast._next=B,B._prev=this._triangleListLast,this._triangleListLast=B),this._numTriangles++,null==this._triangleList?(this._triangleList=P,this._triangleListLast=P):(this._triangleListLast._next=P,P._prev=this._triangleListLast,this._triangleListLast=P),0==this._status},_addVertex:function(t,i){this._vertices[this._numVertices++]=t;var a=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;for(var n=a,o=a,s=null,r=null;;){if(null==n._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==n._tmpEdgeLoopOuterTriangle)return this._status=5,!1;var _=this._trianglePool;null!=_?(this._trianglePool=_._next,_._next=null):_=new R;var e=_;if(null==r&&(r=e),e.init(n,n._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=e,this._triangleListLast=e):(this._triangleListLast._next=e,e._prev=this._triangleListLast,this._triangleListLast=e),e.setAdjacentTriangle(n._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=s&&(e.setAdjacentTriangle(s)||(this._status=1)),s=e,(n=n._tmpEdgeLoopNext)==o)break}return s.setAdjacentTriangle(r)||(this._status=1),0==this._status&&this.validate()},_dumpAsObjModel:function(){}};var R=function(){this.id=++R.count,this._next=null,this._prev=null,this._normal=new E,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1;var t=new Array(3);this._vertices=t;var i=new Array(3);this._adjacentTriangles=i;var a=new Array(3);this._adjacentPairIndex=a,this.tmp=new E;var n=new Array(3);this._nextIndex=n,this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0};R.prototype={init:function(t,i,a,n,o){var s,r,_,e,h,l,v,c,m,b,f,p;null==o&&(o=!1);var u=t.v;s=u.x,r=u.y,_=u.z;var x=i.v;e=x.x,h=x.y,l=x.z;var X=a.v;v=X.x,c=X.y,m=X.z;var M,g,Y,Z,I,y,d,L,z,w=n;b=w.x,f=w.y,p=w.z;var B=!1;if((s-b)*(d=(g=h-r)*(y=m-_)-(Y=l-_)*(I=c-r))+(r-f)*(L=Y*(Z=v-s)-(M=e-s)*y)+(_-p)*(z=M*I-g*Z)<0)if(o){var A=i;i=a,a=A,d*=-1,L*=-1,z*=-1}else B=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=a;var P=this._normal;P.x=d,P.y=L,P.z=z;var T,S,V,k,C,q,R,j,O,E,F,D,N,W,G,U,J,H,Q=t.v,K=i.v,$=a.v,tt=this.tmp,it=Q;T=it.x,S=it.y,V=it.z;var at=K;k=at.x,C=at.y,q=at.z;var nt,ot,st,rt=$;R=rt.x,j=rt.y,O=rt.z;var _t,et,ht,lt=k*((W=j-C)*(st=(E=k-T)*W-(F=C-S)*(N=R-k))-(G=O-q)*(ot=(D=q-V)*N-E*G))+C*(G*(nt=F*G-D*W)-N*st)+q*(N*ot-W*nt),vt=R*((J=S-j)*st-(H=V-O)*ot)+j*(H*nt-(U=T-R)*st)+O*(U*ot-J*nt),ct=-1;if(_t=0,et=0,ht=0,T*(F*st-D*ot)+S*(D*nt-E*st)+V*(E*ot-F*nt)<0){var mt,bt,ft,pt,ut,xt,Xt=Q;mt=Xt.x,bt=Xt.y,ft=Xt.z;var Mt,gt,Yt,Zt=K;pt=Zt.x,ut=Zt.y,xt=Zt.z;var It=(Mt=pt-mt)*mt+(gt=ut-bt)*bt+(Yt=xt-ft)*ft;if((It=-It/(Mt*Mt+gt*gt+Yt*Yt))<0){var yt=tt;yt.x=mt,yt.y=bt,yt.z=ft}else if(It>1){var dt=tt;dt.x=pt,dt.y=ut,dt.z=xt}else{var Lt,zt,wt;Lt=mt+Mt*It,zt=bt+gt*It,wt=ft+Yt*It;var Bt=tt;Bt.x=Lt,Bt.y=zt,Bt.z=wt}ct=tt.x*tt.x+tt.y*tt.y+tt.z*tt.z;var At=tt;_t=At.x,et=At.y,ht=At.z}if(lt<0){var Pt,Tt,St,Vt,kt,Ct,qt=K;Pt=qt.x,Tt=qt.y,St=qt.z;var Rt,jt,Ot,Et=$;Vt=Et.x,kt=Et.y,Ct=Et.z;var Ft=(Rt=Vt-Pt)*Pt+(jt=kt-Tt)*Tt+(Ot=Ct-St)*St;if((Ft=-Ft/(Rt*Rt+jt*jt+Ot*Ot))<0){var Dt=tt;Dt.x=Pt,Dt.y=Tt,Dt.z=St}else if(Ft>1){var Nt=tt;Nt.x=Vt,Nt.y=kt,Nt.z=Ct}else{var Wt,Gt,Ut;Wt=Pt+Rt*Ft,Gt=Tt+jt*Ft,Ut=St+Ot*Ft;var Jt=tt;Jt.x=Wt,Jt.y=Gt,Jt.z=Ut}var Ht=tt.x*tt.x+tt.y*tt.y+tt.z*tt.z;if(ct<0||Ht<ct){ct=Ht;var Qt=tt;_t=Qt.x,et=Qt.y,ht=Qt.z}}if(vt<0){var Kt,$t,ti,ii,ai,ni,oi=Q;Kt=oi.x,$t=oi.y,ti=oi.z;var si,ri,_i,ei=$;ii=ei.x,ai=ei.y,ni=ei.z;var hi=(si=ii-Kt)*Kt+(ri=ai-$t)*$t+(_i=ni-ti)*ti;if((hi=-hi/(si*si+ri*ri+_i*_i))<0){var li=tt;li.x=Kt,li.y=$t,li.z=ti}else if(hi>1){var vi=tt;vi.x=ii,vi.y=ai,vi.z=ni}else{var ci,mi,bi;ci=Kt+si*hi,mi=$t+ri*hi,bi=ti+_i*hi;var fi=tt;fi.x=ci,fi.y=mi,fi.z=bi}var pi=tt.x*tt.x+tt.y*tt.y+tt.z*tt.z;if(ct<0||pi<ct){ct=pi;var ui=tt;_t=ui.x,et=ui.y,ht=ui.z}}if(ct>0){var xi=tt;xi.x=_t,xi.y=et,xi.z=ht}else{var Xi=nt*nt+ot*ot+st*st;Xi>0&&(Xi=1/Math.sqrt(Xi));var Mi=(nt*=Xi)*nt+(ot*=Xi)*ot+(st*=Xi)*st;_t=nt*(Mi=(T*nt+S*ot+V*st)/Mi),et=ot*Mi,ht=st*Mi;var gi=tt;gi.x=_t,gi.y=et,gi.z=ht}var Yi=this.tmp;return this._distanceSq=Yi.x*Yi.x+Yi.y*Yi.y+Yi.z*Yi.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!B},setAdjacentTriangle:function(t){for(var i=0,a=0;a<3;)for(var n=a++,o=0;o<3;){var s=o++,r=this._nextIndex[n],_=this._nextIndex[s];this._vertices[n]==t._vertices[_]&&this._vertices[r]==t._vertices[s]&&(this._adjacentTriangles[n]=t,this._adjacentPairIndex[n]=s,t._adjacentTriangles[s]=this,t._adjacentPairIndex[s]=n,++i)}return 1==i},removeAdjacentTriangles:function(){for(var t=0;t<3;){var i=t++,a=this._adjacentTriangles[i];if(null!=a){var n=this._adjacentPairIndex[i];a._adjacentTriangles[n]=null,a._adjacentPairIndex[n]=-1,this._adjacentTriangles[i]=null,this._adjacentPairIndex[i]=-1}}},removeReferences:function(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0},dump:function(){}};var j=function(){this.randId=1e5*Math.random()|0,this.v=new E,this.w1=new E,this.w2=new E};j.prototype={init:function(t,i,a){var n=this.v;n.x=t.x,n.y=t.y,n.z=t.z;var o=this.w1;o.x=i.x,o.y=i.y,o.z=i.z;var s=this.w2;return s.x=a.x,s.y=a.y,s.z=a.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this},removeReferences:function(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};var O=function(){this.prevClosestDir=new E};O.prototype={clear:function(){this.prevClosestDir.zero()}};var E=function(t,i,a){null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,E.numCreations++};E.prototype={init:function(t,i,a){return this.x=t,this.y=i,this.z=a,this},zero:function(){return this.x=0,this.y=0,this.z=0,this},add:function(t){return new E(this.x+t.x,this.y+t.y,this.z+t.z)},addScaled:function(t,i){return new E(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)},sub:function(t){return new E(this.x-t.x,this.y-t.y,this.z-t.z)},scale:function(t){return new E(this.x*t,this.y*t,this.z*t)},scale3:function(t,i,a){return new E(this.x*t,this.y*i,this.z*a)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new E(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},addEq:function(t){var i=this.x+t.x,a=this.y+t.y,n=this.z+t.z;return this.x=i,this.y=a,this.z=n,this},addScaledEq:function(t,i){var a=this.x+t.x*i,n=this.y+t.y*i,o=this.z+t.z*i;return this.x=a,this.y=n,this.z=o,this},subEq:function(t){var i=this.x-t.x,a=this.y-t.y,n=this.z-t.z;return this.x=i,this.y=a,this.z=n,this},scaleEq:function(t){var i=this.x*t,a=this.y*t,n=this.z*t;return this.x=i,this.y=a,this.z=n,this},scale3Eq:function(t,i,a){var n=this.x*t,o=this.y*i,s=this.z*a;return this.x=n,this.y=o,this.z=s,this},crossEq:function(t){var i=this.y*t.z-this.z*t.y,a=this.z*t.x-this.x*t.z,n=this.x*t.y-this.y*t.x;return this.x=i,this.y=a,this.z=n,this},mulMat3:function(t){return new E(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)},mulMat4:function(t){return new E(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)},mulTransform:function(t){var i,a,n,o,s,r;i=this.x,a=this.y,n=this.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*n,s=t._rotation10*i+t._rotation11*a+t._rotation12*n,r=t._rotation20*i+t._rotation21*a+t._rotation22*n,i=o,a=s,n=r,i+=t._positionX,a+=t._positionY,n+=t._positionZ;var _=new E,e=_;return e.x=i,e.y=a,e.z=n,_},mulMat3Eq:function(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02,a=this.x*t.e10+this.y*t.e11+this.z*t.e12,n=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=i,this.y=a,this.z=n,this},mulMat4Eq:function(t){var i=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,a=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,n=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=i,this.y=a,this.z=n,this},mulTransformEq:function(t){var i,a,n,o,s,r;i=this.x,a=this.y,n=this.z,o=t._rotation00*i+t._rotation01*a+t._rotation02*n,s=t._rotation10*i+t._rotation11*a+t._rotation12*n,r=t._rotation20*i+t._rotation21*a+t._rotation22*n,i=o,a=s,n=r,i+=t._positionX,a+=t._positionY,n+=t._positionZ;return this.x=i,this.y=a,this.z=n,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new E(this.x*t,this.y*t,this.z*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,n=this.z*t;return this.x=i,this.y=a,this.z=n,this},negate:function(){return new E(-this.x,-this.y,-this.z)},negateEq:function(){var t=-this.x,i=-this.y,a=-this.z;return this.x=t,this.y=i,this.z=a,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},clone:function(){return new E(this.x,this.y,this.z)},toString:function(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}};var F=function(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1};F.prototype={identity:function(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this},getPosition:function(){var t=new E,i=t;return i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ,t},getPositionTo:function(t){var i=t;i.x=this._positionX,i.y=this._positionY,i.z=this._positionZ},setPosition:function(t){var i=t;return this._positionX=i.x,this._positionY=i.y,this._positionZ=i.z,this},translate:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._positionX+=i,this._positionY+=a,this._positionZ+=n},getRotation:function(){var t=new U,i=t;return i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22,t},getRotationTo:function(t){var i=t;i.e00=this._rotation00,i.e01=this._rotation01,i.e02=this._rotation02,i.e10=this._rotation10,i.e11=this._rotation11,i.e12=this._rotation12,i.e20=this._rotation20,i.e21=this._rotation21,i.e22=this._rotation22},setRotation:function(t){var i=t;return this._rotation00=i.e00,this._rotation01=i.e01,this._rotation02=i.e02,this._rotation10=i.e10,this._rotation11=i.e11,this._rotation12=i.e12,this._rotation20=i.e20,this._rotation21=i.e21,this._rotation22=i.e22,this},setRotationXyz:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z;var s=Math.sin(i),r=Math.sin(a),_=Math.sin(n),e=Math.cos(i),h=Math.cos(a),l=Math.cos(n);this._rotation00=h*l,this._rotation01=-h*_,this._rotation02=r,this._rotation10=e*_+l*s*r,this._rotation11=e*l-s*r*_,this._rotation12=-h*s,this._rotation20=s*_-e*l*r,this._rotation21=l*s+e*r*_,this._rotation22=e*h},rotate:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=t;i=X.e00,a=X.e01,n=X.e02,o=X.e10,s=X.e11,r=X.e12,_=X.e20,e=X.e21,h=X.e22,l=i*this._rotation00+a*this._rotation10+n*this._rotation20,v=i*this._rotation01+a*this._rotation11+n*this._rotation21,c=i*this._rotation02+a*this._rotation12+n*this._rotation22,m=o*this._rotation00+s*this._rotation10+r*this._rotation20,b=o*this._rotation01+s*this._rotation11+r*this._rotation21,f=o*this._rotation02+s*this._rotation12+r*this._rotation22,p=_*this._rotation00+e*this._rotation10+h*this._rotation20,u=_*this._rotation01+e*this._rotation11+h*this._rotation21,x=_*this._rotation02+e*this._rotation12+h*this._rotation22,this._rotation00=l,this._rotation01=v,this._rotation02=c,this._rotation10=m,this._rotation11=b,this._rotation12=f,this._rotation20=p,this._rotation21=u,this._rotation22=x},rotateXyz:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m=t;i=m.x,a=m.y,n=m.z;var b,f,p,u,x,X,M,g,Y,Z=Math.sin(i),I=Math.sin(a),y=Math.sin(n),d=Math.cos(i),L=Math.cos(a),z=Math.cos(n);s=-L*y,r=I,_=d*y+z*Z*I,e=d*z-Z*I*y,h=-L*Z,l=Z*y-d*z*I,v=z*Z+d*I*y,c=d*L,b=(o=L*z)*this._rotation00+s*this._rotation10+r*this._rotation20,f=o*this._rotation01+s*this._rotation11+r*this._rotation21,p=o*this._rotation02+s*this._rotation12+r*this._rotation22,u=_*this._rotation00+e*this._rotation10+h*this._rotation20,x=_*this._rotation01+e*this._rotation11+h*this._rotation21,X=_*this._rotation02+e*this._rotation12+h*this._rotation22,M=l*this._rotation00+v*this._rotation10+c*this._rotation20,g=l*this._rotation01+v*this._rotation11+c*this._rotation21,Y=l*this._rotation02+v*this._rotation12+c*this._rotation22,this._rotation00=b,this._rotation01=f,this._rotation02=p,this._rotation10=u,this._rotation11=x,this._rotation12=X,this._rotation20=M,this._rotation21=g,this._rotation22=Y},getOrientation:function(){var t,i,a,n,o,s=new K,r=this._rotation00,_=this._rotation11,e=this._rotation22,h=r+_+e;h>0?(n=.5*(o=Math.sqrt(h+1)),o=.5/o,t=(this._rotation21-this._rotation12)*o,i=(this._rotation02-this._rotation20)*o,a=(this._rotation10-this._rotation01)*o):r>_?r>e?(t=.5*(o=Math.sqrt(r-_-e+1)),o=.5/o,i=(this._rotation01+this._rotation10)*o,a=(this._rotation02+this._rotation20)*o,n=(this._rotation21-this._rotation12)*o):(a=.5*(o=Math.sqrt(e-r-_+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,n=(this._rotation10-this._rotation01)*o):_>e?(i=.5*(o=Math.sqrt(_-e-r+1)),o=.5/o,t=(this._rotation01+this._rotation10)*o,a=(this._rotation12+this._rotation21)*o,n=(this._rotation02-this._rotation20)*o):(a=.5*(o=Math.sqrt(e-r-_+1)),o=.5/o,t=(this._rotation02+this._rotation20)*o,i=(this._rotation12+this._rotation21)*o,n=(this._rotation10-this._rotation01)*o);var l=s;return l.x=t,l.y=i,l.z=a,l.w=n,s},getOrientationTo:function(t){var i,a,n,o,s,r=this._rotation00,_=this._rotation11,e=this._rotation22,h=r+_+e;h>0?(o=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._rotation21-this._rotation12)*s,a=(this._rotation02-this._rotation20)*s,n=(this._rotation10-this._rotation01)*s):r>_?r>e?(i=.5*(s=Math.sqrt(r-_-e+1)),s=.5/s,a=(this._rotation01+this._rotation10)*s,n=(this._rotation02+this._rotation20)*s,o=(this._rotation21-this._rotation12)*s):(n=.5*(s=Math.sqrt(e-r-_+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,o=(this._rotation10-this._rotation01)*s):_>e?(a=.5*(s=Math.sqrt(_-e-r+1)),s=.5/s,i=(this._rotation01+this._rotation10)*s,n=(this._rotation12+this._rotation21)*s,o=(this._rotation02-this._rotation20)*s):(n=.5*(s=Math.sqrt(e-r-_+1)),s=.5/s,i=(this._rotation02+this._rotation20)*s,a=(this._rotation12+this._rotation21)*s,o=(this._rotation10-this._rotation01)*s);var l=t;l.x=i,l.y=a,l.z=n,l.w=o},setOrientation:function(t){var i,a,n,o,s=t,r=(i=s.x,a=s.y,n=s.z,o=s.w,2*i),_=2*a,e=2*n,h=i*r,l=a*_,v=n*e,c=i*_,m=a*e,b=i*e,f=o*r,p=o*_,u=o*e;return this._rotation00=1-l-v,this._rotation01=c-u,this._rotation02=b+p,this._rotation10=c+u,this._rotation11=1-h-v,this._rotation12=m-f,this._rotation20=b-p,this._rotation21=m+f,this._rotation22=1-h-l,this},clone:function(){var t=new F;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t},copyFrom:function(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};var D=function(){},N=function(){var t=new Array(4);this.s=t;var i=new Array(4);this.w1=i;var a=new Array(4);this.w2=a;var n=new Array(3);this.baseDirs=n,this.baseDirs[0]=new E(1,0,0),this.baseDirs[1]=new E(0,1,0),this.baseDirs[2]=new E(0,0,1),this.tl1=new E,this.tl2=new E,this.rayX=new E,this.rayR=new E,this.tempTransform=new F;for(var o=0;o<4;){var s=o++;this.s[s]=new E,this.w1[s]=new E,this.w2[s]=new E}this.dir=new E,this.closest=new E,this.closestPoint1=new E,this.closestPoint2=new E,this.polyhedron=new q};N.getInstance=function(){return N.instance},N.prototype={computeClosestPointsImpl:function(t,i,a,n,o,s){this.c1=t,this.c2=i,this.tf1=a,this.tf2=n;var r=this.s,_=this.w1,e=this.w2,h=this.closest,l=this.dir;if(null!=o?(null==o._gjkCache&&(o._gjkCache=new O),this.loadCache(o._gjkCache)):l.zero(),l.x*l.x+l.y*l.y+l.z*l.z==0){var v,c,m;v=n._positionX-a._positionX,c=n._positionY-a._positionY,m=n._positionZ-a._positionZ;var b=l;b.x=v,b.y=c,b.z=m,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var f=this.s[this.simplexSize],p=this.w1[this.simplexSize];f.x=p.x,f.y=p.y,f.z=p.z;var u=f,x=this.w2[this.simplexSize],X=u.x-x.x,M=u.y-x.y,g=u.z-x.z;u.x=X,u.y=M,u.z=g,this.simplexSize=1;for(var Y=0;Y<40;){var Z=0;switch(this.simplexSize){case 1:var I=r[0];h.x=I.x,h.y=I.y,h.z=I.z,Z=1;break;case 2:var y,d,L,z,w,B,A=r[0];y=A.x,d=A.y,L=A.z;var P,T,S,V=r[1];z=V.x,w=V.y,B=V.z;var k=(P=z-y)*y+(T=w-d)*d+(S=B-L)*L;if((k=-k/(P*P+T*T+S*S))<0){var C=h;C.x=y,C.y=d,C.z=L,Z=1}else if(k>1){var q=h;q.x=z,q.y=w,q.z=B,Z=2}else{var R,j,E;R=y+P*k,j=d+T*k,E=L+S*k;var F=h;F.x=R,F.y=j,F.z=E,Z=3}break;case 3:var D,N,W,G,U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et=r[0],ht=r[1],lt=r[2],vt=et;D=vt.x,N=vt.y,W=vt.z;var ct=ht;G=ct.x,U=ct.y,J=ct.z;var mt,bt,ft,pt=lt;H=pt.x,Q=pt.y,K=pt.z;var ut,xt,Xt,Mt=G*((nt=Q-U)*(ft=($=G-D)*nt-(tt=U-N)*(at=H-G))-(ot=K-J)*(bt=(it=J-W)*at-$*ot))+U*(ot*(mt=tt*ot-it*nt)-at*ft)+J*(at*bt-nt*mt),gt=H*((rt=N-Q)*ft-(_t=W-K)*bt)+Q*(_t*mt-(st=D-H)*ft)+K*(st*bt-rt*mt),Yt=-1,Zt=0;if(ut=0,xt=0,Xt=0,D*(tt*ft-it*bt)+N*(it*mt-$*ft)+W*($*bt-tt*mt)<0){var It,yt,dt,Lt,zt,wt,Bt=et;It=Bt.x,yt=Bt.y,dt=Bt.z;var At,Pt,Tt,St=ht;Lt=St.x,zt=St.y,wt=St.z;var Vt,kt=(At=Lt-It)*It+(Pt=zt-yt)*yt+(Tt=wt-dt)*dt;if((kt=-kt/(At*At+Pt*Pt+Tt*Tt))<0){var Ct=h;Ct.x=It,Ct.y=yt,Ct.z=dt,Vt=1}else if(kt>1){var qt=h;qt.x=Lt,qt.y=zt,qt.z=wt,Vt=2}else{var Rt,jt,Ot;Rt=It+At*kt,jt=yt+Pt*kt,Ot=dt+Tt*kt;var Et=h;Et.x=Rt,Et.y=jt,Et.z=Ot,Vt=3}Zt=Vt,Yt=h.x*h.x+h.y*h.y+h.z*h.z;var Ft=h;ut=Ft.x,xt=Ft.y,Xt=Ft.z}if(Mt<0){var Dt,Nt,Wt,Gt,Ut,Jt,Ht=ht;Dt=Ht.x,Nt=Ht.y,Wt=Ht.z;var Qt,Kt,$t,ti=lt;Gt=ti.x,Ut=ti.y,Jt=ti.z;var ii,ai=(Qt=Gt-Dt)*Dt+(Kt=Ut-Nt)*Nt+($t=Jt-Wt)*Wt;if((ai=-ai/(Qt*Qt+Kt*Kt+$t*$t))<0){var ni=h;ni.x=Dt,ni.y=Nt,ni.z=Wt,ii=1}else if(ai>1){var oi=h;oi.x=Gt,oi.y=Ut,oi.z=Jt,ii=2}else{var si,ri,_i;si=Dt+Qt*ai,ri=Nt+Kt*ai,_i=Wt+$t*ai;var ei=h;ei.x=si,ei.y=ri,ei.z=_i,ii=3}var hi=h.x*h.x+h.y*h.y+h.z*h.z;if(Yt<0||hi<Yt){Zt=ii<<1,Yt=hi;var li=h;ut=li.x,xt=li.y,Xt=li.z}}if(gt<0){var vi,ci,mi,bi,fi,pi,ui=et;vi=ui.x,ci=ui.y,mi=ui.z;var xi,Xi,Mi,gi=lt;bi=gi.x,fi=gi.y,pi=gi.z;var Yi,Zi=(xi=bi-vi)*vi+(Xi=fi-ci)*ci+(Mi=pi-mi)*mi;if((Zi=-Zi/(xi*xi+Xi*Xi+Mi*Mi))<0){var Ii=h;Ii.x=vi,Ii.y=ci,Ii.z=mi,Yi=1}else if(Zi>1){var yi=h;yi.x=bi,yi.y=fi,yi.z=pi,Yi=2}else{var di,Li,zi;di=vi+xi*Zi,Li=ci+Xi*Zi,zi=mi+Mi*Zi;var wi=h;wi.x=di,wi.y=Li,wi.z=zi,Yi=3}var Bi=h.x*h.x+h.y*h.y+h.z*h.z;if(Yt<0||Bi<Yt){Zt=1&Yi|(2&Yi)<<1,Yt=Bi;var Ai=h;ut=Ai.x,xt=Ai.y,Xt=Ai.z}}if(Yt>0){var Pi=h;Pi.x=ut,Pi.y=xt,Pi.z=Xt,Z=Zt}else{var Ti=mt*mt+bt*bt+ft*ft;Ti>0&&(Ti=1/Math.sqrt(Ti));var Si=(mt*=Ti)*mt+(bt*=Ti)*bt+(ft*=Ti)*ft;ut=mt*(Si=(D*mt+N*bt+W*ft)/Si),xt=bt*Si,Xt=ft*Si;var Vi=h;Vi.x=ut,Vi.y=xt,Vi.z=Xt,Z=7}break;case 4:var ki,Ci,qi,Ri,ji,Oi,Ei,Fi,Di,Ni,Wi,Gi,Ui,Ji,Hi,Qi,Ki,$i,ta,ia,aa,na,oa,sa,ra,_a,ea,ha=r[0],la=r[1],va=r[2],ca=r[3],ma=ha;ki=ma.x,Ci=ma.y,qi=ma.z;var ba=la;Ri=ba.x,ji=ba.y,Oi=ba.z;var fa,pa,ua,xa=va,Xa=ca;Qi=(Ei=xa.x)-ki,Ki=(Fi=xa.y)-Ci,$i=(Di=xa.z)-qi,ta=(Ni=Xa.x)-ki,ia=(Wi=Xa.y)-Ci,aa=(Gi=Xa.z)-qi;var Ma,ga,Ya,Za=(Ui=Ri-ki)*(fa=(_a=Wi-ji)*(sa=Di-Oi)-(ea=Gi-Oi)*(oa=Fi-ji))+(Ji=ji-Ci)*(pa=ea*(na=Ei-Ri)-(ra=Ni-Ri)*sa)+(Hi=Oi-qi)*(ua=ra*oa-_a*na)>0?1:-1,Ia=ki*(Ki*aa-$i*ia)+Ci*($i*ta-Qi*aa)+qi*(Qi*ia-Ki*ta),ya=ki*(ia*Hi-aa*Ji)+Ci*(aa*Ui-ta*Hi)+qi*(ta*Ji-ia*Ui),da=Ri*fa+ji*pa+Oi*ua,La=-1,za=0;if(Ma=0,ga=0,Ya=0,(ki*(Ji*$i-Hi*Ki)+Ci*(Hi*Qi-Ui*$i)+qi*(Ui*Ki-Ji*Qi))*Za<0){var wa,Ba,Aa,Pa,Ta,Sa,Va,ka,Ca,qa,Ra,ja,Oa,Ea,Fa,Da,Na,Wa,Ga=ha;wa=Ga.x,Ba=Ga.y,Aa=Ga.z;var Ua=la;Pa=Ua.x,Ta=Ua.y,Sa=Ua.z;var Ja,Ha,Qa,Ka=va;Va=Ka.x,ka=Ka.y,Ca=Ka.z;var $a,tn,an,nn,on=Pa*((Ea=ka-Ta)*(Qa=(qa=Pa-wa)*Ea-(Ra=Ta-Ba)*(Oa=Va-Pa))-(Fa=Ca-Sa)*(Ha=(ja=Sa-Aa)*Oa-qa*Fa))+Ta*(Fa*(Ja=Ra*Fa-ja*Ea)-Oa*Qa)+Sa*(Oa*Ha-Ea*Ja),sn=Va*((Na=Ba-ka)*Qa-(Wa=Aa-Ca)*Ha)+ka*(Wa*Ja-(Da=wa-Va)*Qa)+Ca*(Da*Ha-Na*Ja),rn=-1,_n=0;if($a=0,tn=0,an=0,wa*(Ra*Qa-ja*Ha)+Ba*(ja*Ja-qa*Qa)+Aa*(qa*Ha-Ra*Ja)<0){var en,hn,ln,vn,cn,mn,bn=ha;en=bn.x,hn=bn.y,ln=bn.z;var fn,pn,un,xn=la;vn=xn.x,cn=xn.y,mn=xn.z;var Xn,Mn=(fn=vn-en)*en+(pn=cn-hn)*hn+(un=mn-ln)*ln;if((Mn=-Mn/(fn*fn+pn*pn+un*un))<0){var gn=h;gn.x=en,gn.y=hn,gn.z=ln,Xn=1}else if(Mn>1){var Yn=h;Yn.x=vn,Yn.y=cn,Yn.z=mn,Xn=2}else{var Zn,In,yn;Zn=en+fn*Mn,In=hn+pn*Mn,yn=ln+un*Mn;var dn=h;dn.x=Zn,dn.y=In,dn.z=yn,Xn=3}_n=Xn,rn=h.x*h.x+h.y*h.y+h.z*h.z;var Ln=h;$a=Ln.x,tn=Ln.y,an=Ln.z}if(on<0){var zn,wn,Bn,An,Pn,Tn,Sn=la;zn=Sn.x,wn=Sn.y,Bn=Sn.z;var Vn,kn,Cn,qn=va;An=qn.x,Pn=qn.y,Tn=qn.z;var Rn,jn=(Vn=An-zn)*zn+(kn=Pn-wn)*wn+(Cn=Tn-Bn)*Bn;if((jn=-jn/(Vn*Vn+kn*kn+Cn*Cn))<0){var On=h;On.x=zn,On.y=wn,On.z=Bn,Rn=1}else if(jn>1){var En=h;En.x=An,En.y=Pn,En.z=Tn,Rn=2}else{var Fn,Dn,Nn;Fn=zn+Vn*jn,Dn=wn+kn*jn,Nn=Bn+Cn*jn;var Wn=h;Wn.x=Fn,Wn.y=Dn,Wn.z=Nn,Rn=3}var Gn=h.x*h.x+h.y*h.y+h.z*h.z;if(rn<0||Gn<rn){_n=Rn<<1,rn=Gn;var Un=h;$a=Un.x,tn=Un.y,an=Un.z}}if(sn<0){var Jn,Hn,Qn,Kn,$n,to,io=ha;Jn=io.x,Hn=io.y,Qn=io.z;var ao,no,oo,so=va;Kn=so.x,$n=so.y,to=so.z;var ro,_o=(ao=Kn-Jn)*Jn+(no=$n-Hn)*Hn+(oo=to-Qn)*Qn;if((_o=-_o/(ao*ao+no*no+oo*oo))<0){var eo=h;eo.x=Jn,eo.y=Hn,eo.z=Qn,ro=1}else if(_o>1){var ho=h;ho.x=Kn,ho.y=$n,ho.z=to,ro=2}else{var lo,vo,co;lo=Jn+ao*_o,vo=Hn+no*_o,co=Qn+oo*_o;var mo=h;mo.x=lo,mo.y=vo,mo.z=co,ro=3}var bo=h.x*h.x+h.y*h.y+h.z*h.z;if(rn<0||bo<rn){_n=1&ro|(2&ro)<<1,rn=bo;var fo=h;$a=fo.x,tn=fo.y,an=fo.z}}if(rn>0){var po=h;po.x=$a,po.y=tn,po.z=an,nn=_n}else{var uo=Ja*Ja+Ha*Ha+Qa*Qa;uo>0&&(uo=1/Math.sqrt(uo));var xo=(Ja*=uo)*Ja+(Ha*=uo)*Ha+(Qa*=uo)*Qa;$a=Ja*(xo=(wa*Ja+Ba*Ha+Aa*Qa)/xo),tn=Ha*xo,an=Qa*xo;var Xo=h;Xo.x=$a,Xo.y=tn,Xo.z=an,nn=7}za=nn,La=h.x*h.x+h.y*h.y+h.z*h.z;var Mo=h;Ma=Mo.x,ga=Mo.y,Ya=Mo.z}if(Ia*Za<0){var go,Yo,Zo,Io,yo,Lo,zo,wo,Bo,Ao,Po,To,So,Vo,ko,Co,qo,Ro,jo=ha;go=jo.x,Yo=jo.y,Zo=jo.z;var Oo=va;Io=Oo.x,yo=Oo.y,Lo=Oo.z;var Eo,Fo,Do,No=ca;zo=No.x,wo=No.y,Bo=No.z;var Wo,Go,Uo,Jo,Ho=Io*((Vo=wo-yo)*(Do=(Ao=Io-go)*Vo-(Po=yo-Yo)*(So=zo-Io))-(ko=Bo-Lo)*(Fo=(To=Lo-Zo)*So-Ao*ko))+yo*(ko*(Eo=Po*ko-To*Vo)-So*Do)+Lo*(So*Fo-Vo*Eo),Qo=zo*((qo=Yo-wo)*Do-(Ro=Zo-Bo)*Fo)+wo*(Ro*Eo-(Co=go-zo)*Do)+Bo*(Co*Fo-qo*Eo),Ko=-1,$o=0;if(Wo=0,Go=0,Uo=0,go*(Po*Do-To*Fo)+Yo*(To*Eo-Ao*Do)+Zo*(Ao*Fo-Po*Eo)<0){var ts,is,as,ns,os,ss,rs=ha;ts=rs.x,is=rs.y,as=rs.z;var _s,es,hs,ls=va;ns=ls.x,os=ls.y,ss=ls.z;var vs,cs=(_s=ns-ts)*ts+(es=os-is)*is+(hs=ss-as)*as;if((cs=-cs/(_s*_s+es*es+hs*hs))<0){var ms=h;ms.x=ts,ms.y=is,ms.z=as,vs=1}else if(cs>1){var bs=h;bs.x=ns,bs.y=os,bs.z=ss,vs=2}else{var fs,ps,us;fs=ts+_s*cs,ps=is+es*cs,us=as+hs*cs;var xs=h;xs.x=fs,xs.y=ps,xs.z=us,vs=3}$o=vs,Ko=h.x*h.x+h.y*h.y+h.z*h.z;var Xs=h;Wo=Xs.x,Go=Xs.y,Uo=Xs.z}if(Ho<0){var Ms,gs,Ys,Zs,Is,ys,ds=va;Ms=ds.x,gs=ds.y,Ys=ds.z;var Ls,zs,ws,Bs=ca;Zs=Bs.x,Is=Bs.y,ys=Bs.z;var As,Ps=(Ls=Zs-Ms)*Ms+(zs=Is-gs)*gs+(ws=ys-Ys)*Ys;if((Ps=-Ps/(Ls*Ls+zs*zs+ws*ws))<0){var Ts=h;Ts.x=Ms,Ts.y=gs,Ts.z=Ys,As=1}else if(Ps>1){var Ss=h;Ss.x=Zs,Ss.y=Is,Ss.z=ys,As=2}else{var Vs,ks,Cs;Vs=Ms+Ls*Ps,ks=gs+zs*Ps,Cs=Ys+ws*Ps;var qs=h;qs.x=Vs,qs.y=ks,qs.z=Cs,As=3}var Rs=h.x*h.x+h.y*h.y+h.z*h.z;if(Ko<0||Rs<Ko){$o=As<<1,Ko=Rs;var js=h;Wo=js.x,Go=js.y,Uo=js.z}}if(Qo<0){var Os,Es,Fs,Ds,Ns,Ws,Gs=ha;Os=Gs.x,Es=Gs.y,Fs=Gs.z;var Us,Js,Hs,Qs=ca;Ds=Qs.x,Ns=Qs.y,Ws=Qs.z;var Ks,$s=(Us=Ds-Os)*Os+(Js=Ns-Es)*Es+(Hs=Ws-Fs)*Fs;if(($s=-$s/(Us*Us+Js*Js+Hs*Hs))<0){var tr=h;tr.x=Os,tr.y=Es,tr.z=Fs,Ks=1}else if($s>1){var ir=h;ir.x=Ds,ir.y=Ns,ir.z=Ws,Ks=2}else{var ar,nr,or;ar=Os+Us*$s,nr=Es+Js*$s,or=Fs+Hs*$s;var sr=h;sr.x=ar,sr.y=nr,sr.z=or,Ks=3}var rr=h.x*h.x+h.y*h.y+h.z*h.z;if(Ko<0||rr<Ko){$o=1&Ks|(2&Ks)<<1,Ko=rr;var _r=h;Wo=_r.x,Go=_r.y,Uo=_r.z}}if(Ko>0){var er=h;er.x=Wo,er.y=Go,er.z=Uo,Jo=$o}else{var hr=Eo*Eo+Fo*Fo+Do*Do;hr>0&&(hr=1/Math.sqrt(hr));var lr=(Eo*=hr)*Eo+(Fo*=hr)*Fo+(Do*=hr)*Do;Wo=Eo*(lr=(go*Eo+Yo*Fo+Zo*Do)/lr),Go=Fo*lr,Uo=Do*lr;var vr=h;vr.x=Wo,vr.y=Go,vr.z=Uo,Jo=7}var cr=h.x*h.x+h.y*h.y+h.z*h.z;if(La<0||cr<La){za=1&Jo|(6&Jo)<<1,La=cr;var mr=h;Ma=mr.x,ga=mr.y,Ya=mr.z}}if(ya*Za<0){var br,fr,pr,ur,xr,Xr,Mr,gr,Yr,Zr,Ir,yr,dr,Lr,zr,wr,Br,Ar,Pr=ha;br=Pr.x,fr=Pr.y,pr=Pr.z;var Tr=la;ur=Tr.x,xr=Tr.y,Xr=Tr.z;var Sr,Vr,kr,Cr=ca;Mr=Cr.x,gr=Cr.y,Yr=Cr.z;var qr,Rr,jr,Or,Er=ur*((Lr=gr-xr)*(kr=(Zr=ur-br)*Lr-(Ir=xr-fr)*(dr=Mr-ur))-(zr=Yr-Xr)*(Vr=(yr=Xr-pr)*dr-Zr*zr))+xr*(zr*(Sr=Ir*zr-yr*Lr)-dr*kr)+Xr*(dr*Vr-Lr*Sr),Fr=Mr*((Br=fr-gr)*kr-(Ar=pr-Yr)*Vr)+gr*(Ar*Sr-(wr=br-Mr)*kr)+Yr*(wr*Vr-Br*Sr),Dr=-1,Nr=0;if(qr=0,Rr=0,jr=0,br*(Ir*kr-yr*Vr)+fr*(yr*Sr-Zr*kr)+pr*(Zr*Vr-Ir*Sr)<0){var Wr,Gr,Ur,Jr,Hr,Qr,Kr=ha;Wr=Kr.x,Gr=Kr.y,Ur=Kr.z;var $r,t_,i_,a_=la;Jr=a_.x,Hr=a_.y,Qr=a_.z;var n_,o_=($r=Jr-Wr)*Wr+(t_=Hr-Gr)*Gr+(i_=Qr-Ur)*Ur;if((o_=-o_/($r*$r+t_*t_+i_*i_))<0){var s_=h;s_.x=Wr,s_.y=Gr,s_.z=Ur,n_=1}else if(o_>1){var r_=h;r_.x=Jr,r_.y=Hr,r_.z=Qr,n_=2}else{var __,e_,h_;__=Wr+$r*o_,e_=Gr+t_*o_,h_=Ur+i_*o_;var l_=h;l_.x=__,l_.y=e_,l_.z=h_,n_=3}Nr=n_,Dr=h.x*h.x+h.y*h.y+h.z*h.z;var v_=h;qr=v_.x,Rr=v_.y,jr=v_.z}if(Er<0){var c_,m_,b_,f_,p_,u_,x_=la;c_=x_.x,m_=x_.y,b_=x_.z;var X_,M_,g_,Y_=ca;f_=Y_.x,p_=Y_.y,u_=Y_.z;var Z_,I_=(X_=f_-c_)*c_+(M_=p_-m_)*m_+(g_=u_-b_)*b_;if((I_=-I_/(X_*X_+M_*M_+g_*g_))<0){var y_=h;y_.x=c_,y_.y=m_,y_.z=b_,Z_=1}else if(I_>1){var d_=h;d_.x=f_,d_.y=p_,d_.z=u_,Z_=2}else{var L_,z_,w_;L_=c_+X_*I_,z_=m_+M_*I_,w_=b_+g_*I_;var B_=h;B_.x=L_,B_.y=z_,B_.z=w_,Z_=3}var A_=h.x*h.x+h.y*h.y+h.z*h.z;if(Dr<0||A_<Dr){Nr=Z_<<1,Dr=A_;var P_=h;qr=P_.x,Rr=P_.y,jr=P_.z}}if(Fr<0){var T_,S_,V_,k_,C_,q_,R_=ha;T_=R_.x,S_=R_.y,V_=R_.z;var j_,O_,E_,F_=ca;k_=F_.x,C_=F_.y,q_=F_.z;var D_,N_=(j_=k_-T_)*T_+(O_=C_-S_)*S_+(E_=q_-V_)*V_;if((N_=-N_/(j_*j_+O_*O_+E_*E_))<0){var W_=h;W_.x=T_,W_.y=S_,W_.z=V_,D_=1}else if(N_>1){var G_=h;G_.x=k_,G_.y=C_,G_.z=q_,D_=2}else{var U_,J_,H_;U_=T_+j_*N_,J_=S_+O_*N_,H_=V_+E_*N_;var Q_=h;Q_.x=U_,Q_.y=J_,Q_.z=H_,D_=3}var K_=h.x*h.x+h.y*h.y+h.z*h.z;if(Dr<0||K_<Dr){Nr=1&D_|(2&D_)<<1,Dr=K_;var $_=h;qr=$_.x,Rr=$_.y,jr=$_.z}}if(Dr>0){var te=h;te.x=qr,te.y=Rr,te.z=jr,Or=Nr}else{var ie=Sr*Sr+Vr*Vr+kr*kr;ie>0&&(ie=1/Math.sqrt(ie));var ae=(Sr*=ie)*Sr+(Vr*=ie)*Vr+(kr*=ie)*kr;qr=Sr*(ae=(br*Sr+fr*Vr+pr*kr)/ae),Rr=Vr*ae,jr=kr*ae;var ne=h;ne.x=qr,ne.y=Rr,ne.z=jr,Or=7}var oe=h.x*h.x+h.y*h.y+h.z*h.z;if(La<0||oe<La){za=3&Or|(4&Or)<<1,La=oe;var se=h;Ma=se.x,ga=se.y,Ya=se.z}}if(da*Za<0){var re,_e,ee,he,le,ve,ce,me,be,fe,pe,ue,xe,Xe,Me,ge,Ye,Ze,Ie=la;re=Ie.x,_e=Ie.y,ee=Ie.z;var ye=va;he=ye.x,le=ye.y,ve=ye.z;var de,Le,ze,we=ca;ce=we.x,me=we.y,be=we.z;var Be,Ae,Pe,Te,Se=he*((Xe=me-le)*(ze=(fe=he-re)*Xe-(pe=le-_e)*(xe=ce-he))-(Me=be-ve)*(Le=(ue=ve-ee)*xe-fe*Me))+le*(Me*(de=pe*Me-ue*Xe)-xe*ze)+ve*(xe*Le-Xe*de),Ve=ce*((Ye=_e-me)*ze-(Ze=ee-be)*Le)+me*(Ze*de-(ge=re-ce)*ze)+be*(ge*Le-Ye*de),ke=-1,Ce=0;if(Be=0,Ae=0,Pe=0,re*(pe*ze-ue*Le)+_e*(ue*de-fe*ze)+ee*(fe*Le-pe*de)<0){var qe,Re,je,Oe,Ee,Fe,De=la;qe=De.x,Re=De.y,je=De.z;var Ne,We,Ge,Ue=va;Oe=Ue.x,Ee=Ue.y,Fe=Ue.z;var Je,He=(Ne=Oe-qe)*qe+(We=Ee-Re)*Re+(Ge=Fe-je)*je;if((He=-He/(Ne*Ne+We*We+Ge*Ge))<0){var Qe=h;Qe.x=qe,Qe.y=Re,Qe.z=je,Je=1}else if(He>1){var Ke=h;Ke.x=Oe,Ke.y=Ee,Ke.z=Fe,Je=2}else{var $e,th,ih;$e=qe+Ne*He,th=Re+We*He,ih=je+Ge*He;var ah=h;ah.x=$e,ah.y=th,ah.z=ih,Je=3}Ce=Je,ke=h.x*h.x+h.y*h.y+h.z*h.z;var nh=h;Be=nh.x,Ae=nh.y,Pe=nh.z}if(Se<0){var oh,sh,rh,_h,eh,hh,lh=va;oh=lh.x,sh=lh.y,rh=lh.z;var vh,ch,mh,bh=ca;_h=bh.x,eh=bh.y,hh=bh.z;var fh,ph=(vh=_h-oh)*oh+(ch=eh-sh)*sh+(mh=hh-rh)*rh;if((ph=-ph/(vh*vh+ch*ch+mh*mh))<0){var uh=h;uh.x=oh,uh.y=sh,uh.z=rh,fh=1}else if(ph>1){var xh=h;xh.x=_h,xh.y=eh,xh.z=hh,fh=2}else{var Xh,Mh,gh;Xh=oh+vh*ph,Mh=sh+ch*ph,gh=rh+mh*ph;var Yh=h;Yh.x=Xh,Yh.y=Mh,Yh.z=gh,fh=3}var Zh=h.x*h.x+h.y*h.y+h.z*h.z;if(ke<0||Zh<ke){Ce=fh<<1,ke=Zh;var Ih=h;Be=Ih.x,Ae=Ih.y,Pe=Ih.z}}if(Ve<0){var yh,dh,Lh,zh,wh,Bh,Ah=la;yh=Ah.x,dh=Ah.y,Lh=Ah.z;var Ph,Th,Sh,Vh=ca;zh=Vh.x,wh=Vh.y,Bh=Vh.z;var kh,Ch=(Ph=zh-yh)*yh+(Th=wh-dh)*dh+(Sh=Bh-Lh)*Lh;if((Ch=-Ch/(Ph*Ph+Th*Th+Sh*Sh))<0){var qh=h;qh.x=yh,qh.y=dh,qh.z=Lh,kh=1}else if(Ch>1){var Rh=h;Rh.x=zh,Rh.y=wh,Rh.z=Bh,kh=2}else{var jh,Oh,Eh;jh=yh+Ph*Ch,Oh=dh+Th*Ch,Eh=Lh+Sh*Ch;var Fh=h;Fh.x=jh,Fh.y=Oh,Fh.z=Eh,kh=3}var Dh=h.x*h.x+h.y*h.y+h.z*h.z;if(ke<0||Dh<ke){Ce=1&kh|(2&kh)<<1,ke=Dh;var Nh=h;Be=Nh.x,Ae=Nh.y,Pe=Nh.z}}if(ke>0){var Wh=h;Wh.x=Be,Wh.y=Ae,Wh.z=Pe,Te=Ce}else{var Gh=de*de+Le*Le+ze*ze;Gh>0&&(Gh=1/Math.sqrt(Gh));var Uh=(de*=Gh)*de+(Le*=Gh)*Le+(ze*=Gh)*ze;Be=de*(Uh=(re*de+_e*Le+ee*ze)/Uh),Ae=Le*Uh,Pe=ze*Uh;var Jh=h;Jh.x=Be,Jh.y=Ae,Jh.z=Pe,Te=7}var Hh=h.x*h.x+h.y*h.y+h.z*h.z;if(La<0||Hh<La){za=Te<<1,La=Hh;var Qh=h;Ma=Qh.x,ga=Qh.y,Ya=Qh.z}}if(La>0){var Kh=h;Kh.x=Ma,Kh.y=ga,Kh.z=Ya,Z=za}else h.zero(),Z=15}if(h.x*h.x+h.y*h.y+h.z*h.z<1e-8){if(!s)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){var $h=this.computeDepth(t,i,a,n,r,_,e);return 0!=$h?(this.distance=0,$h):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(Z),l.x=h.x,l.y=h.y,l.z=h.z;var tl=l,il=-tl.x,al=-tl.y,nl=-tl.z;tl.x=il,tl.y=al,tl.z=nl,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var ol=this.s[this.simplexSize],sl=this.w1[this.simplexSize];ol.x=sl.x,ol.y=sl.y,ol.z=sl.z;var rl=ol,_l=this.w2[this.simplexSize],el=rl.x-_l.x,hl=rl.y-_l.y,ll=rl.z-_l.z;if(rl.x=el,rl.y=hl,rl.z=ll,l.x*l.x+l.y*l.y+l.z*l.z<1e-8)throw new Error("!?");var vl=h.x*l.x+h.y*l.y+h.z*l.z,cl=r[this.simplexSize];if(cl.x*l.x+cl.y*l.y+cl.z*l.z-vl<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z),null!=o&&null!=o._gjkCache&&this.saveCache(o._gjkCache),0;this.simplexSize++,++Y}return 2},convexCastImpl:function(t,i,a,n,o,s,r){this.c1=t,this.c2=i,this.tf1=a,this.tf2=n;var _,e,h,l=this.s,v=(this.w1,this.w2,this.closest),c=this.dir;_=n._positionX-a._positionX,e=n._positionY-a._positionY,h=n._positionZ-a._positionZ;var m=c;if(m.x=_,m.y=e,m.z=h,c.x*c.x+c.y*c.y+c.z*c.z<1e-6&&c.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{var b=this.w1[this.simplexSize];b.x=this.tf1._positionX,b.y=this.tf1._positionY,b.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var f=this.s[this.simplexSize],p=this.w1[this.simplexSize];f.x=p.x,f.y=p.y,f.z=p.z;var u=f,x=this.w2[this.simplexSize],X=u.x-x.x,M=u.y-x.y,g=u.z-x.z;u.x=X,u.y=M,u.z=g,this.simplexSize=1;var Y=0,Z=0,I=this.rayX,y=this.rayR;I.zero(),y.x=s.x,y.y=s.y,y.z=s.z;var d=y,L=d.x-o.x,z=d.y-o.y,w=d.z-o.z;d.x=L,d.y=z,d.z=w;for(;Y<40;){var B=0;switch(this.simplexSize){case 1:var A=l[0];v.x=A.x,v.y=A.y,v.z=A.z,B=1;break;case 2:var P,T,S,V,k,C,q=l[0];P=q.x,T=q.y,S=q.z;var R,j,O,E=l[1];V=E.x,k=E.y,C=E.z;var F=(R=V-P)*P+(j=k-T)*T+(O=C-S)*S;if((F=-F/(R*R+j*j+O*O))<0){var D=v;D.x=P,D.y=T,D.z=S,B=1}else if(F>1){var N=v;N.x=V,N.y=k,N.z=C,B=2}else{var W,G,U;W=P+R*F,G=T+j*F,U=S+O*F;var J=v;J.x=W,J.y=G,J.z=U,B=3}break;case 3:var H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt=l[0],ft=l[1],pt=l[2],ut=bt;H=ut.x,Q=ut.y,K=ut.z;var xt=ft;$=xt.x,tt=xt.y,it=xt.z;var Xt,Mt,gt,Yt=pt;at=Yt.x,nt=Yt.y,ot=Yt.z;var Zt,It,yt,dt=$*((ht=nt-tt)*(gt=(st=$-H)*ht-(rt=tt-Q)*(et=at-$))-(lt=ot-it)*(Mt=(_t=it-K)*et-st*lt))+tt*(lt*(Xt=rt*lt-_t*ht)-et*gt)+it*(et*Mt-ht*Xt),Lt=at*((ct=Q-nt)*gt-(mt=K-ot)*Mt)+nt*(mt*Xt-(vt=H-at)*gt)+ot*(vt*Mt-ct*Xt),zt=-1,wt=0;if(Zt=0,It=0,yt=0,H*(rt*gt-_t*Mt)+Q*(_t*Xt-st*gt)+K*(st*Mt-rt*Xt)<0){var Bt,At,Pt,Tt,St,Vt,kt=bt;Bt=kt.x,At=kt.y,Pt=kt.z;var Ct,qt,Rt,jt=ft;Tt=jt.x,St=jt.y,Vt=jt.z;var Ot,Et=(Ct=Tt-Bt)*Bt+(qt=St-At)*At+(Rt=Vt-Pt)*Pt;if((Et=-Et/(Ct*Ct+qt*qt+Rt*Rt))<0){var Ft=v;Ft.x=Bt,Ft.y=At,Ft.z=Pt,Ot=1}else if(Et>1){var Dt=v;Dt.x=Tt,Dt.y=St,Dt.z=Vt,Ot=2}else{var Nt,Wt,Gt;Nt=Bt+Ct*Et,Wt=At+qt*Et,Gt=Pt+Rt*Et;var Ut=v;Ut.x=Nt,Ut.y=Wt,Ut.z=Gt,Ot=3}wt=Ot,zt=v.x*v.x+v.y*v.y+v.z*v.z;var Jt=v;Zt=Jt.x,It=Jt.y,yt=Jt.z}if(dt<0){var Ht,Qt,Kt,$t,ti,ii,ai=ft;Ht=ai.x,Qt=ai.y,Kt=ai.z;var ni,oi,si,ri=pt;$t=ri.x,ti=ri.y,ii=ri.z;var _i,ei=(ni=$t-Ht)*Ht+(oi=ti-Qt)*Qt+(si=ii-Kt)*Kt;if((ei=-ei/(ni*ni+oi*oi+si*si))<0){var hi=v;hi.x=Ht,hi.y=Qt,hi.z=Kt,_i=1}else if(ei>1){var li=v;li.x=$t,li.y=ti,li.z=ii,_i=2}else{var vi,ci,mi;vi=Ht+ni*ei,ci=Qt+oi*ei,mi=Kt+si*ei;var bi=v;bi.x=vi,bi.y=ci,bi.z=mi,_i=3}var fi=v.x*v.x+v.y*v.y+v.z*v.z;if(zt<0||fi<zt){wt=_i<<1,zt=fi;var pi=v;Zt=pi.x,It=pi.y,yt=pi.z}}if(Lt<0){var ui,xi,Xi,Mi,gi,Yi,Zi=bt;ui=Zi.x,xi=Zi.y,Xi=Zi.z;var Ii,yi,di,Li=pt;Mi=Li.x,gi=Li.y,Yi=Li.z;var zi,wi=(Ii=Mi-ui)*ui+(yi=gi-xi)*xi+(di=Yi-Xi)*Xi;if((wi=-wi/(Ii*Ii+yi*yi+di*di))<0){var Bi=v;Bi.x=ui,Bi.y=xi,Bi.z=Xi,zi=1}else if(wi>1){var Ai=v;Ai.x=Mi,Ai.y=gi,Ai.z=Yi,zi=2}else{var Pi,Ti,Si;Pi=ui+Ii*wi,Ti=xi+yi*wi,Si=Xi+di*wi;var Vi=v;Vi.x=Pi,Vi.y=Ti,Vi.z=Si,zi=3}var ki=v.x*v.x+v.y*v.y+v.z*v.z;if(zt<0||ki<zt){wt=1&zi|(2&zi)<<1,zt=ki;var Ci=v;Zt=Ci.x,It=Ci.y,yt=Ci.z}}if(zt>0){var qi=v;qi.x=Zt,qi.y=It,qi.z=yt,B=wt}else{var Ri=Xt*Xt+Mt*Mt+gt*gt;Ri>0&&(Ri=1/Math.sqrt(Ri));var ji=(Xt*=Ri)*Xt+(Mt*=Ri)*Mt+(gt*=Ri)*gt;Zt=Xt*(ji=(H*Xt+Q*Mt+K*gt)/ji),It=Mt*ji,yt=gt*ji;var Oi=v;Oi.x=Zt,Oi.y=It,Oi.z=yt,B=7}break;case 4:var Ei,Fi,Di,Ni,Wi,Gi,Ui,Ji,Hi,Qi,Ki,$i,ta,ia,aa,na,oa,sa,ra,_a,ea,ha,la,va,ca,ma,ba,fa=l[0],pa=l[1],ua=l[2],xa=l[3],Xa=fa;Ei=Xa.x,Fi=Xa.y,Di=Xa.z;var Ma=pa;Ni=Ma.x,Wi=Ma.y,Gi=Ma.z;var ga,Ya,Za,Ia=ua,ya=xa;na=(Ui=Ia.x)-Ei,oa=(Ji=Ia.y)-Fi,sa=(Hi=Ia.z)-Di,ra=(Qi=ya.x)-Ei,_a=(Ki=ya.y)-Fi,ea=($i=ya.z)-Di;var da,La,za,wa=(ta=Ni-Ei)*(ga=(ma=Ki-Wi)*(va=Hi-Gi)-(ba=$i-Gi)*(la=Ji-Wi))+(ia=Wi-Fi)*(Ya=ba*(ha=Ui-Ni)-(ca=Qi-Ni)*va)+(aa=Gi-Di)*(Za=ca*la-ma*ha)>0?1:-1,Ba=Ei*(oa*ea-sa*_a)+Fi*(sa*ra-na*ea)+Di*(na*_a-oa*ra),Aa=Ei*(_a*aa-ea*ia)+Fi*(ea*ta-ra*aa)+Di*(ra*ia-_a*ta),Pa=Ni*ga+Wi*Ya+Gi*Za,Ta=-1,Sa=0;if(da=0,La=0,za=0,(Ei*(ia*sa-aa*oa)+Fi*(aa*na-ta*sa)+Di*(ta*oa-ia*na))*wa<0){var Va,ka,Ca,qa,Ra,ja,Oa,Ea,Fa,Da,Na,Wa,Ga,Ua,Ja,Ha,Qa,Ka,$a=fa;Va=$a.x,ka=$a.y,Ca=$a.z;var tn=pa;qa=tn.x,Ra=tn.y,ja=tn.z;var an,nn,on,sn=ua;Oa=sn.x,Ea=sn.y,Fa=sn.z;var rn,_n,en,hn,ln=qa*((Ua=Ea-Ra)*(on=(Da=qa-Va)*Ua-(Na=Ra-ka)*(Ga=Oa-qa))-(Ja=Fa-ja)*(nn=(Wa=ja-Ca)*Ga-Da*Ja))+Ra*(Ja*(an=Na*Ja-Wa*Ua)-Ga*on)+ja*(Ga*nn-Ua*an),vn=Oa*((Qa=ka-Ea)*on-(Ka=Ca-Fa)*nn)+Ea*(Ka*an-(Ha=Va-Oa)*on)+Fa*(Ha*nn-Qa*an),cn=-1,mn=0;if(rn=0,_n=0,en=0,Va*(Na*on-Wa*nn)+ka*(Wa*an-Da*on)+Ca*(Da*nn-Na*an)<0){var bn,fn,pn,un,xn,Xn,Mn=fa;bn=Mn.x,fn=Mn.y,pn=Mn.z;var gn,Yn,Zn,In=pa;un=In.x,xn=In.y,Xn=In.z;var yn,dn=(gn=un-bn)*bn+(Yn=xn-fn)*fn+(Zn=Xn-pn)*pn;if((dn=-dn/(gn*gn+Yn*Yn+Zn*Zn))<0){var Ln=v;Ln.x=bn,Ln.y=fn,Ln.z=pn,yn=1}else if(dn>1){var zn=v;zn.x=un,zn.y=xn,zn.z=Xn,yn=2}else{var wn,Bn,An;wn=bn+gn*dn,Bn=fn+Yn*dn,An=pn+Zn*dn;var Pn=v;Pn.x=wn,Pn.y=Bn,Pn.z=An,yn=3}mn=yn,cn=v.x*v.x+v.y*v.y+v.z*v.z;var Tn=v;rn=Tn.x,_n=Tn.y,en=Tn.z}if(ln<0){var Sn,Vn,kn,Cn,qn,Rn,jn=pa;Sn=jn.x,Vn=jn.y,kn=jn.z;var On,En,Fn,Dn=ua;Cn=Dn.x,qn=Dn.y,Rn=Dn.z;var Nn,Wn=(On=Cn-Sn)*Sn+(En=qn-Vn)*Vn+(Fn=Rn-kn)*kn;if((Wn=-Wn/(On*On+En*En+Fn*Fn))<0){var Gn=v;Gn.x=Sn,Gn.y=Vn,Gn.z=kn,Nn=1}else if(Wn>1){var Un=v;Un.x=Cn,Un.y=qn,Un.z=Rn,Nn=2}else{var Jn,Hn,Qn;Jn=Sn+On*Wn,Hn=Vn+En*Wn,Qn=kn+Fn*Wn;var Kn=v;Kn.x=Jn,Kn.y=Hn,Kn.z=Qn,Nn=3}var $n=v.x*v.x+v.y*v.y+v.z*v.z;if(cn<0||$n<cn){mn=Nn<<1,cn=$n;var to=v;rn=to.x,_n=to.y,en=to.z}}if(vn<0){var io,ao,no,oo,so,ro,_o=fa;io=_o.x,ao=_o.y,no=_o.z;var eo,ho,lo,vo=ua;oo=vo.x,so=vo.y,ro=vo.z;var co,mo=(eo=oo-io)*io+(ho=so-ao)*ao+(lo=ro-no)*no;if((mo=-mo/(eo*eo+ho*ho+lo*lo))<0){var bo=v;bo.x=io,bo.y=ao,bo.z=no,co=1}else if(mo>1){var fo=v;fo.x=oo,fo.y=so,fo.z=ro,co=2}else{var po,uo,xo;po=io+eo*mo,uo=ao+ho*mo,xo=no+lo*mo;var Xo=v;Xo.x=po,Xo.y=uo,Xo.z=xo,co=3}var Mo=v.x*v.x+v.y*v.y+v.z*v.z;if(cn<0||Mo<cn){mn=1&co|(2&co)<<1,cn=Mo;var go=v;rn=go.x,_n=go.y,en=go.z}}if(cn>0){var Yo=v;Yo.x=rn,Yo.y=_n,Yo.z=en,hn=mn}else{var Zo=an*an+nn*nn+on*on;Zo>0&&(Zo=1/Math.sqrt(Zo));var Io=(an*=Zo)*an+(nn*=Zo)*nn+(on*=Zo)*on;rn=an*(Io=(Va*an+ka*nn+Ca*on)/Io),_n=nn*Io,en=on*Io;var yo=v;yo.x=rn,yo.y=_n,yo.z=en,hn=7}Sa=hn,Ta=v.x*v.x+v.y*v.y+v.z*v.z;var Lo=v;da=Lo.x,La=Lo.y,za=Lo.z}if(Ba*wa<0){var zo,wo,Bo,Ao,Po,To,So,Vo,ko,Co,qo,Ro,jo,Oo,Eo,Fo,Do,No,Wo=fa;zo=Wo.x,wo=Wo.y,Bo=Wo.z;var Go=ua;Ao=Go.x,Po=Go.y,To=Go.z;var Uo,Jo,Ho,Qo=xa;So=Qo.x,Vo=Qo.y,ko=Qo.z;var Ko,$o,ts,is,as=Ao*((Oo=Vo-Po)*(Ho=(Co=Ao-zo)*Oo-(qo=Po-wo)*(jo=So-Ao))-(Eo=ko-To)*(Jo=(Ro=To-Bo)*jo-Co*Eo))+Po*(Eo*(Uo=qo*Eo-Ro*Oo)-jo*Ho)+To*(jo*Jo-Oo*Uo),ns=So*((Do=wo-Vo)*Ho-(No=Bo-ko)*Jo)+Vo*(No*Uo-(Fo=zo-So)*Ho)+ko*(Fo*Jo-Do*Uo),os=-1,ss=0;if(Ko=0,$o=0,ts=0,zo*(qo*Ho-Ro*Jo)+wo*(Ro*Uo-Co*Ho)+Bo*(Co*Jo-qo*Uo)<0){var rs,_s,es,hs,ls,vs,cs=fa;rs=cs.x,_s=cs.y,es=cs.z;var ms,bs,fs,ps=ua;hs=ps.x,ls=ps.y,vs=ps.z;var us,xs=(ms=hs-rs)*rs+(bs=ls-_s)*_s+(fs=vs-es)*es;if((xs=-xs/(ms*ms+bs*bs+fs*fs))<0){var Xs=v;Xs.x=rs,Xs.y=_s,Xs.z=es,us=1}else if(xs>1){var Ms=v;Ms.x=hs,Ms.y=ls,Ms.z=vs,us=2}else{var gs,Ys,Zs;gs=rs+ms*xs,Ys=_s+bs*xs,Zs=es+fs*xs;var Is=v;Is.x=gs,Is.y=Ys,Is.z=Zs,us=3}ss=us,os=v.x*v.x+v.y*v.y+v.z*v.z;var ys=v;Ko=ys.x,$o=ys.y,ts=ys.z}if(as<0){var ds,Ls,zs,ws,Bs,As,Ps=ua;ds=Ps.x,Ls=Ps.y,zs=Ps.z;var Ts,Ss,Vs,ks=xa;ws=ks.x,Bs=ks.y,As=ks.z;var Cs,qs=(Ts=ws-ds)*ds+(Ss=Bs-Ls)*Ls+(Vs=As-zs)*zs;if((qs=-qs/(Ts*Ts+Ss*Ss+Vs*Vs))<0){var Rs=v;Rs.x=ds,Rs.y=Ls,Rs.z=zs,Cs=1}else if(qs>1){var js=v;js.x=ws,js.y=Bs,js.z=As,Cs=2}else{var Os,Es,Fs;Os=ds+Ts*qs,Es=Ls+Ss*qs,Fs=zs+Vs*qs;var Ds=v;Ds.x=Os,Ds.y=Es,Ds.z=Fs,Cs=3}var Ns=v.x*v.x+v.y*v.y+v.z*v.z;if(os<0||Ns<os){ss=Cs<<1,os=Ns;var Ws=v;Ko=Ws.x,$o=Ws.y,ts=Ws.z}}if(ns<0){var Gs,Us,Js,Hs,Qs,Ks,$s=fa;Gs=$s.x,Us=$s.y,Js=$s.z;var tr,ir,ar,nr=xa;Hs=nr.x,Qs=nr.y,Ks=nr.z;var or,sr=(tr=Hs-Gs)*Gs+(ir=Qs-Us)*Us+(ar=Ks-Js)*Js;if((sr=-sr/(tr*tr+ir*ir+ar*ar))<0){var rr=v;rr.x=Gs,rr.y=Us,rr.z=Js,or=1}else if(sr>1){var _r=v;_r.x=Hs,_r.y=Qs,_r.z=Ks,or=2}else{var er,hr,lr;er=Gs+tr*sr,hr=Us+ir*sr,lr=Js+ar*sr;var vr=v;vr.x=er,vr.y=hr,vr.z=lr,or=3}var cr=v.x*v.x+v.y*v.y+v.z*v.z;if(os<0||cr<os){ss=1&or|(2&or)<<1,os=cr;var mr=v;Ko=mr.x,$o=mr.y,ts=mr.z}}if(os>0){var br=v;br.x=Ko,br.y=$o,br.z=ts,is=ss}else{var fr=Uo*Uo+Jo*Jo+Ho*Ho;fr>0&&(fr=1/Math.sqrt(fr));var pr=(Uo*=fr)*Uo+(Jo*=fr)*Jo+(Ho*=fr)*Ho;Ko=Uo*(pr=(zo*Uo+wo*Jo+Bo*Ho)/pr),$o=Jo*pr,ts=Ho*pr;var ur=v;ur.x=Ko,ur.y=$o,ur.z=ts,is=7}var xr=v.x*v.x+v.y*v.y+v.z*v.z;if(Ta<0||xr<Ta){Sa=1&is|(6&is)<<1,Ta=xr;var Xr=v;da=Xr.x,La=Xr.y,za=Xr.z}}if(Aa*wa<0){var Mr,gr,Yr,Zr,Ir,yr,dr,Lr,zr,wr,Br,Ar,Pr,Tr,Sr,Vr,kr,Cr,qr=fa;Mr=qr.x,gr=qr.y,Yr=qr.z;var Rr=pa;Zr=Rr.x,Ir=Rr.y,yr=Rr.z;var jr,Or,Er,Fr=xa;dr=Fr.x,Lr=Fr.y,zr=Fr.z;var Dr,Nr,Wr,Gr,Ur=Zr*((Tr=Lr-Ir)*(Er=(wr=Zr-Mr)*Tr-(Br=Ir-gr)*(Pr=dr-Zr))-(Sr=zr-yr)*(Or=(Ar=yr-Yr)*Pr-wr*Sr))+Ir*(Sr*(jr=Br*Sr-Ar*Tr)-Pr*Er)+yr*(Pr*Or-Tr*jr),Jr=dr*((kr=gr-Lr)*Er-(Cr=Yr-zr)*Or)+Lr*(Cr*jr-(Vr=Mr-dr)*Er)+zr*(Vr*Or-kr*jr),Hr=-1,Qr=0;if(Dr=0,Nr=0,Wr=0,Mr*(Br*Er-Ar*Or)+gr*(Ar*jr-wr*Er)+Yr*(wr*Or-Br*jr)<0){var Kr,$r,t_,i_,a_,n_,o_=fa;Kr=o_.x,$r=o_.y,t_=o_.z;var s_,r_,__,e_=pa;i_=e_.x,a_=e_.y,n_=e_.z;var h_,l_=(s_=i_-Kr)*Kr+(r_=a_-$r)*$r+(__=n_-t_)*t_;if((l_=-l_/(s_*s_+r_*r_+__*__))<0){var v_=v;v_.x=Kr,v_.y=$r,v_.z=t_,h_=1}else if(l_>1){var c_=v;c_.x=i_,c_.y=a_,c_.z=n_,h_=2}else{var m_,b_,f_;m_=Kr+s_*l_,b_=$r+r_*l_,f_=t_+__*l_;var p_=v;p_.x=m_,p_.y=b_,p_.z=f_,h_=3}Qr=h_,Hr=v.x*v.x+v.y*v.y+v.z*v.z;var u_=v;Dr=u_.x,Nr=u_.y,Wr=u_.z}if(Ur<0){var x_,X_,M_,g_,Y_,Z_,I_=pa;x_=I_.x,X_=I_.y,M_=I_.z;var y_,d_,L_,z_=xa;g_=z_.x,Y_=z_.y,Z_=z_.z;var w_,B_=(y_=g_-x_)*x_+(d_=Y_-X_)*X_+(L_=Z_-M_)*M_;if((B_=-B_/(y_*y_+d_*d_+L_*L_))<0){var A_=v;A_.x=x_,A_.y=X_,A_.z=M_,w_=1}else if(B_>1){var P_=v;P_.x=g_,P_.y=Y_,P_.z=Z_,w_=2}else{var T_,S_,V_;T_=x_+y_*B_,S_=X_+d_*B_,V_=M_+L_*B_;var k_=v;k_.x=T_,k_.y=S_,k_.z=V_,w_=3}var C_=v.x*v.x+v.y*v.y+v.z*v.z;if(Hr<0||C_<Hr){Qr=w_<<1,Hr=C_;var q_=v;Dr=q_.x,Nr=q_.y,Wr=q_.z}}if(Jr<0){var R_,j_,O_,E_,F_,D_,N_=fa;R_=N_.x,j_=N_.y,O_=N_.z;var W_,G_,U_,J_=xa;E_=J_.x,F_=J_.y,D_=J_.z;var H_,Q_=(W_=E_-R_)*R_+(G_=F_-j_)*j_+(U_=D_-O_)*O_;if((Q_=-Q_/(W_*W_+G_*G_+U_*U_))<0){var K_=v;K_.x=R_,K_.y=j_,K_.z=O_,H_=1}else if(Q_>1){var $_=v;$_.x=E_,$_.y=F_,$_.z=D_,H_=2}else{var te,ie,ae;te=R_+W_*Q_,ie=j_+G_*Q_,ae=O_+U_*Q_;var ne=v;ne.x=te,ne.y=ie,ne.z=ae,H_=3}var oe=v.x*v.x+v.y*v.y+v.z*v.z;if(Hr<0||oe<Hr){Qr=1&H_|(2&H_)<<1,Hr=oe;var se=v;Dr=se.x,Nr=se.y,Wr=se.z}}if(Hr>0){var re=v;re.x=Dr,re.y=Nr,re.z=Wr,Gr=Qr}else{var _e=jr*jr+Or*Or+Er*Er;_e>0&&(_e=1/Math.sqrt(_e));var ee=(jr*=_e)*jr+(Or*=_e)*Or+(Er*=_e)*Er;Dr=jr*(ee=(Mr*jr+gr*Or+Yr*Er)/ee),Nr=Or*ee,Wr=Er*ee;var he=v;he.x=Dr,he.y=Nr,he.z=Wr,Gr=7}var le=v.x*v.x+v.y*v.y+v.z*v.z;if(Ta<0||le<Ta){Sa=3&Gr|(4&Gr)<<1,Ta=le;var ve=v;da=ve.x,La=ve.y,za=ve.z}}if(Pa*wa<0){var ce,me,be,fe,pe,ue,xe,Xe,Me,ge,Ye,Ze,Ie,ye,de,Le,ze,we,Be=pa;ce=Be.x,me=Be.y,be=Be.z;var Ae=ua;fe=Ae.x,pe=Ae.y,ue=Ae.z;var Pe,Te,Se,Ve=xa;xe=Ve.x,Xe=Ve.y,Me=Ve.z;var ke,Ce,qe,Re,je=fe*((ye=Xe-pe)*(Se=(ge=fe-ce)*ye-(Ye=pe-me)*(Ie=xe-fe))-(de=Me-ue)*(Te=(Ze=ue-be)*Ie-ge*de))+pe*(de*(Pe=Ye*de-Ze*ye)-Ie*Se)+ue*(Ie*Te-ye*Pe),Oe=xe*((ze=me-Xe)*Se-(we=be-Me)*Te)+Xe*(we*Pe-(Le=ce-xe)*Se)+Me*(Le*Te-ze*Pe),Ee=-1,Fe=0;if(ke=0,Ce=0,qe=0,ce*(Ye*Se-Ze*Te)+me*(Ze*Pe-ge*Se)+be*(ge*Te-Ye*Pe)<0){var De,Ne,We,Ge,Ue,Je,He=pa;De=He.x,Ne=He.y,We=He.z;var Qe,Ke,$e,th=ua;Ge=th.x,Ue=th.y,Je=th.z;var ih,ah=(Qe=Ge-De)*De+(Ke=Ue-Ne)*Ne+($e=Je-We)*We;if((ah=-ah/(Qe*Qe+Ke*Ke+$e*$e))<0){var nh=v;nh.x=De,nh.y=Ne,nh.z=We,ih=1}else if(ah>1){var oh=v;oh.x=Ge,oh.y=Ue,oh.z=Je,ih=2}else{var sh,rh,_h;sh=De+Qe*ah,rh=Ne+Ke*ah,_h=We+$e*ah;var eh=v;eh.x=sh,eh.y=rh,eh.z=_h,ih=3}Fe=ih,Ee=v.x*v.x+v.y*v.y+v.z*v.z;var hh=v;ke=hh.x,Ce=hh.y,qe=hh.z}if(je<0){var lh,vh,ch,mh,bh,fh,ph=ua;lh=ph.x,vh=ph.y,ch=ph.z;var uh,xh,Xh,Mh=xa;mh=Mh.x,bh=Mh.y,fh=Mh.z;var gh,Yh=(uh=mh-lh)*lh+(xh=bh-vh)*vh+(Xh=fh-ch)*ch;if((Yh=-Yh/(uh*uh+xh*xh+Xh*Xh))<0){var Zh=v;Zh.x=lh,Zh.y=vh,Zh.z=ch,gh=1}else if(Yh>1){var Ih=v;Ih.x=mh,Ih.y=bh,Ih.z=fh,gh=2}else{var yh,dh,Lh;yh=lh+uh*Yh,dh=vh+xh*Yh,Lh=ch+Xh*Yh;var zh=v;zh.x=yh,zh.y=dh,zh.z=Lh,gh=3}var wh=v.x*v.x+v.y*v.y+v.z*v.z;if(Ee<0||wh<Ee){Fe=gh<<1,Ee=wh;var Bh=v;ke=Bh.x,Ce=Bh.y,qe=Bh.z}}if(Oe<0){var Ah,Ph,Th,Sh,Vh,kh,Ch=pa;Ah=Ch.x,Ph=Ch.y,Th=Ch.z;var qh,Rh,jh,Oh=xa;Sh=Oh.x,Vh=Oh.y,kh=Oh.z;var Eh,Fh=(qh=Sh-Ah)*Ah+(Rh=Vh-Ph)*Ph+(jh=kh-Th)*Th;if((Fh=-Fh/(qh*qh+Rh*Rh+jh*jh))<0){var Dh=v;Dh.x=Ah,Dh.y=Ph,Dh.z=Th,Eh=1}else if(Fh>1){var Nh=v;Nh.x=Sh,Nh.y=Vh,Nh.z=kh,Eh=2}else{var Wh,Gh,Uh;Wh=Ah+qh*Fh,Gh=Ph+Rh*Fh,Uh=Th+jh*Fh;var Jh=v;Jh.x=Wh,Jh.y=Gh,Jh.z=Uh,Eh=3}var Hh=v.x*v.x+v.y*v.y+v.z*v.z;if(Ee<0||Hh<Ee){Fe=1&Eh|(2&Eh)<<1,Ee=Hh;var Qh=v;ke=Qh.x,Ce=Qh.y,qe=Qh.z}}if(Ee>0){var Kh=v;Kh.x=ke,Kh.y=Ce,Kh.z=qe,Re=Fe}else{var $h=Pe*Pe+Te*Te+Se*Se;$h>0&&($h=1/Math.sqrt($h));var tl=(Pe*=$h)*Pe+(Te*=$h)*Te+(Se*=$h)*Se;ke=Pe*(tl=(ce*Pe+me*Te+be*Se)/tl),Ce=Te*tl,qe=Se*tl;var il=v;il.x=ke,il.y=Ce,il.z=qe,Re=7}var al=v.x*v.x+v.y*v.y+v.z*v.z;if(Ta<0||al<Ta){Sa=Re<<1,Ta=al;var nl=v;da=nl.x,La=nl.y,za=nl.z}}if(Ta>0){var ol=v;ol.x=da,ol.y=La,ol.z=za,B=Sa}else v.zero(),B=15}if(this.shrinkSimplex(B),v.x*v.x+v.y*v.y+v.z*v.z<1e-8){if(0==Z||4==this.simplexSize)return r.fraction=Z,!1;this.interpolateClosestPoints(),r.fraction=Z;var sl=r.normal;sl.x=c.x,sl.y=c.y,sl.z=c.z;var rl=sl,_l=Math.sqrt(rl.x*rl.x+rl.y*rl.y+rl.z*rl.z);_l>0&&(_l=1/_l);var el=rl.x*_l,hl=rl.y*_l,ll=rl.z*_l;rl.x=el,rl.y=hl,rl.z=ll;var vl=r.position,cl=this.closestPoint1;vl.x=cl.x,vl.y=cl.y,vl.z=cl.z;var ml=vl,bl=ml.x+o.x*Z,fl=ml.y+o.y*Z,pl=ml.z+o.z*Z;return ml.x=bl,ml.y=fl,ml.z=pl,!0}c.x=v.x,c.y=v.y,c.z=v.z;var ul=c,xl=-ul.x,Xl=-ul.y,Ml=-ul.z;if(ul.x=xl,ul.y=Xl,ul.z=Ml,null!=this.c1)this.computeWitnessPoint1(!0);else{var gl=this.w1[this.simplexSize];gl.x=this.tf1._positionX,gl.y=this.tf1._positionY,gl.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);var Yl=this.s[this.simplexSize],Zl=this.w1[this.simplexSize];Yl.x=Zl.x,Yl.y=Zl.y,Yl.z=Zl.z;var Il=Yl,yl=this.w2[this.simplexSize],dl=Il.x-yl.x,Ll=Il.y-yl.y,zl=Il.z-yl.z;Il.x=dl,Il.y=Ll,Il.z=zl;var wl=l[this.simplexSize],Bl=wl.x-I.x,Al=wl.y-I.y,Pl=wl.z-I.z;if(wl.x=Bl,wl.y=Al,wl.z=Pl,c.x*c.x+c.y*c.y+c.z*c.z<1e-8)throw new Error("!?");var Tl=l[this.simplexSize],Sl=c,Vl=Tl.x*Sl.x+Tl.y*Sl.y+Tl.z*Sl.z;if(Vl<0){if(y.x*Sl.x+y.y*Sl.y+y.z*Sl.z>=0)return!1;var kl=Vl/(y.x*Sl.x+y.y*Sl.y+y.z*Sl.z);if((Z+=kl)>=1)return!1;var Cl=I.x+y.x*kl,ql=I.y+y.y*kl,Rl=I.z+y.z*kl;I.x=Cl,I.y=ql,I.z=Rl;for(var jl=0,Ol=this.simplexSize+1;jl<Ol;){var El=l[jl++],Fl=-kl,Dl=El.x+y.x*Fl,Nl=El.y+y.y*Fl,Wl=El.z+y.z*Fl;El.x=Dl,El.y=Nl,El.z=Wl}}for(var Gl=!1,Ul=0,Jl=this.simplexSize;Ul<Jl;){var Hl=Ul++,Ql=l[Hl].x-l[this.simplexSize].x,Kl=l[Hl].y-l[this.simplexSize].y,$l=l[Hl].z-l[this.simplexSize].z;if(Ql*Ql+Kl*Kl+$l*$l<1e-8){Gl=!0;break}}Gl||this.simplexSize++,++Y}return!1},interpolateClosestPoints:function(){switch(this.simplexSize){case 1:var t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;var a=this.closestPoint2,n=this.w2[0];a.x=n.x,a.y=n.y,a.z=n.z;break;case 2:var o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y=this.closest;o=y.x,s=y.y,r=y.z;var d=this.s[0];_=d.x,e=d.y,h=d.z;var L=this.w1[0];l=L.x,v=L.y,c=L.z;var z=this.w2[0];m=z.x,b=z.y,f=z.z;var w=this.s[1];p=w.x,u=w.y,x=w.z;var B=this.w1[1];X=B.x,M=B.y,g=B.z;var A=this.w2[1];Y=A.x,Z=A.y,I=A.z;var P=this.s[2];P.x,P.y,P.z;var T=this.w1[2];T.x,T.y,T.z;var S,V,k,C=this.w2[2];C.x,C.y,C.z;var q=(S=p-_)*S+(V=u-e)*V+(k=x-h)*k;0!=q&&(q=1/q);var R,j,O,E,F,D,N=((o-_)*S+(s-e)*V+(r-h)*k)*q;R=l+(X-l)*N,j=v+(M-v)*N,O=c+(g-c)*N,E=m+(Y-m)*N,F=b+(Z-b)*N,D=f+(I-f)*N;var W=this.closestPoint1;W.x=R,W.y=j,W.z=O;var G=this.closestPoint2;G.x=E,G.y=F,G.z=D;break;case 3:var U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt,ft,pt,ut,xt,Xt,Mt,gt,Yt,Zt,It=this.closest;U=It.x,J=It.y,H=It.z;var yt=this.s[0];Q=yt.x,K=yt.y,$=yt.z;var dt=this.w1[0];tt=dt.x,it=dt.y,at=dt.z;var Lt=this.w2[0];nt=Lt.x,ot=Lt.y,st=Lt.z;var zt=this.s[1];rt=zt.x,_t=zt.y,et=zt.z;var wt=this.w1[1];ht=wt.x,lt=wt.y,vt=wt.z;var Bt=this.w2[1];ct=Bt.x,mt=Bt.y,bt=Bt.z;var At=this.s[2];ft=At.x,pt=At.y,ut=At.z;var Pt=this.w1[2];xt=Pt.x,Xt=Pt.y,Mt=Pt.z;var Tt,St,Vt,kt,Ct,qt,Rt,jt,Ot,Et=this.w2[2];gt=Et.x,Yt=Et.y,Zt=Et.z;var Ft=(Tt=rt-Q)*Tt+(St=_t-K)*St+(Vt=et-$)*Vt,Dt=Tt*(kt=ft-Q)+St*(Ct=pt-K)+Vt*(qt=ut-$),Nt=kt*kt+Ct*Ct+qt*qt,Wt=Tt*(Rt=U-Q)+St*(jt=J-K)+Vt*(Ot=H-$),Gt=kt*Rt+Ct*jt+qt*Ot,Ut=Ft*Nt-Dt*Dt;0!=Ut&&(Ut=1/Ut);var Jt,Ht,Qt,Kt,$t,ti,ii=(Wt*Nt-Gt*Dt)*Ut,ai=(-Wt*Dt+Gt*Ft)*Ut;Jt=tt+(ht-tt)*ii,Ht=it+(lt-it)*ii,Qt=at+(vt-at)*ii,Jt+=(xt-tt)*ai,Ht+=(Xt-it)*ai,Qt+=(Mt-at)*ai,Kt=nt+(ct-nt)*ii,$t=ot+(mt-ot)*ii,ti=st+(bt-st)*ii,Kt+=(gt-nt)*ai,$t+=(Yt-ot)*ai,ti+=(Zt-st)*ai;var ni=this.closestPoint1;ni.x=Jt,ni.y=Ht,ni.z=Qt;var oi=this.closestPoint2;oi.x=Kt,oi.y=$t,oi.z=ti;break;default:throw new Error("!?")}},loadCache:function(t){var i=this.dir,a=t.prevClosestDir;i.x=a.x,i.y=a.y,i.z=a.z},saveCache:function(t){var i=t.prevClosestDir,a=this.closest;i.x=a.x,i.y=a.y,i.z=a.z;var n=i,o=-n.x,s=-n.y,r=-n.z;n.x=o,n.y=s,n.z=r},shrinkSimplex:function(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:var i=this.s[0],a=this.s[1];i.x=a.x,i.y=a.y,i.z=a.z;var n=this.w1[0],o=this.w1[1];n.x=o.x,n.y=o.y,n.z=o.z;var s=this.w2[0],r=this.w2[1];s.x=r.x,s.y=r.y,s.z=r.z;break;case 4:var _=this.s[0],e=this.s[2];_.x=e.x,_.y=e.y,_.z=e.z;var h=this.w1[0],l=this.w1[2];h.x=l.x,h.y=l.y,h.z=l.z;var v=this.w2[0],c=this.w2[2];v.x=c.x,v.y=c.y,v.z=c.z;break;case 5:var m=this.s[1],b=this.s[2];m.x=b.x,m.y=b.y,m.z=b.z;var f=this.w1[1],p=this.w1[2];f.x=p.x,f.y=p.y,f.z=p.z;var u=this.w2[1],x=this.w2[2];u.x=x.x,u.y=x.y,u.z=x.z;break;case 6:var X=this.s[0],M=this.s[2];X.x=M.x,X.y=M.y,X.z=M.z;var g=this.w1[0],Y=this.w1[2];g.x=Y.x,g.y=Y.y,g.z=Y.z;var Z=this.w2[0],I=this.w2[2];Z.x=I.x,Z.y=I.y,Z.z=I.z;break;case 8:var y=this.s[0],d=this.s[3];y.x=d.x,y.y=d.y,y.z=d.z;var L=this.w1[0],z=this.w1[3];L.x=z.x,L.y=z.y,L.z=z.z;var w=this.w2[0],B=this.w2[3];w.x=B.x,w.y=B.y,w.z=B.z;break;case 9:var A=this.s[1],P=this.s[3];A.x=P.x,A.y=P.y,A.z=P.z;var T=this.w1[1],S=this.w1[3];T.x=S.x,T.y=S.y,T.z=S.z;var V=this.w2[1],k=this.w2[3];V.x=k.x,V.y=k.y,V.z=k.z;break;case 10:var C=this.s[0],q=this.s[3];C.x=q.x,C.y=q.y,C.z=q.z;var R=this.w1[0],j=this.w1[3];R.x=j.x,R.y=j.y,R.z=j.z;var O=this.w2[0],E=this.w2[3];O.x=E.x,O.y=E.y,O.z=E.z;break;case 11:var F=this.s[2],D=this.s[3];F.x=D.x,F.y=D.y,F.z=D.z;var N=this.w1[2],W=this.w1[3];N.x=W.x,N.y=W.y,N.z=W.z;var G=this.w2[2],U=this.w2[3];G.x=U.x,G.y=U.y,G.z=U.z;break;case 12:var J=this.s[0],H=this.s[2];J.x=H.x,J.y=H.y,J.z=H.z;var Q=this.w1[0],K=this.w1[2];Q.x=K.x,Q.y=K.y,Q.z=K.z;var $=this.w2[0],tt=this.w2[2];$.x=tt.x,$.y=tt.y,$.z=tt.z;var it=this.s[1],at=this.s[3];it.x=at.x,it.y=at.y,it.z=at.z;var nt=this.w1[1],ot=this.w1[3];nt.x=ot.x,nt.y=ot.y,nt.z=ot.z;var st=this.w2[1],rt=this.w2[3];st.x=rt.x,st.y=rt.y,st.z=rt.z;break;case 13:var _t=this.s[1],et=this.s[3];_t.x=et.x,_t.y=et.y,_t.z=et.z;var ht=this.w1[1],lt=this.w1[3];ht.x=lt.x,ht.y=lt.y,ht.z=lt.z;var vt=this.w2[1],ct=this.w2[3];vt.x=ct.x,vt.y=ct.y,vt.z=ct.z;break;case 14:var mt=this.s[0],bt=this.s[3];mt.x=bt.x,mt.y=bt.y,mt.z=bt.z;var ft=this.w1[0],pt=this.w1[3];ft.x=pt.x,ft.y=pt.y,ft.z=pt.z;var ut=this.w2[0],xt=this.w2[3];ut.x=xt.x,ut.y=xt.y,ut.z=xt.z}},computeWitnessPoint1:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m=this.dir;o=m.x,s=m.y,r=m.z,_=this.tf1._rotation00*o+this.tf1._rotation10*s+this.tf1._rotation20*r,e=this.tf1._rotation01*o+this.tf1._rotation11*s+this.tf1._rotation21*r,h=this.tf1._rotation02*o+this.tf1._rotation12*s+this.tf1._rotation22*r;var b=this.dir;if(b.x=_,b.y=e,b.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){var f=this.dir,p=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);p>0&&(p=1/p);var u=f.x*p,x=f.y*p,X=f.z*p;f.x=u,f.y=x,f.z=X;var M=this.w1[this.simplexSize],g=this.dir,Y=this.c1._gjkMargin,Z=M.x+g.x*Y,I=M.y+g.y*Y,y=M.z+g.z*Y;M.x=Z,M.y=I,M.z=y}var d=this.w1[this.simplexSize];i=d.x,a=d.y,n=d.z,l=this.tf1._rotation00*i+this.tf1._rotation01*a+this.tf1._rotation02*n,v=this.tf1._rotation10*i+this.tf1._rotation11*a+this.tf1._rotation12*n,c=this.tf1._rotation20*i+this.tf1._rotation21*a+this.tf1._rotation22*n,l+=this.tf1._positionX,v+=this.tf1._positionY,c+=this.tf1._positionZ;var L=this.w1[this.simplexSize];L.x=l,L.y=v,L.z=c;var z=this.dir;z.x=o,z.y=s,z.z=r},computeWitnessPoint2:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m=this.dir;o=m.x,s=m.y,r=m.z,_=-(_=this.tf2._rotation00*o+this.tf2._rotation10*s+this.tf2._rotation20*r),e=-(e=this.tf2._rotation01*o+this.tf2._rotation11*s+this.tf2._rotation21*r),h=-(h=this.tf2._rotation02*o+this.tf2._rotation12*s+this.tf2._rotation22*r);var b=this.dir;if(b.x=_,b.y=e,b.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){var f=this.dir,p=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);p>0&&(p=1/p);var u=f.x*p,x=f.y*p,X=f.z*p;f.x=u,f.y=x,f.z=X;var M=this.w2[this.simplexSize],g=this.dir,Y=this.c2._gjkMargin,Z=M.x+g.x*Y,I=M.y+g.y*Y,y=M.z+g.z*Y;M.x=Z,M.y=I,M.z=y}var d=this.w2[this.simplexSize];i=d.x,a=d.y,n=d.z,l=this.tf2._rotation00*i+this.tf2._rotation01*a+this.tf2._rotation02*n,v=this.tf2._rotation10*i+this.tf2._rotation11*a+this.tf2._rotation12*n,c=this.tf2._rotation20*i+this.tf2._rotation21*a+this.tf2._rotation22*n,l+=this.tf2._positionX,v+=this.tf2._positionY,c+=this.tf2._positionZ;var L=this.w2[this.simplexSize];L.x=l,L.y=v,L.z=c;var z=this.dir;z.x=o,z.y=s,z.z=r},pointToTetrahedron:function(){for(var t=0;t<3;){var i=t++,a=this.dir,n=this.baseDirs[i];a.x=n.x,a.y=n.y,a.z=n.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var o=this.s[this.simplexSize],s=this.w1[this.simplexSize];o.x=s.x,o.y=s.y,o.z=s.z;var r=o,_=this.w2[this.simplexSize],e=r.x-_.x,h=r.y-_.y,l=r.z-_.z;if(r.x=e,r.y=h,r.z=l,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var v=this.dir,c=-v.x,m=-v.y,b=-v.z;v.x=c,v.y=m,v.z=b,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var f=this.s[this.simplexSize],p=this.w1[this.simplexSize];f.x=p.x,f.y=p.y,f.z=p.z;var u=f,x=this.w2[this.simplexSize],X=u.x-x.x,M=u.y-x.y,g=u.z-x.z;if(u.x=X,u.y=M,u.z=g,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}},lineToTetrahedron:function(){var t,i,a,n,o,s,r,_,e,h=this.dir;t=h.x,i=h.y,a=h.z;var l=this.s[0];n=l.x,o=l.y,s=l.z;var v=this.s[1];r=n-v.x,_=o-v.y,e=s-v.z;for(var c=0;c<3;){var m,b,f,p,u,x,X=c++,M=this.baseDirs[X];m=M.x,b=M.y,p=_*(f=M.z)-e*b,u=e*m-r*f,x=r*b-_*m;var g=this.dir;g.x=p,g.y=u,g.z=x,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var Y=this.s[this.simplexSize],Z=this.w1[this.simplexSize];Y.x=Z.x,Y.y=Z.y,Y.z=Z.z;var I=Y,y=this.w2[this.simplexSize],d=I.x-y.x,L=I.y-y.y,z=I.z-y.z;if(I.x=d,I.y=L,I.z=z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;var w=this.dir,B=-w.x,A=-w.y,P=-w.z;w.x=B,w.y=A,w.z=P,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var T=this.s[this.simplexSize],S=this.w1[this.simplexSize];T.x=S.x,T.y=S.y,T.z=S.z;var V=T,k=this.w2[this.simplexSize],C=V.x-k.x,q=V.y-k.y,R=V.z-k.z;if(V.x=C,V.y=q,V.z=R,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}var j=this.dir;j.x=t,j.y=i,j.z=a},triangleToTetrahedron:function(){var t,i,a,n=this.dir;for(t=n.x,i=n.y,a=n.z;;){var o,s,r,_,e,h,l,v,c,m,b,f,p,u,x=this.s[0];o=x.x,s=x.y,r=x.z;var X=this.s[1];_=X.x,e=X.y,h=X.z;var M,g,Y,Z=this.s[2];l=Z.x,v=Z.y,M=(m=e-s)*(u=Z.z-r)-(b=h-r)*(p=v-s),g=b*(f=l-o)-(c=_-o)*u,Y=c*p-m*f;var I=this.dir;I.x=M,I.y=g,I.z=Y,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var y=this.s[this.simplexSize],d=this.w1[this.simplexSize];y.x=d.x,y.y=d.y,y.z=d.z;var L=y,z=this.w2[this.simplexSize],w=L.x-z.x,B=L.y-z.y,A=L.z-z.z;if(L.x=w,L.y=B,L.z=A,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;var P=this.dir,T=-P.x,S=-P.y,V=-P.z;P.x=T,P.y=S,P.z=V,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var k=this.s[this.simplexSize],C=this.w1[this.simplexSize];k.x=C.x,k.y=C.y,k.z=C.z;var q=k,R=this.w2[this.simplexSize],j=q.x-R.x,O=q.y-R.y,E=q.z-R.z;if(q.x=j,q.y=O,q.z=E,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}var F=this.dir;F.x=t,F.y=i,F.z=a},isValidTetrahedron:function(){var t=this.s[1].x-this.s[0].x,i=this.s[1].y-this.s[0].y,a=this.s[1].z-this.s[0].z,n=this.s[2].x-this.s[0].x,o=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,r=this.s[3].x-this.s[0].x,_=this.s[3].y-this.s[0].y,e=this.s[3].z-this.s[0].z,h=t*(o*e-s*_)-i*(n*e-s*r)+a*(n*_-o*r);return h>1e-12||h<-1e-12},computeDepth:function(t,i,a,n,o,s,r){for(var _=this.polyhedron;_._numTriangles>0;){var e=_._triangleList;_._numTriangles--;var h=e._prev,l=e._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),e==_._triangleList&&(_._triangleList=_._triangleList._next),e==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),e._next=null,e._prev=null,e.removeReferences(),e._next=_._trianglePool,_._trianglePool=e}for(;_._numVertices>0;){var v=_._vertices[--_._numVertices];v.removeReferences(),v._next=_._vertexPool,_._vertexPool=v}var c=this.polyhedron,m=this.polyhedron,b=m._vertexPool;null!=b?(m._vertexPool=b._next,b._next=null):b=new j;var f=b.init(o[0],s[0],r[0]),p=this.polyhedron,u=p._vertexPool;null!=u?(p._vertexPool=u._next,u._next=null):u=new j;var x=u.init(o[1],s[1],r[1]),X=this.polyhedron,M=X._vertexPool;null!=M?(X._vertexPool=M._next,M._next=null):M=new j;var g=M.init(o[2],s[2],r[2]),Y=this.polyhedron,Z=Y._vertexPool;if(null!=Z?(Y._vertexPool=Z._next,Z._next=null):Z=new j,!c._init(f,x,g,Z.init(o[3],s[3],r[3])))return W.EPA_FAILED_TO_INIT;this.simplexSize=0;for(var I=this.s[0],y=this.w1[0],d=this.w2[0],L=0;L<40;){for(var z=this.polyhedron._triangleList,w=1/0,B=null;null!=z;){var A=z._next;z._distanceSq<w&&(w=z._distanceSq,B=z),z=A}var P=B,T=this.dir,S=P._normal;T.x=S.x,T.y=S.y,T.z=S.z;var V=T,k=Math.sqrt(V.x*V.x+V.y*V.y+V.z*V.z);k>0&&(k=1/k);var C=V.x*k,q=V.y*k,R=V.z*k;V.x=C,V.y=q,V.z=R,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);var O=this.s[this.simplexSize],E=this.w1[this.simplexSize];O.x=E.x,O.y=E.y,O.z=E.z;var F=O,D=this.w2[this.simplexSize],N=F.x-D.x,G=F.y-D.y,U=F.z-D.z;F.x=N,F.y=G,F.z=U;var J=P._vertices[0],H=P._vertices[1],Q=P._vertices[2],K=J.v,$=this.dir,tt=K.x*$.x+K.y*$.y+K.z*$.z,it=this.dir;if(I.x*it.x+I.y*it.y+I.z*it.z-tt<1e-6||39==L){var at=this.closest,nt=this.dir;at.x=nt.x,at.y=nt.y,at.z=nt.z;var ot,st,rt,_t=at,et=this.dir,ht=J.v,lt=this.dir,vt=(et.x*ht.x+et.y*ht.y+et.z*ht.z)/(lt.x*lt.x+lt.y*lt.y+lt.z*lt.z),ct=_t.x*vt,mt=_t.y*vt,bt=_t.z*vt;_t.x=ct,_t.y=mt,_t.z=bt;var ft,pt,ut,xt,Xt,Mt,gt,Yt,Zt,It,yt,dt,Lt,zt,wt,Bt,At,Pt,Tt,St,Vt,kt,Ct,qt,Rt,jt,Ot,Et=this.closest;ot=Et.x,st=Et.y,rt=Et.z;var Ft=J.v;ft=Ft.x,pt=Ft.y,ut=Ft.z;var Dt=J.w1;xt=Dt.x,Xt=Dt.y,Mt=Dt.z;var Nt=J.w2;gt=Nt.x,Yt=Nt.y,Zt=Nt.z;var Wt=H.v;It=Wt.x,yt=Wt.y,dt=Wt.z;var Gt=H.w1;Lt=Gt.x,zt=Gt.y,wt=Gt.z;var Ut=H.w2;Bt=Ut.x,At=Ut.y,Pt=Ut.z;var Jt=Q.v;Tt=Jt.x,St=Jt.y,Vt=Jt.z;var Ht=Q.w1;kt=Ht.x,Ct=Ht.y,qt=Ht.z;var Qt,Kt,$t,ti,ii,ai,ni,oi,si,ri=Q.w2;Rt=ri.x,jt=ri.y,Ot=ri.z;var _i=(Qt=It-ft)*Qt+(Kt=yt-pt)*Kt+($t=dt-ut)*$t,ei=Qt*(ti=Tt-ft)+Kt*(ii=St-pt)+$t*(ai=Vt-ut),hi=ti*ti+ii*ii+ai*ai,li=Qt*(ni=ot-ft)+Kt*(oi=st-pt)+$t*(si=rt-ut),vi=ti*ni+ii*oi+ai*si,ci=_i*hi-ei*ei;0!=ci&&(ci=1/ci);var mi,bi,fi,pi,ui,xi,Xi=(li*hi-vi*ei)*ci,Mi=(-li*ei+vi*_i)*ci;mi=xt+(Lt-xt)*Xi,bi=Xt+(zt-Xt)*Xi,fi=Mt+(wt-Mt)*Xi,mi+=(kt-xt)*Mi,bi+=(Ct-Xt)*Mi,fi+=(qt-Mt)*Mi,pi=gt+(Bt-gt)*Xi,ui=Yt+(At-Yt)*Xi,xi=Zt+(Pt-Zt)*Xi,pi+=(Rt-gt)*Mi,ui+=(jt-Yt)*Mi,xi+=(Ot-Zt)*Mi;var gi=this.closestPoint1;gi.x=mi,gi.y=bi,gi.z=fi;var Yi=this.closestPoint2;Yi.x=pi,Yi.y=ui,Yi.z=xi;var Zi=this.closest;return this.depth=Math.sqrt(Zi.x*Zi.x+Zi.y*Zi.y+Zi.z*Zi.z),W.SUCCEEDED}var Ii=this.polyhedron,yi=Ii._vertexPool;null!=yi?(Ii._vertexPool=yi._next,yi._next=null):yi=new j;var di=yi.init(I,y,d);if(!this.polyhedron._addVertex(di,P))return W.EPA_FAILED_TO_ADD_VERTEX;++L}return W.EPA_DID_NOT_CONVERGE},computeClosestPoints:function(t,i,a,n,o){return this.computeClosestPointsImpl(t,i,a,n,o,!0)},computeDistance:function(t,i,a,n,o){return this.computeClosestPointsImpl(t,i,a,n,o,!1)},convexCast:function(t,i,a,n,o,s,r){return this.convexCastImpl(t,i,a,n,o,s,r)},rayCast:function(t,i,a,n,o){var s=this.tempTransform,r=i,_=a;s._positionX=_.x,s._positionY=_.y,s._positionZ=_.z;var e=this.tl1,h=this.tl2;e.x=n.x,e.y=n.y,e.z=n.z;var l=e,v=l.x-a.x,c=l.y-a.y,m=l.z-a.z;return l.x=v,l.y=c,l.z=m,h.zero(),this.convexCastImpl(null,t,s,r,e,h,o)}};var W=function(){},G=function(){};G.projectOrigin2=function(t,i,a){var n,o,s,r,_,e,h=t;n=h.x,o=h.y,s=h.z;var l,v,c,m=i;r=m.x,_=m.y,e=m.z;var b,f,p,u=(l=r-n)*n+(v=_-o)*o+(c=e-s)*s;if((u=-u/(l*l+v*v+c*c))<0){var x=a;return x.x=n,x.y=o,x.z=s,1}if(u>1){var X=a;return X.x=r,X.y=_,X.z=e,2}b=n+l*u,f=o+v*u,p=s+c*u;var M=a;return M.x=b,M.y=f,M.z=p,3},G.projectOrigin3=function(t,i,a,n){var o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y=t;o=Y.x,s=Y.y,r=Y.z;var Z=i;_=Z.x,e=Z.y,h=Z.z;var I,y,d,L=a;l=L.x,v=L.y,c=L.z;var z,w,B,A=_*((u=v-e)*(d=(m=_-o)*u-(b=e-s)*(p=l-_))-(x=c-h)*(y=(f=h-r)*p-m*x))+e*(x*(I=b*x-f*u)-p*d)+h*(p*y-u*I),P=l*((M=s-v)*d-(g=r-c)*y)+v*(g*I-(X=o-l)*d)+c*(X*y-M*I),T=-1,S=0;if(z=0,w=0,B=0,o*(b*d-f*y)+s*(f*I-m*d)+r*(m*y-b*I)<0){var V,k,C,q,R,j,O=t;V=O.x,k=O.y,C=O.z;var E,F,D,N=i;q=N.x,R=N.y,j=N.z;var W,G=(E=q-V)*V+(F=R-k)*k+(D=j-C)*C;if((G=-G/(E*E+F*F+D*D))<0){var U=n;U.x=V,U.y=k,U.z=C,W=1}else if(G>1){var J=n;J.x=q,J.y=R,J.z=j,W=2}else{var H,Q,K;H=V+E*G,Q=k+F*G,K=C+D*G;var $=n;$.x=H,$.y=Q,$.z=K,W=3}S=W,T=n.x*n.x+n.y*n.y+n.z*n.z;var tt=n;z=tt.x,w=tt.y,B=tt.z}if(A<0){var it,at,nt,ot,st,rt,_t=i;it=_t.x,at=_t.y,nt=_t.z;var et,ht,lt,vt=a;ot=vt.x,st=vt.y,rt=vt.z;var ct,mt=(et=ot-it)*it+(ht=st-at)*at+(lt=rt-nt)*nt;if((mt=-mt/(et*et+ht*ht+lt*lt))<0){var bt=n;bt.x=it,bt.y=at,bt.z=nt,ct=1}else if(mt>1){var ft=n;ft.x=ot,ft.y=st,ft.z=rt,ct=2}else{var pt,ut,xt;pt=it+et*mt,ut=at+ht*mt,xt=nt+lt*mt;var Xt=n;Xt.x=pt,Xt.y=ut,Xt.z=xt,ct=3}var Mt=n.x*n.x+n.y*n.y+n.z*n.z;if(T<0||Mt<T){S=ct<<1,T=Mt;var gt=n;z=gt.x,w=gt.y,B=gt.z}}if(P<0){var Yt,Zt,It,yt,dt,Lt,zt=t;Yt=zt.x,Zt=zt.y,It=zt.z;var wt,Bt,At,Pt=a;yt=Pt.x,dt=Pt.y,Lt=Pt.z;var Tt,St=(wt=yt-Yt)*Yt+(Bt=dt-Zt)*Zt+(At=Lt-It)*It;if((St=-St/(wt*wt+Bt*Bt+At*At))<0){var Vt=n;Vt.x=Yt,Vt.y=Zt,Vt.z=It,Tt=1}else if(St>1){var kt=n;kt.x=yt,kt.y=dt,kt.z=Lt,Tt=2}else{var Ct,qt,Rt;Ct=Yt+wt*St,qt=Zt+Bt*St,Rt=It+At*St;var jt=n;jt.x=Ct,jt.y=qt,jt.z=Rt,Tt=3}var Ot=n.x*n.x+n.y*n.y+n.z*n.z;if(T<0||Ot<T){S=1&Tt|(2&Tt)<<1,T=Ot;var Et=n;z=Et.x,w=Et.y,B=Et.z}}if(T>0){var Ft=n;return Ft.x=z,Ft.y=w,Ft.z=B,S}var Dt=I*I+y*y+d*d;Dt>0&&(Dt=1/Math.sqrt(Dt));var Nt=(I*=Dt)*I+(y*=Dt)*y+(d*=Dt)*d;z=I*(Nt=(o*I+s*y+r*d)/Nt),w=y*Nt,B=d*Nt;var Wt=n;return Wt.x=z,Wt.y=w,Wt.z=B,7},G.projectOrigin4=function(t,i,a,n,o){var s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P=t;s=P.x,r=P.y,_=P.z;var T=i;e=T.x,h=T.y,l=T.z;var S,V,k,C=a,q=n;M=(v=C.x)-s,g=(c=C.y)-r,Y=(m=C.z)-_,Z=(b=q.x)-s,I=(f=q.y)-r,y=(p=q.z)-_;var R,j,O,E=(u=e-s)*(S=(B=f-h)*(z=m-l)-(A=p-l)*(L=c-h))+(x=h-r)*(V=A*(d=v-e)-(w=b-e)*z)+(X=l-_)*(k=w*L-B*d)>0?1:-1,F=s*(g*y-Y*I)+r*(Y*Z-M*y)+_*(M*I-g*Z),D=s*(I*X-y*x)+r*(y*u-Z*X)+_*(Z*x-I*u),N=e*S+h*V+l*k,W=-1,G=0;if(R=0,j=0,O=0,(s*(x*Y-X*g)+r*(X*M-u*Y)+_*(u*g-x*M))*E<0){var U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct=t;U=ct.x,J=ct.y,H=ct.z;var mt=i;Q=mt.x,K=mt.y,$=mt.z;var bt,ft,pt,ut=a;tt=ut.x,it=ut.y,at=ut.z;var xt,Xt,Mt,gt,Yt=Q*((_t=it-K)*(pt=(nt=Q-U)*_t-(ot=K-J)*(rt=tt-Q))-(et=at-$)*(ft=(st=$-H)*rt-nt*et))+K*(et*(bt=ot*et-st*_t)-rt*pt)+$*(rt*ft-_t*bt),Zt=tt*((lt=J-it)*pt-(vt=H-at)*ft)+it*(vt*bt-(ht=U-tt)*pt)+at*(ht*ft-lt*bt),It=-1,yt=0;if(xt=0,Xt=0,Mt=0,U*(ot*pt-st*ft)+J*(st*bt-nt*pt)+H*(nt*ft-ot*bt)<0){var dt,Lt,zt,wt,Bt,At,Pt=t;dt=Pt.x,Lt=Pt.y,zt=Pt.z;var Tt,St,Vt,kt=i;wt=kt.x,Bt=kt.y,At=kt.z;var Ct,qt=(Tt=wt-dt)*dt+(St=Bt-Lt)*Lt+(Vt=At-zt)*zt;if((qt=-qt/(Tt*Tt+St*St+Vt*Vt))<0){var Rt=o;Rt.x=dt,Rt.y=Lt,Rt.z=zt,Ct=1}else if(qt>1){var jt=o;jt.x=wt,jt.y=Bt,jt.z=At,Ct=2}else{var Ot,Et,Ft;Ot=dt+Tt*qt,Et=Lt+St*qt,Ft=zt+Vt*qt;var Dt=o;Dt.x=Ot,Dt.y=Et,Dt.z=Ft,Ct=3}yt=Ct,It=o.x*o.x+o.y*o.y+o.z*o.z;var Nt=o;xt=Nt.x,Xt=Nt.y,Mt=Nt.z}if(Yt<0){var Wt,Gt,Ut,Jt,Ht,Qt,Kt=i;Wt=Kt.x,Gt=Kt.y,Ut=Kt.z;var $t,ti,ii,ai=a;Jt=ai.x,Ht=ai.y,Qt=ai.z;var ni,oi=($t=Jt-Wt)*Wt+(ti=Ht-Gt)*Gt+(ii=Qt-Ut)*Ut;if((oi=-oi/($t*$t+ti*ti+ii*ii))<0){var si=o;si.x=Wt,si.y=Gt,si.z=Ut,ni=1}else if(oi>1){var ri=o;ri.x=Jt,ri.y=Ht,ri.z=Qt,ni=2}else{var _i,ei,hi;_i=Wt+$t*oi,ei=Gt+ti*oi,hi=Ut+ii*oi;var li=o;li.x=_i,li.y=ei,li.z=hi,ni=3}var vi=o.x*o.x+o.y*o.y+o.z*o.z;if(It<0||vi<It){yt=ni<<1,It=vi;var ci=o;xt=ci.x,Xt=ci.y,Mt=ci.z}}if(Zt<0){var mi,bi,fi,pi,ui,xi,Xi=t;mi=Xi.x,bi=Xi.y,fi=Xi.z;var Mi,gi,Yi,Zi=a;pi=Zi.x,ui=Zi.y,xi=Zi.z;var Ii,yi=(Mi=pi-mi)*mi+(gi=ui-bi)*bi+(Yi=xi-fi)*fi;if((yi=-yi/(Mi*Mi+gi*gi+Yi*Yi))<0){var di=o;di.x=mi,di.y=bi,di.z=fi,Ii=1}else if(yi>1){var Li=o;Li.x=pi,Li.y=ui,Li.z=xi,Ii=2}else{var zi,wi,Bi;zi=mi+Mi*yi,wi=bi+gi*yi,Bi=fi+Yi*yi;var Ai=o;Ai.x=zi,Ai.y=wi,Ai.z=Bi,Ii=3}var Pi=o.x*o.x+o.y*o.y+o.z*o.z;if(It<0||Pi<It){yt=1&Ii|(2&Ii)<<1,It=Pi;var Ti=o;xt=Ti.x,Xt=Ti.y,Mt=Ti.z}}if(It>0){var Si=o;Si.x=xt,Si.y=Xt,Si.z=Mt,gt=yt}else{var Vi=bt*bt+ft*ft+pt*pt;Vi>0&&(Vi=1/Math.sqrt(Vi));var ki=(bt*=Vi)*bt+(ft*=Vi)*ft+(pt*=Vi)*pt;xt=bt*(ki=(U*bt+J*ft+H*pt)/ki),Xt=ft*ki,Mt=pt*ki;var Ci=o;Ci.x=xt,Ci.y=Xt,Ci.z=Mt,gt=7}G=gt,W=o.x*o.x+o.y*o.y+o.z*o.z;var qi=o;R=qi.x,j=qi.y,O=qi.z}if(F*E<0){var Ri,ji,Oi,Ei,Fi,Di,Ni,Wi,Gi,Ui,Ji,Hi,Qi,Ki,$i,ta,ia,aa,na=t;Ri=na.x,ji=na.y,Oi=na.z;var oa=a;Ei=oa.x,Fi=oa.y,Di=oa.z;var sa,ra,_a,ea=n;Ni=ea.x,Wi=ea.y,Gi=ea.z;var ha,la,va,ca,ma=Ei*((Ki=Wi-Fi)*(_a=(Ui=Ei-Ri)*Ki-(Ji=Fi-ji)*(Qi=Ni-Ei))-($i=Gi-Di)*(ra=(Hi=Di-Oi)*Qi-Ui*$i))+Fi*($i*(sa=Ji*$i-Hi*Ki)-Qi*_a)+Di*(Qi*ra-Ki*sa),ba=Ni*((ia=ji-Wi)*_a-(aa=Oi-Gi)*ra)+Wi*(aa*sa-(ta=Ri-Ni)*_a)+Gi*(ta*ra-ia*sa),fa=-1,pa=0;if(ha=0,la=0,va=0,Ri*(Ji*_a-Hi*ra)+ji*(Hi*sa-Ui*_a)+Oi*(Ui*ra-Ji*sa)<0){var ua,xa,Xa,Ma,ga,Ya,Za=t;ua=Za.x,xa=Za.y,Xa=Za.z;var Ia,ya,da,La=a;Ma=La.x,ga=La.y,Ya=La.z;var za,wa=(Ia=Ma-ua)*ua+(ya=ga-xa)*xa+(da=Ya-Xa)*Xa;if((wa=-wa/(Ia*Ia+ya*ya+da*da))<0){var Ba=o;Ba.x=ua,Ba.y=xa,Ba.z=Xa,za=1}else if(wa>1){var Aa=o;Aa.x=Ma,Aa.y=ga,Aa.z=Ya,za=2}else{var Pa,Ta,Sa;Pa=ua+Ia*wa,Ta=xa+ya*wa,Sa=Xa+da*wa;var Va=o;Va.x=Pa,Va.y=Ta,Va.z=Sa,za=3}pa=za,fa=o.x*o.x+o.y*o.y+o.z*o.z;var ka=o;ha=ka.x,la=ka.y,va=ka.z}if(ma<0){var Ca,qa,Ra,ja,Oa,Ea,Fa=a;Ca=Fa.x,qa=Fa.y,Ra=Fa.z;var Da,Na,Wa,Ga=n;ja=Ga.x,Oa=Ga.y,Ea=Ga.z;var Ua,Ja=(Da=ja-Ca)*Ca+(Na=Oa-qa)*qa+(Wa=Ea-Ra)*Ra;if((Ja=-Ja/(Da*Da+Na*Na+Wa*Wa))<0){var Ha=o;Ha.x=Ca,Ha.y=qa,Ha.z=Ra,Ua=1}else if(Ja>1){var Qa=o;Qa.x=ja,Qa.y=Oa,Qa.z=Ea,Ua=2}else{var Ka,$a,tn;Ka=Ca+Da*Ja,$a=qa+Na*Ja,tn=Ra+Wa*Ja;var an=o;an.x=Ka,an.y=$a,an.z=tn,Ua=3}var nn=o.x*o.x+o.y*o.y+o.z*o.z;if(fa<0||nn<fa){pa=Ua<<1,fa=nn;var on=o;ha=on.x,la=on.y,va=on.z}}if(ba<0){var sn,rn,_n,en,hn,ln,vn=t;sn=vn.x,rn=vn.y,_n=vn.z;var cn,mn,bn,fn=n;en=fn.x,hn=fn.y,ln=fn.z;var pn,un=(cn=en-sn)*sn+(mn=hn-rn)*rn+(bn=ln-_n)*_n;if((un=-un/(cn*cn+mn*mn+bn*bn))<0){var xn=o;xn.x=sn,xn.y=rn,xn.z=_n,pn=1}else if(un>1){var Xn=o;Xn.x=en,Xn.y=hn,Xn.z=ln,pn=2}else{var Mn,gn,Yn;Mn=sn+cn*un,gn=rn+mn*un,Yn=_n+bn*un;var Zn=o;Zn.x=Mn,Zn.y=gn,Zn.z=Yn,pn=3}var In=o.x*o.x+o.y*o.y+o.z*o.z;if(fa<0||In<fa){pa=1&pn|(2&pn)<<1,fa=In;var yn=o;ha=yn.x,la=yn.y,va=yn.z}}if(fa>0){var dn=o;dn.x=ha,dn.y=la,dn.z=va,ca=pa}else{var Ln=sa*sa+ra*ra+_a*_a;Ln>0&&(Ln=1/Math.sqrt(Ln));var zn=(sa*=Ln)*sa+(ra*=Ln)*ra+(_a*=Ln)*_a;ha=sa*(zn=(Ri*sa+ji*ra+Oi*_a)/zn),la=ra*zn,va=_a*zn;var wn=o;wn.x=ha,wn.y=la,wn.z=va,ca=7}var Bn=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||Bn<W){G=1&ca|(6&ca)<<1,W=Bn;var An=o;R=An.x,j=An.y,O=An.z}}if(D*E<0){var Pn,Tn,Sn,Vn,kn,Cn,qn,Rn,jn,On,En,Fn,Dn,Nn,Wn,Gn,Un,Jn,Hn=t;Pn=Hn.x,Tn=Hn.y,Sn=Hn.z;var Qn=i;Vn=Qn.x,kn=Qn.y,Cn=Qn.z;var Kn,$n,to,io=n;qn=io.x,Rn=io.y,jn=io.z;var ao,no,oo,so,ro=Vn*((Nn=Rn-kn)*(to=(On=Vn-Pn)*Nn-(En=kn-Tn)*(Dn=qn-Vn))-(Wn=jn-Cn)*($n=(Fn=Cn-Sn)*Dn-On*Wn))+kn*(Wn*(Kn=En*Wn-Fn*Nn)-Dn*to)+Cn*(Dn*$n-Nn*Kn),_o=qn*((Un=Tn-Rn)*to-(Jn=Sn-jn)*$n)+Rn*(Jn*Kn-(Gn=Pn-qn)*to)+jn*(Gn*$n-Un*Kn),eo=-1,ho=0;if(ao=0,no=0,oo=0,Pn*(En*to-Fn*$n)+Tn*(Fn*Kn-On*to)+Sn*(On*$n-En*Kn)<0){var lo,vo,co,mo,bo,fo,po=t;lo=po.x,vo=po.y,co=po.z;var uo,xo,Xo,Mo=i;mo=Mo.x,bo=Mo.y,fo=Mo.z;var go,Yo=(uo=mo-lo)*lo+(xo=bo-vo)*vo+(Xo=fo-co)*co;if((Yo=-Yo/(uo*uo+xo*xo+Xo*Xo))<0){var Zo=o;Zo.x=lo,Zo.y=vo,Zo.z=co,go=1}else if(Yo>1){var Io=o;Io.x=mo,Io.y=bo,Io.z=fo,go=2}else{var yo,Lo,zo;yo=lo+uo*Yo,Lo=vo+xo*Yo,zo=co+Xo*Yo;var wo=o;wo.x=yo,wo.y=Lo,wo.z=zo,go=3}ho=go,eo=o.x*o.x+o.y*o.y+o.z*o.z;var Bo=o;ao=Bo.x,no=Bo.y,oo=Bo.z}if(ro<0){var Ao,Po,To,So,Vo,ko,Co=i;Ao=Co.x,Po=Co.y,To=Co.z;var qo,Ro,jo,Oo=n;So=Oo.x,Vo=Oo.y,ko=Oo.z;var Eo,Fo=(qo=So-Ao)*Ao+(Ro=Vo-Po)*Po+(jo=ko-To)*To;if((Fo=-Fo/(qo*qo+Ro*Ro+jo*jo))<0){var Do=o;Do.x=Ao,Do.y=Po,Do.z=To,Eo=1}else if(Fo>1){var No=o;No.x=So,No.y=Vo,No.z=ko,Eo=2}else{var Wo,Go,Uo;Wo=Ao+qo*Fo,Go=Po+Ro*Fo,Uo=To+jo*Fo;var Jo=o;Jo.x=Wo,Jo.y=Go,Jo.z=Uo,Eo=3}var Ho=o.x*o.x+o.y*o.y+o.z*o.z;if(eo<0||Ho<eo){ho=Eo<<1,eo=Ho;var Qo=o;ao=Qo.x,no=Qo.y,oo=Qo.z}}if(_o<0){var Ko,$o,ts,is,as,ns,os=t;Ko=os.x,$o=os.y,ts=os.z;var ss,rs,_s,es=n;is=es.x,as=es.y,ns=es.z;var hs,ls=(ss=is-Ko)*Ko+(rs=as-$o)*$o+(_s=ns-ts)*ts;if((ls=-ls/(ss*ss+rs*rs+_s*_s))<0){var vs=o;vs.x=Ko,vs.y=$o,vs.z=ts,hs=1}else if(ls>1){var cs=o;cs.x=is,cs.y=as,cs.z=ns,hs=2}else{var ms,bs,fs;ms=Ko+ss*ls,bs=$o+rs*ls,fs=ts+_s*ls;var ps=o;ps.x=ms,ps.y=bs,ps.z=fs,hs=3}var us=o.x*o.x+o.y*o.y+o.z*o.z;if(eo<0||us<eo){ho=1&hs|(2&hs)<<1,eo=us;var xs=o;ao=xs.x,no=xs.y,oo=xs.z}}if(eo>0){var Xs=o;Xs.x=ao,Xs.y=no,Xs.z=oo,so=ho}else{var Ms=Kn*Kn+$n*$n+to*to;Ms>0&&(Ms=1/Math.sqrt(Ms));var gs=(Kn*=Ms)*Kn+($n*=Ms)*$n+(to*=Ms)*to;ao=Kn*(gs=(Pn*Kn+Tn*$n+Sn*to)/gs),no=$n*gs,oo=to*gs;var Ys=o;Ys.x=ao,Ys.y=no,Ys.z=oo,so=7}var Zs=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||Zs<W){G=3&so|(4&so)<<1,W=Zs;var Is=o;R=Is.x,j=Is.y,O=Is.z}}if(N*E<0){var ys,ds,Ls,zs,ws,Bs,As,Ps,Ts,Ss,Vs,ks,Cs,qs,Rs,js,Os,Es,Fs=i;ys=Fs.x,ds=Fs.y,Ls=Fs.z;var Ds=a;zs=Ds.x,ws=Ds.y,Bs=Ds.z;var Ns,Ws,Gs,Us=n;As=Us.x,Ps=Us.y,Ts=Us.z;var Js,Hs,Qs,Ks,$s=zs*((qs=Ps-ws)*(Gs=(Ss=zs-ys)*qs-(Vs=ws-ds)*(Cs=As-zs))-(Rs=Ts-Bs)*(Ws=(ks=Bs-Ls)*Cs-Ss*Rs))+ws*(Rs*(Ns=Vs*Rs-ks*qs)-Cs*Gs)+Bs*(Cs*Ws-qs*Ns),tr=As*((Os=ds-Ps)*Gs-(Es=Ls-Ts)*Ws)+Ps*(Es*Ns-(js=ys-As)*Gs)+Ts*(js*Ws-Os*Ns),ir=-1,ar=0;if(Js=0,Hs=0,Qs=0,ys*(Vs*Gs-ks*Ws)+ds*(ks*Ns-Ss*Gs)+Ls*(Ss*Ws-Vs*Ns)<0){var nr,or,sr,rr,_r,er,hr=i;nr=hr.x,or=hr.y,sr=hr.z;var lr,vr,cr,mr=a;rr=mr.x,_r=mr.y,er=mr.z;var br,fr=(lr=rr-nr)*nr+(vr=_r-or)*or+(cr=er-sr)*sr;if((fr=-fr/(lr*lr+vr*vr+cr*cr))<0){var pr=o;pr.x=nr,pr.y=or,pr.z=sr,br=1}else if(fr>1){var ur=o;ur.x=rr,ur.y=_r,ur.z=er,br=2}else{var xr,Xr,Mr;xr=nr+lr*fr,Xr=or+vr*fr,Mr=sr+cr*fr;var gr=o;gr.x=xr,gr.y=Xr,gr.z=Mr,br=3}ar=br,ir=o.x*o.x+o.y*o.y+o.z*o.z;var Yr=o;Js=Yr.x,Hs=Yr.y,Qs=Yr.z}if($s<0){var Zr,Ir,yr,dr,Lr,zr,wr=a;Zr=wr.x,Ir=wr.y,yr=wr.z;var Br,Ar,Pr,Tr=n;dr=Tr.x,Lr=Tr.y,zr=Tr.z;var Sr,Vr=(Br=dr-Zr)*Zr+(Ar=Lr-Ir)*Ir+(Pr=zr-yr)*yr;if((Vr=-Vr/(Br*Br+Ar*Ar+Pr*Pr))<0){var kr=o;kr.x=Zr,kr.y=Ir,kr.z=yr,Sr=1}else if(Vr>1){var Cr=o;Cr.x=dr,Cr.y=Lr,Cr.z=zr,Sr=2}else{var qr,Rr,jr;qr=Zr+Br*Vr,Rr=Ir+Ar*Vr,jr=yr+Pr*Vr;var Or=o;Or.x=qr,Or.y=Rr,Or.z=jr,Sr=3}var Er=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||Er<ir){ar=Sr<<1,ir=Er;var Fr=o;Js=Fr.x,Hs=Fr.y,Qs=Fr.z}}if(tr<0){var Dr,Nr,Wr,Gr,Ur,Jr,Hr=i;Dr=Hr.x,Nr=Hr.y,Wr=Hr.z;var Qr,Kr,$r,t_=n;Gr=t_.x,Ur=t_.y,Jr=t_.z;var i_,a_=(Qr=Gr-Dr)*Dr+(Kr=Ur-Nr)*Nr+($r=Jr-Wr)*Wr;if((a_=-a_/(Qr*Qr+Kr*Kr+$r*$r))<0){var n_=o;n_.x=Dr,n_.y=Nr,n_.z=Wr,i_=1}else if(a_>1){var o_=o;o_.x=Gr,o_.y=Ur,o_.z=Jr,i_=2}else{var s_,r_,__;s_=Dr+Qr*a_,r_=Nr+Kr*a_,__=Wr+$r*a_;var e_=o;e_.x=s_,e_.y=r_,e_.z=__,i_=3}var h_=o.x*o.x+o.y*o.y+o.z*o.z;if(ir<0||h_<ir){ar=1&i_|(2&i_)<<1,ir=h_;var l_=o;Js=l_.x,Hs=l_.y,Qs=l_.z}}if(ir>0){var v_=o;v_.x=Js,v_.y=Hs,v_.z=Qs,Ks=ar}else{var c_=Ns*Ns+Ws*Ws+Gs*Gs;c_>0&&(c_=1/Math.sqrt(c_));var m_=(Ns*=c_)*Ns+(Ws*=c_)*Ws+(Gs*=c_)*Gs;Js=Ns*(m_=(ys*Ns+ds*Ws+Ls*Gs)/m_),Hs=Ws*m_,Qs=Gs*m_;var b_=o;b_.x=Js,b_.y=Hs,b_.z=Qs,Ks=7}var f_=o.x*o.x+o.y*o.y+o.z*o.z;if(W<0||f_<W){G=Ks<<1,W=f_;var p_=o;R=p_.x,j=p_.y,O=p_.z}}if(W>0){var u_=o;return u_.x=R,u_.y=j,u_.z=O,G}return o.zero(),15};var U=function(t,i,a,n,o,s,r,_,e){null==e&&(e=1),null==_&&(_=0),null==r&&(r=0),null==s&&(s=0),null==o&&(o=1),null==n&&(n=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=r,this.e21=_,this.e22=e,U.numCreations++};U.prototype={init:function(t,i,a,n,o,s,r,_,e){return this.e00=t,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=r,this.e21=_,this.e22=e,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this},add:function(t){return new U(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)},sub:function(t){return new U(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)},scale:function(t){return new U(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)},mul:function(t){return new U(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)},addEq:function(t){var i=this.e00+t.e00,a=this.e01+t.e01,n=this.e02+t.e02,o=this.e10+t.e10,s=this.e11+t.e11,r=this.e12+t.e12,_=this.e20+t.e20,e=this.e21+t.e21,h=this.e22+t.e22;return this.e00=i,this.e01=a,this.e02=n,this.e10=o,this.e11=s,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this},subEq:function(t){var i=this.e00-t.e00,a=this.e01-t.e01,n=this.e02-t.e02,o=this.e10-t.e10,s=this.e11-t.e11,r=this.e12-t.e12,_=this.e20-t.e20,e=this.e21-t.e21,h=this.e22-t.e22;return this.e00=i,this.e01=a,this.e02=n,this.e10=o,this.e11=s,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this},scaleEq:function(t){var i=this.e00*t,a=this.e01*t,n=this.e02*t,o=this.e10*t,s=this.e11*t,r=this.e12*t,_=this.e20*t,e=this.e21*t,h=this.e22*t;return this.e00=i,this.e01=a,this.e02=n,this.e10=o,this.e11=s,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this},mulEq:function(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,n=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,e=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=i,this.e01=a,this.e02=n,this.e10=o,this.e11=s,this.e12=r,this.e20=_,this.e21=e,this.e22=h,this},prependScale:function(t,i,a){return new U(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*a,this.e21*a,this.e22*a)},appendScale:function(t,i,a){return new U(this.e00*t,this.e01*i,this.e02*a,this.e10*t,this.e11*i,this.e12*a,this.e20*t,this.e21*i,this.e22*a)},prependRotation:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s;return new U(_*this.e00+e*this.e10+h*this.e20,_*this.e01+e*this.e11+h*this.e21,_*this.e02+e*this.e12+h*this.e22,l*this.e00+v*this.e10+c*this.e20,l*this.e01+v*this.e11+c*this.e21,l*this.e02+v*this.e12+c*this.e22,m*this.e00+b*this.e10+f*this.e20,m*this.e01+b*this.e11+f*this.e21,m*this.e02+b*this.e12+f*this.e22)},appendRotation:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s;return new U(this.e00*_+this.e01*l+this.e02*m,this.e00*e+this.e01*v+this.e02*b,this.e00*h+this.e01*c+this.e02*f,this.e10*_+this.e11*l+this.e12*m,this.e10*e+this.e11*v+this.e12*b,this.e10*h+this.e11*c+this.e12*f,this.e20*_+this.e21*l+this.e22*m,this.e20*e+this.e21*v+this.e22*b,this.e20*h+this.e21*c+this.e22*f)},prependScaleEq:function(t,i,a){var n=this.e00*t,o=this.e01*t,s=this.e02*t,r=this.e10*i,_=this.e11*i,e=this.e12*i,h=this.e20*a,l=this.e21*a,v=this.e22*a;return this.e00=n,this.e01=o,this.e02=s,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=v,this},appendScaleEq:function(t,i,a){var n=this.e00*t,o=this.e01*i,s=this.e02*a,r=this.e10*t,_=this.e11*i,e=this.e12*a,h=this.e20*t,l=this.e21*i,v=this.e22*a;return this.e00=n,this.e01=o,this.e02=s,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=v,this},prependRotationEq:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,p=_*this.e00+e*this.e10+h*this.e20,u=_*this.e01+e*this.e11+h*this.e21,x=_*this.e02+e*this.e12+h*this.e22,X=l*this.e00+v*this.e10+c*this.e20,M=l*this.e01+v*this.e11+c*this.e21,g=l*this.e02+v*this.e12+c*this.e22,Y=m*this.e00+b*this.e10+f*this.e20,Z=m*this.e01+b*this.e11+f*this.e21,I=m*this.e02+b*this.e12+f*this.e22;return this.e00=p,this.e01=u,this.e02=x,this.e10=X,this.e11=M,this.e12=g,this.e20=Y,this.e21=Z,this.e22=I,this},appendRotationEq:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,p=this.e00*_+this.e01*l+this.e02*m,u=this.e00*e+this.e01*v+this.e02*b,x=this.e00*h+this.e01*c+this.e02*f,X=this.e10*_+this.e11*l+this.e12*m,M=this.e10*e+this.e11*v+this.e12*b,g=this.e10*h+this.e11*c+this.e12*f,Y=this.e20*_+this.e21*l+this.e22*m,Z=this.e20*e+this.e21*v+this.e22*b,I=this.e20*h+this.e21*c+this.e22*f;return this.e00=p,this.e01=u,this.e02=x,this.e10=X,this.e11=M,this.e12=g,this.e20=Y,this.e21=Z,this.e22=I,this},transpose:function(){return new U(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},transposeEq:function(){var t=this.e00,i=this.e10,a=this.e20,n=this.e01,o=this.e11,s=this.e21,r=this.e02,_=this.e12,e=this.e22;return this.e00=t,this.e01=i,this.e02=a,this.e10=n,this.e11=o,this.e12=s,this.e20=r,this.e21=_,this.e22=e,this},determinant:function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},trace:function(){return this.e00+this.e11+this.e22},inverse:function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,n=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,_=this.e00*this.e12-this.e02*this.e10,e=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;return 0!=h&&(h=1/h),new U(t*h,-n*h,r*h,-i*h,o*h,-_*h,a*h,-s*h,e*h)},inverseEq:function(){var t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,a=this.e10*this.e21-this.e11*this.e20,n=this.e01*this.e22-this.e02*this.e21,o=this.e00*this.e22-this.e02*this.e20,s=this.e00*this.e21-this.e01*this.e20,r=this.e01*this.e12-this.e02*this.e11,_=this.e00*this.e12-this.e02*this.e10,e=this.e00*this.e11-this.e01*this.e10,h=this.e00*t-this.e01*i+this.e02*a;0!=h&&(h=1/h);var l=t*h,v=-n*h,c=r*h,m=-i*h,b=o*h,f=-_*h,p=a*h,u=-s*h,x=e*h;return this.e00=l,this.e01=v,this.e02=c,this.e10=m,this.e11=b,this.e12=f,this.e20=p,this.e21=u,this.e22=x,this},toArray:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]},copyFrom:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this},clone:function(){return new U(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},fromQuat:function(t){var i=t.x,a=t.y,n=t.z,o=t.w,s=2*i,r=2*a,_=2*n,e=i*s,h=a*r,l=n*_,v=i*r,c=a*_,m=i*_,b=o*s,f=o*r,p=o*_;return this.e00=1-h-l,this.e01=v-p,this.e02=m+f,this.e10=v+p,this.e11=1-e-l,this.e12=c-b,this.e20=m-f,this.e21=c+b,this.e22=1-e-h,this},toQuat:function(){var t,i=new K,a=this.e00,n=this.e11,o=this.e22,s=a+n+o;return s>0?(t=Math.sqrt(s+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):a>n?a>o?(t=Math.sqrt(a-n-o+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(o-a-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):n>o?(t=Math.sqrt(n-o-a+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(o-a-n+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i},fromEulerXyz:function(t){var i=Math.sin(t.x),a=Math.sin(t.y),n=Math.sin(t.z),o=Math.cos(t.x),s=Math.cos(t.y),r=Math.cos(t.z),_=s*r,e=-s*n,h=a,l=o*n+r*i*a,v=o*r-i*a*n,c=-s*i,m=i*n-o*r*a,b=r*i+o*a*n,f=o*s;return this.e00=_,this.e01=e,this.e02=h,this.e10=l,this.e11=v,this.e12=c,this.e20=m,this.e21=b,this.e22=f,this},toEulerXyz:function(){var t=this.e02;if(t<=-1){var i=Math.atan2(this.e21,this.e11);return new E(.5*i,-1.570796326794895,.5*-i)}if(t>=1){var a=Math.atan2(this.e21,this.e11);return new E(.5*a,1.570796326794895,.5*a)}var n=Math.asin(t),o=Math.atan2(-this.e12,this.e22),s=Math.atan2(-this.e01,this.e00);return new E(o,n,s)},getRow:function(t){return 0==t?new E(this.e00,this.e01,this.e02):1==t?new E(this.e10,this.e11,this.e12):2==t?new E(this.e20,this.e21,this.e22):null},getCol:function(t){return 0==t?new E(this.e00,this.e10,this.e20):1==t?new E(this.e01,this.e11,this.e21):2==t?new E(this.e02,this.e12,this.e22):null},getRowTo:function(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()},getColTo:function(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()},fromRows:function(t,i,a){var n=t.x,o=t.y,s=t.z,r=i.x,_=i.y,e=i.z,h=a.x,l=a.y,v=a.z;return this.e00=n,this.e01=o,this.e02=s,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=v,this},fromCols:function(t,i,a){var n=t.x,o=i.x,s=a.x,r=t.y,_=i.y,e=a.y,h=t.z,l=i.z,v=a.z;return this.e00=n,this.e01=o,this.e02=s,this.e10=r,this.e11=_,this.e12=e,this.e20=h,this.e21=l,this.e22=v,this},toString:function(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}};var J=function(t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f){null==f&&(f=1),null==b&&(b=0),null==m&&(m=0),null==c&&(c=0),null==v&&(v=0),null==l&&(l=1),null==h&&(h=0),null==e&&(e=0),null==_&&(_=0),null==r&&(r=0),null==s&&(s=1),null==o&&(o=0),null==n&&(n=0),null==a&&(a=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=r,this.e13=_,this.e20=e,this.e21=h,this.e22=l,this.e23=v,this.e30=c,this.e31=m,this.e32=b,this.e33=f,J.numCreations++};J.prototype={init:function(t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f){return this.e00=t,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=r,this.e13=_,this.e20=e,this.e21=h,this.e22=l,this.e23=v,this.e30=c,this.e31=m,this.e32=b,this.e33=f,this},identity:function(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},add:function(t){return new J(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)},sub:function(t){return new J(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)},scale:function(t){return new J(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)},mul:function(t){return new J(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)},addEq:function(t){var i=this.e00+t.e00,a=this.e01+t.e01,n=this.e02+t.e02,o=this.e03+t.e03,s=this.e10+t.e10,r=this.e11+t.e11,_=this.e12+t.e12,e=this.e13+t.e13,h=this.e20+t.e20,l=this.e21+t.e21,v=this.e22+t.e22,c=this.e23+t.e23,m=this.e30+t.e30,b=this.e31+t.e31,f=this.e32+t.e32,p=this.e33+t.e33;return this.e00=i,this.e01=a,this.e02=n,this.e03=o,this.e10=s,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=v,this.e23=c,this.e30=m,this.e31=b,this.e32=f,this.e33=p,this},subEq:function(t){var i=this.e00-t.e00,a=this.e01-t.e01,n=this.e02-t.e02,o=this.e03-t.e03,s=this.e10-t.e10,r=this.e11-t.e11,_=this.e12-t.e12,e=this.e13-t.e13,h=this.e20-t.e20,l=this.e21-t.e21,v=this.e22-t.e22,c=this.e23-t.e23,m=this.e30-t.e30,b=this.e31-t.e31,f=this.e32-t.e32,p=this.e33-t.e33;return this.e00=i,this.e01=a,this.e02=n,this.e03=o,this.e10=s,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=v,this.e23=c,this.e30=m,this.e31=b,this.e32=f,this.e33=p,this},scaleEq:function(t){var i=this.e00*t,a=this.e01*t,n=this.e02*t,o=this.e03*t,s=this.e10*t,r=this.e11*t,_=this.e12*t,e=this.e13*t,h=this.e20*t,l=this.e21*t,v=this.e22*t,c=this.e23*t,m=this.e30*t,b=this.e31*t,f=this.e32*t,p=this.e33*t;return this.e00=i,this.e01=a,this.e02=n,this.e03=o,this.e10=s,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=v,this.e23=c,this.e30=m,this.e31=b,this.e32=f,this.e33=p,this},mulEq:function(t){var i=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,a=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,n=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,o=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,r=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,_=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,e=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,h=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,v=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,f=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=i,this.e01=a,this.e02=n,this.e03=o,this.e10=s,this.e11=r,this.e12=_,this.e13=e,this.e20=h,this.e21=l,this.e22=v,this.e23=c,this.e30=m,this.e31=b,this.e32=f,this.e33=p,this},prependScale:function(t,i,a){return new J(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*a,this.e21*a,this.e22*a,this.e23*a,this.e30,this.e31,this.e32,this.e33)},appendScale:function(t,i,a){return new J(this.e00*t,this.e01*i,this.e02*a,this.e03,this.e10*t,this.e11*i,this.e12*a,this.e13,this.e20*t,this.e21*i,this.e22*a,this.e23,this.e30*t,this.e31*i,this.e32*a,this.e33)},prependRotation:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s;return new J(_*this.e00+e*this.e10+h*this.e20,_*this.e01+e*this.e11+h*this.e21,_*this.e02+e*this.e12+h*this.e22,_*this.e03+e*this.e13+h*this.e23,l*this.e00+v*this.e10+c*this.e20,l*this.e01+v*this.e11+c*this.e21,l*this.e02+v*this.e12+c*this.e22,l*this.e03+v*this.e13+c*this.e23,m*this.e00+b*this.e10+f*this.e20,m*this.e01+b*this.e11+f*this.e21,m*this.e02+b*this.e12+f*this.e22,m*this.e03+b*this.e13+f*this.e23,this.e30,this.e31,this.e32,this.e33)},appendRotation:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s;return new J(this.e00*_+this.e01*l+this.e02*m,this.e00*e+this.e01*v+this.e02*b,this.e00*h+this.e01*c+this.e02*f,this.e03,this.e10*_+this.e11*l+this.e12*m,this.e10*e+this.e11*v+this.e12*b,this.e10*h+this.e11*c+this.e12*f,this.e13,this.e20*_+this.e21*l+this.e22*m,this.e20*e+this.e21*v+this.e22*b,this.e20*h+this.e21*c+this.e22*f,this.e23,this.e30*_+this.e31*l+this.e32*m,this.e30*e+this.e31*v+this.e32*b,this.e30*h+this.e31*c+this.e32*f,this.e33)},prependTranslation:function(t,i,a){return new J(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+a*this.e30,this.e21+a*this.e31,this.e22+a*this.e32,this.e23+a*this.e33,this.e30,this.e31,this.e32,this.e33)},appendTranslation:function(t,i,a){return new J(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*a+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*a+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*a+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*a+this.e33)},prependScaleEq:function(t,i,a){var n=this.e00*t,o=this.e01*t,s=this.e02*t,r=this.e03*t,_=this.e10*i,e=this.e11*i,h=this.e12*i,l=this.e13*i,v=this.e20*a,c=this.e21*a,m=this.e22*a,b=this.e23*a,f=this.e30,p=this.e31,u=this.e32,x=this.e33;return this.e00=n,this.e01=o,this.e02=s,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=v,this.e21=c,this.e22=m,this.e23=b,this.e30=f,this.e31=p,this.e32=u,this.e33=x,this},appendScaleEq:function(t,i,a){var n=this.e00*t,o=this.e01*i,s=this.e02*a,r=this.e03,_=this.e10*t,e=this.e11*i,h=this.e12*a,l=this.e13,v=this.e20*t,c=this.e21*i,m=this.e22*a,b=this.e23,f=this.e30*t,p=this.e31*i,u=this.e32*a,x=this.e33;return this.e00=n,this.e01=o,this.e02=s,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=v,this.e21=c,this.e22=m,this.e23=b,this.e30=f,this.e31=p,this.e32=u,this.e33=x,this},prependRotationEq:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,p=_*this.e00+e*this.e10+h*this.e20,u=_*this.e01+e*this.e11+h*this.e21,x=_*this.e02+e*this.e12+h*this.e22,X=_*this.e03+e*this.e13+h*this.e23,M=l*this.e00+v*this.e10+c*this.e20,g=l*this.e01+v*this.e11+c*this.e21,Y=l*this.e02+v*this.e12+c*this.e22,Z=l*this.e03+v*this.e13+c*this.e23,I=m*this.e00+b*this.e10+f*this.e20,y=m*this.e01+b*this.e11+f*this.e21,d=m*this.e02+b*this.e12+f*this.e22,L=m*this.e03+b*this.e13+f*this.e23,z=this.e30,w=this.e31,B=this.e32,A=this.e33;return this.e00=p,this.e01=u,this.e02=x,this.e03=X,this.e10=M,this.e11=g,this.e12=Y,this.e13=Z,this.e20=I,this.e21=y,this.e22=d,this.e23=L,this.e30=z,this.e31=w,this.e32=B,this.e33=A,this},appendRotationEq:function(t,i,a,n){var o=Math.sin(t),s=Math.cos(t),r=1-s,_=i*i*r+s,e=i*a*r-n*o,h=i*n*r+a*o,l=a*i*r+n*o,v=a*a*r+s,c=a*n*r-i*o,m=n*i*r-a*o,b=n*a*r+i*o,f=n*n*r+s,p=this.e00*_+this.e01*l+this.e02*m,u=this.e00*e+this.e01*v+this.e02*b,x=this.e00*h+this.e01*c+this.e02*f,X=this.e03,M=this.e10*_+this.e11*l+this.e12*m,g=this.e10*e+this.e11*v+this.e12*b,Y=this.e10*h+this.e11*c+this.e12*f,Z=this.e13,I=this.e20*_+this.e21*l+this.e22*m,y=this.e20*e+this.e21*v+this.e22*b,d=this.e20*h+this.e21*c+this.e22*f,L=this.e23,z=this.e30*_+this.e31*l+this.e32*m,w=this.e30*e+this.e31*v+this.e32*b,B=this.e30*h+this.e31*c+this.e32*f,A=this.e33;return this.e00=p,this.e01=u,this.e02=x,this.e03=X,this.e10=M,this.e11=g,this.e12=Y,this.e13=Z,this.e20=I,this.e21=y,this.e22=d,this.e23=L,this.e30=z,this.e31=w,this.e32=B,this.e33=A,this},prependTranslationEq:function(t,i,a){var n=this.e00+t*this.e30,o=this.e01+t*this.e31,s=this.e02+t*this.e32,r=this.e03+t*this.e33,_=this.e10+i*this.e30,e=this.e11+i*this.e31,h=this.e12+i*this.e32,l=this.e13+i*this.e33,v=this.e20+a*this.e30,c=this.e21+a*this.e31,m=this.e22+a*this.e32,b=this.e23+a*this.e33,f=this.e30,p=this.e31,u=this.e32,x=this.e33;return this.e00=n,this.e01=o,this.e02=s,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=v,this.e21=c,this.e22=m,this.e23=b,this.e30=f,this.e31=p,this.e32=u,this.e33=x,this},appendTranslationEq:function(t,i,a){var n=this.e00,o=this.e01,s=this.e02,r=this.e00*t+this.e01*i+this.e02*a+this.e03,_=this.e10,e=this.e11,h=this.e12,l=this.e10*t+this.e11*i+this.e12*a+this.e13,v=this.e20,c=this.e21,m=this.e22,b=this.e20*t+this.e21*i+this.e22*a+this.e23,f=this.e30,p=this.e31,u=this.e32,x=this.e30*t+this.e31*i+this.e32*a+this.e33;return this.e00=n,this.e01=o,this.e02=s,this.e03=r,this.e10=_,this.e11=e,this.e12=h,this.e13=l,this.e20=v,this.e21=c,this.e22=m,this.e23=b,this.e30=f,this.e31=p,this.e32=u,this.e33=x,this},transpose:function(){return new J(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},transposeEq:function(){var t=this.e00,i=this.e10,a=this.e20,n=this.e30,o=this.e01,s=this.e11,r=this.e21,_=this.e31,e=this.e02,h=this.e12,l=this.e22,v=this.e32,c=this.e03,m=this.e13,b=this.e23,f=this.e33;return this.e00=t,this.e01=i,this.e02=a,this.e03=n,this.e10=o,this.e11=s,this.e12=r,this.e13=_,this.e20=e,this.e21=h,this.e22=l,this.e23=v,this.e30=c,this.e31=m,this.e32=b,this.e33=f,this},determinant:function(){var t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,n=this.e21*this.e32-this.e22*this.e31,o=this.e21*this.e33-this.e23*this.e31,s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*o+this.e13*n)-this.e01*(this.e10*s-this.e12*a+this.e13*i)+this.e02*(this.e10*o-this.e11*a+this.e13*t)-this.e03*(this.e10*n-this.e11*i+this.e12*t)},trace:function(){return this.e00+this.e11+this.e22+this.e33},inverse:function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,v=this.e22*this.e33-this.e23*this.e32,c=this.e11*v-this.e12*l+this.e13*h,m=this.e10*v-this.e12*e+this.e13*_,b=this.e10*l-this.e11*e+this.e13*r,f=this.e10*h-this.e11*_+this.e12*r,p=this.e01*v-this.e02*l+this.e03*h,u=this.e00*v-this.e02*e+this.e03*_,x=this.e00*l-this.e01*e+this.e03*r,X=this.e00*h-this.e01*_+this.e02*r,M=this.e31*s-this.e32*o+this.e33*n,g=this.e30*s-this.e32*a+this.e33*i,Y=this.e30*o-this.e31*a+this.e33*t,Z=this.e30*n-this.e31*i+this.e32*t,I=this.e21*s-this.e22*o+this.e23*n,y=this.e20*s-this.e22*a+this.e23*i,d=this.e20*o-this.e21*a+this.e23*t,L=this.e20*n-this.e21*i+this.e22*t,z=this.e00*c-this.e01*m+this.e02*b-this.e03*f;return 0!=z&&(z=1/z),new J(c*z,-p*z,M*z,-I*z,-m*z,u*z,-g*z,y*z,b*z,-x*z,Y*z,-d*z,-f*z,X*z,-Z*z,L*z)},inverseEq:function(){var t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,a=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,o=this.e01*this.e13-this.e03*this.e11,s=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,h=this.e21*this.e32-this.e22*this.e31,l=this.e21*this.e33-this.e23*this.e31,v=this.e22*this.e33-this.e23*this.e32,c=this.e11*v-this.e12*l+this.e13*h,m=this.e10*v-this.e12*e+this.e13*_,b=this.e10*l-this.e11*e+this.e13*r,f=this.e10*h-this.e11*_+this.e12*r,p=this.e01*v-this.e02*l+this.e03*h,u=this.e00*v-this.e02*e+this.e03*_,x=this.e00*l-this.e01*e+this.e03*r,X=this.e00*h-this.e01*_+this.e02*r,M=this.e31*s-this.e32*o+this.e33*n,g=this.e30*s-this.e32*a+this.e33*i,Y=this.e30*o-this.e31*a+this.e33*t,Z=this.e30*n-this.e31*i+this.e32*t,I=this.e21*s-this.e22*o+this.e23*n,y=this.e20*s-this.e22*a+this.e23*i,d=this.e20*o-this.e21*a+this.e23*t,L=this.e20*n-this.e21*i+this.e22*t,z=this.e00*c-this.e01*m+this.e02*b-this.e03*f;0!=z&&(z=1/z);var w=c*z,B=-p*z,A=M*z,P=-I*z,T=-m*z,S=u*z,V=-g*z,k=y*z,C=b*z,q=-x*z,R=Y*z,j=-d*z,O=-f*z,E=X*z,F=-Z*z,D=L*z;return this.e00=w,this.e01=B,this.e02=A,this.e03=P,this.e10=T,this.e11=S,this.e12=V,this.e13=k,this.e20=C,this.e21=q,this.e22=R,this.e23=j,this.e30=O,this.e31=E,this.e32=F,this.e33=D,this},lookAt:function(t,i,a,n,o,s,r,_,e){var h=t-n,l=i-o,v=a-s,c=1/Math.sqrt(h*h+l*l+v*v),m=_*(v*=c)-e*(l*=c),b=e*(h*=c)-r*v,f=r*l-_*h,p=l*(f*=c=1/Math.sqrt(m*m+b*b+f*f))-v*(b*=c),u=v*(m*=c)-h*f,x=h*b-l*m;return this.e00=m,this.e01=b,this.e02=f,this.e03=-(m*t+b*i+f*a),this.e10=p,this.e11=u,this.e12=x,this.e13=-(p*t+u*i+x*a),this.e20=h,this.e21=l,this.e22=v,this.e23=-(h*t+l*i+v*a),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},perspective:function(t,i,a,n){var o=1/Math.tan(.5*t),s=n/(a-n);return this.e00=o/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=o,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=a*s,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this},ortho:function(t,i,a,n){var o=1/(a-n);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=a*o,this.e30=0,this.e31=0,this.e32=0,this.e33=0,this},toArray:function(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]},copyFrom:function(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this},fromMat3:function(t){var i=t.e00,a=t.e01,n=t.e02,o=t.e10,s=t.e11,r=t.e12,_=t.e20,e=t.e21,h=t.e22;return this.e00=i,this.e01=a,this.e02=n,this.e03=0,this.e10=o,this.e11=s,this.e12=r,this.e13=0,this.e20=_,this.e21=e,this.e22=h,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this},fromTransform:function(t){var i=this;return i.e00=t._rotation00,i.e01=t._rotation01,i.e02=t._rotation02,i.e10=t._rotation10,i.e11=t._rotation11,i.e12=t._rotation12,i.e20=t._rotation20,i.e21=t._rotation21,i.e22=t._rotation22,i.e03=t._positionX,i.e13=t._positionY,i.e23=t._positionZ,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this},clone:function(){return new J(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}};var H={POSITIVE_INFINITY:1/0,NEGATIVE_INFINITY:-1/0,PI:3.14159265358979,TWO_PI:6.28318530717958,HALF_PI:1.570796326794895,TO_RADIANS:.017453292519943278,TO_DEGREES:57.29577951308238,abs:function(t){return t>0?t:-t},sin:function(t){return Math.sin(t)},cos:function(t){return Math.cos(t)},tan:function(t){return Math.tan(t)},asin:function(t){return Math.asin(t)},acos:function(t){return Math.acos(t)},atan:function(t){return Math.atan(t)},safeAsin:function(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)},safeAcos:function(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)},atan2:function(t,i){return Math.atan2(t,i)},sqrt:function(t){return Math.sqrt(t)},clamp:function(t,i,a){return t<i?i:t>a?a:t},rand:function(){return Math.random()},randIn:function(t,i){return t+Math.random()*(i-t)},randVec3In:function(t,i){return new E(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))},randVec3:function(){return new E(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},Q=function(){var t=new Array(256);this.stackVec3=t,this.sizeVec3=0;var i=new Array(256);this.stackMat3=i,this.sizeMat3=0;var a=new Array(256);this.stackMat4=a,this.sizeMat4=0;var n=new Array(256);this.stackQuat=n,this.sizeQuat=0};Q.prototype={vec3:function(){return 0==this.sizeVec3?new E:this.stackVec3[--this.sizeVec3]},mat3:function(){return 0==this.sizeMat3?new U:this.stackMat3[--this.sizeMat3]},mat4:function(){return 0==this.sizeMat4?new J:this.stackMat4[--this.sizeMat4]},quat:function(){return 0==this.sizeQuat?new K:this.stackQuat[--this.sizeQuat]},dispose:function(t,i,a,n){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var o=this.sizeVec3<<1,s=new Array(o),r=0,_=this.sizeVec3;r<_;){var e=r++;s[e]=this.stackVec3[e],this.stackVec3[e]=null}this.stackVec3=s}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){for(var h=this.sizeMat3<<1,l=new Array(h),v=0,c=this.sizeMat3;v<c;){var m=v++;l[m]=this.stackMat3[m],this.stackMat3[m]=null}this.stackMat3=l}this.stackMat3[this.sizeMat3++]=i}if(null!=a){if(a.e00=1,a.e01=0,a.e02=0,a.e03=0,a.e10=0,a.e11=1,a.e12=0,a.e13=0,a.e20=0,a.e21=0,a.e22=1,a.e23=0,a.e30=0,a.e31=0,a.e32=0,a.e33=1,this.sizeMat4==this.stackMat4.length){for(var b=this.sizeMat4<<1,f=new Array(b),p=0,u=this.sizeMat4;p<u;){var x=p++;f[x]=this.stackMat4[x],this.stackMat4[x]=null}this.stackMat4=f}this.stackMat4[this.sizeMat4++]=a}if(null!=n){if(n.x=0,n.y=0,n.z=0,n.w=1,this.sizeQuat==this.stackQuat.length){for(var X=this.sizeQuat<<1,M=new Array(X),g=0,Y=this.sizeQuat;g<Y;){var Z=g++;M[Z]=this.stackQuat[Z],this.stackQuat[Z]=null}this.stackQuat=M}this.stackQuat[this.sizeQuat++]=n}},disposeVec3:function(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){for(var i=this.sizeVec3<<1,a=new Array(i),n=0,o=this.sizeVec3;n<o;){var s=n++;a[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=a}this.stackVec3[this.sizeVec3++]=t},disposeMat3:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){for(var i=this.sizeMat3<<1,a=new Array(i),n=0,o=this.sizeMat3;n<o;){var s=n++;a[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=a}this.stackMat3[this.sizeMat3++]=t},disposeMat4:function(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){for(var i=this.sizeMat4<<1,a=new Array(i),n=0,o=this.sizeMat4;n<o;){var s=n++;a[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=a}this.stackMat4[this.sizeMat4++]=t},disposeQuat:function(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){for(var i=this.sizeQuat<<1,a=new Array(i),n=0,o=this.sizeQuat;n<o;){var s=n++;a[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=a}this.stackQuat[this.sizeQuat++]=t}};var K=function(t,i,a,n){null==n&&(n=1),null==a&&(a=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=a,this.w=n,K.numCreations++};K.prototype={identity:function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},init:function(t,i,a,n){return this.x=t,this.y=i,this.z=a,this.w=n,this},add:function(t){return new K(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},sub:function(t){return new K(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},scale:function(t){return new K(this.x*t,this.y*t,this.z*t,this.w*t)},addEq:function(t){var i=this.x+t.x,a=this.y+t.y,n=this.z+t.z,o=this.w+t.w;return this.x=i,this.y=a,this.z=n,this.w=o,this},subEq:function(t){var i=this.x-t.x,a=this.y-t.y,n=this.z-t.z,o=this.w-t.w;return this.x=i,this.y=a,this.z=n,this.w=o,this},scaleEq:function(t){var i=this.x*t,a=this.y*t,n=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=n,this.w=o,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new K(this.x*t,this.y*t,this.z*t,this.w*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);t>0&&(t=1/t);var i=this.x*t,a=this.y*t,n=this.z*t,o=this.w*t;return this.x=i,this.y=a,this.z=n,this.w=o,this},setArc:function(t,i){var a=t.x,n=t.y,o=t.z,s=i.x,r=i.y,_=i.z,e=a*s+n*r+o*_;if(this.w=Math.sqrt(.5*(1+e)),0==this.w)return _=o*o,(s=a*a)<(r=n*n)?s<_?(e=1/Math.sqrt(r+_),this.x=0,this.y=o*e,this.z=-n*e):(e=1/Math.sqrt(s+r),this.z=0,this.x=n*e,this.y=-a*e):r<_?(e=1/Math.sqrt(_+s),this.y=0,this.z=a*e,this.x=-o*e):(e=1/Math.sqrt(s+r),this.z=0,this.x=n*e,this.y=-a*e),this;e=.5/this.w;var h=n*_-o*r,l=o*s-a*_,v=a*r-n*s;return this.x=h*e,this.y=l*e,this.z=v*e,this},slerp:function(t,i){var a,n,o,s,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,a=-t.x,n=-t.y,o=-t.z,s=-t.w):(a=t.x,n=t.y,o=t.z,s=t.w),r>.999999){var _=new K(this.x+(a-this.x)*i,this.y+(n-this.y)*i,this.z+(o-this.z)*i,this.w+(s-this.w)*i),e=Math.sqrt(_.x*_.x+_.y*_.y+_.z*_.z+_.w*_.w);e>0&&(e=1/e);var h=_.x*e,l=_.y*e,v=_.z*e,c=_.w*e;return _.x=h,_.y=l,_.z=v,_.w=c,_}var m=i*Math.acos(r);a-=this.x*r,n-=this.y*r,o-=this.z*r,s-=this.w*r;var b=1/Math.sqrt(a*a+n*n+o*o+s*s);a*=b,n*=b,o*=b,s*=b;var f=Math.sin(m),p=Math.cos(m);return new K(this.x*p+a*f,this.y*p+n*f,this.z*p+o*f,this.w*p+s*f)},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(){return new K(this.x,this.y,this.z,this.w)},fromMat3:function(t){var i,a=t.e00,n=t.e11,o=t.e22,s=a+n+o;return s>0?(i=Math.sqrt(s+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):a>n?a>o?(i=Math.sqrt(a-n-o+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(o-a-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):n>o?(i=Math.sqrt(n-o-a+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(o-a-n+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this},toMat3:function(){var t=new U,i=this.x,a=this.y,n=this.z,o=this.w,s=2*i,r=2*a,_=2*n,e=i*s,h=a*r,l=n*_,v=i*r,c=a*_,m=i*_,b=o*s,f=o*r,p=o*_;return t.e00=1-h-l,t.e01=v-p,t.e02=m+f,t.e10=v+p,t.e11=1-e-l,t.e12=c-b,t.e20=m-f,t.e21=c+b,t.e22=1-e-h,t},toString:function(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}};var $=function(){this._next=null,this._prev=null,this._link1=new tt,this._link2=new tt,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new P,this._detectorResult=new d,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new ut,this._updater=new Xt(this._manifold),this._contactConstraint=new ft(this._manifold),this._touching=!1};$.prototype={_updateManifold:function(){if(null!=this._detector){var t=this._touching,i=this._detectorResult;this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var a=i.numPoints;if(this._touching=a>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>D.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=D.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=D.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){var n=this._s1._contactCallback,o=this._s2._contactCallback;n==o&&(o=null),null!=n&&n.beginContact(this),null!=o&&o.beginContact(this)}if(!this._touching&&t){var s=this._s1._contactCallback,r=this._s2._contactCallback;s==r&&(r=null),null!=s&&s.endContact(this),null!=r&&r.endContact(this)}if(this._touching){var _=this._s1._contactCallback,e=this._s2._contactCallback;_==e&&(e=null),null!=_&&_.preSolve(this),null!=e&&e.preSolve(this)}}},_postSolve:function(){var t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},isTouching:function(){return this._touching},getManifold:function(){return this._manifold},getContactConstraint:function(){return this._contactConstraint},getPrev:function(){return this._prev},getNext:function(){return this._next}};var tt=function(){this._prev=null,this._next=null,this._contact=null,this._other=null};tt.prototype={getContact:function(){return this._contact},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var it=function(t){this._broadPhase=t,this._collisionMatrix=new y,this._numContacts=0};it.prototype={createContacts:function(){for(var t=this._broadPhase._proxyPairList;null!=t;){for(var i=t._next;;){var a,n;if(t._p1._id<t._p2._id?(a=t._p1.userData,n=t._p2.userData):(a=t._p2.userData,n=t._p1.userData),!this.shouldCollide(a,n))break;var o,s=a._rigidBody,r=n._rigidBody;o=s._numContactLinks<r._numContactLinks?s._contactLinkList:r._contactLinkList;for(var _=a._id,e=n._id,h=!1;null!=o;){var l=o._next,v=o._contact;if(v._s1._id==_&&v._s2._id==e){v._latest=!0,h=!0;break}o=l}if(!h){var c=this._contactPool;null!=c?(this._contactPool=c._next,c._next=null):c=new $;var m=c;null==this._contactList?(this._contactList=m,this._contactListLast=m):(this._contactListLast._next=m,m._prev=this._contactListLast,this._contactListLast=m),m._latest=!0;var b=this._collisionMatrix.detectors[a._geom._type][n._geom._type];m._s1=a,m._s2=n,m._b1=a._rigidBody,m._b2=n._rigidBody,m._touching=!1,null==m._b1._contactLinkList?(m._b1._contactLinkList=m._link1,m._b1._contactLinkListLast=m._link1):(m._b1._contactLinkListLast._next=m._link1,m._link1._prev=m._b1._contactLinkListLast,m._b1._contactLinkListLast=m._link1),null==m._b2._contactLinkList?(m._b2._contactLinkList=m._link2,m._b2._contactLinkListLast=m._link2):(m._b2._contactLinkListLast._next=m._link2,m._link2._prev=m._b2._contactLinkListLast,m._b2._contactLinkListLast=m._link2),m._b1._numContactLinks++,m._b2._numContactLinks++,m._link1._other=m._b2,m._link2._other=m._b1,m._link1._contact=m,m._link2._contact=m,m._detector=b;var f=m._contactConstraint;f._s1=a,f._s2=n,f._b1=f._s1._rigidBody,f._b2=f._s2._rigidBody,f._tf1=f._b1._transform,f._tf2=f._b2._transform,this._numContacts++}break}t=i}},destroyOutdatedContacts:function(){for(var t=this._broadPhase._incremental,i=this._contactList;null!=i;){for(var a=i._next;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){var n=i._prev,o=i._next;if(null!=n&&(n._next=o),null!=o&&(o._prev=n),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var s=i._s1._contactCallback,r=i._s2._contactCallback;s==r&&(r=null),null!=s&&s.endContact(i),null!=r&&r.endContact(i)}var _=i._link1._prev,e=i._link1._next;null!=_&&(_._next=e),null!=e&&(e._prev=_),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var h=i._link2._prev,l=i._link2._next;null!=h&&(h._next=l),null!=l&&(l._prev=h),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var v=i._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var c=i._s1,m=i._s2,b=c._rigidBody,f=m._rigidBody,p=!b._sleeping&&1!=b._type,u=!f._sleeping&&1!=f._type;if(!p&&!u){i._shouldBeSkipped=!0;break}var x=c._aabb,X=m._aabb,M=c._proxy,g=m._proxy;if(!(M._aabbMinX<g._aabbMaxX&&M._aabbMaxX>g._aabbMinX&&M._aabbMinY<g._aabbMaxY&&M._aabbMaxY>g._aabbMinY&&M._aabbMinZ<g._aabbMaxZ&&M._aabbMaxZ>g._aabbMinZ)){var Y=i._prev,Z=i._next;if(null!=Y&&(Y._next=Z),null!=Z&&(Z._prev=Y),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){var I=i._s1._contactCallback,y=i._s2._contactCallback;I==y&&(y=null),null!=I&&I.endContact(i),null!=y&&y.endContact(i)}var d=i._link1._prev,L=i._link1._next;null!=d&&(d._next=L),null!=L&&(L._prev=d),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;var z=i._link2._prev,w=i._link2._next;null!=z&&(z._next=w),null!=w&&(w._prev=z),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;var B=i._contactConstraint;B._s1=null,B._s2=null,B._b1=null,B._b2=null,B._tf1=null,B._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}var A=x._minX<X._maxX&&x._maxX>X._minX&&x._minY<X._maxY&&x._maxY>X._minY&&x._minZ<X._maxZ&&x._maxZ>X._minZ;i._shouldBeSkipped=!A;break}i=a}},shouldCollide:function(t,i){var a,n,o=t._rigidBody,s=i._rigidBody;if(o==s)return!1;if(0!=o._type&&0!=s._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(o._numJointLinks<s._numJointLinks?(a=o._jointLinkList,n=s):(a=s._jointLinkList,n=o);null!=a;){var r=a._next;if(a._other==n&&!a._joint._allowCollision)return!1;a=r}return!0},_updateContacts:function(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()},_postSolve:function(){for(var t=this._contactList;null!=t;){var i=t._next;t._touching&&t._postSolve(),t=i}},getNumContacts:function(){return this._numContacts},getContactList:function(){return this._contactList}};var at=function(){var t=D.islandInitialRigidBodyArraySize,i=new Array(t);this.rigidBodies=i;var a=D.islandInitialConstraintArraySize,n=new Array(a);this.solvers=n;var o=D.islandInitialConstraintArraySize,s=new Array(o);this.solversSi=s;var r=D.islandInitialConstraintArraySize,_=new Array(r);this.solversNgs=_,this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0};at.prototype={_clear:function(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null},_addRigidBody:function(t){if(this.numRigidBodies==this.rigidBodies.length){for(var i=this.numRigidBodies<<1,a=new Array(i),n=0,o=this.numRigidBodies;n<o;){var s=n++;a[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=a}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t},_addConstraintSolver:function(t,i){if(this.numSolvers==this.solvers.length){for(var a=this.numSolvers<<1,n=new Array(a),o=0,s=this.numSolvers;o<s;){var r=o++;n[r]=this.solvers[r],this.solvers[r]=null}this.solvers=n}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==bt.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){for(var _=this.numSolversSi<<1,e=new Array(_),h=0,l=this.numSolversSi;h<l;){var v=h++;e[v]=this.solversSi[v],this.solversSi[v]=null}this.solversSi=e}this.solversSi[this.numSolversSi++]=t}if(i==bt.NGS){if(this.numSolversNgs==this.solversNgs.length){for(var c=this.numSolversNgs<<1,m=new Array(c),b=0,f=this.numSolversNgs;b<f;){var p=b++;m[p]=this.solversNgs[p],this.solversNgs[p]=null}this.solversNgs=m}this.solversNgs[this.numSolversNgs++]=t}},_stepSingleRigidBody:function(t,i){var a=t.dt,n=i._ptransform,o=i._transform;if(n._positionX=o._positionX,n._positionY=o._positionY,n._positionZ=o._positionZ,n._rotation00=o._rotation00,n._rotation01=o._rotation01,n._rotation02=o._rotation02,n._rotation10=o._rotation10,n._rotation11=o._rotation11,n._rotation12=o._rotation12,n._rotation20=o._rotation20,n._rotation21=o._rotation21,n._rotation22=o._rotation22,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<D.sleepingVelocityThreshold*D.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<D.sleepingAngularVelocityThreshold*D.sleepingAngularVelocityThreshold?(i._sleepTime+=a,i._sleepTime>D.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){var s,r,_,e,h,l,v=a*i._linearDamping,c=v*v,m=1/(1+v+c*(.5+.16666666666666666*v+.041666666666666664*c)),b=a*i._angularDamping,f=b*b,p=1/(1+b+f*(.5+.16666666666666666*b+.041666666666666664*f));s=this.gravityX*i._gravityScale,r=this.gravityY*i._gravityScale,_=this.gravityZ*i._gravityScale,s+=i._forceX*i._invMass,r+=i._forceY*i._invMass,_+=i._forceZ*i._invMass,e=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,h=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,l=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,i._velX+=s*a,i._velY+=r*a,i._velZ+=_*a,i._velX*=m,i._velY*=m,i._velZ*=m,i._angVelX+=e*a,i._angVelY+=h*a,i._angVelZ+=l*a,i._angVelX*=p,i._angVelY*=p,i._angVelZ*=p}i._integrate(a);for(var u=i._shapeList;null!=u;){var x,X,M,g,Y,Z,I,y,d,L,z,w,B=u._next,A=u._ptransform,P=u._localTransform,T=i._ptransform;x=T._rotation00*P._rotation00+T._rotation01*P._rotation10+T._rotation02*P._rotation20,X=T._rotation00*P._rotation01+T._rotation01*P._rotation11+T._rotation02*P._rotation21,M=T._rotation00*P._rotation02+T._rotation01*P._rotation12+T._rotation02*P._rotation22,g=T._rotation10*P._rotation00+T._rotation11*P._rotation10+T._rotation12*P._rotation20,Y=T._rotation10*P._rotation01+T._rotation11*P._rotation11+T._rotation12*P._rotation21,Z=T._rotation10*P._rotation02+T._rotation11*P._rotation12+T._rotation12*P._rotation22,I=T._rotation20*P._rotation00+T._rotation21*P._rotation10+T._rotation22*P._rotation20,y=T._rotation20*P._rotation01+T._rotation21*P._rotation11+T._rotation22*P._rotation21,d=T._rotation20*P._rotation02+T._rotation21*P._rotation12+T._rotation22*P._rotation22,A._rotation00=x,A._rotation01=X,A._rotation02=M,A._rotation10=g,A._rotation11=Y,A._rotation12=Z,A._rotation20=I,A._rotation21=y,A._rotation22=d,L=T._rotation00*P._positionX+T._rotation01*P._positionY+T._rotation02*P._positionZ,z=T._rotation10*P._positionX+T._rotation11*P._positionY+T._rotation12*P._positionZ,w=T._rotation20*P._positionX+T._rotation21*P._positionY+T._rotation22*P._positionZ,A._positionX=L,A._positionY=z,A._positionZ=w,A._positionX+=T._positionX,A._positionY+=T._positionY,A._positionZ+=T._positionZ;var S,V,k,C,q,R,j,O,E,F,N,W,G,U,J,H,Q,K,$=u._transform,tt=u._localTransform,it=i._transform;if(S=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,V=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,k=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,C=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,q=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,R=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,j=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,O=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,E=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,$._rotation00=S,$._rotation01=V,$._rotation02=k,$._rotation10=C,$._rotation11=q,$._rotation12=R,$._rotation20=j,$._rotation21=O,$._rotation22=E,F=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,N=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,W=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,$._positionX=F,$._positionY=N,$._positionZ=W,$._positionX+=it._positionX,$._positionY+=it._positionY,$._positionZ+=it._positionZ,u._geom._computeAabb(u._aabb,u._ptransform),G=u._aabb._minX,U=u._aabb._minY,J=u._aabb._minZ,H=u._aabb._maxX,Q=u._aabb._maxY,K=u._aabb._maxZ,u._geom._computeAabb(u._aabb,u._transform),u._aabb._minX=G<u._aabb._minX?G:u._aabb._minX,u._aabb._minY=U<u._aabb._minY?U:u._aabb._minY,u._aabb._minZ=J<u._aabb._minZ?J:u._aabb._minZ,u._aabb._maxX=H>u._aabb._maxX?H:u._aabb._maxX,u._aabb._maxY=Q>u._aabb._maxY?Q:u._aabb._maxY,u._aabb._maxZ=K>u._aabb._maxZ?K:u._aabb._maxZ,null!=u._proxy){var at,nt,ot;at=u._transform._positionX-u._ptransform._positionX,nt=u._transform._positionY-u._ptransform._positionY,ot=u._transform._positionZ-u._ptransform._positionZ;var st=u.displacement;st.x=at,st.y=nt,st.z=ot,u._rigidBody._world._broadPhase.moveProxy(u._proxy,u._aabb,u.displacement)}u=B}}},_step:function(t,i,a){for(var n=t.dt,o=!0,s=0,r=this.numRigidBodies;s<r;){var _=s++,e=this.rigidBodies[_],h=e._ptransform,l=e._transform;if(h._positionX=l._positionX,h._positionY=l._positionY,h._positionZ=l._positionZ,h._rotation00=l._rotation00,h._rotation01=l._rotation01,h._rotation02=l._rotation02,h._rotation10=l._rotation10,h._rotation11=l._rotation11,h._rotation12=l._rotation12,h._rotation20=l._rotation20,h._rotation21=l._rotation21,h._rotation22=l._rotation22,e._sleeping=!1,e._autoSleep&&e._velX*e._velX+e._velY*e._velY+e._velZ*e._velZ<D.sleepingVelocityThreshold*D.sleepingVelocityThreshold&&e._angVelX*e._angVelX+e._angVelY*e._angVelY+e._angVelZ*e._angVelZ<D.sleepingAngularVelocityThreshold*D.sleepingAngularVelocityThreshold?e._sleepTime+=n:e._sleepTime=0,e._sleepTime<D.sleepingTimeThreshold&&(o=!1),0==e._type){var v,c,m,b,f,p,u=n*e._linearDamping,x=u*u,X=1/(1+u+x*(.5+.16666666666666666*u+.041666666666666664*x)),M=n*e._angularDamping,g=M*M,Y=1/(1+M+g*(.5+.16666666666666666*M+.041666666666666664*g));v=this.gravityX*e._gravityScale,c=this.gravityY*e._gravityScale,m=this.gravityZ*e._gravityScale,v+=e._forceX*e._invMass,c+=e._forceY*e._invMass,m+=e._forceZ*e._invMass,b=e._invInertia00*e._torqueX+e._invInertia01*e._torqueY+e._invInertia02*e._torqueZ,f=e._invInertia10*e._torqueX+e._invInertia11*e._torqueY+e._invInertia12*e._torqueZ,p=e._invInertia20*e._torqueX+e._invInertia21*e._torqueY+e._invInertia22*e._torqueZ,e._velX+=v*n,e._velY+=c*n,e._velZ+=m*n,e._velX*=X,e._velY*=X,e._velZ*=X,e._angVelX+=b*n,e._angVelY+=f*n,e._angVelZ+=p*n,e._angVelX*=Y,e._angVelY*=Y,e._angVelZ*=Y}}if(o)for(var Z=0,I=this.numRigidBodies;Z<I;){var y=Z++,d=this.rigidBodies[y];d._sleeping=!0,d._sleepTime=0}else{for(var L=0,z=this.numSolvers;L<z;){var w=L++;this.solvers[w].preSolveVelocity(t)}for(var B=0,A=this.numSolvers;B<A;){var P=B++;this.solvers[P].warmStart(t)}for(var T=0,S=i;T<S;){T++;for(var V=0,k=this.numSolvers;V<k;){var C=V++;this.solvers[C].solveVelocity()}}for(var q=0,R=this.numSolvers;q<R;){var j=q++;this.solvers[j].postSolveVelocity(t)}for(var O=0,E=this.numRigidBodies;O<E;){var F=O++;this.rigidBodies[F]._integrate(n)}for(var N=0,W=this.numSolversSi;N<W;){var G=N++;this.solversSi[G].preSolvePosition(t)}for(var U=0,J=a;U<J;){U++;for(var H=0,Q=this.numSolversSi;H<Q;){var K=H++;this.solversSi[K].solvePositionSplitImpulse()}}for(var $=0,tt=this.numRigidBodies;$<tt;){var it=$++;this.rigidBodies[it]._integratePseudoVelocity()}for(var at=0,nt=this.numSolversNgs;at<nt;){var ot=at++;this.solversNgs[ot].preSolvePosition(t)}for(var st=0,rt=a;st<rt;){st++;for(var _t=0,et=this.numSolversNgs;_t<et;){var ht=_t++;this.solversNgs[ht].solvePositionNgs(t)}}for(var lt=0,vt=this.numSolvers;lt<vt;){var ct=lt++;this.solvers[ct].postSolve()}for(var mt=0,bt=this.numRigidBodies;mt<bt;)for(var ft=mt++,pt=this.rigidBodies[ft],ut=pt._shapeList;null!=ut;){var xt,Xt,Mt,gt,Yt,Zt,It,yt,dt,Lt,zt,wt,Bt=ut._next,At=ut._ptransform,Pt=ut._localTransform,Tt=pt._ptransform;xt=Tt._rotation00*Pt._rotation00+Tt._rotation01*Pt._rotation10+Tt._rotation02*Pt._rotation20,Xt=Tt._rotation00*Pt._rotation01+Tt._rotation01*Pt._rotation11+Tt._rotation02*Pt._rotation21,Mt=Tt._rotation00*Pt._rotation02+Tt._rotation01*Pt._rotation12+Tt._rotation02*Pt._rotation22,gt=Tt._rotation10*Pt._rotation00+Tt._rotation11*Pt._rotation10+Tt._rotation12*Pt._rotation20,Yt=Tt._rotation10*Pt._rotation01+Tt._rotation11*Pt._rotation11+Tt._rotation12*Pt._rotation21,Zt=Tt._rotation10*Pt._rotation02+Tt._rotation11*Pt._rotation12+Tt._rotation12*Pt._rotation22,It=Tt._rotation20*Pt._rotation00+Tt._rotation21*Pt._rotation10+Tt._rotation22*Pt._rotation20,yt=Tt._rotation20*Pt._rotation01+Tt._rotation21*Pt._rotation11+Tt._rotation22*Pt._rotation21,dt=Tt._rotation20*Pt._rotation02+Tt._rotation21*Pt._rotation12+Tt._rotation22*Pt._rotation22,At._rotation00=xt,At._rotation01=Xt,At._rotation02=Mt,At._rotation10=gt,At._rotation11=Yt,At._rotation12=Zt,At._rotation20=It,At._rotation21=yt,At._rotation22=dt,Lt=Tt._rotation00*Pt._positionX+Tt._rotation01*Pt._positionY+Tt._rotation02*Pt._positionZ,zt=Tt._rotation10*Pt._positionX+Tt._rotation11*Pt._positionY+Tt._rotation12*Pt._positionZ,wt=Tt._rotation20*Pt._positionX+Tt._rotation21*Pt._positionY+Tt._rotation22*Pt._positionZ,At._positionX=Lt,At._positionY=zt,At._positionZ=wt,At._positionX+=Tt._positionX,At._positionY+=Tt._positionY,At._positionZ+=Tt._positionZ;var St,Vt,kt,Ct,qt,Rt,jt,Ot,Et,Ft,Dt,Nt,Wt,Gt,Ut,Jt,Ht,Qt,Kt=ut._transform,$t=ut._localTransform,ti=pt._transform;if(St=ti._rotation00*$t._rotation00+ti._rotation01*$t._rotation10+ti._rotation02*$t._rotation20,Vt=ti._rotation00*$t._rotation01+ti._rotation01*$t._rotation11+ti._rotation02*$t._rotation21,kt=ti._rotation00*$t._rotation02+ti._rotation01*$t._rotation12+ti._rotation02*$t._rotation22,Ct=ti._rotation10*$t._rotation00+ti._rotation11*$t._rotation10+ti._rotation12*$t._rotation20,qt=ti._rotation10*$t._rotation01+ti._rotation11*$t._rotation11+ti._rotation12*$t._rotation21,Rt=ti._rotation10*$t._rotation02+ti._rotation11*$t._rotation12+ti._rotation12*$t._rotation22,jt=ti._rotation20*$t._rotation00+ti._rotation21*$t._rotation10+ti._rotation22*$t._rotation20,Ot=ti._rotation20*$t._rotation01+ti._rotation21*$t._rotation11+ti._rotation22*$t._rotation21,Et=ti._rotation20*$t._rotation02+ti._rotation21*$t._rotation12+ti._rotation22*$t._rotation22,Kt._rotation00=St,Kt._rotation01=Vt,Kt._rotation02=kt,Kt._rotation10=Ct,Kt._rotation11=qt,Kt._rotation12=Rt,Kt._rotation20=jt,Kt._rotation21=Ot,Kt._rotation22=Et,Ft=ti._rotation00*$t._positionX+ti._rotation01*$t._positionY+ti._rotation02*$t._positionZ,Dt=ti._rotation10*$t._positionX+ti._rotation11*$t._positionY+ti._rotation12*$t._positionZ,Nt=ti._rotation20*$t._positionX+ti._rotation21*$t._positionY+ti._rotation22*$t._positionZ,Kt._positionX=Ft,Kt._positionY=Dt,Kt._positionZ=Nt,Kt._positionX+=ti._positionX,Kt._positionY+=ti._positionY,Kt._positionZ+=ti._positionZ,ut._geom._computeAabb(ut._aabb,ut._ptransform),Wt=ut._aabb._minX,Gt=ut._aabb._minY,Ut=ut._aabb._minZ,Jt=ut._aabb._maxX,Ht=ut._aabb._maxY,Qt=ut._aabb._maxZ,ut._geom._computeAabb(ut._aabb,ut._transform),ut._aabb._minX=Wt<ut._aabb._minX?Wt:ut._aabb._minX,ut._aabb._minY=Gt<ut._aabb._minY?Gt:ut._aabb._minY,ut._aabb._minZ=Ut<ut._aabb._minZ?Ut:ut._aabb._minZ,ut._aabb._maxX=Jt>ut._aabb._maxX?Jt:ut._aabb._maxX,ut._aabb._maxY=Ht>ut._aabb._maxY?Ht:ut._aabb._maxY,ut._aabb._maxZ=Qt>ut._aabb._maxZ?Qt:ut._aabb._maxZ,null!=ut._proxy){var ii,ai,ni;ii=ut._transform._positionX-ut._ptransform._positionX,ai=ut._transform._positionY-ut._ptransform._positionY,ni=ut._transform._positionZ-ut._ptransform._positionZ;var oi=ut.displacement;oi.x=ii,oi.y=ai,oi.z=ni,ut._rigidBody._world._broadPhase.moveProxy(ut._proxy,ut._aabb,ut.displacement)}ut=Bt}}}};var nt=function(){this.dt=0,this.invDt=0,this.dtRatio=1},ot=function(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new l;break;case 2:this._broadPhase=new v}this._contactManager=new it(this._broadPhase),null==i&&(i=new E(0,-9.80665,0)),this._gravity=new E(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new st,this._convexCastWrapper=new rt,this._aabbTestWrapper=new _t,this._island=new at;var a=D.islandInitialConstraintArraySize,n=new Array(a);this._solversInIslands=n;var o=D.islandInitialRigidBodyArraySize,s=new Array(o);this._rigidBodyStack=s,this._timeStep=new nt,this._pool=new Q,this._shapeIdCount=0};ot.prototype={_updateContacts:function(){var t=(new Date).getTime()/1e3;this._contactManager._updateContacts();var i=(new Date).getTime()/1e3;ct.broadPhaseCollisionTime=1e3*(i-t);for(var a=(new Date).getTime()/1e3,n=this._contactManager._contactList;null!=n;){var o=n._next;n._shouldBeSkipped||n._updateManifold(),n=o}var s=(new Date).getTime()/1e3;ct.narrowPhaseCollisionTime=1e3*(s-a)},_solveIslands:function(){var t=(new Date).getTime()/1e3;if(D.disableSleeping)for(var i=this._rigidBodyList;null!=i;){var a=i._next;i._sleeping=!1,i._sleepTime=0,i=a}if(this._rigidBodyStack.length<this._numRigidBodies){for(var n=this._rigidBodyStack.length<<1;n<this._numRigidBodies;)n<<=1;var o=new Array(n);this._rigidBodyStack=o}this._numIslands=0;var s=this._island,r=this._gravity;s.gravityX=r.x,s.gravityY=r.y,s.gravityZ=r.z;var _=this._rigidBodyList;for(this._numSolversInIslands=0;null!=_;){for(var e=_._next;!_._addedToIsland&&!_._sleeping&&1!=_._type;){if(0==_._numContactLinks&&0==_._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,_),this._numIslands++;break}this.buildIsland(_),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}_=e}for(this._contactManager._postSolve(),_=this._rigidBodyList;null!=_;){var h=_._next;_._addedToIsland=!1,_=h}for(_=this._rigidBodyList;null!=_;){var l=_._next;_._forceX=0,_._forceY=0,_._forceZ=0,_._torqueX=0,_._torqueY=0,_._torqueZ=0,_=l}for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;var v=(new Date).getTime()/1e3;ct.dynamicsTime=1e3*(v-t)},buildIsland:function(t){var i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){var a=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1!=a._type){for(var n=a._contactLinkList;null!=n;){var o=n._next,s=n._contact._contactConstraint,r=n._contact._contactConstraint._solver;if(s.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var _=this._numSolversInIslands<<1,e=new Array(_),h=0,l=this._numSolversInIslands;h<l;){var v=h++;e[v]=this._solversInIslands[v],this._solversInIslands[v]=null}this._solversInIslands=e}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,s._positionCorrectionAlgorithm);var c=n._other;c._addedToIsland||(this._island._addRigidBody(c),this._rigidBodyStack[i++]=c)}n=o}for(var m=a._jointLinkList;null!=m;){var b=m._next,f=m._joint,p=f._solver;if(!p._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){for(var u=this._numSolversInIslands<<1,x=new Array(u),X=0,M=this._numSolversInIslands;X<M;){var g=X++;x[g]=this._solversInIslands[g],this._solversInIslands[g]=null}this._solversInIslands=x}this._solversInIslands[this._numSolversInIslands++]=p,this._island._addConstraintSolver(p,f._positionCorrectionAlgorithm);var Y=m._other;Y._addedToIsland||(this._island._addRigidBody(Y),this._rigidBodyStack[i++]=Y)}m=b}}}},step:function(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;var i=(new Date).getTime()/1e3;this._updateContacts(),this._solveIslands();var a=(new Date).getTime()/1e3;ct.totalTime=1e3*(a-i)},addRigidBody:function(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;for(var i=t._shapeList;null!=i;){var a=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=a}this._numRigidBodies++},removeRigidBody:function(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;for(var n=t._shapeList;null!=n;){var o=n._next;this._broadPhase.destroyProxy(n._proxy),n._proxy=null,n._id=-1;for(var s=n._rigidBody._contactLinkList;null!=s;){var r=s._next,_=s._contact;if(_._s1==n||_._s2==n){var e=s._other;e._sleeping=!1,e._sleepTime=0;var h=this._contactManager,l=_._prev,v=_._next;if(null!=l&&(l._next=v),null!=v&&(v._prev=l),_==h._contactList&&(h._contactList=h._contactList._next),_==h._contactListLast&&(h._contactListLast=h._contactListLast._prev),_._next=null,_._prev=null,_._touching){var c=_._s1._contactCallback,m=_._s2._contactCallback;c==m&&(m=null),null!=c&&c.endContact(_),null!=m&&m.endContact(_)}var b=_._link1._prev,f=_._link1._next;null!=b&&(b._next=f),null!=f&&(f._prev=b),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;var p=_._link2._prev,u=_._link2._next;null!=p&&(p._next=u),null!=u&&(u._prev=p),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;var x=_._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,_._next=h._contactPool,h._contactPool=_,h._numContacts--}s=r}this._numShapes--,n=o}this._numRigidBodies--},addJoint:function(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;var i=t._b1;i._sleeping=!1,i._sleepTime=0;var a=t._b2;a._sleeping=!1,a._sleepTime=0,t._syncAnchors(),this._numJoints++},removeJoint:function(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");var i=t._prev,a=t._next;null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;var n=t._link1._prev,o=t._link1._next;null!=n&&(n._next=o),null!=o&&(o._prev=n),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;var s=t._link2._prev,r=t._link2._next;null!=s&&(s._next=r),null!=r&&(r._prev=s),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;var _=t._b1;_._sleeping=!1,_._sleepTime=0;var e=t._b2;e._sleeping=!1,e._sleepTime=0,this._numJoints--},rayCast:function(t,i,a){var n=this._rayCastWrapper.begin;n.x=t.x,n.y=t.y,n.z=t.z;var o=this._rayCastWrapper.end;o.x=i.x,o.y=i.y,o.z=i.z,this._rayCastWrapper.callback=a,this._broadPhase.rayCast(t,i,this._rayCastWrapper)},convexCast:function(t,i,a,n){this._convexCastWrapper.convex=t;var o=this._convexCastWrapper.begin;o._positionX=i._positionX,o._positionY=i._positionY,o._positionZ=i._positionZ,o._rotation00=i._rotation00,o._rotation01=i._rotation01,o._rotation02=i._rotation02,o._rotation10=i._rotation10,o._rotation11=i._rotation11,o._rotation12=i._rotation12,o._rotation20=i._rotation20,o._rotation21=i._rotation21,o._rotation22=i._rotation22;var s=this._convexCastWrapper.translation;s.x=a.x,s.y=a.y,s.z=a.z,this._convexCastWrapper.callback=n,this._broadPhase.convexCast(t,i,a,this._convexCastWrapper)},aabbTest:function(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)},getRigidBodyList:function(){return this._rigidBodyList},getJointList:function(){return this._jointList},getBroadPhase:function(){return this._broadPhase},getContactManager:function(){return this._contactManager},getNumRigidBodies:function(){return this._numRigidBodies},getNumJoints:function(){return this._numJoints},getNumShapes:function(){return this._numShapes},getNumIslands:function(){return this._numIslands},getNumVelocityIterations:function(){return this._numVelocityIterations},setNumVelocityIterations:function(t){this._numVelocityIterations=t},getNumPositionIterations:function(){return this._numPositionIterations},setNumPositionIterations:function(t){this._numPositionIterations=t},getGravity:function(){return this._gravity},setGravity:function(t){var i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}};var st=function(){r.call(this),this.rayCastHit=new Z,this.begin=new E,this.end=new E,this.callback=null};st.__super__=r,st.prototype=t(r.prototype,{process:function(t){var i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}});var rt=function(){r.call(this),this.rayCastHit=new Z,this.begin=new F,this.translation=new E,this.zero=new E,this.callback=null,this.convex=null};rt.__super__=r,rt.prototype=t(r.prototype,{process:function(t){var i=t.userData,a=i._geom._type;if(!(a<0||a>5)){var n=i._geom;N.instance.convexCast(this.convex,n,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}}});var _t=function(){r.call(this),this._aabb=new p,this._callback=null};_t.__super__=r,_t.prototype=t(r.prototype,{process:function(t){var i=t.userData,a=i._aabb;a._minX<this._aabb._maxX&&a._maxX>this._aabb._minX&&a._minY<this._aabb._maxY&&a._maxY>this._aabb._minY&&a._minZ<this._aabb._maxZ&&a._maxZ>this._aabb._minZ&&this._callback.process(i)}});var et=function(){};et.prototype={process:function(t){}};var ht=function(){};ht.prototype={beginContact:function(t){},preSolve:function(t){},postSolve:function(t){},endContact:function(t){}};var lt=function(){};lt.prototype={process:function(t,i){}};var vt=function(){lt.call(this),this.position=new E,this.normal=new E,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1};vt.__super__=lt,vt.prototype=t(lt.prototype,{clear:function(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1},process:function(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;var a=this.position,n=i.position;a.x=n.x,a.y=n.y,a.z=n.z;var o=this.normal,s=i.normal;o.x=s.x,o.y=s.y,o.z=s.z}}});var ct=function(){},mt=function(){this._b1=null,this._b2=null,this._addedToIsland=!1};mt.prototype={preSolveVelocity:function(t){},warmStart:function(t){},solveVelocity:function(){},postSolveVelocity:function(t){},preSolvePosition:function(t){},solvePositionSplitImpulse:function(){},solvePositionNgs:function(t){},postSolve:function(){}};var bt=function(){},ft=function(t){this._solver=new $t(this),this._manifold=t};ft.prototype={_getVelocitySolverInfo:function(t,i){var a,n,o,s,r,_,e,h,l;i.b1=this._b1,i.b2=this._b2,a=this._manifold._normalX,n=this._manifold._normalY,o=this._manifold._normalZ,s=this._manifold._tangentX,r=this._manifold._tangentY,_=this._manifold._tangentZ,e=this._manifold._binormalX,h=this._manifold._binormalY,l=this._manifold._binormalZ;var v=Math.sqrt(this._s1._friction*this._s2._friction),c=Math.sqrt(this._s1._restitution*this._s2._restitution),m=this._manifold._numPoints;i.numRows=0,this._tf1._positionX,this._tf2._positionX,this._tf1._positionY,this._tf2._positionY,this._tf1._positionZ,this._tf2._positionZ;for(var b=0,f=m;b<f;){var p=b++,u=this._manifold._points[p];if(u._depth<0){u._disabled=!0;var x=u._impulse;x.impulseN=0,x.impulseT=0,x.impulseB=0,x.impulseP=0,x.impulseLX=0,x.impulseLY=0,x.impulseLZ=0}else{u._disabled=!1;var X=i.rows[i.numRows++];X.friction=v,X.cfm=0;var M=X.jacobianN;M.lin1X=a,M.lin1Y=n,M.lin1Z=o,M.lin2X=a,M.lin2Y=n,M.lin2Z=o,M.ang1X=u._relPos1Y*o-u._relPos1Z*n,M.ang1Y=u._relPos1Z*a-u._relPos1X*o,M.ang1Z=u._relPos1X*n-u._relPos1Y*a,M.ang2X=u._relPos2Y*o-u._relPos2Z*n,M.ang2Y=u._relPos2Z*a-u._relPos2X*o,M.ang2Z=u._relPos2X*n-u._relPos2Y*a,(M=X.jacobianT).lin1X=s,M.lin1Y=r,M.lin1Z=_,M.lin2X=s,M.lin2Y=r,M.lin2Z=_,M.ang1X=u._relPos1Y*_-u._relPos1Z*r,M.ang1Y=u._relPos1Z*s-u._relPos1X*_,M.ang1Z=u._relPos1X*r-u._relPos1Y*s,M.ang2X=u._relPos2Y*_-u._relPos2Z*r,M.ang2Y=u._relPos2Z*s-u._relPos2X*_,M.ang2Z=u._relPos2X*r-u._relPos2Y*s,(M=X.jacobianB).lin1X=e,M.lin1Y=h,M.lin1Z=l,M.lin2X=e,M.lin2Y=h,M.lin2Z=l,M.ang1X=u._relPos1Y*l-u._relPos1Z*h,M.ang1Y=u._relPos1Z*e-u._relPos1X*l,M.ang1Z=u._relPos1X*h-u._relPos1Y*e,M.ang2X=u._relPos2Y*l-u._relPos2Z*h,M.ang2Y=u._relPos2Z*e-u._relPos2X*l,M.ang2Z=u._relPos2X*h-u._relPos2Y*e;var g=(M=X.jacobianN).lin1X*this._b1._velX+M.lin1Y*this._b1._velY+M.lin1Z*this._b1._velZ+(M.ang1X*this._b1._angVelX+M.ang1Y*this._b1._angVelY+M.ang1Z*this._b1._angVelZ)-(M.lin2X*this._b2._velX+M.lin2Y*this._b2._velY+M.lin2Z*this._b2._velZ+(M.ang2X*this._b2._angVelX+M.ang2Y*this._b2._angVelY+M.ang2Z*this._b2._angVelZ));if(g<-D.contactEnableBounceThreshold&&!u._warmStarted?X.rhs=-g*c:X.rhs=0,this._positionCorrectionAlgorithm==bt.BAUMGARTE&&u._depth>D.linearSlop){var Y=(u._depth-D.linearSlop)*D.velocityBaumgarte*t.invDt;X.rhs<Y&&(X.rhs=Y)}if(!u._warmStarted){var Z=u._impulse;Z.impulseN=0,Z.impulseT=0,Z.impulseB=0,Z.impulseP=0,Z.impulseLX=0,Z.impulseLY=0,Z.impulseLZ=0}X.impulse=u._impulse}}},_getPositionSolverInfo:function(t){var i,a,n;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,a=this._manifold._normalY,n=this._manifold._normalZ;var o=this._manifold._numPoints;t.numRows=0;for(var s=0,r=o;s<r;){var _=s++,e=this._manifold._points[_];if(!e._disabled){var h=t.rows[t.numRows++],l=h.jacobianN;l.lin1X=i,l.lin1Y=a,l.lin1Z=n,l.lin2X=i,l.lin2Y=a,l.lin2Z=n,l.ang1X=e._relPos1Y*n-e._relPos1Z*a,l.ang1Y=e._relPos1Z*i-e._relPos1X*n,l.ang1Z=e._relPos1X*a-e._relPos1Y*i,l.ang2X=e._relPos2Y*n-e._relPos2Z*a,l.ang2Y=e._relPos2Z*i-e._relPos2X*n,l.ang2Z=e._relPos2X*a-e._relPos2Y*i,h.rhs=e._depth-D.linearSlop,h.rhs<0&&(h.rhs=0),h.impulse=e._impulse}}},_syncManifold:function(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},getManifold:function(){return this._manifold},isTouching:function(){for(var t=0,i=this._manifold._numPoints;t<i;){var a=t++;if(this._manifold._points[a]._depth>=0)return!0}return!1}};var pt=function(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0};pt.prototype={copyFrom:function(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};var ut=function(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0;var t=D.maxManifoldPoints,i=new Array(t);this._points=i;for(var a=0,n=D.maxManifoldPoints;a<n;){var o=a++;this._points[o]=new xt}};ut.prototype={_clear:function(){for(var t=0,i=this._numPoints;t<i;){var a=t++,n=this._points[a];n._localPos1X=0,n._localPos1Y=0,n._localPos1Z=0,n._localPos2X=0,n._localPos2Y=0,n._localPos2Z=0,n._relPos1X=0,n._relPos1Y=0,n._relPos1Z=0,n._relPos2X=0,n._relPos2Y=0,n._relPos2Z=0,n._pos1X=0,n._pos1Y=0,n._pos1Z=0,n._pos2X=0,n._pos2Y=0,n._pos2Z=0,n._depth=0;var o=n._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,n._warmStarted=!1,n._disabled=!1,n._id=-1}this._numPoints=0},_buildBasis:function(t){var i=t;this._normalX=i.x,this._normalY=i.y,this._normalZ=i.z;var a,n,o,s,r,_,e=t.x,h=t.y,l=t.z,v=e*e,c=h*h,m=l*l;if(v<c)if(v<m){var b=1/Math.sqrt(c+m);a=0,s=h*(o=h*b)-l*(n=-l*b),r=-e*o,_=e*n}else{var f=1/Math.sqrt(v+c);o=0,s=-l*(n=e*f),r=l*(a=-h*f),_=e*n-h*a}else if(c<m){var p=1/Math.sqrt(v+m);n=0,s=h*(o=-e*p),r=l*(a=l*p)-e*o,_=-h*a}else{var u=1/Math.sqrt(v+c);o=0,s=-l*(n=e*u),r=l*(a=-h*u),_=e*n-h*a}this._tangentX=a,this._tangentY=n,this._tangentZ=o,this._binormalX=s,this._binormalY=r,this._binormalZ=_},_updateDepthsAndPositions:function(t,i){for(var a=0,n=this._numPoints;a<n;){var o,s,r,_,e,h,l,v,c,m=a++,b=this._points[m];o=t._rotation00*b._localPos1X+t._rotation01*b._localPos1Y+t._rotation02*b._localPos1Z,s=t._rotation10*b._localPos1X+t._rotation11*b._localPos1Y+t._rotation12*b._localPos1Z,r=t._rotation20*b._localPos1X+t._rotation21*b._localPos1Y+t._rotation22*b._localPos1Z,b._relPos1X=o,b._relPos1Y=s,b._relPos1Z=r,_=i._rotation00*b._localPos2X+i._rotation01*b._localPos2Y+i._rotation02*b._localPos2Z,e=i._rotation10*b._localPos2X+i._rotation11*b._localPos2Y+i._rotation12*b._localPos2Z,h=i._rotation20*b._localPos2X+i._rotation21*b._localPos2Y+i._rotation22*b._localPos2Z,b._relPos2X=_,b._relPos2Y=e,b._relPos2Z=h,b._pos1X=b._relPos1X+t._positionX,b._pos1Y=b._relPos1Y+t._positionY,b._pos1Z=b._relPos1Z+t._positionZ,b._pos2X=b._relPos2X+i._positionX,b._pos2Y=b._relPos2Y+i._positionY,b._pos2Z=b._relPos2Z+i._positionZ,l=b._pos1X-b._pos2X,v=b._pos1Y-b._pos2Y,c=b._pos1Z-b._pos2Z;var f=l*this._normalX+v*this._normalY+c*this._normalZ;b._depth=-f}},getNormal:function(){var t=new E,i=t;return i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ,t},getNormalTo:function(t){var i=t;i.x=this._normalX,i.y=this._normalY,i.z=this._normalZ},getTangent:function(){var t=new E,i=t;return i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ,t},getTangentTo:function(t){var i=t;i.x=this._tangentX,i.y=this._tangentY,i.z=this._tangentZ},getBinormal:function(){var t=new E,i=t;return i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ,t},getBinormalTo:function(t){var i=t;i.x=this._binormalX,i.y=this._binormalY,i.z=this._binormalZ},getPoints:function(){return this._points},getNumPoints:function(){return this._numPoints}};var xt=function(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new pt,this._warmStarted=!1,this._disabled=!1,this._id=-1};xt.prototype={getPosition1:function(){var t=new E,i=t;return i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z,t},getPosition1To:function(t){var i=t;i.x=this._pos1X,i.y=this._pos1Y,i.z=this._pos1Z},getPosition2:function(){var t=new E,i=t;return i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z,t},getPosition2To:function(t){var i=t;i.x=this._pos2X,i.y=this._pos2Y,i.z=this._pos2Z},getDepth:function(){return this._depth},isWarmStarted:function(){return this._warmStarted},getNormalImpulse:function(){return this._impulse.impulseN},getTangentImpulse:function(){return this._impulse.impulseT},getBinormalImpulse:function(){return this._impulse.impulseB},isEnabled:function(){return!this._disabled}};var Xt=function(t){this._manifold=t,this.numOldPoints=0;var i=D.maxManifoldPoints,a=new Array(i);this.oldPoints=a;for(var n=0,o=D.maxManifoldPoints;n<o;){var s=n++;this.oldPoints[s]=new xt}};Xt.prototype={removeOutdatedPoints:function(){for(var t=this._manifold._numPoints;--t>=0;){var i,a,n,o=this._manifold._points[t];i=o._pos1X-o._pos2X,a=o._pos1Y-o._pos2Y,n=o._pos1Z-o._pos2Z;var s=this._manifold._normalX*i+this._manifold._normalY*a+this._manifold._normalZ*n;s>D.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-s)*i+(a+=this._manifold._normalY*-s)*a+(n+=this._manifold._normalZ*-s)*n>D.contactPersistenceThreshold*D.contactPersistenceThreshold&&this.removeManifoldPoint(t)}},removeManifoldPoint:function(t){var i=--this._manifold._numPoints;if(t!=i){var a=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=a}var n=this._manifold._points[i];n._localPos1X=0,n._localPos1Y=0,n._localPos1Z=0,n._localPos2X=0,n._localPos2Y=0,n._localPos2Z=0,n._relPos1X=0,n._relPos1Y=0,n._relPos1Z=0,n._relPos2X=0,n._relPos2Y=0,n._relPos2Z=0,n._pos1X=0,n._pos1Y=0,n._pos1Z=0,n._pos2X=0,n._pos2Y=0,n._pos2Z=0,n._depth=0;var o=n._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,n._warmStarted=!1,n._disabled=!1,n._id=-1},addManifoldPoint:function(t,i,a){var n=this._manifold._numPoints;if(n==D.maxManifoldPoints){var o=this.computeTargetIndex(t,i,a),s=this._manifold._points[o],r=t.position1;s._pos1X=r.x,s._pos1Y=r.y,s._pos1Z=r.z;var _,e,h,l,v,c,m=t.position2;s._pos2X=m.x,s._pos2Y=m.y,s._pos2Z=m.z,s._relPos1X=s._pos1X-i._positionX,s._relPos1Y=s._pos1Y-i._positionY,s._relPos1Z=s._pos1Z-i._positionZ,s._relPos2X=s._pos2X-a._positionX,s._relPos2Y=s._pos2Y-a._positionY,s._relPos2Z=s._pos2Z-a._positionZ,_=i._rotation00*s._relPos1X+i._rotation10*s._relPos1Y+i._rotation20*s._relPos1Z,e=i._rotation01*s._relPos1X+i._rotation11*s._relPos1Y+i._rotation21*s._relPos1Z,h=i._rotation02*s._relPos1X+i._rotation12*s._relPos1Y+i._rotation22*s._relPos1Z,s._localPos1X=_,s._localPos1Y=e,s._localPos1Z=h,l=a._rotation00*s._relPos2X+a._rotation10*s._relPos2Y+a._rotation20*s._relPos2Z,v=a._rotation01*s._relPos2X+a._rotation11*s._relPos2Y+a._rotation21*s._relPos2Z,c=a._rotation02*s._relPos2X+a._rotation12*s._relPos2Y+a._rotation22*s._relPos2Z,s._localPos2X=l,s._localPos2Y=v,s._localPos2Z=c,s._depth=t.depth;var b=s._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,s._id=t.id,s._warmStarted=!1,void(s._disabled=!1)}var f=this._manifold._points[n],p=t.position1;f._pos1X=p.x,f._pos1Y=p.y,f._pos1Z=p.z;var u,x,X,M,g,Y,Z=t.position2;f._pos2X=Z.x,f._pos2Y=Z.y,f._pos2Z=Z.z,f._relPos1X=f._pos1X-i._positionX,f._relPos1Y=f._pos1Y-i._positionY,f._relPos1Z=f._pos1Z-i._positionZ,f._relPos2X=f._pos2X-a._positionX,f._relPos2Y=f._pos2Y-a._positionY,f._relPos2Z=f._pos2Z-a._positionZ,u=i._rotation00*f._relPos1X+i._rotation10*f._relPos1Y+i._rotation20*f._relPos1Z,x=i._rotation01*f._relPos1X+i._rotation11*f._relPos1Y+i._rotation21*f._relPos1Z,X=i._rotation02*f._relPos1X+i._rotation12*f._relPos1Y+i._rotation22*f._relPos1Z,f._localPos1X=u,f._localPos1Y=x,f._localPos1Z=X,M=a._rotation00*f._relPos2X+a._rotation10*f._relPos2Y+a._rotation20*f._relPos2Z,g=a._rotation01*f._relPos2X+a._rotation11*f._relPos2Y+a._rotation21*f._relPos2Z,Y=a._rotation02*f._relPos2X+a._rotation12*f._relPos2Y+a._rotation22*f._relPos2Z,f._localPos2X=M,f._localPos2Y=g,f._localPos2Z=Y,f._depth=t.depth;var I=f._impulse;I.impulseN=0,I.impulseT=0,I.impulseB=0,I.impulseP=0,I.impulseLX=0,I.impulseLY=0,I.impulseLZ=0,f._id=t.id,f._warmStarted=!1,f._disabled=!1,this._manifold._numPoints++},computeTargetIndex:function(t,i,a){var n,o,s,r=this._manifold._points[0],_=this._manifold._points[1],e=this._manifold._points[2],h=this._manifold._points[3],l=r._depth,v=0;_._depth>l&&(l=_._depth,v=1),e._depth>l&&(l=e._depth,v=2),h._depth>l&&(l=h._depth,v=3);var c=t.position1;n=c.x,o=c.y,s=c.z,n-=i._positionX,o-=i._positionY,s-=i._positionZ;var m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R,j,O,E,F,D,N,W,G,U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt,ft,pt,ut,xt,Xt,Mt,gt,Yt,Zt,It,yt,dt,Lt,zt,wt,Bt,At,Pt,Tt,St,Vt,kt,Ct,qt,Rt,jt,Ot,Et,Ft,Dt,Nt,Wt,Gt,Ut,Jt,Ht,Qt,Kt,$t,ti,ii,ai,ni,oi,si,ri,_i,ei,hi,li,vi,ci,mi=_._relPos1X,bi=_._relPos1Y,fi=_._relPos1Z,pi=e._relPos1X,ui=e._relPos1Y,xi=e._relPos1Z,Xi=h._relPos1X,Mi=h._relPos1Y,gi=h._relPos1Z,Yi=(A=(b=ui-bi)*(x=s-gi)-(f=xi-fi)*(u=o-Mi))*A+(P=f*(p=n-Xi)-(m=pi-mi)*x)*P+(T=m*u-b*p)*T,Zi=(S=(M=Mi-bi)*(I=s-xi)-(g=gi-fi)*(Z=o-ui))*S+(V=g*(Y=n-pi)-(X=Xi-mi)*I)*V+(k=X*Z-M*Y)*k,Ii=(C=(d=o-bi)*(B=gi-xi)-(L=s-fi)*(w=Mi-ui))*C+(q=L*(z=Xi-pi)-(y=n-mi)*B)*q+(R=y*w-d*z)*R,yi=Yi>Zi?Yi>Ii?Yi:Ii:Zi>Ii?Zi:Ii,di=r._relPos1X,Li=r._relPos1Y,zi=r._relPos1Z,wi=e._relPos1X,Bi=e._relPos1Y,Ai=e._relPos1Z,Pi=h._relPos1X,Ti=h._relPos1Y,Si=h._relPos1Z,Vi=(ot=(O=Bi-Li)*(N=s-Si)-(E=Ai-zi)*(D=o-Ti))*ot+(st=E*(F=n-Pi)-(j=wi-di)*N)*st+(rt=j*D-O*F)*rt,ki=(_t=(G=Ti-Li)*(Q=s-Ai)-(U=Si-zi)*(H=o-Bi))*_t+(et=U*(J=n-wi)-(W=Pi-di)*Q)*et+(ht=W*H-G*J)*ht,Ci=(lt=($=o-Li)*(nt=Si-Ai)-(tt=s-zi)*(at=Ti-Bi))*lt+(vt=tt*(it=Pi-wi)-(K=n-di)*nt)*vt+(ct=K*at-$*it)*ct,qi=Vi>ki?Vi>Ci?Vi:Ci:ki>Ci?ki:Ci,Ri=r._relPos1X,ji=r._relPos1Y,Oi=r._relPos1Z,Ei=_._relPos1X,Fi=_._relPos1Y,Di=_._relPos1Z,Ni=h._relPos1X,Wi=h._relPos1Y,Gi=h._relPos1Z,Ui=(At=(bt=Fi-ji)*(xt=s-Gi)-(ft=Di-Oi)*(ut=o-Wi))*At+(Pt=ft*(pt=n-Ni)-(mt=Ei-Ri)*xt)*Pt+(Tt=mt*ut-bt*pt)*Tt,Ji=(St=(Mt=Wi-ji)*(It=s-Di)-(gt=Gi-Oi)*(Zt=o-Fi))*St+(Vt=gt*(Yt=n-Ei)-(Xt=Ni-Ri)*It)*Vt+(kt=Xt*Zt-Mt*Yt)*kt,Hi=(Ct=(dt=o-ji)*(Bt=Gi-Di)-(Lt=s-Oi)*(wt=Wi-Fi))*Ct+(qt=Lt*(zt=Ni-Ei)-(yt=n-Ri)*Bt)*qt+(Rt=yt*wt-dt*zt)*Rt,Qi=Ui>Ji?Ui>Hi?Ui:Hi:Ji>Hi?Ji:Hi,Ki=r._relPos1X,$i=r._relPos1Y,ta=r._relPos1Z,ia=_._relPos1X,aa=_._relPos1Y,na=_._relPos1Z,oa=e._relPos1X,sa=e._relPos1Y,ra=e._relPos1Z,_a=(oi=(Ot=aa-$i)*(Nt=s-ra)-(Et=na-ta)*(Dt=o-sa))*oi+(si=Et*(Ft=n-oa)-(jt=ia-Ki)*Nt)*si+(ri=jt*Dt-Ot*Ft)*ri,ea=(_i=(Gt=sa-$i)*(Qt=s-na)-(Ut=ra-ta)*(Ht=o-aa))*_i+(ei=Ut*(Jt=n-ia)-(Wt=oa-Ki)*Qt)*ei+(hi=Wt*Ht-Gt*Jt)*hi,ha=(li=($t=o-$i)*(ni=ra-na)-(ti=s-ta)*(ai=sa-aa))*li+(vi=ti*(ii=oa-ia)-(Kt=n-Ki)*ni)*vi+(ci=Kt*ai-$t*ii)*ci,la=_a>ea?_a>ha?_a:ha:ea>ha?ea:ha,va=yi,ca=0;return(qi>va&&1!=v||0==v)&&(va=qi,ca=1),Qi>va&&2!=v&&(va=Qi,ca=2),la>va&&3!=v&&(va=la,ca=3),ca},computeRelativePositions:function(t,i){for(var a=0,n=this._manifold._numPoints;a<n;){var o,s,r,_,e,h,l=a++,v=this._manifold._points[l];o=t._rotation00*v._localPos1X+t._rotation01*v._localPos1Y+t._rotation02*v._localPos1Z,s=t._rotation10*v._localPos1X+t._rotation11*v._localPos1Y+t._rotation12*v._localPos1Z,r=t._rotation20*v._localPos1X+t._rotation21*v._localPos1Y+t._rotation22*v._localPos1Z,v._relPos1X=o,v._relPos1Y=s,v._relPos1Z=r,_=i._rotation00*v._localPos2X+i._rotation01*v._localPos2Y+i._rotation02*v._localPos2Z,e=i._rotation10*v._localPos2X+i._rotation11*v._localPos2Y+i._rotation12*v._localPos2Z,h=i._rotation20*v._localPos2X+i._rotation21*v._localPos2Y+i._rotation22*v._localPos2Z,v._relPos2X=_,v._relPos2Y=e,v._relPos2Z=h,v._warmStarted=!0}},findNearestContactPointIndex:function(t,i,a){for(var n=D.contactPersistenceThreshold*D.contactPersistenceThreshold,o=-1,s=0,r=this._manifold._numPoints;s<r;){var _,e,h,l,v,c,m=s++,b=this._manifold._points[m],f=t.position1;_=f.x,e=f.y,h=f.z;var p,u,x,X,M,g,Y=t.position2;l=Y.x,v=Y.y,c=Y.z,_-=i._positionX,e-=i._positionY,h-=i._positionZ,l-=a._positionX,v-=a._positionY,c-=a._positionZ;var Z=(p=b._relPos1X-_)*p+(u=b._relPos1Y-e)*u+(x=b._relPos1Z-h)*x,I=(X=b._relPos2X-l)*X+(M=b._relPos2Y-v)*M+(g=b._relPos2Z-c)*g,y=Z<I?Z:I;y<n&&(n=y,o=m)}return o},totalUpdate:function(t,i,a){this.numOldPoints=this._manifold._numPoints;for(var n=0,o=this.numOldPoints;n<o;){var s=n++,r=this.oldPoints[s],_=this._manifold._points[s];r._localPos1X=_._localPos1X,r._localPos1Y=_._localPos1Y,r._localPos1Z=_._localPos1Z,r._localPos2X=_._localPos2X,r._localPos2Y=_._localPos2Y,r._localPos2Z=_._localPos2Z,r._relPos1X=_._relPos1X,r._relPos1Y=_._relPos1Y,r._relPos1Z=_._relPos1Z,r._relPos2X=_._relPos2X,r._relPos2Y=_._relPos2Y,r._relPos2Z=_._relPos2Z,r._pos1X=_._pos1X,r._pos1Y=_._pos1Y,r._pos1Z=_._pos1Z,r._pos2X=_._pos2X,r._pos2Y=_._pos2Y,r._pos2Z=_._pos2Z,r._depth=_._depth,r._impulse.copyFrom(_._impulse),r._id=_._id,r._warmStarted=_._warmStarted,r._disabled=!1}var e=t.numPoints;this._manifold._numPoints=e;for(var h=0,l=e;h<l;){var v=h++,c=this._manifold._points[v],m=t.points[v],b=m.position1;c._pos1X=b.x,c._pos1Y=b.y,c._pos1Z=b.z;var f,p,u,x,X,M,g=m.position2;c._pos2X=g.x,c._pos2Y=g.y,c._pos2Z=g.z,c._relPos1X=c._pos1X-i._positionX,c._relPos1Y=c._pos1Y-i._positionY,c._relPos1Z=c._pos1Z-i._positionZ,c._relPos2X=c._pos2X-a._positionX,c._relPos2Y=c._pos2Y-a._positionY,c._relPos2Z=c._pos2Z-a._positionZ,f=i._rotation00*c._relPos1X+i._rotation10*c._relPos1Y+i._rotation20*c._relPos1Z,p=i._rotation01*c._relPos1X+i._rotation11*c._relPos1Y+i._rotation21*c._relPos1Z,u=i._rotation02*c._relPos1X+i._rotation12*c._relPos1Y+i._rotation22*c._relPos1Z,c._localPos1X=f,c._localPos1Y=p,c._localPos1Z=u,x=a._rotation00*c._relPos2X+a._rotation10*c._relPos2Y+a._rotation20*c._relPos2Z,X=a._rotation01*c._relPos2X+a._rotation11*c._relPos2Y+a._rotation21*c._relPos2Z,M=a._rotation02*c._relPos2X+a._rotation12*c._relPos2Y+a._rotation22*c._relPos2Z,c._localPos2X=x,c._localPos2Y=X,c._localPos2Z=M,c._depth=m.depth;var Y=c._impulse;Y.impulseN=0,Y.impulseT=0,Y.impulseB=0,Y.impulseP=0,Y.impulseLX=0,Y.impulseLY=0,Y.impulseLZ=0,c._id=m.id,c._warmStarted=!1,c._disabled=!1;for(var Z=0,I=this.numOldPoints;Z<I;){var y=Z++,d=this.oldPoints[y];if(c._id==d._id){c._impulse.copyFrom(d._impulse),c._warmStarted=!0;break}}}},incrementalUpdate:function(t,i,a){this._manifold._updateDepthsAndPositions(i,a);for(var n=0,o=this._manifold._numPoints;n<o;){var s=n++;this._manifold._points[s]._warmStarted=!0}var r=t.points[0],_=this.findNearestContactPointIndex(r,i,a);if(-1==_)this.addManifoldPoint(r,i,a);else{var e=this._manifold._points[_],h=r.position1;e._pos1X=h.x,e._pos1Y=h.y,e._pos1Z=h.z;var l,v,c,m,b,f,p=r.position2;e._pos2X=p.x,e._pos2Y=p.y,e._pos2Z=p.z,e._relPos1X=e._pos1X-i._positionX,e._relPos1Y=e._pos1Y-i._positionY,e._relPos1Z=e._pos1Z-i._positionZ,e._relPos2X=e._pos2X-a._positionX,e._relPos2Y=e._pos2Y-a._positionY,e._relPos2Z=e._pos2Z-a._positionZ,l=i._rotation00*e._relPos1X+i._rotation10*e._relPos1Y+i._rotation20*e._relPos1Z,v=i._rotation01*e._relPos1X+i._rotation11*e._relPos1Y+i._rotation21*e._relPos1Z,c=i._rotation02*e._relPos1X+i._rotation12*e._relPos1Y+i._rotation22*e._relPos1Z,e._localPos1X=l,e._localPos1Y=v,e._localPos1Z=c,m=a._rotation00*e._relPos2X+a._rotation10*e._relPos2Y+a._rotation20*e._relPos2Z,b=a._rotation01*e._relPos2X+a._rotation11*e._relPos2Y+a._rotation21*e._relPos2Z,f=a._rotation02*e._relPos2X+a._rotation12*e._relPos2Y+a._rotation22*e._relPos2Z,e._localPos2X=m,e._localPos2Y=b,e._localPos2Z=f,e._depth=r.depth}this.removeOutdatedPoints()}};var Mt=function(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0};Mt.prototype={updateSparsity:function(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}};var gt=function(){this.jacobianN=new Mt,this.jacobianT=new Mt,this.jacobianB=new Mt,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null},Yt=function(){this.b1=null,this.b2=null,this.numRows=0;var t=D.maxJacobianRows,i=new Array(t);this.rows=i;for(var a=0,n=this.rows.length;a<n;){var o=a++;this.rows[o]=new Zt}},Zt=function(){this.jacobian=new Mt,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null},It=function(t,i){switch(this._link1=new Bt(this),this._link2=new Bt(this),this._positionCorrectionAlgorithm=D.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new ti(this);break;case 1:this._solver=new Qt(this)}var a=t.localAnchor1;this._localAnchor1X=a.x,this._localAnchor1Y=a.y,this._localAnchor1Z=a.z;var n=t.localAnchor2;this._localAnchor2X=n.x,this._localAnchor2Y=n.y,this._localAnchor2Z=n.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0;var o=D.maxJacobianRows,s=new Array(o);this._impulses=s;for(var r=0,_=D.maxJacobianRows;r<_;){var e=r++;this._impulses[e]=new wt}};It.prototype={_syncAnchors:function(){var t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I=this._b1._transform,y=this._b2._transform;t=I._rotation00*this._localAnchor1X+I._rotation01*this._localAnchor1Y+I._rotation02*this._localAnchor1Z,i=I._rotation10*this._localAnchor1X+I._rotation11*this._localAnchor1Y+I._rotation12*this._localAnchor1Z,a=I._rotation20*this._localAnchor1X+I._rotation21*this._localAnchor1Y+I._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=a,n=y._rotation00*this._localAnchor2X+y._rotation01*this._localAnchor2Y+y._rotation02*this._localAnchor2Z,o=y._rotation10*this._localAnchor2X+y._rotation11*this._localAnchor2Y+y._rotation12*this._localAnchor2Z,s=y._rotation20*this._localAnchor2X+y._rotation21*this._localAnchor2Y+y._rotation22*this._localAnchor2Z,this._relativeAnchor2X=n,this._relativeAnchor2Y=o,this._relativeAnchor2Z=s,this._anchor1X=this._relativeAnchor1X+I._positionX,this._anchor1Y=this._relativeAnchor1Y+I._positionY,this._anchor1Z=this._relativeAnchor1Z+I._positionZ,this._anchor2X=this._relativeAnchor2X+y._positionX,this._anchor2Y=this._relativeAnchor2Y+y._positionY,this._anchor2Z=this._relativeAnchor2Z+y._positionZ,r=I._rotation00*this._localBasisX1X+I._rotation01*this._localBasisX1Y+I._rotation02*this._localBasisX1Z,_=I._rotation10*this._localBasisX1X+I._rotation11*this._localBasisX1Y+I._rotation12*this._localBasisX1Z,e=I._rotation20*this._localBasisX1X+I._rotation21*this._localBasisX1Y+I._rotation22*this._localBasisX1Z,this._basisX1X=r,this._basisX1Y=_,this._basisX1Z=e,h=I._rotation00*this._localBasisY1X+I._rotation01*this._localBasisY1Y+I._rotation02*this._localBasisY1Z,l=I._rotation10*this._localBasisY1X+I._rotation11*this._localBasisY1Y+I._rotation12*this._localBasisY1Z,v=I._rotation20*this._localBasisY1X+I._rotation21*this._localBasisY1Y+I._rotation22*this._localBasisY1Z,this._basisY1X=h,this._basisY1Y=l,this._basisY1Z=v,c=I._rotation00*this._localBasisZ1X+I._rotation01*this._localBasisZ1Y+I._rotation02*this._localBasisZ1Z,m=I._rotation10*this._localBasisZ1X+I._rotation11*this._localBasisZ1Y+I._rotation12*this._localBasisZ1Z,b=I._rotation20*this._localBasisZ1X+I._rotation21*this._localBasisZ1Y+I._rotation22*this._localBasisZ1Z,this._basisZ1X=c,this._basisZ1Y=m,this._basisZ1Z=b,f=y._rotation00*this._localBasisX2X+y._rotation01*this._localBasisX2Y+y._rotation02*this._localBasisX2Z,p=y._rotation10*this._localBasisX2X+y._rotation11*this._localBasisX2Y+y._rotation12*this._localBasisX2Z,u=y._rotation20*this._localBasisX2X+y._rotation21*this._localBasisX2Y+y._rotation22*this._localBasisX2Z,this._basisX2X=f,this._basisX2Y=p,this._basisX2Z=u,x=y._rotation00*this._localBasisY2X+y._rotation01*this._localBasisY2Y+y._rotation02*this._localBasisY2Z,X=y._rotation10*this._localBasisY2X+y._rotation11*this._localBasisY2Y+y._rotation12*this._localBasisY2Z,M=y._rotation20*this._localBasisY2X+y._rotation21*this._localBasisY2Y+y._rotation22*this._localBasisY2Z,this._basisY2X=x,this._basisY2Y=X,this._basisY2Z=M,g=y._rotation00*this._localBasisZ2X+y._rotation01*this._localBasisZ2Y+y._rotation02*this._localBasisZ2Z,Y=y._rotation10*this._localBasisZ2X+y._rotation11*this._localBasisZ2Y+y._rotation12*this._localBasisZ2Z,Z=y._rotation20*this._localBasisZ2X+y._rotation21*this._localBasisZ2Y+y._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=Y,this._basisZ2Z=Z},_getVelocitySolverInfo:function(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0},_getPositionSolverInfo:function(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0},_checkDestruction:function(){var t=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ,i=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;this._breakForce>0&&t>this._breakForce*this._breakForce?this._world.removeJoint(this):this._breakTorque>0&&i>this._breakTorque*this._breakTorque&&this._world.removeJoint(this)},getRigidBody1:function(){return this._b1},getRigidBody2:function(){return this._b2},getType:function(){return this._type},getAnchor1:function(){var t=new E,i=t;return i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z,t},getAnchor2:function(){var t=new E,i=t;return i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z,t},getAnchor1To:function(t){var i=t;i.x=this._anchor1X,i.y=this._anchor1Y,i.z=this._anchor1Z},getAnchor2To:function(t){var i=t;i.x=this._anchor2X,i.y=this._anchor2Y,i.z=this._anchor2Z},getLocalAnchor1:function(){var t=new E,i=t;return i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z,t},getLocalAnchor2:function(){var t=new E,i=t;return i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z,t},getLocalAnchor1To:function(t){var i=t;i.x=this._localAnchor1X,i.y=this._localAnchor1Y,i.z=this._localAnchor1Z},getLocalAnchor2To:function(t){var i=t;i.x=this._localAnchor2X,i.y=this._localAnchor2Y,i.z=this._localAnchor2Z},getBasis1:function(){var t,i,a,n,o,s,r,_,e,h=new U;t=this._basisX1X,i=this._basisY1X,a=this._basisZ1X,n=this._basisX1Y,o=this._basisY1Y,s=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,e=this._basisZ1Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=n,l.e11=o,l.e12=s,l.e20=r,l.e21=_,l.e22=e,h},getBasis2:function(){var t,i,a,n,o,s,r,_,e,h=new U;t=this._basisX2X,i=this._basisY2X,a=this._basisZ2X,n=this._basisX2Y,o=this._basisY2Y,s=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,e=this._basisZ2Z;var l=h;return l.e00=t,l.e01=i,l.e02=a,l.e10=n,l.e11=o,l.e12=s,l.e20=r,l.e21=_,l.e22=e,h},getBasis1To:function(t){var i,a,n,o,s,r,_,e,h;i=this._basisX1X,a=this._basisY1X,n=this._basisZ1X,o=this._basisX1Y,s=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,e=this._basisY1Z,h=this._basisZ1Z;var l=t;l.e00=i,l.e01=a,l.e02=n,l.e10=o,l.e11=s,l.e12=r,l.e20=_,l.e21=e,l.e22=h},getBasis2To:function(t){var i,a,n,o,s,r,_,e,h;i=this._basisX2X,a=this._basisY2X,n=this._basisZ2X,o=this._basisX2Y,s=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,e=this._basisY2Z,h=this._basisZ2Z;var l=t;l.e00=i,l.e01=a,l.e02=n,l.e10=o,l.e11=s,l.e12=r,l.e20=_,l.e21=e,l.e22=h},getAllowCollision:function(){return this._allowCollision},setAllowCollision:function(t){this._allowCollision=t},getBreakForce:function(){return this._breakForce},setBreakForce:function(t){this._breakForce=t},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(t){this._breakTorque=t},getPositionCorrectionAlgorithm:function(){return this._positionCorrectionAlgorithm},setPositionCorrectionAlgorithm:function(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t},getAppliedForce:function(){var t=new E,i=t;return i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ,t},getAppliedForceTo:function(t){var i=t;i.x=this._appliedForceX,i.y=this._appliedForceY,i.z=this._appliedForceZ},getAppliedTorque:function(){var t=new E,i=t;return i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ,t},getAppliedTorqueTo:function(t){var i=t;i.x=this._appliedTorqueX,i.y=this._appliedTorqueY,i.z=this._appliedTorqueZ},getPrev:function(){return this._prev},getNext:function(){return this._next}};var yt=function(t){It.call(this,t,2);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,n,o,s,r,_,e,h,l,v,c,m,b,f=t.localAxis2;if(this._localBasisX2X=f.x,this._localBasisX2Y=f.y,this._localBasisX2Z=f.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var p=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisX1X*=p,this._localBasisX1Y*=p,this._localBasisX1Z*=p}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var u=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;u>0&&(u=1/Math.sqrt(u)),this._localBasisX2X*=u,this._localBasisX2Y*=u,this._localBasisX2Z*=u}var x=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(x<-.999999999){var X,M,g,Y,Z=this._localBasisX1X,I=this._localBasisX1Y,y=this._localBasisX1Z,d=Z*Z,L=I*I,z=y*y;d<L?d<z?(X=0,M=y*(Y=1/Math.sqrt(L+z)),g=-I*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0):L<z?(X=-y*(Y=1/Math.sqrt(z+d)),M=0,g=Z*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0),a=X,n=M,o=g,s=0}else{var w,B,A;w=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,B=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt(.5*(1+x));a=w*=x=.5/P,n=B*=x,o=A*=x,s=P}var T=2*a,S=2*n,V=2*o,k=a*T,C=n*S,q=o*V,R=a*S,j=n*V,O=a*V,E=s*T,F=s*S,D=s*V;r=1-C-q,_=R-D,e=O+F,h=R+D,l=1-k-q,v=j-E,c=O-F,m=j+E,b=1-k-C;var N,W,G,U,J,H,Q,K,$,tt,it=this._localBasisX1X,at=this._localBasisX1Y,nt=this._localBasisX1Z,ot=it*it,st=at*at,rt=nt*nt;ot<st?ot<rt?(N=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=nt*N,this._localBasisY1Z=-at*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0):st<rt?(N=1/Math.sqrt(rt+ot),this._localBasisY1X=-nt*N,this._localBasisY1Y=0,this._localBasisY1Z=it*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+_*this._localBasisX1Y+e*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+v*this._localBasisX1Z,U=c*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=U,J=r*this._localBasisY1X+_*this._localBasisY1Y+e*this._localBasisY1Z,H=h*this._localBasisY1X+l*this._localBasisY1Y+v*this._localBasisY1Z,Q=c*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=J,this._localBasisY2Y=H,this._localBasisY2Z=Q,K=r*this._localBasisZ1X+_*this._localBasisZ1Y+e*this._localBasisZ1Z,$=h*this._localBasisZ1X+l*this._localBasisZ1Y+v*this._localBasisZ1Z,tt=c*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=K,this._localBasisZ2Y=$,this._localBasisZ2Z=tt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new zt(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()};yt.__super__=It,yt.prototype=t(It.prototype,{getInfo:function(t,i,a){var n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0,I=this.linearErrorY*Z,y=this.linearErrorZ*Z,d=this.angularErrorY*Z,L=this.angularErrorZ*Z;n=-(n=0),o=-(o=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),v=-(v=0),c=-(c=0),m=-(m=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),f=-(f=this._relativeAnchor2Z),p=-(p=0),u=-(u=-this._relativeAnchor2X),x=-(x=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),M=-(M=0);var z,w,B,A,P,T,S=1/(this._b1._invMass+this._b2._invMass),V=this._basis.xX,k=this._basis.xY,C=this._basis.xZ;z=this._b1._invInertia00*V+this._b1._invInertia01*k+this._b1._invInertia02*C,w=this._b1._invInertia10*V+this._b1._invInertia11*k+this._b1._invInertia12*C,B=this._b1._invInertia20*V+this._b1._invInertia21*k+this._b1._invInertia22*C,A=this._b2._invInertia00*V+this._b2._invInertia01*k+this._b2._invInertia02*C,P=this._b2._invInertia10*V+this._b2._invInertia11*k+this._b2._invInertia12*C,T=this._b2._invInertia20*V+this._b2._invInertia21*k+this._b2._invInertia22*C;var q=z*V+w*k+B*C,R=A*V+P*k+T*C;if(q>0){var j=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,O=V*this._relativeAnchor1X+k*this._relativeAnchor1Y+C*this._relativeAnchor1Z,E=j-O*O;E>0&&(q=this._b1._invMass>0?1/(1/q+this._b1._mass*E):0)}if(R>0){var F=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,N=V*this._relativeAnchor2X+k*this._relativeAnchor2Y+C*this._relativeAnchor2Z,W=F-N*N;W>0&&(R=this._b2._invMass>0?1/(1/R+this._b2._mass*W):0)}var G=q+R==0?0:1/(q+R);if(this._translSd.frequency<=0||!a){var U=this._impulses[0],J=t.rows[t.numRows++],H=J.jacobian;H.lin1X=0,H.lin1Y=0,H.lin1Z=0,H.lin2X=0,H.lin2Y=0,H.lin2Z=0,H.ang1X=0,H.ang1Y=0,H.ang1Z=0,H.ang2X=0,H.ang2Y=0,H.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=U,g=J;var Q,K,$=this.translation,tt=this._translLm,it=this._translSd,at=D.linearSlop;if(a)Q=0,K=1;else{if(it.frequency>0){at=0;var nt=6.28318530717958*it.frequency,ot=it.dampingRatio;ot<D.minSpringDamperDampingRatio&&(ot=D.minSpringDamperDampingRatio);var st=i.dt,rt=2*ot*nt,_t=nt*nt;it.useSymplecticEuler?(Q=1/(st*rt),K=_t/rt):(Q=1/(st*(st*_t+rt)),K=_t/(st*_t+rt))}else Q=0,K=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;tt.motorForce>0?(g.motorSpeed=tt.motorSpeed,g.motorMaxImpulse=tt.motorForce*i.dt):(g.motorSpeed=0,g.motorMaxImpulse=0)}var et,ht,lt,vt=tt.lowerLimit,ct=tt.upperLimit;vt>ct?(et=0,ht=0,lt=0):vt==ct?(et=-1/0,ht=1/0,lt=$-vt):$<vt?(et=-1/0,ht=0,(lt=$-vt+at)>0&&(lt=0)):$>ct?(et=0,ht=1/0,(lt=$-ct-at)<0&&(lt=0)):(et=0,ht=0,lt=0);var mt=0==S?0:1/S;g.minImpulse=et,g.maxImpulse=ht,g.cfm=Q*mt,g.rhs=lt*K,(Y=g.jacobian).lin1X=this._basis.xX,Y.lin1Y=this._basis.xY,Y.lin1Z=this._basis.xZ,Y.lin2X=this._basis.xX,Y.lin2Y=this._basis.xY,Y.lin2Z=this._basis.xZ,Y.ang1X=n,Y.ang1Y=o,Y.ang1Z=s,Y.ang2X=c,Y.ang2Y=m,Y.ang2Z=b}var ft=this._impulses[1],pt=t.rows[t.numRows++],ut=pt.jacobian;ut.lin1X=0,ut.lin1Y=0,ut.lin1Z=0,ut.lin2X=0,ut.lin2Y=0,ut.lin2Z=0,ut.ang1X=0,ut.ang1Y=0,ut.ang1Z=0,ut.ang2X=0,ut.ang2Y=0,ut.ang2Z=0,pt.rhs=0,pt.cfm=0,pt.minImpulse=0,pt.maxImpulse=0,pt.motorSpeed=0,pt.motorMaxImpulse=0,pt.impulse=null,pt.impulse=ft,(g=pt).rhs=I,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).lin1X=this._basis.yX,Y.lin1Y=this._basis.yY,Y.lin1Z=this._basis.yZ,Y.lin2X=this._basis.yX,Y.lin2Y=this._basis.yY,Y.lin2Z=this._basis.yZ,Y.ang1X=r,Y.ang1Y=_,Y.ang1Z=e,Y.ang2X=f,Y.ang2Y=p,Y.ang2Z=u;var xt=this._impulses[2],Xt=t.rows[t.numRows++],Mt=Xt.jacobian;if(Mt.lin1X=0,Mt.lin1Y=0,Mt.lin1Z=0,Mt.lin2X=0,Mt.lin2Y=0,Mt.lin2Z=0,Mt.ang1X=0,Mt.ang1Y=0,Mt.ang1Z=0,Mt.ang2X=0,Mt.ang2Y=0,Mt.ang2Z=0,Xt.rhs=0,Xt.cfm=0,Xt.minImpulse=0,Xt.maxImpulse=0,Xt.motorSpeed=0,Xt.motorMaxImpulse=0,Xt.impulse=null,Xt.impulse=xt,(g=Xt).rhs=y,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).lin1X=this._basis.zX,Y.lin1Y=this._basis.zY,Y.lin1Z=this._basis.zZ,Y.lin2X=this._basis.zX,Y.lin2Y=this._basis.zY,Y.lin2Z=this._basis.zZ,Y.ang1X=h,Y.ang1Y=l,Y.ang1Z=v,Y.ang2X=x,Y.ang2Y=X,Y.ang2Z=M,this._rotSd.frequency<=0||!a){var gt=this._impulses[3],Yt=t.rows[t.numRows++],Zt=Yt.jacobian;Zt.lin1X=0,Zt.lin1Y=0,Zt.lin1Z=0,Zt.lin2X=0,Zt.lin2Y=0,Zt.lin2Z=0,Zt.ang1X=0,Zt.ang1Y=0,Zt.ang1Z=0,Zt.ang2X=0,Zt.ang2Y=0,Zt.ang2Z=0,Yt.rhs=0,Yt.cfm=0,Yt.minImpulse=0,Yt.maxImpulse=0,Yt.motorSpeed=0,Yt.motorMaxImpulse=0,Yt.impulse=null,Yt.impulse=gt,g=Yt;var It,yt,dt=this.angle,Lt=this._rotLm,zt=this._rotSd,wt=D.angularSlop;if(a)It=0,yt=1;else{if(zt.frequency>0){wt=0;var Bt=6.28318530717958*zt.frequency,At=zt.dampingRatio;At<D.minSpringDamperDampingRatio&&(At=D.minSpringDamperDampingRatio);var Pt=i.dt,Tt=2*At*Bt,St=Bt*Bt;zt.useSymplecticEuler?(It=1/(Pt*Tt),yt=St/Tt):(It=1/(Pt*(Pt*St+Tt)),yt=St/(Pt*St+Tt))}else It=0,yt=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;Lt.motorTorque>0?(g.motorSpeed=Lt.motorSpeed,g.motorMaxImpulse=Lt.motorTorque*i.dt):(g.motorSpeed=0,g.motorMaxImpulse=0)}var Vt,kt,Ct,qt=Lt.lowerLimit,Rt=Lt.upperLimit,jt=.5*(qt+Rt);dt=(((dt-=jt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,dt+=jt,qt>Rt?(Vt=0,kt=0,Ct=0):qt==Rt?(Vt=-1/0,kt=1/0,Ct=dt-qt):dt<qt?(Vt=-1/0,kt=0,(Ct=dt-qt+wt)>0&&(Ct=0)):dt>Rt?(Vt=0,kt=1/0,(Ct=dt-Rt-wt)<0&&(Ct=0)):(Vt=0,kt=0,Ct=0);var Ot=0==G?0:1/G;g.minImpulse=Vt,g.maxImpulse=kt,g.cfm=It*Ot,g.rhs=Ct*yt,(Y=g.jacobian).ang1X=this._basis.xX,Y.ang1Y=this._basis.xY,Y.ang1Z=this._basis.xZ,Y.ang2X=this._basis.xX,Y.ang2Y=this._basis.xY,Y.ang2Z=this._basis.xZ}var Et=this._impulses[4],Ft=t.rows[t.numRows++],Dt=Ft.jacobian;Dt.lin1X=0,Dt.lin1Y=0,Dt.lin1Z=0,Dt.lin2X=0,Dt.lin2Y=0,Dt.lin2Z=0,Dt.ang1X=0,Dt.ang1Y=0,Dt.ang1Z=0,Dt.ang2X=0,Dt.ang2Y=0,Dt.ang2Z=0,Ft.rhs=0,Ft.cfm=0,Ft.minImpulse=0,Ft.maxImpulse=0,Ft.motorSpeed=0,Ft.motorMaxImpulse=0,Ft.impulse=null,Ft.impulse=Et,(g=Ft).rhs=d,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).ang1X=this._basis.yX,Y.ang1Y=this._basis.yY,Y.ang1Z=this._basis.yZ,Y.ang2X=this._basis.yX,Y.ang2Y=this._basis.yY,Y.ang2Z=this._basis.yZ;var Nt=this._impulses[5],Wt=t.rows[t.numRows++],Gt=Wt.jacobian;Gt.lin1X=0,Gt.lin1Y=0,Gt.lin1Z=0,Gt.lin2X=0,Gt.lin2Y=0,Gt.lin2Z=0,Gt.ang1X=0,Gt.ang1Y=0,Gt.ang1Z=0,Gt.ang2X=0,Gt.ang2Y=0,Gt.ang2Z=0,Wt.rhs=0,Wt.cfm=0,Wt.minImpulse=0,Wt.maxImpulse=0,Wt.motorSpeed=0,Wt.motorMaxImpulse=0,Wt.impulse=null,Wt.impulse=Nt,(g=Wt).rhs=L,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).ang1X=this._basis.zX,Y.ang1Y=this._basis.zY,Y.ang1Z=this._basis.zZ,Y.ang2X=this._basis.zX,Y.ang2Y=this._basis.zY,Y.ang2Z=this._basis.zZ},_syncAnchors:function(){It.prototype._syncAnchors.call(this);var t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R=this._basis,j=R.joint._b1._invMass,O=R.joint._b2._invMass,E=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(E<-.999999999){var F,D,N,W,G=R.joint._basisX1X,U=R.joint._basisX1Y,J=R.joint._basisX1Z,H=G*G,Q=U*U,K=J*J;H<Q?H<K?(F=0,D=J*(W=1/Math.sqrt(Q+K)),N=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0):Q<K?(F=-J*(W=1/Math.sqrt(K+H)),D=0,N=G*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0),t=F,i=D,a=N,n=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+E));t=$*=E=.5/at,i=tt*=E,a=it*=E,n=at}var nt=(A=0)*(V=t)+(P=0)*(k=i)+(T=0)*(C=a)+(S=1)*(q=n);if(nt<0&&(nt=-nt,V=-V,k=-k,C=-C,q=-q),nt>.999999){var ot=(V=A+(V-A)*(j/(j+O)))*V+(k=P+(k-P)*(j/(j+O)))*k+(C=T+(C-T)*(j/(j+O)))*C+(q=S+(q-S)*(j/(j+O)))*q;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=V*ot,s=k*ot,r=C*ot,_=q*ot}else{var st=j/(j+O)*Math.acos(nt),rt=(V+=A*-nt)*V+(k+=P*-nt)*k+(C+=T*-nt)*C+(q+=S*-nt)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),V*=rt,k*=rt,C*=rt,q*=rt;var _t=Math.sin(st),et=Math.cos(st);o=(A*=et)+V*_t,s=(P*=et)+k*_t,r=(T*=et)+C*_t,_=(S*=et)+q*_t}var ht=2*o,lt=2*s,vt=2*r,ct=o*ht,mt=s*lt,bt=r*vt,ft=o*lt,pt=s*vt,ut=o*vt,xt=_*ht,Xt=_*lt,Mt=_*vt;e=ft-Mt,h=ut+Xt,l=ft+Mt,v=1-ct-bt,c=pt-xt,m=ut-Xt,b=pt+xt,f=1-ct-mt,p=(1-mt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,u=l*R.joint._basisX1X+v*R.joint._basisX1Y+c*R.joint._basisX1Z,x=m*R.joint._basisX1X+b*R.joint._basisX1Y+f*R.joint._basisX1Z,y=R.xX,d=R.xY,L=R.xZ,z=R.yX,w=R.yY,B=R.yZ;var gt=y*p+d*u+L*x;if(gt<-.999999999){var Yt,Zt,yt,dt,Lt=y,zt=d,wt=L,Bt=Lt*Lt,At=zt*zt,Pt=wt*wt;Bt<At?Bt<Pt?(Yt=0,Zt=wt*(dt=1/Math.sqrt(At+Pt)),yt=-zt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0):At<Pt?(Yt=-wt*(dt=1/Math.sqrt(Pt+Bt)),Zt=0,yt=Lt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0),o=Yt,s=Zt,r=yt,_=0}else{var Tt,St,Vt;Tt=d*x-L*u,St=L*p-y*x,Vt=y*u-d*p;var kt=Math.sqrt(.5*(1+gt));o=Tt*=gt=.5/kt,s=St*=gt,r=Vt*=gt,_=kt}var Ct,qt,Rt,jt=2*o,Ot=2*s,Et=2*r,Ft=o*jt,Dt=s*Ot,Nt=r*Et,Wt=o*Ot,Gt=s*Et,Ut=o*Et,Jt=_*jt,Ht=_*Ot,Qt=_*Et;if((Y=u*(g=(m=Ut-Ht)*z+(b=Gt+Jt)*w+(f=1-Ft-Dt)*B)-x*(M=(l=Wt+Qt)*z+(v=1-Ft-Nt)*w+(c=Gt-Jt)*B))*Y+(Z=x*(X=(1-Dt-Nt)*z+(e=Wt-Qt)*w+(h=Ut+Ht)*B)-p*g)*Z+(I=p*M-u*X)*I>1e-6){var Kt=Y*Y+Z*Z+I*I;Kt>0&&(Kt=1/Math.sqrt(Kt)),Y*=Kt,Z*=Kt,I*=Kt}else{var $t,ti=p,ii=u,ai=x,ni=ti*ti,oi=ii*ii,si=ai*ai;ni<oi?ni<si?(Y=0,Z=ai*($t=1/Math.sqrt(oi+si)),I=-ii*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),Z=-ti*$t,I=0):oi<si?(Y=-ai*($t=1/Math.sqrt(si+ni)),Z=0,I=ti*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),Z=-ti*$t,I=0)}X=Z*x-I*u,M=I*p-Y*x,g=Y*u-Z*p,R.xX=p,R.xY=u,R.xZ=x,R.yX=X,R.yY=M,R.yZ=g,R.zX=Y,R.zY=Z,R.zZ=I,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,qt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,_i,ei,hi,li,vi,ci=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,mi=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),bi=Ct*Ct+qt*qt+Rt*Rt;bi>0&&(bi=1/Math.sqrt(bi)),Ct*=bi,qt*=bi,Rt*=bi,Ct*=mi,qt*=mi,Rt*=mi,this.angularErrorY=Ct*this._basis.yX+qt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+qt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,_i=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,ei=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,ci=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=ci<=-1?3.14159265358979:ci>=1?0:Math.acos(ci),ri*this._basis.xX+_i*this._basis.xY+ei*this._basis.xZ<0&&(this.angle=-this.angle),hi=this._anchor2X-this._anchor1X,li=this._anchor2Y-this._anchor1Y,vi=this._anchor2Z-this._anchor1Z,this.translation=hi*this._basis.xX+li*this._basis.xY+vi*this._basis.xZ,this.linearErrorY=hi*this._basis.yX+li*this._basis.yY+vi*this._basis.yZ,this.linearErrorZ=hi*this._basis.zX+li*this._basis.zY+vi*this._basis.zZ},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new E,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new E,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new E,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new E,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getTranslationalSpringDamper:function(){return this._translSd},getRotationalSpringDamper:function(){return this._rotSd},getTranslationalLimitMotor:function(){return this._translLm},getRotationalLimitMotor:function(){return this._rotLm},getAngle:function(){return this.angle},getTranslation:function(){return this.translation}});var dt=function(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new E,this.localAnchor2=new E,this.allowCollision=!1,this.solverType=D.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=D.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0};dt.prototype={_init:function(t,i,a){this.rigidBody1=t,this.rigidBody2=i;var n,o,s,r,_,e,h=this.rigidBody1,l=a;n=l.x,o=l.y,s=l.z,n-=h._transform._positionX,o-=h._transform._positionY,s-=h._transform._positionZ,r=h._transform._rotation00*n+h._transform._rotation10*o+h._transform._rotation20*s,_=h._transform._rotation01*n+h._transform._rotation11*o+h._transform._rotation21*s,e=h._transform._rotation02*n+h._transform._rotation12*o+h._transform._rotation22*s,n=r,o=_,s=e;var v=this.localAnchor1;v.x=n,v.y=o,v.z=s;var c,m,b,f,p,u,x=this.rigidBody2,X=a;c=X.x,m=X.y,b=X.z,c-=x._transform._positionX,m-=x._transform._positionY,b-=x._transform._positionZ,f=x._transform._rotation00*c+x._transform._rotation10*m+x._transform._rotation20*b,p=x._transform._rotation01*c+x._transform._rotation11*m+x._transform._rotation21*b,u=x._transform._rotation02*c+x._transform._rotation12*m+x._transform._rotation22*b,c=f,m=p,b=u;var M=this.localAnchor2;M.x=c,M.y=m,M.z=b}};var Lt=function(){dt.call(this),this.localAxis1=new E(1,0,0),this.localAxis2=new E(1,0,0),this.translationalLimitMotor=new Et,this.translationalSpringDamper=new Ot,this.rotationalLimitMotor=new qt,this.rotationalSpringDamper=new Ot};Lt.__super__=dt,Lt.prototype=t(dt.prototype,{init:function(t,i,a,n){var o,s,r;this._init(t,i,a);var _,e,h,l=n;o=l.x,s=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=_,s=e,r=h;var v,c,m,b=this.localAxis1;b.x=o,b.y=s,b.z=r;var f,p,u,x=n;v=x.x,c=x.y,m=x.z,f=i._transform._rotation00*v+i._transform._rotation10*c+i._transform._rotation20*m,p=i._transform._rotation01*v+i._transform._rotation11*c+i._transform._rotation21*m,u=i._transform._rotation02*v+i._transform._rotation12*c+i._transform._rotation22*m,v=f,c=p,m=u;var X=this.localAxis2;return X.x=v,X.y=c,X.z=m,this}});var zt=function(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0},wt=function(){this.impulse=0,this.impulseM=0,this.impulseP=0},Bt=function(t){this._joint=t};Bt.prototype={getContact:function(){return this._joint},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var At=function(){},Pt=function(t){It.call(this,t,At.PRISMATIC);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,n,o,s,r,_,e,h,l,v,c,m,b,f=t.localAxis2;if(this._localBasisX2X=f.x,this._localBasisX2Y=f.y,this._localBasisX2Z=f.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var p=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisX1X*=p,this._localBasisX1Y*=p,this._localBasisX1Z*=p}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var u=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;u>0&&(u=1/Math.sqrt(u)),this._localBasisX2X*=u,this._localBasisX2Y*=u,this._localBasisX2Z*=u}var x=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(x<-.999999999){var X,M,g,Y,Z=this._localBasisX1X,I=this._localBasisX1Y,y=this._localBasisX1Z,d=Z*Z,L=I*I,z=y*y;d<L?d<z?(X=0,M=y*(Y=1/Math.sqrt(L+z)),g=-I*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0):L<z?(X=-y*(Y=1/Math.sqrt(z+d)),M=0,g=Z*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0),a=X,n=M,o=g,s=0}else{var w,B,A;w=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,B=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt(.5*(1+x));a=w*=x=.5/P,n=B*=x,o=A*=x,s=P}var T=2*a,S=2*n,V=2*o,k=a*T,C=n*S,q=o*V,R=a*S,j=n*V,O=a*V,E=s*T,F=s*S,D=s*V;r=1-C-q,_=R-D,e=O+F,h=R+D,l=1-k-q,v=j-E,c=O-F,m=j+E,b=1-k-C;var N,W,G,U,J,H,Q,K,$,tt,it=this._localBasisX1X,at=this._localBasisX1Y,nt=this._localBasisX1Z,ot=it*it,st=at*at,rt=nt*nt;ot<st?ot<rt?(N=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=nt*N,this._localBasisY1Z=-at*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0):st<rt?(N=1/Math.sqrt(rt+ot),this._localBasisY1X=-nt*N,this._localBasisY1Y=0,this._localBasisY1Z=it*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+_*this._localBasisX1Y+e*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+v*this._localBasisX1Z,U=c*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=U,J=r*this._localBasisY1X+_*this._localBasisY1Y+e*this._localBasisY1Z,H=h*this._localBasisY1X+l*this._localBasisY1Y+v*this._localBasisY1Z,Q=c*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=J,this._localBasisY2Y=H,this._localBasisY2Z=Q,K=r*this._localBasisZ1X+_*this._localBasisZ1Y+e*this._localBasisZ1Z,$=h*this._localBasisZ1X+l*this._localBasisZ1Y+v*this._localBasisZ1Z,tt=c*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=K,this._localBasisZ2Y=$,this._localBasisZ2Z=tt,this._basis=new zt(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()};Pt.__super__=It,Pt.prototype=t(It.prototype,{getInfo:function(t,i,a){var n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0,I=this.linearErrorY*Z,y=this.linearErrorZ*Z,d=this.angularErrorX*Z,L=this.angularErrorY*Z,z=this.angularErrorZ*Z;n=-(n=0),o=-(o=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),v=-(v=0),c=-(c=0),m=-(m=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),f=-(f=this._relativeAnchor2Z),p=-(p=0),u=-(u=-this._relativeAnchor2X),x=-(x=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),M=-(M=0);var w=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!a){var B=this._impulses[0],A=t.rows[t.numRows++],P=A.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=B,g=A;var T,S,V=this.translation,k=this._lm,C=this._sd,q=D.linearSlop;if(a)T=0,S=1;else{if(C.frequency>0){q=0;var R=6.28318530717958*C.frequency,j=C.dampingRatio;j<D.minSpringDamperDampingRatio&&(j=D.minSpringDamperDampingRatio);var O=i.dt,E=2*j*R,F=R*R;C.useSymplecticEuler?(T=1/(O*E),S=F/E):(T=1/(O*(O*F+E)),S=F/(O*F+E))}else T=0,S=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;k.motorForce>0?(g.motorSpeed=k.motorSpeed,g.motorMaxImpulse=k.motorForce*i.dt):(g.motorSpeed=0,g.motorMaxImpulse=0)}var N,W,G,U=k.lowerLimit,J=k.upperLimit;U>J?(N=0,W=0,G=0):U==J?(N=-1/0,W=1/0,G=V-U):V<U?(N=-1/0,W=0,(G=V-U+q)>0&&(G=0)):V>J?(N=0,W=1/0,(G=V-J-q)<0&&(G=0)):(N=0,W=0,G=0);var H=0==w?0:1/w;g.minImpulse=N,g.maxImpulse=W,g.cfm=T*H,g.rhs=G*S,(Y=g.jacobian).lin1X=this._basis.xX,Y.lin1Y=this._basis.xY,Y.lin1Z=this._basis.xZ,Y.lin2X=this._basis.xX,Y.lin2Y=this._basis.xY,Y.lin2Z=this._basis.xZ,Y.ang1X=n,Y.ang1Y=o,Y.ang1Z=s,Y.ang2X=c,Y.ang2Y=m,Y.ang2Z=b}var Q=this._impulses[1],K=t.rows[t.numRows++],$=K.jacobian;$.lin1X=0,$.lin1Y=0,$.lin1Z=0,$.lin2X=0,$.lin2Y=0,$.lin2Z=0,$.ang1X=0,$.ang1Y=0,$.ang1Z=0,$.ang2X=0,$.ang2Y=0,$.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=Q,(g=K).rhs=I,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).lin1X=this._basis.yX,Y.lin1Y=this._basis.yY,Y.lin1Z=this._basis.yZ,Y.lin2X=this._basis.yX,Y.lin2Y=this._basis.yY,Y.lin2Z=this._basis.yZ,Y.ang1X=r,Y.ang1Y=_,Y.ang1Z=e,Y.ang2X=f,Y.ang2Y=p,Y.ang2Z=u;var tt=this._impulses[2],it=t.rows[t.numRows++],at=it.jacobian;at.lin1X=0,at.lin1Y=0,at.lin1Z=0,at.lin2X=0,at.lin2Y=0,at.lin2Z=0,at.ang1X=0,at.ang1Y=0,at.ang1Z=0,at.ang2X=0,at.ang2Y=0,at.ang2Z=0,it.rhs=0,it.cfm=0,it.minImpulse=0,it.maxImpulse=0,it.motorSpeed=0,it.motorMaxImpulse=0,it.impulse=null,it.impulse=tt,(g=it).rhs=y,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).lin1X=this._basis.zX,Y.lin1Y=this._basis.zY,Y.lin1Z=this._basis.zZ,Y.lin2X=this._basis.zX,Y.lin2Y=this._basis.zY,Y.lin2Z=this._basis.zZ,Y.ang1X=h,Y.ang1Y=l,Y.ang1Z=v,Y.ang2X=x,Y.ang2Y=X,Y.ang2Z=M;var nt=this._impulses[3],ot=t.rows[t.numRows++],st=ot.jacobian;st.lin1X=0,st.lin1Y=0,st.lin1Z=0,st.lin2X=0,st.lin2Y=0,st.lin2Z=0,st.ang1X=0,st.ang1Y=0,st.ang1Z=0,st.ang2X=0,st.ang2Y=0,st.ang2Z=0,ot.rhs=0,ot.cfm=0,ot.minImpulse=0,ot.maxImpulse=0,ot.motorSpeed=0,ot.motorMaxImpulse=0,ot.impulse=null,ot.impulse=nt,(g=ot).rhs=d,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).ang1X=1,Y.ang1Y=0,Y.ang1Z=0,Y.ang2X=1,Y.ang2Y=0,Y.ang2Z=0;var rt=this._impulses[4],_t=t.rows[t.numRows++],et=_t.jacobian;et.lin1X=0,et.lin1Y=0,et.lin1Z=0,et.lin2X=0,et.lin2Y=0,et.lin2Z=0,et.ang1X=0,et.ang1Y=0,et.ang1Z=0,et.ang2X=0,et.ang2Y=0,et.ang2Z=0,_t.rhs=0,_t.cfm=0,_t.minImpulse=0,_t.maxImpulse=0,_t.motorSpeed=0,_t.motorMaxImpulse=0,_t.impulse=null,_t.impulse=rt,(g=_t).rhs=L,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).ang1X=0,Y.ang1Y=1,Y.ang1Z=0,Y.ang2X=0,Y.ang2Y=1,Y.ang2Z=0;var ht=this._impulses[5],lt=t.rows[t.numRows++],vt=lt.jacobian;vt.lin1X=0,vt.lin1Y=0,vt.lin1Z=0,vt.lin2X=0,vt.lin2Y=0,vt.lin2Z=0,vt.ang1X=0,vt.ang1Y=0,vt.ang1Z=0,vt.ang2X=0,vt.ang2Y=0,vt.ang2Z=0,lt.rhs=0,lt.cfm=0,lt.minImpulse=0,lt.maxImpulse=0,lt.motorSpeed=0,lt.motorMaxImpulse=0,lt.impulse=null,lt.impulse=ht,(g=lt).rhs=z,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,(Y=g.jacobian).ang1X=0,Y.ang1Y=0,Y.ang1Z=1,Y.ang2X=0,Y.ang2Y=0,Y.ang2Z=1},_syncAnchors:function(){It.prototype._syncAnchors.call(this);var t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R=this._basis,j=R.joint._b1._invMass,O=R.joint._b2._invMass,E=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(E<-.999999999){var F,D,N,W,G=R.joint._basisX1X,U=R.joint._basisX1Y,J=R.joint._basisX1Z,H=G*G,Q=U*U,K=J*J;H<Q?H<K?(F=0,D=J*(W=1/Math.sqrt(Q+K)),N=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0):Q<K?(F=-J*(W=1/Math.sqrt(K+H)),D=0,N=G*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0),t=F,i=D,a=N,n=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+E));t=$*=E=.5/at,i=tt*=E,a=it*=E,n=at}var nt=(A=0)*(V=t)+(P=0)*(k=i)+(T=0)*(C=a)+(S=1)*(q=n);if(nt<0&&(nt=-nt,V=-V,k=-k,C=-C,q=-q),nt>.999999){var ot=(V=A+(V-A)*(j/(j+O)))*V+(k=P+(k-P)*(j/(j+O)))*k+(C=T+(C-T)*(j/(j+O)))*C+(q=S+(q-S)*(j/(j+O)))*q;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=V*ot,s=k*ot,r=C*ot,_=q*ot}else{var st=j/(j+O)*Math.acos(nt),rt=(V+=A*-nt)*V+(k+=P*-nt)*k+(C+=T*-nt)*C+(q+=S*-nt)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),V*=rt,k*=rt,C*=rt,q*=rt;var _t=Math.sin(st),et=Math.cos(st);o=(A*=et)+V*_t,s=(P*=et)+k*_t,r=(T*=et)+C*_t,_=(S*=et)+q*_t}var ht=2*o,lt=2*s,vt=2*r,ct=o*ht,mt=s*lt,bt=r*vt,ft=o*lt,pt=s*vt,ut=o*vt,xt=_*ht,Xt=_*lt,Mt=_*vt;e=ft-Mt,h=ut+Xt,l=ft+Mt,v=1-ct-bt,c=pt-xt,m=ut-Xt,b=pt+xt,f=1-ct-mt,p=(1-mt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,u=l*R.joint._basisX1X+v*R.joint._basisX1Y+c*R.joint._basisX1Z,x=m*R.joint._basisX1X+b*R.joint._basisX1Y+f*R.joint._basisX1Z,y=R.xX,d=R.xY,L=R.xZ,z=R.yX,w=R.yY,B=R.yZ;var gt=y*p+d*u+L*x;if(gt<-.999999999){var Yt,Zt,yt,dt,Lt=y,zt=d,wt=L,Bt=Lt*Lt,At=zt*zt,Pt=wt*wt;Bt<At?Bt<Pt?(Yt=0,Zt=wt*(dt=1/Math.sqrt(At+Pt)),yt=-zt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0):At<Pt?(Yt=-wt*(dt=1/Math.sqrt(Pt+Bt)),Zt=0,yt=Lt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0),o=Yt,s=Zt,r=yt,_=0}else{var Tt,St,Vt;Tt=d*x-L*u,St=L*p-y*x,Vt=y*u-d*p;var kt=Math.sqrt(.5*(1+gt));o=Tt*=gt=.5/kt,s=St*=gt,r=Vt*=gt,_=kt}var Ct,qt,Rt,jt,Ot,Et,Ft,Dt,Nt,Wt,Gt,Ut,Jt,Ht,Qt,Kt,$t,ti,ii,ai,ni,oi,si,ri,_i,ei,hi,li,vi=2*o,ci=2*s,mi=2*r,bi=o*vi,fi=s*ci,pi=r*mi,ui=o*ci,xi=s*mi,Xi=o*mi,Mi=_*vi,gi=_*ci,Yi=_*mi;if((Y=u*(g=(m=Xi-gi)*z+(b=xi+Mi)*w+(f=1-bi-fi)*B)-x*(M=(l=ui+Yi)*z+(v=1-bi-pi)*w+(c=xi-Mi)*B))*Y+(Z=x*(X=(1-fi-pi)*z+(e=ui-Yi)*w+(h=Xi+gi)*B)-p*g)*Z+(I=p*M-u*X)*I>1e-6){var Zi=Y*Y+Z*Z+I*I;Zi>0&&(Zi=1/Math.sqrt(Zi)),Y*=Zi,Z*=Zi,I*=Zi}else{var Ii,yi=p,di=u,Li=x,zi=yi*yi,wi=di*di,Bi=Li*Li;zi<wi?zi<Bi?(Y=0,Z=Li*(Ii=1/Math.sqrt(wi+Bi)),I=-di*Ii):(Y=di*(Ii=1/Math.sqrt(zi+wi)),Z=-yi*Ii,I=0):wi<Bi?(Y=-Li*(Ii=1/Math.sqrt(Bi+zi)),Z=0,I=yi*Ii):(Y=di*(Ii=1/Math.sqrt(zi+wi)),Z=-yi*Ii,I=0)}X=Z*x-I*u,M=I*p-Y*x,g=Y*u-Z*p,R.xX=p,R.xY=u,R.xZ=x,R.yX=X,R.yY=M,R.yZ=g,R.zX=Y,R.zY=Z,R.zZ=I,Ct=this._basisX1X,qt=this._basisY1X,Rt=this._basisZ1X,jt=this._basisX1Y,Ot=this._basisY1Y,Et=this._basisZ1Y,Ft=this._basisX1Z,Dt=this._basisY1Z,Nt=this._basisZ1Z,ii=(Wt=this._basisX2X)*jt+(Gt=this._basisY2X)*Ot+(Ut=this._basisZ2X)*Et,ai=Wt*Ft+Gt*Dt+Ut*Nt,ni=(Jt=this._basisX2Y)*Ct+(Ht=this._basisY2Y)*qt+(Qt=this._basisZ2Y)*Rt,oi=Jt*Ft+Ht*Dt+Qt*Nt,si=(Kt=this._basisX2Z)*Ct+($t=this._basisY2Z)*qt+(ti=this._basisZ2Z)*Rt,ri=Kt*jt+$t*Ot+ti*Et;var Ai,Pi=Wt*Ct+Gt*qt+Ut*Rt,Ti=Jt*jt+Ht*Ot+Qt*Et,Si=Kt*Ft+$t*Dt+ti*Nt,Vi=Pi+Ti+Si;Vi>0?(li=.5*(Ai=Math.sqrt(Vi+1)),_i=(ri-oi)*(Ai=.5/Ai),ei=(ai-si)*Ai,hi=(ni-ii)*Ai):Pi>Ti?Pi>Si?(_i=.5*(Ai=Math.sqrt(Pi-Ti-Si+1)),ei=(ii+ni)*(Ai=.5/Ai),hi=(ai+si)*Ai,li=(ri-oi)*Ai):(hi=.5*(Ai=Math.sqrt(Si-Pi-Ti+1)),_i=(ai+si)*(Ai=.5/Ai),ei=(oi+ri)*Ai,li=(ni-ii)*Ai):Ti>Si?(ei=.5*(Ai=Math.sqrt(Ti-Si-Pi+1)),_i=(ii+ni)*(Ai=.5/Ai),hi=(oi+ri)*Ai,li=(ai-si)*Ai):(hi=.5*(Ai=Math.sqrt(Si-Pi-Ti+1)),_i=(ai+si)*(Ai=.5/Ai),ei=(oi+ri)*Ai,li=(ni-ii)*Ai);var ki=li,Ci=2*(ki<=-1?3.14159265358979:ki>=1?0:Math.acos(ki));this.angularErrorX=_i,this.angularErrorY=ei,this.angularErrorZ=hi;var qi,Ri,ji,Oi=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Oi>0&&(Oi=1/Math.sqrt(Oi)),this.angularErrorX*=Oi,this.angularErrorY*=Oi,this.angularErrorZ*=Oi,this.angularErrorX*=Ci,this.angularErrorY*=Ci,this.angularErrorZ*=Ci,qi=this._anchor2X-this._anchor1X,Ri=this._anchor2Y-this._anchor1Y,ji=this._anchor2Z-this._anchor1Z,this.translation=qi*this._basis.xX+Ri*this._basis.xY+ji*this._basis.xZ,this.linearErrorY=qi*this._basis.yX+Ri*this._basis.yY+ji*this._basis.yZ,this.linearErrorZ=qi*this._basis.zX+Ri*this._basis.zY+ji*this._basis.zZ},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new E,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new E,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new E,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new E,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getTranslation:function(){return this.translation}});var Tt=function(){dt.call(this),this.localAxis1=new E(1,0,0),this.localAxis2=new E(1,0,0),this.limitMotor=new Et,this.springDamper=new Ot};Tt.__super__=dt,Tt.prototype=t(dt.prototype,{init:function(t,i,a,n){var o,s,r;this._init(t,i,a);var _,e,h,l=n;o=l.x,s=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=_,s=e,r=h;var v,c,m,b=this.localAxis1;b.x=o,b.y=s,b.z=r;var f,p,u,x=n;v=x.x,c=x.y,m=x.z,f=i._transform._rotation00*v+i._transform._rotation10*c+i._transform._rotation20*m,p=i._transform._rotation01*v+i._transform._rotation11*c+i._transform._rotation21*m,u=i._transform._rotation02*v+i._transform._rotation12*c+i._transform._rotation22*m,v=f,c=p,m=u;var X=this.localAxis2;return X.x=v,X.y=c,X.z=m,this}});var St=function(t){It.call(this,t,At.RAGDOLL);var i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localSwingAxis1;this._localBasisY1X=a.x,this._localBasisY1Y=a.y,this._localBasisY1Z=a.z;var n,o,s,r,_,e,h,l,v,c,m,b,f,p=t.localTwistAxis2;if(this._localBasisX2X=p.x,this._localBasisX2Y=p.y,this._localBasisX2Z=p.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var u=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;u>0&&(u=1/Math.sqrt(u)),this._localBasisX1X*=u,this._localBasisX1Y*=u,this._localBasisX1Z*=u}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var x,X=this._localBasisX1X,M=this._localBasisX1Y,g=this._localBasisX1Z,Y=X*X,Z=M*M,I=g*g;Y<Z?Y<I?(x=1/Math.sqrt(Z+I),this._localBasisY1X=0,this._localBasisY1Y=g*x,this._localBasisY1Z=-M*x):(x=1/Math.sqrt(Y+Z),this._localBasisY1X=M*x,this._localBasisY1Y=-X*x,this._localBasisY1Z=0):Z<I?(x=1/Math.sqrt(I+Y),this._localBasisY1X=-g*x,this._localBasisY1Y=0,this._localBasisY1Z=X*x):(x=1/Math.sqrt(Y+Z),this._localBasisY1X=M*x,this._localBasisY1Y=-X*x,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var y=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;y>0&&(y=1/Math.sqrt(y)),this._localBasisZ1X*=y,this._localBasisZ1Y*=y,this._localBasisZ1Z*=y,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var d=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(d<-.999999999){var L,z,w,B,A=this._localBasisX1X,P=this._localBasisX1Y,T=this._localBasisX1Z,S=A*A,V=P*P,k=T*T;S<V?S<k?(L=0,z=T*(B=1/Math.sqrt(V+k)),w=-P*B):(L=P*(B=1/Math.sqrt(S+V)),z=-A*B,w=0):V<k?(L=-T*(B=1/Math.sqrt(k+S)),z=0,w=A*B):(L=P*(B=1/Math.sqrt(S+V)),z=-A*B,w=0),n=L,o=z,s=w,r=0}else{var C,q,R;C=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,q=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,R=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var j=Math.sqrt(.5*(1+d));n=C*=d=.5/j,o=q*=d,s=R*=d,r=j}var O,E,F,N,W,G,U,J,H,Q=2*n,K=2*o,$=2*s,tt=n*Q,it=o*K,at=s*$,nt=n*K,ot=o*$,st=n*$,rt=r*Q,_t=r*K,et=r*$;e=nt-et,h=st+_t,l=nt+et,v=1-tt-at,c=ot-rt,m=st-_t,b=ot+rt,f=1-tt-it,O=(_=1-it-at)*this._localBasisX1X+e*this._localBasisX1Y+h*this._localBasisX1Z,E=l*this._localBasisX1X+v*this._localBasisX1Y+c*this._localBasisX1Z,F=m*this._localBasisX1X+b*this._localBasisX1Y+f*this._localBasisX1Z,this._localBasisX2X=O,this._localBasisX2Y=E,this._localBasisX2Z=F,N=_*this._localBasisY1X+e*this._localBasisY1Y+h*this._localBasisY1Z,W=l*this._localBasisY1X+v*this._localBasisY1Y+c*this._localBasisY1Z,G=m*this._localBasisY1X+b*this._localBasisY1Y+f*this._localBasisY1Z,this._localBasisY2X=N,this._localBasisY2Y=W,this._localBasisY2Z=G,U=_*this._localBasisZ1X+e*this._localBasisZ1Y+h*this._localBasisZ1Z,J=l*this._localBasisZ1X+v*this._localBasisZ1Y+c*this._localBasisZ1Z,H=m*this._localBasisZ1X+b*this._localBasisZ1Y+f*this._localBasisZ1Z,this._localBasisZ2X=U,this._localBasisZ2Y=J,this._localBasisZ2Z=H,this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<D.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=D.minRagdollMaxSwingAngle),this._maxSwingAngle2<D.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=D.minRagdollMaxSwingAngle),this.dummySwingLm=new qt,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0};St.__super__=It,St.prototype=t(It.prototype,{getInfo:function(t,i,a){var n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0,Y=this.linearErrorX*g,Z=this.linearErrorY*g,I=this.linearErrorZ*g;n=-(n=0),o=-(o=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),v=-(v=0),c=-(c=0),m=-(m=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),f=-(f=this._relativeAnchor2Z),p=-(p=0),u=-(u=-this._relativeAnchor2X),x=-(x=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),M=-(M=0);var y,d,L,z,w,B,A=this.swingAxisX,P=this.swingAxisY,T=this.swingAxisZ;y=this._b1._invInertia00*A+this._b1._invInertia01*P+this._b1._invInertia02*T,d=this._b1._invInertia10*A+this._b1._invInertia11*P+this._b1._invInertia12*T,L=this._b1._invInertia20*A+this._b1._invInertia21*P+this._b1._invInertia22*T,z=this._b2._invInertia00*A+this._b2._invInertia01*P+this._b2._invInertia02*T,w=this._b2._invInertia10*A+this._b2._invInertia11*P+this._b2._invInertia12*T,B=this._b2._invInertia20*A+this._b2._invInertia21*P+this._b2._invInertia22*T;var S=y*A+d*P+L*T,V=z*A+w*P+B*T;if(S>0){var k=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,C=A*this._relativeAnchor1X+P*this._relativeAnchor1Y+T*this._relativeAnchor1Z,q=k-C*C;q>0&&(S=this._b1._invMass>0?1/(1/S+this._b1._mass*q):0)}if(V>0){var R=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,j=A*this._relativeAnchor2X+P*this._relativeAnchor2Y+T*this._relativeAnchor2Z,O=R-j*j;O>0&&(V=this._b2._invMass>0?1/(1/V+this._b2._mass*O):0)}var E,F,N,W,G,U,J=S+V==0?0:1/(S+V),H=this._basisX2X,Q=this._basisX2Y,K=this._basisX2Z;E=this._b1._invInertia00*H+this._b1._invInertia01*Q+this._b1._invInertia02*K,F=this._b1._invInertia10*H+this._b1._invInertia11*Q+this._b1._invInertia12*K,N=this._b1._invInertia20*H+this._b1._invInertia21*Q+this._b1._invInertia22*K,W=this._b2._invInertia00*H+this._b2._invInertia01*Q+this._b2._invInertia02*K,G=this._b2._invInertia10*H+this._b2._invInertia11*Q+this._b2._invInertia12*K,U=this._b2._invInertia20*H+this._b2._invInertia21*Q+this._b2._invInertia22*K;var $=E*H+F*Q+N*K,tt=W*H+G*Q+U*K;if($>0){var it=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,at=H*this._relativeAnchor1X+Q*this._relativeAnchor1Y+K*this._relativeAnchor1Z,nt=it-at*at;nt>0&&($=this._b1._invMass>0?1/(1/$+this._b1._mass*nt):0)}if(tt>0){var ot=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,st=H*this._relativeAnchor2X+Q*this._relativeAnchor2Y+K*this._relativeAnchor2Z,rt=ot-st*st;rt>0&&(tt=this._b2._invMass>0?1/(1/tt+this._b2._mass*rt):0)}var _t=$+tt==0?0:1/($+tt),et=this._impulses[0],ht=t.rows[t.numRows++],lt=ht.jacobian;lt.lin1X=0,lt.lin1Y=0,lt.lin1Z=0,lt.lin2X=0,lt.lin2Y=0,lt.lin2Z=0,lt.ang1X=0,lt.ang1Y=0,lt.ang1Z=0,lt.ang2X=0,lt.ang2Y=0,lt.ang2Z=0,ht.rhs=0,ht.cfm=0,ht.minImpulse=0,ht.maxImpulse=0,ht.motorSpeed=0,ht.motorMaxImpulse=0,ht.impulse=null,ht.impulse=et;var vt=ht;vt.rhs=Y,vt.cfm=0,vt.minImpulse=-1/0,vt.maxImpulse=1/0;var ct=vt.jacobian;ct.lin1X=1,ct.lin1Y=0,ct.lin1Z=0,ct.lin2X=1,ct.lin2Y=0,ct.lin2Z=0,ct.ang1X=n,ct.ang1Y=o,ct.ang1Z=s,ct.ang2X=c,ct.ang2Y=m,ct.ang2Z=b;var mt=this._impulses[1],ft=t.rows[t.numRows++],pt=ft.jacobian;pt.lin1X=0,pt.lin1Y=0,pt.lin1Z=0,pt.lin2X=0,pt.lin2Y=0,pt.lin2Z=0,pt.ang1X=0,pt.ang1Y=0,pt.ang1Z=0,pt.ang2X=0,pt.ang2Y=0,pt.ang2Z=0,ft.rhs=0,ft.cfm=0,ft.minImpulse=0,ft.maxImpulse=0,ft.motorSpeed=0,ft.motorMaxImpulse=0,ft.impulse=null,ft.impulse=mt,(vt=ft).rhs=Z,vt.cfm=0,vt.minImpulse=-1/0,vt.maxImpulse=1/0,(ct=vt.jacobian).lin1X=0,ct.lin1Y=1,ct.lin1Z=0,ct.lin2X=0,ct.lin2Y=1,ct.lin2Z=0,ct.ang1X=r,ct.ang1Y=_,ct.ang1Z=e,ct.ang2X=f,ct.ang2Y=p,ct.ang2Z=u;var ut=this._impulses[2],xt=t.rows[t.numRows++],Xt=xt.jacobian;if(Xt.lin1X=0,Xt.lin1Y=0,Xt.lin1Z=0,Xt.lin2X=0,Xt.lin2Y=0,Xt.lin2Z=0,Xt.ang1X=0,Xt.ang1Y=0,Xt.ang1Z=0,Xt.ang2X=0,Xt.ang2Y=0,Xt.ang2Z=0,xt.rhs=0,xt.cfm=0,xt.minImpulse=0,xt.maxImpulse=0,xt.motorSpeed=0,xt.motorMaxImpulse=0,xt.impulse=null,xt.impulse=ut,(vt=xt).rhs=I,vt.cfm=0,vt.minImpulse=-1/0,vt.maxImpulse=1/0,(ct=vt.jacobian).lin1X=0,ct.lin1Y=0,ct.lin1Z=1,ct.lin2X=0,ct.lin2Y=0,ct.lin2Z=1,ct.ang1X=h,ct.ang1Y=l,ct.ang1Z=v,ct.ang2X=x,ct.ang2Y=X,ct.ang2Z=M,this.swingError>0&&(this._swingSd.frequency<=0||!a)){var Mt=this._impulses[3],gt=t.rows[t.numRows++],Yt=gt.jacobian;Yt.lin1X=0,Yt.lin1Y=0,Yt.lin1Z=0,Yt.lin2X=0,Yt.lin2Y=0,Yt.lin2Z=0,Yt.ang1X=0,Yt.ang1Y=0,Yt.ang1Z=0,Yt.ang2X=0,Yt.ang2Y=0,Yt.ang2Z=0,gt.rhs=0,gt.cfm=0,gt.minImpulse=0,gt.maxImpulse=0,gt.motorSpeed=0,gt.motorMaxImpulse=0,gt.impulse=null,gt.impulse=Mt,vt=gt;var Zt,It,yt=this.swingError,dt=this.dummySwingLm,Lt=this._swingSd,zt=D.angularSlop;if(a)Zt=0,It=1;else{if(Lt.frequency>0){zt=0;var wt=6.28318530717958*Lt.frequency,Bt=Lt.dampingRatio;Bt<D.minSpringDamperDampingRatio&&(Bt=D.minSpringDamperDampingRatio);var At=i.dt,Pt=2*Bt*wt,Tt=wt*wt;Lt.useSymplecticEuler?(Zt=1/(At*Pt),It=Tt/Pt):(Zt=1/(At*(At*Tt+Pt)),It=Tt/(At*Tt+Pt))}else Zt=0,It=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;dt.motorTorque>0?(vt.motorSpeed=dt.motorSpeed,vt.motorMaxImpulse=dt.motorTorque*i.dt):(vt.motorSpeed=0,vt.motorMaxImpulse=0)}var St,Vt,kt,Ct=dt.lowerLimit,qt=dt.upperLimit,Rt=.5*(Ct+qt);yt=(((yt-=Rt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,yt+=Rt,Ct>qt?(St=0,Vt=0,kt=0):Ct==qt?(St=-1/0,Vt=1/0,kt=yt-Ct):yt<Ct?(St=-1/0,Vt=0,(kt=yt-Ct+zt)>0&&(kt=0)):yt>qt?(St=0,Vt=1/0,(kt=yt-qt-zt)<0&&(kt=0)):(St=0,Vt=0,kt=0);var jt=0==J?0:1/J;vt.minImpulse=St,vt.maxImpulse=Vt,vt.cfm=Zt*jt,vt.rhs=kt*It,(ct=vt.jacobian).ang1X=this.swingAxisX,ct.ang1Y=this.swingAxisY,ct.ang1Z=this.swingAxisZ,ct.ang2X=this.swingAxisX,ct.ang2Y=this.swingAxisY,ct.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!a){var Ot=this._impulses[4],Et=t.rows[t.numRows++],Ft=Et.jacobian;Ft.lin1X=0,Ft.lin1Y=0,Ft.lin1Z=0,Ft.lin2X=0,Ft.lin2Y=0,Ft.lin2Z=0,Ft.ang1X=0,Ft.ang1Y=0,Ft.ang1Z=0,Ft.ang2X=0,Ft.ang2Y=0,Ft.ang2Z=0,Et.rhs=0,Et.cfm=0,Et.minImpulse=0,Et.maxImpulse=0,Et.motorSpeed=0,Et.motorMaxImpulse=0,Et.impulse=null,Et.impulse=Ot,vt=Et;var Dt,Nt,Wt=this._twistAngle,Gt=this._twistLm,Ut=this._twistSd,Jt=D.angularSlop;if(a)Dt=0,Nt=1;else{if(Ut.frequency>0){Jt=0;var Ht=6.28318530717958*Ut.frequency,Qt=Ut.dampingRatio;Qt<D.minSpringDamperDampingRatio&&(Qt=D.minSpringDamperDampingRatio);var Kt=i.dt,$t=2*Qt*Ht,ti=Ht*Ht;Ut.useSymplecticEuler?(Dt=1/(Kt*$t),Nt=ti/$t):(Dt=1/(Kt*(Kt*ti+$t)),Nt=ti/(Kt*ti+$t))}else Dt=0,Nt=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;Gt.motorTorque>0?(vt.motorSpeed=Gt.motorSpeed,vt.motorMaxImpulse=Gt.motorTorque*i.dt):(vt.motorSpeed=0,vt.motorMaxImpulse=0)}var ii,ai,ni,oi=Gt.lowerLimit,si=Gt.upperLimit,ri=.5*(oi+si);Wt=(((Wt-=ri)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,Wt+=ri,oi>si?(ii=0,ai=0,ni=0):oi==si?(ii=-1/0,ai=1/0,ni=Wt-oi):Wt<oi?(ii=-1/0,ai=0,(ni=Wt-oi+Jt)>0&&(ni=0)):Wt>si?(ii=0,ai=1/0,(ni=Wt-si-Jt)<0&&(ni=0)):(ii=0,ai=0,ni=0);var _i=0==_t?0:1/_t;vt.minImpulse=ii,vt.maxImpulse=ai,vt.cfm=Dt*_i,vt.rhs=ni*Nt,(ct=vt.jacobian).ang1X=this.twistAxisX,ct.ang1Y=this.twistAxisY,ct.ang1Z=this.twistAxisZ,ct.ang2X=this.twistAxisX,ct.ang2Y=this.twistAxisY,ct.ang2Z=this.twistAxisZ}},_syncAnchors:function(){It.prototype._syncAnchors.call(this);var t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B;this._b1._transform,this._b2._transform;t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,n=this._basisX2X,o=this._basisX2Y,s=this._basisX2Z,r=this._basisX1X,_=this._basisY1X,e=this._basisZ1X,h=this._basisX1Y,l=this._basisY1Y,v=this._basisZ1Y,c=this._basisX1Z,m=this._basisY1Z,b=this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z;var A=t*n+i*o+a*s;if(A<-.999999999){var P,T,S,V,k=t,C=i,q=a,R=k*k,j=C*C,O=q*q;R<j?R<O?(P=0,T=q*(V=1/Math.sqrt(j+O)),S=-C*V):(P=C*(V=1/Math.sqrt(R+j)),T=-k*V,S=0):j<O?(P=-q*(V=1/Math.sqrt(O+R)),T=0,S=k*V):(P=C*(V=1/Math.sqrt(R+j)),T=-k*V,S=0),f=P,p=T,u=S,x=0}else{var E,F,D;E=i*s-a*o,F=a*n-t*s,D=t*o-i*n;var N=Math.sqrt(.5*(1+A));f=E*=A=.5/N,p=F*=A,u=D*=A,x=N}var W,G,U,J=2*f,H=2*p,Q=2*u,K=f*J,$=p*H,tt=u*Q,it=f*H,at=p*Q,nt=f*Q,ot=x*J,st=x*H,rt=x*Q;X=1-$-tt,M=it-rt,g=nt+st,Y=it+rt,Z=1-K-tt,I=at-ot,y=nt-st,d=at+ot,L=1-K-$,this._swingAngle=2*(x<=-1?3.14159265358979:x>=1?0:Math.acos(x)),z=f,w=p,B=u,W=X*this._basisY2X+Y*this._basisY2Y+y*this._basisY2Z,G=M*this._basisY2X+Z*this._basisY2Y+d*this._basisY2Z,U=g*this._basisY2X+I*this._basisY2Y+L*this._basisY2Z;var _t=this._basisY1X*W+this._basisY1Y*G+this._basisY1Z*U,et=this._basisZ1X*W+this._basisZ1Y*G+this._basisZ1Z*U;this._twistAngle=Math.atan2(et,_t),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;var ht=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ht>0&&(ht=1/Math.sqrt(ht)),this.twistAxisX*=ht,this.twistAxisY*=ht,this.twistAxisZ*=ht;var lt,vt,ct=Math.sqrt(z*z+w*w+B*B);ct>0&&(ct=1/ct),lt=_*(z*=ct*this._swingAngle)+l*(w*=ct*this._swingAngle)+m*(B*=ct*this._swingAngle),vt=e*z+v*w+b*B,z=r*z+h*w+c*B;var mt=w=lt,bt=B=vt,ft=this._maxSwingAngle1,pt=this._maxSwingAngle2,ut=1/(ft*ft),xt=1/(pt*pt),Xt=mt*mt*ut+bt*bt*xt;if(0==Xt)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{var Mt,gt,Yt,Zt,yt,dt,Lt=Math.sqrt(1/Xt),zt=mt*Lt,wt=bt*Lt,Bt=zt*ut,At=wt*xt,Pt=(mt-zt)*(Bt*=ct=1/Math.sqrt(Bt*Bt+At*At))+(bt-wt)*(At*=ct);if(Pt>0)this.swingError=Pt,this.swingAxisX=0,this.swingAxisY=Bt,this.swingAxisZ=At,Mt=r*this.swingAxisX+_*this.swingAxisY+e*this.swingAxisZ,gt=h*this.swingAxisX+l*this.swingAxisY+v*this.swingAxisZ,Yt=c*this.swingAxisX+m*this.swingAxisY+b*this.swingAxisZ,this.swingAxisX=Mt,this.swingAxisY=gt,this.swingAxisZ=Yt,Zt=X*this.swingAxisX+M*this.swingAxisY+g*this.swingAxisZ,yt=Y*this.swingAxisX+Z*this.swingAxisY+I*this.swingAxisZ,dt=y*this.swingAxisX+d*this.swingAxisY+L*this.swingAxisZ,this.swingAxisX=Zt,this.swingAxisY=yt,this.swingAxisZ=dt;else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new E,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new E,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new E,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new E,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getTwistSpringDamper:function(){return this._twistSd},getTwistLimitMotor:function(){return this._twistLm},getSwingSpringDamper:function(){return this._swingSd},getSwingAxis:function(){var t=new E,i=t;return i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ,t},getSwingAxisTo:function(t){var i=t;i.x=this.swingAxisX,i.y=this.swingAxisY,i.z=this.swingAxisZ},getSwingAngle:function(){return this._swingAngle},getTwistAngle:function(){return this._twistAngle}});var Vt=function(){dt.call(this),this.localTwistAxis1=new E(1,0,0),this.localTwistAxis2=new E(1,0,0),this.localSwingAxis1=new E(0,1,0),this.twistSpringDamper=new Ot,this.swingSpringDamper=new Ot,this.twistLimitMotor=new qt,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979};Vt.__super__=dt,Vt.prototype=t(dt.prototype,{init:function(t,i,a,n,o){var s,r,_;this._init(t,i,a);var e,h,l,v=n;s=v.x,r=v.y,_=v.z,e=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*_,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*_,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*_,s=e,r=h,_=l;var c,m,b,f=this.localTwistAxis1;f.x=s,f.y=r,f.z=_;var p,u,x,X=n;c=X.x,m=X.y,b=X.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,u=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,x=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=u,b=x;var M,g,Y,Z=this.localTwistAxis2;Z.x=c,Z.y=m,Z.z=b;var I,y,d,L=o;M=L.x,g=L.y,Y=L.z,I=t._transform._rotation00*M+t._transform._rotation10*g+t._transform._rotation20*Y,y=t._transform._rotation01*M+t._transform._rotation11*g+t._transform._rotation21*Y,d=t._transform._rotation02*M+t._transform._rotation12*g+t._transform._rotation22*Y,M=I,g=y,Y=d;var z=this.localSwingAxis1;return z.x=M,z.y=g,z.z=Y,this}});var kt=function(t){It.call(this,t,1);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a,n,o,s,r,_,e,h,l,v,c,m,b,f=t.localAxis2;if(this._localBasisX2X=f.x,this._localBasisX2Y=f.y,this._localBasisX2Z=f.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var p=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;p>0&&(p=1/Math.sqrt(p)),this._localBasisX1X*=p,this._localBasisX1Y*=p,this._localBasisX1Z*=p}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{var u=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;u>0&&(u=1/Math.sqrt(u)),this._localBasisX2X*=u,this._localBasisX2Y*=u,this._localBasisX2Z*=u}var x=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(x<-.999999999){var X,M,g,Y,Z=this._localBasisX1X,I=this._localBasisX1Y,y=this._localBasisX1Z,d=Z*Z,L=I*I,z=y*y;d<L?d<z?(X=0,M=y*(Y=1/Math.sqrt(L+z)),g=-I*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0):L<z?(X=-y*(Y=1/Math.sqrt(z+d)),M=0,g=Z*Y):(X=I*(Y=1/Math.sqrt(d+L)),M=-Z*Y,g=0),a=X,n=M,o=g,s=0}else{var w,B,A;w=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,B=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,A=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt(.5*(1+x));a=w*=x=.5/P,n=B*=x,o=A*=x,s=P}var T=2*a,S=2*n,V=2*o,k=a*T,C=n*S,q=o*V,R=a*S,j=n*V,O=a*V,E=s*T,F=s*S,D=s*V;r=1-C-q,_=R-D,e=O+F,h=R+D,l=1-k-q,v=j-E,c=O-F,m=j+E,b=1-k-C;var N,W,G,U,J,H,Q,K,$,tt,it=this._localBasisX1X,at=this._localBasisX1Y,nt=this._localBasisX1Z,ot=it*it,st=at*at,rt=nt*nt;ot<st?ot<rt?(N=1/Math.sqrt(st+rt),this._localBasisY1X=0,this._localBasisY1Y=nt*N,this._localBasisY1Z=-at*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0):st<rt?(N=1/Math.sqrt(rt+ot),this._localBasisY1X=-nt*N,this._localBasisY1Y=0,this._localBasisY1Z=it*N):(N=1/Math.sqrt(ot+st),this._localBasisY1X=at*N,this._localBasisY1Y=-it*N,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,W=r*this._localBasisX1X+_*this._localBasisX1Y+e*this._localBasisX1Z,G=h*this._localBasisX1X+l*this._localBasisX1Y+v*this._localBasisX1Z,U=c*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z,this._localBasisX2X=W,this._localBasisX2Y=G,this._localBasisX2Z=U,J=r*this._localBasisY1X+_*this._localBasisY1Y+e*this._localBasisY1Z,H=h*this._localBasisY1X+l*this._localBasisY1Y+v*this._localBasisY1Z,Q=c*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z,this._localBasisY2X=J,this._localBasisY2Y=H,this._localBasisY2Z=Q,K=r*this._localBasisZ1X+_*this._localBasisZ1Y+e*this._localBasisZ1Z,$=h*this._localBasisZ1X+l*this._localBasisZ1Y+v*this._localBasisZ1Z,tt=c*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z,this._localBasisZ2X=K,this._localBasisZ2Y=$,this._localBasisZ2Z=tt,this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new zt(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()};kt.__super__=It,kt.prototype=t(It.prototype,{getInfo:function(t,i,a){var n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0,Y=this.linearErrorX*g,Z=this.linearErrorY*g,I=this.linearErrorZ*g,y=this.angularErrorY*g,d=this.angularErrorZ*g;n=-(n=0),o=-(o=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),v=-(v=0),c=-(c=0),m=-(m=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),f=-(f=this._relativeAnchor2Z),p=-(p=0),u=-(u=-this._relativeAnchor2X),x=-(x=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),M=-(M=0);var L,z,w,B,A,P,T=this._basis.xX,S=this._basis.xY,V=this._basis.xZ;L=this._b1._invInertia00*T+this._b1._invInertia01*S+this._b1._invInertia02*V,z=this._b1._invInertia10*T+this._b1._invInertia11*S+this._b1._invInertia12*V,w=this._b1._invInertia20*T+this._b1._invInertia21*S+this._b1._invInertia22*V,B=this._b2._invInertia00*T+this._b2._invInertia01*S+this._b2._invInertia02*V,A=this._b2._invInertia10*T+this._b2._invInertia11*S+this._b2._invInertia12*V,P=this._b2._invInertia20*T+this._b2._invInertia21*S+this._b2._invInertia22*V;var k=L*T+z*S+w*V,C=B*T+A*S+P*V;if(k>0){var q=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,R=T*this._relativeAnchor1X+S*this._relativeAnchor1Y+V*this._relativeAnchor1Z,j=q-R*R;j>0&&(k=this._b1._invMass>0?1/(1/k+this._b1._mass*j):0)}if(C>0){var O=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,E=T*this._relativeAnchor2X+S*this._relativeAnchor2Y+V*this._relativeAnchor2Z,F=O-E*E;F>0&&(C=this._b2._invMass>0?1/(1/C+this._b2._mass*F):0)}var N=k+C==0?0:1/(k+C),W=this._impulses[0],G=t.rows[t.numRows++],U=G.jacobian;U.lin1X=0,U.lin1Y=0,U.lin1Z=0,U.lin2X=0,U.lin2Y=0,U.lin2Z=0,U.ang1X=0,U.ang1Y=0,U.ang1Z=0,U.ang2X=0,U.ang2Y=0,U.ang2Z=0,G.rhs=0,G.cfm=0,G.minImpulse=0,G.maxImpulse=0,G.motorSpeed=0,G.motorMaxImpulse=0,G.impulse=null,G.impulse=W;var J=G;J.rhs=Y,J.cfm=0,J.minImpulse=-1/0,J.maxImpulse=1/0;var H=J.jacobian;H.lin1X=1,H.lin1Y=0,H.lin1Z=0,H.lin2X=1,H.lin2Y=0,H.lin2Z=0,H.ang1X=n,H.ang1Y=o,H.ang1Z=s,H.ang2X=c,H.ang2Y=m,H.ang2Z=b;var Q=this._impulses[1],K=t.rows[t.numRows++],$=K.jacobian;$.lin1X=0,$.lin1Y=0,$.lin1Z=0,$.lin2X=0,$.lin2Y=0,$.lin2Z=0,$.ang1X=0,$.ang1Y=0,$.ang1Z=0,$.ang2X=0,$.ang2Y=0,$.ang2Z=0,K.rhs=0,K.cfm=0,K.minImpulse=0,K.maxImpulse=0,K.motorSpeed=0,K.motorMaxImpulse=0,K.impulse=null,K.impulse=Q,(J=K).rhs=Z,J.cfm=0,J.minImpulse=-1/0,J.maxImpulse=1/0,(H=J.jacobian).lin1X=0,H.lin1Y=1,H.lin1Z=0,H.lin2X=0,H.lin2Y=1,H.lin2Z=0,H.ang1X=r,H.ang1Y=_,H.ang1Z=e,H.ang2X=f,H.ang2Y=p,H.ang2Z=u;var tt=this._impulses[2],it=t.rows[t.numRows++],at=it.jacobian;if(at.lin1X=0,at.lin1Y=0,at.lin1Z=0,at.lin2X=0,at.lin2Y=0,at.lin2Z=0,at.ang1X=0,at.ang1Y=0,at.ang1Z=0,at.ang2X=0,at.ang2Y=0,at.ang2Z=0,it.rhs=0,it.cfm=0,it.minImpulse=0,it.maxImpulse=0,it.motorSpeed=0,it.motorMaxImpulse=0,it.impulse=null,it.impulse=tt,(J=it).rhs=I,J.cfm=0,J.minImpulse=-1/0,J.maxImpulse=1/0,(H=J.jacobian).lin1X=0,H.lin1Y=0,H.lin1Z=1,H.lin2X=0,H.lin2Y=0,H.lin2Z=1,H.ang1X=h,H.ang1Y=l,H.ang1Z=v,H.ang2X=x,H.ang2Y=X,H.ang2Z=M,this._sd.frequency<=0||!a){var nt=this._impulses[3],ot=t.rows[t.numRows++],st=ot.jacobian;st.lin1X=0,st.lin1Y=0,st.lin1Z=0,st.lin2X=0,st.lin2Y=0,st.lin2Z=0,st.ang1X=0,st.ang1Y=0,st.ang1Z=0,st.ang2X=0,st.ang2Y=0,st.ang2Z=0,ot.rhs=0,ot.cfm=0,ot.minImpulse=0,ot.maxImpulse=0,ot.motorSpeed=0,ot.motorMaxImpulse=0,ot.impulse=null,ot.impulse=nt,J=ot;var rt,_t,et=this.angle,ht=this._lm,lt=this._sd,vt=D.angularSlop;if(a)rt=0,_t=1;else{if(lt.frequency>0){vt=0;var ct=6.28318530717958*lt.frequency,mt=lt.dampingRatio;mt<D.minSpringDamperDampingRatio&&(mt=D.minSpringDamperDampingRatio);var ft=i.dt,pt=2*mt*ct,ut=ct*ct;lt.useSymplecticEuler?(rt=1/(ft*pt),_t=ut/pt):(rt=1/(ft*(ft*ut+pt)),_t=ut/(ft*ut+pt))}else rt=0,_t=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;ht.motorTorque>0?(J.motorSpeed=ht.motorSpeed,J.motorMaxImpulse=ht.motorTorque*i.dt):(J.motorSpeed=0,J.motorMaxImpulse=0)}var xt,Xt,Mt,gt=ht.lowerLimit,Yt=ht.upperLimit,Zt=.5*(gt+Yt);et=(((et-=Zt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,et+=Zt,gt>Yt?(xt=0,Xt=0,Mt=0):gt==Yt?(xt=-1/0,Xt=1/0,Mt=et-gt):et<gt?(xt=-1/0,Xt=0,(Mt=et-gt+vt)>0&&(Mt=0)):et>Yt?(xt=0,Xt=1/0,(Mt=et-Yt-vt)<0&&(Mt=0)):(xt=0,Xt=0,Mt=0);var It=0==N?0:1/N;J.minImpulse=xt,J.maxImpulse=Xt,J.cfm=rt*It,J.rhs=Mt*_t,(H=J.jacobian).ang1X=this._basis.xX,H.ang1Y=this._basis.xY,H.ang1Z=this._basis.xZ,H.ang2X=this._basis.xX,H.ang2Y=this._basis.xY,H.ang2Z=this._basis.xZ}var yt=this._impulses[4],dt=t.rows[t.numRows++],Lt=dt.jacobian;Lt.lin1X=0,Lt.lin1Y=0,Lt.lin1Z=0,Lt.lin2X=0,Lt.lin2Y=0,Lt.lin2Z=0,Lt.ang1X=0,Lt.ang1Y=0,Lt.ang1Z=0,Lt.ang2X=0,Lt.ang2Y=0,Lt.ang2Z=0,dt.rhs=0,dt.cfm=0,dt.minImpulse=0,dt.maxImpulse=0,dt.motorSpeed=0,dt.motorMaxImpulse=0,dt.impulse=null,dt.impulse=yt,(J=dt).rhs=y,J.cfm=0,J.minImpulse=-1/0,J.maxImpulse=1/0,(H=J.jacobian).ang1X=this._basis.yX,H.ang1Y=this._basis.yY,H.ang1Z=this._basis.yZ,H.ang2X=this._basis.yX,H.ang2Y=this._basis.yY,H.ang2Z=this._basis.yZ;var zt=this._impulses[5],wt=t.rows[t.numRows++],Bt=wt.jacobian;Bt.lin1X=0,Bt.lin1Y=0,Bt.lin1Z=0,Bt.lin2X=0,Bt.lin2Y=0,Bt.lin2Z=0,Bt.ang1X=0,Bt.ang1Y=0,Bt.ang1Z=0,Bt.ang2X=0,Bt.ang2Y=0,Bt.ang2Z=0,wt.rhs=0,wt.cfm=0,wt.minImpulse=0,wt.maxImpulse=0,wt.motorSpeed=0,wt.motorMaxImpulse=0,wt.impulse=null,wt.impulse=zt,(J=wt).rhs=d,J.cfm=0,J.minImpulse=-1/0,J.maxImpulse=1/0,(H=J.jacobian).ang1X=this._basis.zX,H.ang1Y=this._basis.zY,H.ang1Z=this._basis.zZ,H.ang2X=this._basis.zX,H.ang2Y=this._basis.zY,H.ang2Z=this._basis.zZ},_syncAnchors:function(){It.prototype._syncAnchors.call(this);var t,i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R=this._basis,j=R.joint._b1._invMass,O=R.joint._b2._invMass,E=R.joint._basisX1X*R.joint._basisX2X+R.joint._basisX1Y*R.joint._basisX2Y+R.joint._basisX1Z*R.joint._basisX2Z;if(E<-.999999999){var F,D,N,W,G=R.joint._basisX1X,U=R.joint._basisX1Y,J=R.joint._basisX1Z,H=G*G,Q=U*U,K=J*J;H<Q?H<K?(F=0,D=J*(W=1/Math.sqrt(Q+K)),N=-U*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0):Q<K?(F=-J*(W=1/Math.sqrt(K+H)),D=0,N=G*W):(F=U*(W=1/Math.sqrt(H+Q)),D=-G*W,N=0),t=F,i=D,a=N,n=0}else{var $,tt,it;$=R.joint._basisX1Y*R.joint._basisX2Z-R.joint._basisX1Z*R.joint._basisX2Y,tt=R.joint._basisX1Z*R.joint._basisX2X-R.joint._basisX1X*R.joint._basisX2Z,it=R.joint._basisX1X*R.joint._basisX2Y-R.joint._basisX1Y*R.joint._basisX2X;var at=Math.sqrt(.5*(1+E));t=$*=E=.5/at,i=tt*=E,a=it*=E,n=at}var nt=(A=0)*(V=t)+(P=0)*(k=i)+(T=0)*(C=a)+(S=1)*(q=n);if(nt<0&&(nt=-nt,V=-V,k=-k,C=-C,q=-q),nt>.999999){var ot=(V=A+(V-A)*(j/(j+O)))*V+(k=P+(k-P)*(j/(j+O)))*k+(C=T+(C-T)*(j/(j+O)))*C+(q=S+(q-S)*(j/(j+O)))*q;ot>1e-32&&(ot=1/Math.sqrt(ot)),o=V*ot,s=k*ot,r=C*ot,_=q*ot}else{var st=j/(j+O)*Math.acos(nt),rt=(V+=A*-nt)*V+(k+=P*-nt)*k+(C+=T*-nt)*C+(q+=S*-nt)*q;rt>1e-32&&(rt=1/Math.sqrt(rt)),V*=rt,k*=rt,C*=rt,q*=rt;var _t=Math.sin(st),et=Math.cos(st);o=(A*=et)+V*_t,s=(P*=et)+k*_t,r=(T*=et)+C*_t,_=(S*=et)+q*_t}var ht=2*o,lt=2*s,vt=2*r,ct=o*ht,mt=s*lt,bt=r*vt,ft=o*lt,pt=s*vt,ut=o*vt,xt=_*ht,Xt=_*lt,Mt=_*vt;e=ft-Mt,h=ut+Xt,l=ft+Mt,v=1-ct-bt,c=pt-xt,m=ut-Xt,b=pt+xt,f=1-ct-mt,p=(1-mt-bt)*R.joint._basisX1X+e*R.joint._basisX1Y+h*R.joint._basisX1Z,u=l*R.joint._basisX1X+v*R.joint._basisX1Y+c*R.joint._basisX1Z,x=m*R.joint._basisX1X+b*R.joint._basisX1Y+f*R.joint._basisX1Z,y=R.xX,d=R.xY,L=R.xZ,z=R.yX,w=R.yY,B=R.yZ;var gt=y*p+d*u+L*x;if(gt<-.999999999){var Yt,Zt,yt,dt,Lt=y,zt=d,wt=L,Bt=Lt*Lt,At=zt*zt,Pt=wt*wt;Bt<At?Bt<Pt?(Yt=0,Zt=wt*(dt=1/Math.sqrt(At+Pt)),yt=-zt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0):At<Pt?(Yt=-wt*(dt=1/Math.sqrt(Pt+Bt)),Zt=0,yt=Lt*dt):(Yt=zt*(dt=1/Math.sqrt(Bt+At)),Zt=-Lt*dt,yt=0),o=Yt,s=Zt,r=yt,_=0}else{var Tt,St,Vt;Tt=d*x-L*u,St=L*p-y*x,Vt=y*u-d*p;var kt=Math.sqrt(.5*(1+gt));o=Tt*=gt=.5/kt,s=St*=gt,r=Vt*=gt,_=kt}var Ct,qt,Rt,jt=2*o,Ot=2*s,Et=2*r,Ft=o*jt,Dt=s*Ot,Nt=r*Et,Wt=o*Ot,Gt=s*Et,Ut=o*Et,Jt=_*jt,Ht=_*Ot,Qt=_*Et;if((Y=u*(g=(m=Ut-Ht)*z+(b=Gt+Jt)*w+(f=1-Ft-Dt)*B)-x*(M=(l=Wt+Qt)*z+(v=1-Ft-Nt)*w+(c=Gt-Jt)*B))*Y+(Z=x*(X=(1-Dt-Nt)*z+(e=Wt-Qt)*w+(h=Ut+Ht)*B)-p*g)*Z+(I=p*M-u*X)*I>1e-6){var Kt=Y*Y+Z*Z+I*I;Kt>0&&(Kt=1/Math.sqrt(Kt)),Y*=Kt,Z*=Kt,I*=Kt}else{var $t,ti=p,ii=u,ai=x,ni=ti*ti,oi=ii*ii,si=ai*ai;ni<oi?ni<si?(Y=0,Z=ai*($t=1/Math.sqrt(oi+si)),I=-ii*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),Z=-ti*$t,I=0):oi<si?(Y=-ai*($t=1/Math.sqrt(si+ni)),Z=0,I=ti*$t):(Y=ii*($t=1/Math.sqrt(ni+oi)),Z=-ti*$t,I=0)}X=Z*x-I*u,M=I*p-Y*x,g=Y*u-Z*p,R.xX=p,R.xY=u,R.xZ=x,R.yX=X,R.yY=M,R.yZ=g,R.zX=Y,R.zY=Z,R.zZ=I,Ct=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,qt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,Rt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var ri,_i,ei,hi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,li=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),vi=Ct*Ct+qt*qt+Rt*Rt;vi>0&&(vi=1/Math.sqrt(vi)),Ct*=vi,qt*=vi,Rt*=vi,Ct*=li,qt*=li,Rt*=li,this.angularErrorY=Ct*this._basis.yX+qt*this._basis.yY+Rt*this._basis.yZ,this.angularErrorZ=Ct*this._basis.zX+qt*this._basis.zY+Rt*this._basis.zZ,ri=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,_i=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,ei=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,hi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=hi<=-1?3.14159265358979:hi>=1?0:Math.acos(hi),ri*this._basis.xX+_i*this._basis.xY+ei*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new E,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new E,i=t;return i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisX2X,i.y=this._basisX2Y,i.z=this._basisX2Z},getLocalAxis1:function(){var t=new E,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new E,i=t;return i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisX2X,i.y=this._localBasisX2Y,i.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getAngle:function(){return this.angle}});var Ct=function(){dt.call(this),this.localAxis1=new E(1,0,0),this.localAxis2=new E(1,0,0),this.springDamper=new Ot,this.limitMotor=new qt};Ct.__super__=dt,Ct.prototype=t(dt.prototype,{init:function(t,i,a,n){var o,s,r;this._init(t,i,a);var _,e,h,l=n;o=l.x,s=l.y,r=l.z,_=t._transform._rotation00*o+t._transform._rotation10*s+t._transform._rotation20*r,e=t._transform._rotation01*o+t._transform._rotation11*s+t._transform._rotation21*r,h=t._transform._rotation02*o+t._transform._rotation12*s+t._transform._rotation22*r,o=_,s=e,r=h;var v,c,m,b=this.localAxis1;b.x=o,b.y=s,b.z=r;var f,p,u,x=n;v=x.x,c=x.y,m=x.z,f=i._transform._rotation00*v+i._transform._rotation10*c+i._transform._rotation20*m,p=i._transform._rotation01*v+i._transform._rotation11*c+i._transform._rotation21*m,u=i._transform._rotation02*v+i._transform._rotation12*c+i._transform._rotation22*m,v=f,c=p,m=u;var X=this.localAxis2;return X.x=v,X.y=c,X.z=m,this}});var qt=function(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0};qt.prototype={setLimits:function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},setMotor:function(t,i){return this.motorSpeed=t,this.motorTorque=i,this},clone:function(){var t=new qt;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};var Rt=function(t){It.call(this,t,0),this._sd=t.springDamper.clone()};Rt.__super__=It,Rt.prototype=t(It.prototype,{getInfo:function(t,i,a){if(!(this._sd.frequency>0&&a)){var n,o,s,r,_;if(n=this._anchor2X-this._anchor1X,o=this._anchor2Y-this._anchor1Y,s=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){var e=6.28318530717958*this._sd.frequency,h=this._sd.dampingRatio;h<D.minSpringDamperDampingRatio&&(h=D.minSpringDamperDampingRatio);var l=i.dt,v=2*h*e,c=e*e;this._sd.useSymplecticEuler?(r=1/(l*v),_=c/v):(r=1/(l*(l*c+v)),_=c/(l*c+v)),r*=this._b1._invMass+this._b2._invMass}else r=0,_=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;var m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A=n*_,P=o*_,T=s*_;m=-(m=0),b=-(b=-this._relativeAnchor1Z),f=-(f=this._relativeAnchor1Y),p=-(p=this._relativeAnchor1Z),u=-(u=0),x=-(x=-this._relativeAnchor1X),X=-(X=-this._relativeAnchor1Y),M=-(M=this._relativeAnchor1X),g=-(g=0),Y=-(Y=0),Z=-(Z=-this._relativeAnchor2Z),I=-(I=this._relativeAnchor2Y),y=-(y=this._relativeAnchor2Z),d=-(d=0),L=-(L=-this._relativeAnchor2X),z=-(z=-this._relativeAnchor2Y),w=-(w=this._relativeAnchor2X),B=-(B=0);var S=this._impulses[0],V=t.rows[t.numRows++],k=V.jacobian;k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=S;var C=V;C.rhs=A,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0;var q=C.jacobian;q.lin1X=1,q.lin1Y=0,q.lin1Z=0,q.lin2X=1,q.lin2Y=0,q.lin2Z=0,q.ang1X=m,q.ang1Y=b,q.ang1Z=f,q.ang2X=Y,q.ang2Y=Z,q.ang2Z=I;var R=this._impulses[1],j=t.rows[t.numRows++],O=j.jacobian;O.lin1X=0,O.lin1Y=0,O.lin1Z=0,O.lin2X=0,O.lin2Y=0,O.lin2Z=0,O.ang1X=0,O.ang1Y=0,O.ang1Z=0,O.ang2X=0,O.ang2Y=0,O.ang2Z=0,j.rhs=0,j.cfm=0,j.minImpulse=0,j.maxImpulse=0,j.motorSpeed=0,j.motorMaxImpulse=0,j.impulse=null,j.impulse=R,(C=j).rhs=P,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0,(q=C.jacobian).lin1X=0,q.lin1Y=1,q.lin1Z=0,q.lin2X=0,q.lin2Y=1,q.lin2Z=0,q.ang1X=p,q.ang1Y=u,q.ang1Z=x,q.ang2X=y,q.ang2Y=d,q.ang2Z=L;var E=this._impulses[2],F=t.rows[t.numRows++],N=F.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,F.rhs=0,F.cfm=0,F.minImpulse=0,F.maxImpulse=0,F.motorSpeed=0,F.motorMaxImpulse=0,F.impulse=null,F.impulse=E,(C=F).rhs=T,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0,(q=C.jacobian).lin1X=0,q.lin1Y=0,q.lin1Z=1,q.lin2X=0,q.lin2Y=0,q.lin2Z=1,q.ang1X=X,q.ang1Y=M,q.ang1Z=g,q.ang2X=z,q.ang2Y=w,q.ang2Z=B}},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getSpringDamper:function(){return this._sd}});var jt=function(){dt.call(this),this.springDamper=new Ot};jt.__super__=dt,jt.prototype=t(dt.prototype,{init:function(t,i,a){return this._init(t,i,a),this}});var Ot=function(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1};Ot.prototype={setSpring:function(t,i){return this.frequency=t,this.dampingRatio=i,this},setSymplecticEuler:function(t){return this.useSymplecticEuler=t,this},clone:function(){var t=new Ot;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};var Et=function(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0};Et.prototype={setLimits:function(t,i){return this.lowerLimit=t,this.upperLimit=i,this},setMotor:function(t,i){return this.motorSpeed=t,this.motorForce=i,this},clone:function(){var t=new Et;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};var Ft=function(t){It.call(this,t,At.UNIVERSAL);var i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;var a=t.localAxis2;if(this._localBasisZ2X=a.x,this._localBasisZ2Y=a.y,this._localBasisZ2Z=a.z,this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{var n=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;n>0&&(n=1/Math.sqrt(n)),this._localBasisX1X*=n,this._localBasisX1Y*=n,this._localBasisX1Z*=n}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{var o=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;o>0&&(o=1/Math.sqrt(o)),this._localBasisZ2X*=o,this._localBasisZ2Y*=o,this._localBasisZ2Z*=o}var s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R,j,O=this._b1._transform,E=this._b2._transform;if(s=O._rotation00*this._localBasisX1X+O._rotation01*this._localBasisX1Y+O._rotation02*this._localBasisX1Z,r=O._rotation10*this._localBasisX1X+O._rotation11*this._localBasisX1Y+O._rotation12*this._localBasisX1Z,_=O._rotation20*this._localBasisX1X+O._rotation21*this._localBasisX1Y+O._rotation22*this._localBasisX1Z,M=E._rotation00*this._localBasisZ2X+E._rotation01*this._localBasisZ2Y+E._rotation02*this._localBasisZ2Z,g=E._rotation10*this._localBasisZ2X+E._rotation11*this._localBasisZ2Y+E._rotation12*this._localBasisZ2Z,Y=E._rotation20*this._localBasisZ2X+E._rotation21*this._localBasisZ2Y+E._rotation22*this._localBasisZ2Z,(v=(x=g)*_-(X=Y)*r)*v+(c=X*s-(u=M)*_)*c+(m=u*r-x*s)*m==0){var F,D=s,N=r,W=_,G=D*D,U=N*N,J=W*W;G<U?G<J?(v=0,c=W*(F=1/Math.sqrt(U+J)),m=-N*F):(v=N*(F=1/Math.sqrt(G+U)),c=-D*F,m=0):U<J?(v=-W*(F=1/Math.sqrt(J+G)),c=0,m=D*F):(v=N*(F=1/Math.sqrt(G+U)),c=-D*F,m=0)}e=r*m-_*c,h=_*v-s*m,l=s*c-r*v,b=c*X-m*x,f=m*u-v*X,p=v*x-c*u,Z=O._rotation00*s+O._rotation10*r+O._rotation20*_,I=O._rotation01*s+O._rotation11*r+O._rotation21*_,y=O._rotation02*s+O._rotation12*r+O._rotation22*_,this._localBasisX1X=Z,this._localBasisX1Y=I,this._localBasisX1Z=y,d=O._rotation00*v+O._rotation10*c+O._rotation20*m,L=O._rotation01*v+O._rotation11*c+O._rotation21*m,z=O._rotation02*v+O._rotation12*c+O._rotation22*m,this._localBasisY1X=d,this._localBasisY1Y=L,this._localBasisY1Z=z,w=O._rotation00*e+O._rotation10*h+O._rotation20*l,B=O._rotation01*e+O._rotation11*h+O._rotation21*l,A=O._rotation02*e+O._rotation12*h+O._rotation22*l,this._localBasisZ1X=w,this._localBasisZ1Y=B,this._localBasisZ1Z=A,P=E._rotation00*b+E._rotation10*f+E._rotation20*p,T=E._rotation01*b+E._rotation11*f+E._rotation21*p,S=E._rotation02*b+E._rotation12*f+E._rotation22*p,this._localBasisX2X=P,this._localBasisX2Y=T,this._localBasisX2Z=S,V=E._rotation00*v+E._rotation10*c+E._rotation20*m,k=E._rotation01*v+E._rotation11*c+E._rotation21*m,C=E._rotation02*v+E._rotation12*c+E._rotation22*m,this._localBasisY2X=V,this._localBasisY2Y=k,this._localBasisY2Z=C,q=E._rotation00*u+E._rotation10*x+E._rotation20*X,R=E._rotation01*u+E._rotation11*x+E._rotation21*X,j=E._rotation02*u+E._rotation12*x+E._rotation22*X,this._localBasisZ2X=q,this._localBasisZ2Y=R,this._localBasisZ2Z=j,this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()};Ft.__super__=It,Ft.prototype=t(It.prototype,{getInfo:function(t,i,a){var n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g=a?1:this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0,Y=this.linearErrorX*g,Z=this.linearErrorY*g,I=this.linearErrorZ*g,y=this._angleY*g;n=-(n=0),o=-(o=-this._relativeAnchor1Z),s=-(s=this._relativeAnchor1Y),r=-(r=this._relativeAnchor1Z),_=-(_=0),e=-(e=-this._relativeAnchor1X),h=-(h=-this._relativeAnchor1Y),l=-(l=this._relativeAnchor1X),v=-(v=0),c=-(c=0),m=-(m=-this._relativeAnchor2Z),b=-(b=this._relativeAnchor2Y),f=-(f=this._relativeAnchor2Z),p=-(p=0),u=-(u=-this._relativeAnchor2X),x=-(x=-this._relativeAnchor2Y),X=-(X=this._relativeAnchor2X),M=-(M=0);var d,L,z,w,B,A,P=this._axisXX,T=this._axisXY,S=this._axisXZ;d=this._b1._invInertia00*P+this._b1._invInertia01*T+this._b1._invInertia02*S,L=this._b1._invInertia10*P+this._b1._invInertia11*T+this._b1._invInertia12*S,z=this._b1._invInertia20*P+this._b1._invInertia21*T+this._b1._invInertia22*S,w=this._b2._invInertia00*P+this._b2._invInertia01*T+this._b2._invInertia02*S,B=this._b2._invInertia10*P+this._b2._invInertia11*T+this._b2._invInertia12*S,A=this._b2._invInertia20*P+this._b2._invInertia21*T+this._b2._invInertia22*S;var V=d*P+L*T+z*S,k=w*P+B*T+A*S;if(V>0){var C=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,q=P*this._relativeAnchor1X+T*this._relativeAnchor1Y+S*this._relativeAnchor1Z,R=C-q*q;R>0&&(V=this._b1._invMass>0?1/(1/V+this._b1._mass*R):0)}if(k>0){var j=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,O=P*this._relativeAnchor2X+T*this._relativeAnchor2Y+S*this._relativeAnchor2Z,E=j-O*O;E>0&&(k=this._b2._invMass>0?1/(1/k+this._b2._mass*E):0)}var F,N,W,G,U,J,H=V+k==0?0:1/(V+k),Q=this._axisZX,K=this._axisZY,$=this._axisZZ;F=this._b1._invInertia00*Q+this._b1._invInertia01*K+this._b1._invInertia02*$,N=this._b1._invInertia10*Q+this._b1._invInertia11*K+this._b1._invInertia12*$,W=this._b1._invInertia20*Q+this._b1._invInertia21*K+this._b1._invInertia22*$,G=this._b2._invInertia00*Q+this._b2._invInertia01*K+this._b2._invInertia02*$,U=this._b2._invInertia10*Q+this._b2._invInertia11*K+this._b2._invInertia12*$,J=this._b2._invInertia20*Q+this._b2._invInertia21*K+this._b2._invInertia22*$;var tt=F*Q+N*K+W*$,it=G*Q+U*K+J*$;if(tt>0){var at=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,nt=Q*this._relativeAnchor1X+K*this._relativeAnchor1Y+$*this._relativeAnchor1Z,ot=at-nt*nt;ot>0&&(tt=this._b1._invMass>0?1/(1/tt+this._b1._mass*ot):0)}if(it>0){var st=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,rt=Q*this._relativeAnchor2X+K*this._relativeAnchor2Y+$*this._relativeAnchor2Z,_t=st-rt*rt;_t>0&&(it=this._b2._invMass>0?1/(1/it+this._b2._mass*_t):0)}var et=tt+it==0?0:1/(tt+it),ht=this._impulses[0],lt=t.rows[t.numRows++],vt=lt.jacobian;vt.lin1X=0,vt.lin1Y=0,vt.lin1Z=0,vt.lin2X=0,vt.lin2Y=0,vt.lin2Z=0,vt.ang1X=0,vt.ang1Y=0,vt.ang1Z=0,vt.ang2X=0,vt.ang2Y=0,vt.ang2Z=0,lt.rhs=0,lt.cfm=0,lt.minImpulse=0,lt.maxImpulse=0,lt.motorSpeed=0,lt.motorMaxImpulse=0,lt.impulse=null,lt.impulse=ht;var ct=lt;ct.rhs=Y,ct.cfm=0,ct.minImpulse=-1/0,ct.maxImpulse=1/0;var mt=ct.jacobian;mt.lin1X=1,mt.lin1Y=0,mt.lin1Z=0,mt.lin2X=1,mt.lin2Y=0,mt.lin2Z=0,mt.ang1X=n,mt.ang1Y=o,mt.ang1Z=s,mt.ang2X=c,mt.ang2Y=m,mt.ang2Z=b;var ft=this._impulses[1],pt=t.rows[t.numRows++],ut=pt.jacobian;ut.lin1X=0,ut.lin1Y=0,ut.lin1Z=0,ut.lin2X=0,ut.lin2Y=0,ut.lin2Z=0,ut.ang1X=0,ut.ang1Y=0,ut.ang1Z=0,ut.ang2X=0,ut.ang2Y=0,ut.ang2Z=0,pt.rhs=0,pt.cfm=0,pt.minImpulse=0,pt.maxImpulse=0,pt.motorSpeed=0,pt.motorMaxImpulse=0,pt.impulse=null,pt.impulse=ft,(ct=pt).rhs=Z,ct.cfm=0,ct.minImpulse=-1/0,ct.maxImpulse=1/0,(mt=ct.jacobian).lin1X=0,mt.lin1Y=1,mt.lin1Z=0,mt.lin2X=0,mt.lin2Y=1,mt.lin2Z=0,mt.ang1X=r,mt.ang1Y=_,mt.ang1Z=e,mt.ang2X=f,mt.ang2Y=p,mt.ang2Z=u;var xt=this._impulses[2],Xt=t.rows[t.numRows++],Mt=Xt.jacobian;if(Mt.lin1X=0,Mt.lin1Y=0,Mt.lin1Z=0,Mt.lin2X=0,Mt.lin2Y=0,Mt.lin2Z=0,Mt.ang1X=0,Mt.ang1Y=0,Mt.ang1Z=0,Mt.ang2X=0,Mt.ang2Y=0,Mt.ang2Z=0,Xt.rhs=0,Xt.cfm=0,Xt.minImpulse=0,Xt.maxImpulse=0,Xt.motorSpeed=0,Xt.motorMaxImpulse=0,Xt.impulse=null,Xt.impulse=xt,(ct=Xt).rhs=I,ct.cfm=0,ct.minImpulse=-1/0,ct.maxImpulse=1/0,(mt=ct.jacobian).lin1X=0,mt.lin1Y=0,mt.lin1Z=1,mt.lin2X=0,mt.lin2Y=0,mt.lin2Z=1,mt.ang1X=h,mt.ang1Y=l,mt.ang1Z=v,mt.ang2X=x,mt.ang2Y=X,mt.ang2Z=M,!this.xSingular&&(this._sd1.frequency<=0||!a)){var gt=this._impulses[3],Yt=t.rows[t.numRows++],Zt=Yt.jacobian;Zt.lin1X=0,Zt.lin1Y=0,Zt.lin1Z=0,Zt.lin2X=0,Zt.lin2Y=0,Zt.lin2Z=0,Zt.ang1X=0,Zt.ang1Y=0,Zt.ang1Z=0,Zt.ang2X=0,Zt.ang2Y=0,Zt.ang2Z=0,Yt.rhs=0,Yt.cfm=0,Yt.minImpulse=0,Yt.maxImpulse=0,Yt.motorSpeed=0,Yt.motorMaxImpulse=0,Yt.impulse=null,Yt.impulse=gt,ct=Yt;var It,yt,dt=this._angleX,Lt=this._lm1,zt=this._sd1,wt=D.angularSlop;if(a)It=0,yt=1;else{if(zt.frequency>0){wt=0;var Bt=6.28318530717958*zt.frequency,At=zt.dampingRatio;At<D.minSpringDamperDampingRatio&&(At=D.minSpringDamperDampingRatio);var Pt=i.dt,Tt=2*At*Bt,St=Bt*Bt;zt.useSymplecticEuler?(It=1/(Pt*Tt),yt=St/Tt):(It=1/(Pt*(Pt*St+Tt)),yt=St/(Pt*St+Tt))}else It=0,yt=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;Lt.motorTorque>0?(ct.motorSpeed=Lt.motorSpeed,ct.motorMaxImpulse=Lt.motorTorque*i.dt):(ct.motorSpeed=0,ct.motorMaxImpulse=0)}var Vt,kt,Ct,qt=Lt.lowerLimit,Rt=Lt.upperLimit,jt=.5*(qt+Rt);dt=(((dt-=jt)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,dt+=jt,qt>Rt?(Vt=0,kt=0,Ct=0):qt==Rt?(Vt=-1/0,kt=1/0,Ct=dt-qt):dt<qt?(Vt=-1/0,kt=0,(Ct=dt-qt+wt)>0&&(Ct=0)):dt>Rt?(Vt=0,kt=1/0,(Ct=dt-Rt-wt)<0&&(Ct=0)):(Vt=0,kt=0,Ct=0);var Ot=0==H?0:1/H;ct.minImpulse=Vt,ct.maxImpulse=kt,ct.cfm=It*Ot,ct.rhs=Ct*yt,(mt=ct.jacobian).ang1X=this._axisXX,mt.ang1Y=this._axisXY,mt.ang1Z=this._axisXZ,mt.ang2X=this._axisXX,mt.ang2Y=this._axisXY,mt.ang2Z=this._axisXZ}if(!this.ySingular){var Et=this._impulses[4],Ft=t.rows[t.numRows++],Dt=Ft.jacobian;Dt.lin1X=0,Dt.lin1Y=0,Dt.lin1Z=0,Dt.lin2X=0,Dt.lin2Y=0,Dt.lin2Z=0,Dt.ang1X=0,Dt.ang1Y=0,Dt.ang1Z=0,Dt.ang2X=0,Dt.ang2Y=0,Dt.ang2Z=0,Ft.rhs=0,Ft.cfm=0,Ft.minImpulse=0,Ft.maxImpulse=0,Ft.motorSpeed=0,Ft.motorMaxImpulse=0,Ft.impulse=null,Ft.impulse=Et,(ct=Ft).rhs=y,ct.cfm=0,ct.minImpulse=-1/0,ct.maxImpulse=1/0,(mt=ct.jacobian).ang1X=this._axisYX,mt.ang1Y=this._axisYY,mt.ang1Z=this._axisYZ,mt.ang2X=this._axisYX,mt.ang2Y=this._axisYY,mt.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!a)){var Nt=this._impulses[5],Wt=t.rows[t.numRows++],Gt=Wt.jacobian;Gt.lin1X=0,Gt.lin1Y=0,Gt.lin1Z=0,Gt.lin2X=0,Gt.lin2Y=0,Gt.lin2Z=0,Gt.ang1X=0,Gt.ang1Y=0,Gt.ang1Z=0,Gt.ang2X=0,Gt.ang2Y=0,Gt.ang2Z=0,Wt.rhs=0,Wt.cfm=0,Wt.minImpulse=0,Wt.maxImpulse=0,Wt.motorSpeed=0,Wt.motorMaxImpulse=0,Wt.impulse=null,Wt.impulse=Nt,ct=Wt;var Ut,Jt,Ht=this._angleZ,Qt=this._lm2,Kt=this._sd2,$t=D.angularSlop;if(a)Ut=0,Jt=1;else{if(Kt.frequency>0){$t=0;var ti=6.28318530717958*Kt.frequency,ii=Kt.dampingRatio;ii<D.minSpringDamperDampingRatio&&(ii=D.minSpringDamperDampingRatio);var ai=i.dt,ni=2*ii*ti,oi=ti*ti;Kt.useSymplecticEuler?(Ut=1/(ai*ni),Jt=oi/ni):(Ut=1/(ai*(ai*oi+ni)),Jt=oi/(ai*oi+ni))}else Ut=0,Jt=this._positionCorrectionAlgorithm==bt.BAUMGARTE?i.invDt*D.velocityBaumgarte:0;Qt.motorTorque>0?(ct.motorSpeed=Qt.motorSpeed,ct.motorMaxImpulse=Qt.motorTorque*i.dt):(ct.motorSpeed=0,ct.motorMaxImpulse=0)}var si,ri,_i,ei=Qt.lowerLimit,hi=Qt.upperLimit,li=.5*(ei+hi);Ht=(((Ht-=li)+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,Ht+=li,ei>hi?(si=0,ri=0,_i=0):ei==hi?(si=-1/0,ri=1/0,_i=Ht-ei):Ht<ei?(si=-1/0,ri=0,(_i=Ht-ei+$t)>0&&(_i=0)):Ht>hi?(si=0,ri=1/0,(_i=Ht-hi-$t)<0&&(_i=0)):(si=0,ri=0,_i=0);var vi=0==et?0:1/et;ct.minImpulse=si,ct.maxImpulse=ri,ct.cfm=Ut*vi,ct.rhs=_i*Jt,(mt=ct.jacobian).ang1X=this._axisZX,mt.ang1Y=this._axisZY,mt.ang1Z=this._axisZZ,mt.ang2X=this._axisZX,mt.ang2Y=this._axisZY,mt.ang2Z=this._axisZZ}},_syncAnchors:function(){var t,i,a,n,o,s,r,_,e;It.prototype._syncAnchors.call(this),this._basisX1X,this._basisY1X,this._basisZ1X,this._basisX1Y,this._basisY1Y,this._basisZ1Y,this._basisX1Z,this._basisY1Z,this._basisZ1Z,this._basisX2X,this._basisY2X,this._basisZ2X,this._basisX2Y,this._basisY2Y,this._basisZ2Y,this._basisX2Z,this._basisY2Z,this._basisZ2Z,t=this._basisX1X,i=this._basisX1Y,a=this._basisX1Z,r=this._basisZ2X,n=(_=this._basisZ2Y)*a-(e=this._basisZ2Z)*i,o=e*t-r*a,s=r*i-_*t,this._axisXX=o*e-s*_,this._axisXY=s*r-n*e,this._axisXZ=n*_-o*r,this._axisYX=n,this._axisYY=o,this._axisYZ=s,this._axisZX=i*s-a*o,this._axisZY=a*n-t*s,this._axisZZ=t*o-i*n;var h=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;h>0&&(h=1/Math.sqrt(h)),this._axisXX*=h,this._axisXY*=h,this._axisXZ*=h;var l=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;l>0&&(l=1/Math.sqrt(l)),this._axisYX*=l,this._axisYY*=l,this._axisYZ*=l;var v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;C>0&&(C=1/Math.sqrt(C)),this._axisZX*=C,this._axisZY*=C,this._axisZZ*=C,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,v=this._basisX1X,c=this._basisY1X,m=this._basisZ1X,b=this._basisX1Y,f=this._basisY1Y,p=this._basisZ1Y,u=this._basisX1Z,x=this._basisY1Z,X=this._basisZ1Z,M=this._basisX2X,g=this._basisY2X,Y=this._basisZ2X,Z=this._basisX2Y,I=this._basisY2Y,y=this._basisZ2Y,z=v*M+b*Z+u*this._basisX2Z,w=v*g+b*I+u*(d=this._basisY2Z),B=c*g+f*I+x*d,A=c*Y+f*y+x*(L=this._basisZ2Z),P=m*g+p*I+X*d,T=m*Y+p*y+X*L;var q=v*Y+b*y+u*L;if(q<=-1){var R=Math.atan2(P,B);S=.5*R,V=-1.570796326794895,k=.5*-R}else if(q>=1){var j=Math.atan2(P,B);S=.5*j,V=1.570796326794895,k=.5*j}else{var O=Math.asin(q);S=Math.atan2(-A,T),V=O,k=Math.atan2(-w,z)}this._angleX=S,this._angleY=V,this._angleZ=k,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,i){It.prototype._getVelocitySolverInfo.call(this,t,i),this.getInfo(i,t,!1)},_getPositionSolverInfo:function(t){It.prototype._getPositionSolverInfo.call(this,t),this.getInfo(t,null,!0)},getAxis1:function(){var t=new E,i=t;return i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z,t},getAxis2:function(){var t=new E,i=t;return i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z,t},getAxis1To:function(t){var i=t;i.x=this._basisX1X,i.y=this._basisX1Y,i.z=this._basisX1Z},getAxis2To:function(t){var i=t;i.x=this._basisZ2X,i.y=this._basisZ2Y,i.z=this._basisZ2Z},getLocalAxis1:function(){var t=new E,i=t;return i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z,t},getLocalAxis2:function(){var t=new E,i=t;return i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z,t},getLocalAxis1To:function(t){var i=t;i.x=this._localBasisX1X,i.y=this._localBasisX1Y,i.z=this._localBasisX1Z},getLocalAxis2To:function(t){var i=t;i.x=this._localBasisZ2X,i.y=this._localBasisZ2Y,i.z=this._localBasisZ2Z},getSpringDamper1:function(){return this._sd1},getSpringDamper2:function(){return this._sd2},getLimitMotor1:function(){return this._lm1},getLimitMotor2:function(){return this._lm2},getAngle1:function(){return this._angleX},getAngle2:function(){return this._angleZ}});var Dt=function(){dt.call(this),this.localAxis1=new E(1,0,0),this.localAxis2=new E(1,0,0),this.springDamper1=new Ot,this.springDamper2=new Ot,this.limitMotor1=new qt,this.limitMotor2=new qt};Dt.__super__=dt,Dt.prototype=t(dt.prototype,{init:function(t,i,a,n,o){var s,r,_;this._init(t,i,a);var e,h,l,v=n;s=v.x,r=v.y,_=v.z,e=t._transform._rotation00*s+t._transform._rotation10*r+t._transform._rotation20*_,h=t._transform._rotation01*s+t._transform._rotation11*r+t._transform._rotation21*_,l=t._transform._rotation02*s+t._transform._rotation12*r+t._transform._rotation22*_,s=e,r=h,_=l;var c,m,b,f=this.localAxis1;f.x=s,f.y=r,f.z=_;var p,u,x,X=o;c=X.x,m=X.y,b=X.z,p=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,u=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,x=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=p,m=u,b=x;var M=this.localAxis2;return M.x=c,M.y=m,M.z=b,this}});var Nt=function(){},Wt=function(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0},Gt=function(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0},Ut=function(t){var i=new Array(t);this.iBounded=i;var a=new Array(t);this.iUnbounded=a;var n=new Array(t);this.signs=n;var o=new Array(t);this.b=o,this.numBounded=0,this.numUnbounded=0,this.matrixId=0};Ut.prototype={init:function(t){this.numBounded=t.numBounded;for(var i=0,a=this.numBounded;i<a;){var n=i++;this.iBounded[n]=t.iBounded[n],this.signs[n]=t.signs[n]}this.numUnbounded=t.numUnbounded,this.matrixId=0;for(var o=0,s=this.numUnbounded;o<s;){var r=o++,_=t.iUnbounded[r];this.iUnbounded[r]=_,this.matrixId|=1<<_}},computeImpulses:function(t,i,a,n,o,s,r){for(var _=0,e=this.numUnbounded;_<e;){var h=_++,l=this.iUnbounded[h],v=t.rows[l],c=a[l];this.b[l]=v.rhs*s-c-v.cfm*n[l]}for(var m=i._invMassWithoutCfm,b=0,f=this.numBounded;b<f;){var p=b++,u=this.iBounded[p],x=this.signs[p],X=t.rows[u],M=n[u],g=(x<0?X.minImpulse:x>0?X.maxImpulse:0)-M;if(o[u]=g,0!=g)for(var Y=0,Z=this.numUnbounded;Y<Z;){var I=Y++,y=this.iUnbounded[I],d=m[u][y]*g,L=y,z=this.b;z[L]=z[L]-d}}for(var w,B=this.iUnbounded,A=this.numUnbounded,P=0,T=0,S=A;T<S;){P|=1<<B[T++]}i._cacheComputed[P]?w=i._cachedSubmatrices[P]:(i.computeSubmatrix(P,B,A),i._cacheComputed[P]=!0,w=i._cachedSubmatrices[P]);for(var V=!0,k=0,C=this.numUnbounded;k<C;){for(var q=k++,R=this.iUnbounded[q],j=t.rows[R],O=n[R],E=O,F=0,N=this.numUnbounded;F<N;){var W=F++,G=this.iUnbounded[W];E+=this.b[G]*w[q][W]}if(E<j.minImpulse-D.directMlcpSolverEps||E>j.maxImpulse+D.directMlcpSolverEps){V=!1;break}o[R]=E-O}if(r)return!0;if(!V)return!1;for(var U=0,J=this.numBounded;U<J;){for(var H,Q=U++,K=this.iBounded[Q],$=t.rows[K],tt=this.signs[Q],it=n[K]+o[K],at=a[K],nt=0,ot=t.numRows;nt<ot;){var st=nt++;at+=m[K][st]*o[st]}if(H=$.rhs*s-at-$.cfm*it,tt<0&&H>D.directMlcpSolverEps||tt>0&&H<-D.directMlcpSolverEps){V=!1;break}}return V}};var Jt=function(t){this.maxRows=t,this.numBoundaries=0;var i=new Array(1<<t);this.boundaries=i,this.bbInfo=new function(t){this.size=t,this.numBounded=0;var i=new Array(t);this.iBounded=i;var a=new Array(t);this.signs=a,this.numUnbounded=0;var n=new Array(t);this.iUnbounded=n}(t)};Jt.prototype={buildBoundariesRecursive:function(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new Ut(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);var a=t.rows[i],n=a.minImpulse>-1/0,o=a.maxImpulse<1/0;if(0==a.minImpulse&&0==a.maxImpulse){var s=this.bbInfo;return s.iBounded[s.numBounded]=i,s.signs[s.numBounded]=0,s.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}var r=this.bbInfo;if(r.iUnbounded[r.numUnbounded]=i,r.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,n){var _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=-1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(o){var e=this.bbInfo;e.iBounded[e.numBounded]=i,e.signs[e.numBounded]=1,e.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}},buildBoundaries:function(t){this.numBoundaries=0;var i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};var Ht=function(t){this.n=t;var i=new Array(t);this.indices=i;var a=new Array(t);this.tmpIndices=a;for(var n=0,o=t;n<o;){var s=n++;this.indices[s]=s}};Ht.prototype={getIndex:function(t){return this.indices[t]},select:function(t){for(var i=0;this.indices[i]!=t;)++i;for(;i>0;){var a=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=a,--i}},setSize:function(t){for(var i=0,a=0,n=0,o=this.n;n<o;){var s=n++,r=this.indices[s];r<t?(this.tmpIndices[i]=r,++i):(this.tmpIndices[t+a]=r,++a)}var _=this.indices;this.indices=this.tmpIndices,this.tmpIndices=_}};var Qt=function(t){mt.call(this),this.joint=t,this.info=new Yt;var i=D.maxJacobianRows;this.massMatrix=new Kt(i),this.boundaryBuilder=new Jt(i);var a=new Array(i);this.massData=a;for(var n=0,o=this.massData.length;n<o;){var s=n++;this.massData[s]=new Gt}var r=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new Ht(r),this.posBoundarySelector=new Ht(r);var _=new Array(i);this.relVels=_;var e=new Array(i);this.impulses=e;var h=new Array(i);this.dImpulses=h;var l=new Array(i);this.dTotalImpulses=l;for(var v=0,c=i;v<c;){var m=v++;this.relVels[m]=0,this.impulses[m]=0,this.dImpulses[m]=0,this.dTotalImpulses[m]=0}};Qt.__super__=mt,Qt.prototype=t(mt.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.velBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,r=0,_=0,e=n.n;_<e;){var h=_++,l=n.indices[h];l<o?(n.tmpIndices[s]=l,++s):(n.tmpIndices[o+r]=l,++r)}var v=n.indices;n.indices=n.tmpIndices,n.tmpIndices=v},warmStart:function(t){var i=this.joint._positionCorrectionAlgorithm==bt.BAUMGARTE?D.jointWarmStartingFactorForBaungarte:D.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,n=this.info.numRows;a<n;){var o=a++,s=this.info.rows[o].impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}else{for(var r=0,_=this.info.numRows;r<_;){var e=r++,h=this.info.rows[e],l=h.impulse,v=l.impulse*i;if(v<h.minImpulse?v=h.minImpulse:v>h.maxImpulse&&(v=h.maxImpulse),l.impulse=v,h.motorMaxImpulse>0){var c=l.impulseM*i,m=h.motorMaxImpulse;c<-m?c=-m:c>m&&(c=m),l.impulseM=c}else l.impulseM=0;this.dImpulses[e]=l.impulse+l.impulseM}var b,f,p,u,x,X,M,g,Y,Z,I,y,d=this.dImpulses,L=!1,z=!1;b=this._b1._velX,f=this._b1._velY,p=this._b1._velZ,u=this._b2._velX,x=this._b2._velY,X=this._b2._velZ,M=this._b1._angVelX,g=this._b1._angVelY,Y=this._b1._angVelZ,Z=this._b2._angVelX,I=this._b2._angVelY,y=this._b2._angVelZ;for(var w=0,B=this.info.numRows;w<B;){var A=w++,P=this.info.rows[A].jacobian,T=this.massData[A],S=d[A];0!=(1&P.flag)&&(b+=T.invMLin1X*S,f+=T.invMLin1Y*S,p+=T.invMLin1Z*S,u+=T.invMLin2X*-S,x+=T.invMLin2Y*-S,X+=T.invMLin2Z*-S,L=!0),0!=(2&P.flag)&&(M+=T.invMAng1X*S,g+=T.invMAng1Y*S,Y+=T.invMAng1Z*S,Z+=T.invMAng2X*-S,I+=T.invMAng2Y*-S,y+=T.invMAng2Z*-S,z=!0)}L&&(this._b1._velX=b,this._b1._velY=f,this._b1._velZ=p,this._b2._velX=u,this._b2._velY=x,this._b2._velZ=X),z&&(this._b1._angVelX=M,this._b1._angVelY=g,this._b1._angVelZ=Y,this._b2._angVelX=Z,this._b2._angVelY=I,this._b2._angVelZ=y)}},solveVelocity:function(){var t,i,a,n,o,s,r,_,e,h,l,v,c=this.info.numRows;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,v=this._b2._angVelZ;for(var m=0,b=c;m<b;){var f=m++,p=this.info.rows[f],u=p.impulse,x=p.jacobian,X=0;X+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,X-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,X+=r*x.ang1X+_*x.ang1Y+e*x.ang1Z,X-=h*x.ang2X+l*x.ang2Y+v*x.ang2Z,this.relVels[f]=X,this.impulses[f]=u.impulse,this.dTotalImpulses[f]=0}for(var M=this.massMatrix._invMassWithoutCfm,g=0,Y=c;g<Y;){var Z=g++,I=this.info.rows[Z],y=I.impulse,d=this.massData[Z];if(I.motorMaxImpulse>0){var L=y.impulseM,z=L+d.massWithoutCfm*(-I.motorSpeed-this.relVels[Z]),w=y.impulseM;z<-w?z=-w:z>w&&(z=w),y.impulseM=z;var B=z-L;this.dTotalImpulses[Z]=B;for(var A=0,P=c;A<P;){var T=A++,S=T,V=this.relVels;V[S]=V[S]+B*M[Z][T]}}}for(var k=!1,C=0,q=this.boundaryBuilder.numBoundaries;C<q;){var R=C++,j=this.velBoundarySelector.indices[R];if(this.boundaryBuilder.boundaries[j].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){for(var O=0,E=c;O<E;){var F=O++,D=this.info.rows[F].impulse,N=this.dImpulses[F];D.impulse+=N;var W=F,G=this.dTotalImpulses;G[W]=G[W]+N}var U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt=this.dTotalImpulses,_t=!1,et=!1;U=this._b1._velX,J=this._b1._velY,H=this._b1._velZ,Q=this._b2._velX,K=this._b2._velY,$=this._b2._velZ,tt=this._b1._angVelX,it=this._b1._angVelY,at=this._b1._angVelZ,nt=this._b2._angVelX,ot=this._b2._angVelY,st=this._b2._angVelZ;for(var ht=0,lt=this.info.numRows;ht<lt;){var vt=ht++,ct=this.info.rows[vt].jacobian,mt=this.massData[vt],bt=rt[vt];0!=(1&ct.flag)&&(U+=mt.invMLin1X*bt,J+=mt.invMLin1Y*bt,H+=mt.invMLin1Z*bt,Q+=mt.invMLin2X*-bt,K+=mt.invMLin2Y*-bt,$+=mt.invMLin2Z*-bt,_t=!0),0!=(2&ct.flag)&&(tt+=mt.invMAng1X*bt,it+=mt.invMAng1Y*bt,at+=mt.invMAng1Z*bt,nt+=mt.invMAng2X*-bt,ot+=mt.invMAng2Y*-bt,st+=mt.invMAng2Z*-bt,et=!0)}_t&&(this._b1._velX=U,this._b1._velY=J,this._b1._velZ=H,this._b2._velX=Q,this._b2._velY=K,this._b2._velZ=$),et&&(this._b1._angVelX=tt,this._b1._angVelY=it,this._b1._angVelZ=at,this._b2._angVelX=nt,this._b2._angVelY=ot,this._b2._angVelZ=st);for(var ft=this.velBoundarySelector,pt=0;ft.indices[pt]!=j;)++pt;for(;pt>0;){var ut=ft.indices[pt];ft.indices[pt]=ft.indices[pt-1],ft.indices[pt-1]=ut,--pt}k=!0;break}}k||console.log("DirectJointConstraintSolver.hx:338:","could not find solution. (velocity)")},postSolveVelocity:function(t){var i,a,n,o,s,r;i=0,a=0,n=0,o=0,s=0,r=0;for(var _=0,e=this.info.numRows;_<e;){var h=_++,l=this.info.rows[h],v=l.impulse,c=l.jacobian;0!=(1&c.flag)?(i+=c.lin1X*v.impulse,a+=c.lin1Y*v.impulse,n+=c.lin1Z*v.impulse):0!=(2&c.flag)&&(o+=c.ang1X*v.impulse,s+=c.ang1Y*v.impulse,r+=c.ang1Z*v.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,r=0,_=0,e=n.n;_<e;){var h=_++,l=n.indices[h];l<o?(n.tmpIndices[s]=l,++s):(n.tmpIndices[o+r]=l,++r)}var v=n.indices;n.indices=n.tmpIndices,n.tmpIndices=v;for(var c=0,m=this.info.numRows;c<m;){var b=c++;this.info.rows[b].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,n,o,s,r,_,e,h,l,v,c=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,v=this._b2._angPseudoVelZ;for(var m=0,b=c;m<b;){var f=m++,p=this.info.rows[f],u=p.impulse,x=p.jacobian,X=0;X+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,X-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,X+=r*x.ang1X+_*x.ang1Y+e*x.ang1Z,X-=h*x.ang2X+l*x.ang2Y+v*x.ang2Z,this.relVels[f]=X,this.impulses[f]=u.impulseP}for(var M=!1,g=0,Y=this.boundaryBuilder.numBoundaries;g<Y;){var Z=g++,I=this.posBoundarySelector.indices[Z];if(this.boundaryBuilder.boundaries[I].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,D.positionSplitImpulseBaumgarte,!1)){for(var y=0,d=c;y<d;){var L=y++,z=this.info.rows[L].impulse,w=this.dImpulses[L];z.impulseP+=w}var B,A,P,T,S,V,k,C,q,R,j,O,E=this.dImpulses,F=!1,N=!1;B=this._b1._pseudoVelX,A=this._b1._pseudoVelY,P=this._b1._pseudoVelZ,T=this._b2._pseudoVelX,S=this._b2._pseudoVelY,V=this._b2._pseudoVelZ,k=this._b1._angPseudoVelX,C=this._b1._angPseudoVelY,q=this._b1._angPseudoVelZ,R=this._b2._angPseudoVelX,j=this._b2._angPseudoVelY,O=this._b2._angPseudoVelZ;for(var W=0,G=this.info.numRows;W<G;){var U=W++,J=this.info.rows[U].jacobian,H=this.massData[U],Q=E[U];0!=(1&J.flag)&&(B+=H.invMLin1X*Q,A+=H.invMLin1Y*Q,P+=H.invMLin1Z*Q,T+=H.invMLin2X*-Q,S+=H.invMLin2Y*-Q,V+=H.invMLin2Z*-Q,F=!0),0!=(2&J.flag)&&(k+=H.invMAng1X*Q,C+=H.invMAng1Y*Q,q+=H.invMAng1Z*Q,R+=H.invMAng2X*-Q,j+=H.invMAng2Y*-Q,O+=H.invMAng2Z*-Q,N=!0)}F&&(this._b1._pseudoVelX=B,this._b1._pseudoVelY=A,this._b1._pseudoVelZ=P,this._b2._pseudoVelX=T,this._b2._pseudoVelY=S,this._b2._pseudoVelZ=V),N&&(this._b1._angPseudoVelX=k,this._b1._angPseudoVelY=C,this._b1._angPseudoVelZ=q,this._b2._angPseudoVelX=R,this._b2._angPseudoVelY=j,this._b2._angPseudoVelZ=O);for(var K=this.posBoundarySelector,$=0;K.indices[$]!=I;)++$;for(;$>0;){var tt=K.indices[$];K.indices[$]=K.indices[$-1],K.indices[$-1]=tt,--$}M=!0;break}}M||console.log("DirectJointConstraintSolver.hx:454:","could not find solution. (split impulse)")},solvePositionNgs:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);var i=this.boundaryBuilder;i.numBoundaries=0;var a=i.bbInfo;a.numBounded=0,a.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);for(var n=this.posBoundarySelector,o=this.boundaryBuilder.numBoundaries,s=0,r=0,_=0,e=n.n;_<e;){var h=_++,l=n.indices[h];l<o?(n.tmpIndices[s]=l,++s):(n.tmpIndices[o+r]=l,++r)}var v=n.indices;n.indices=n.tmpIndices,n.tmpIndices=v;for(var c=this.info.numRows,m=0,b=c;m<b;){var f=m++,p=this.info.rows[f],u=p.impulse;p.jacobian;this.relVels[f]=0,this.impulses[f]=u.impulseP}for(var x=!1,X=0,M=this.boundaryBuilder.numBoundaries;X<M;){var g=X++,Y=this.posBoundarySelector.indices[g];if(this.boundaryBuilder.boundaries[Y].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,D.positionNgsBaumgarte,!1)){for(var Z=0,I=c;Z<I;){var y=Z++,d=this.info.rows[y].impulse,L=this.dImpulses[y];d.impulseP+=L}var z,w,B,A,P,T,S,V,k,C,q,R,j=this.dImpulses,O=!1,E=!1;z=0,w=0,B=0,A=0,P=0,T=0,S=0,V=0,k=0,C=0,q=0,R=0;for(var F=0,N=this.info.numRows;F<N;){var W=F++,G=this.info.rows[W].jacobian,U=this.massData[W],J=j[W];0!=(1&G.flag)&&(z+=U.invMLin1X*J,w+=U.invMLin1Y*J,B+=U.invMLin1Z*J,A+=U.invMLin2X*-J,P+=U.invMLin2Y*-J,T+=U.invMLin2Z*-J,O=!0),0!=(2&G.flag)&&(S+=U.invMAng1X*J,V+=U.invMAng1Y*J,k+=U.invMAng1Z*J,C+=U.invMAng2X*-J,q+=U.invMAng2Y*-J,R+=U.invMAng2Z*-J,E=!0)}if(O){var H=this._b1;H._transform._positionX+=z,H._transform._positionY+=w,H._transform._positionZ+=B;var Q=this._b2;Q._transform._positionX+=A,Q._transform._positionY+=P,Q._transform._positionZ+=T}if(E){var K,$,tt,it,at,nt,ot,st,rt,_t,et=this._b1,ht=Math.sqrt(S*S+V*V+k*k),lt=.5*ht;if(lt<.5){var vt=lt*lt;K=.5*(1-.16666666666666666*vt+vt*vt*.008333333333333333),$=1-.5*vt+vt*vt*.041666666666666664}else K=Math.sin(lt)/ht,$=Math.cos(lt);tt=S*K,it=V*K,at=k*K,nt=$;var ct,mt=et._transform._rotation00,bt=et._transform._rotation11,ft=et._transform._rotation22,pt=mt+bt+ft;pt>0?(_t=.5*(ct=Math.sqrt(pt+1)),ct=.5/ct,ot=(et._transform._rotation21-et._transform._rotation12)*ct,st=(et._transform._rotation02-et._transform._rotation20)*ct,rt=(et._transform._rotation10-et._transform._rotation01)*ct):mt>bt?mt>ft?(ot=.5*(ct=Math.sqrt(mt-bt-ft+1)),ct=.5/ct,st=(et._transform._rotation01+et._transform._rotation10)*ct,rt=(et._transform._rotation02+et._transform._rotation20)*ct,_t=(et._transform._rotation21-et._transform._rotation12)*ct):(rt=.5*(ct=Math.sqrt(ft-mt-bt+1)),ct=.5/ct,ot=(et._transform._rotation02+et._transform._rotation20)*ct,st=(et._transform._rotation12+et._transform._rotation21)*ct,_t=(et._transform._rotation10-et._transform._rotation01)*ct):bt>ft?(st=.5*(ct=Math.sqrt(bt-ft-mt+1)),ct=.5/ct,ot=(et._transform._rotation01+et._transform._rotation10)*ct,rt=(et._transform._rotation12+et._transform._rotation21)*ct,_t=(et._transform._rotation02-et._transform._rotation20)*ct):(rt=.5*(ct=Math.sqrt(ft-mt-bt+1)),ct=.5/ct,ot=(et._transform._rotation02+et._transform._rotation20)*ct,st=(et._transform._rotation12+et._transform._rotation21)*ct,_t=(et._transform._rotation10-et._transform._rotation01)*ct);var ut=(ot=nt*ot+tt*_t+it*rt-at*st)*ot+(st=nt*st-tt*rt+it*_t+at*ot)*st+(rt=nt*rt+tt*st-it*ot+at*_t)*rt+(_t=nt*_t-tt*ot-it*st-at*rt)*_t;ut>1e-32&&(ut=1/Math.sqrt(ut));ot*=ut,st*=ut,rt*=ut,_t*=ut;var xt,Xt,Mt,gt,Yt,Zt,It,yt,dt,Lt,zt,wt,Bt,At,Pt,Tt,St,Vt,kt=2*ot,Ct=2*st,qt=2*rt,Rt=ot*kt,jt=st*Ct,Ot=rt*qt,Et=ot*Ct,Ft=st*qt,Dt=ot*qt,Nt=_t*kt,Wt=_t*Ct,Gt=_t*qt;et._transform._rotation00=1-jt-Ot,et._transform._rotation01=Et-Gt,et._transform._rotation02=Dt+Wt,et._transform._rotation10=Et+Gt,et._transform._rotation11=1-Rt-Ot,et._transform._rotation12=Ft-Nt,et._transform._rotation20=Dt-Wt,et._transform._rotation21=Ft+Nt,et._transform._rotation22=1-Rt-jt,xt=et._transform._rotation00*et._invLocalInertia00+et._transform._rotation01*et._invLocalInertia10+et._transform._rotation02*et._invLocalInertia20,Xt=et._transform._rotation00*et._invLocalInertia01+et._transform._rotation01*et._invLocalInertia11+et._transform._rotation02*et._invLocalInertia21,Mt=et._transform._rotation00*et._invLocalInertia02+et._transform._rotation01*et._invLocalInertia12+et._transform._rotation02*et._invLocalInertia22,gt=et._transform._rotation10*et._invLocalInertia00+et._transform._rotation11*et._invLocalInertia10+et._transform._rotation12*et._invLocalInertia20,Yt=et._transform._rotation10*et._invLocalInertia01+et._transform._rotation11*et._invLocalInertia11+et._transform._rotation12*et._invLocalInertia21,Zt=et._transform._rotation10*et._invLocalInertia02+et._transform._rotation11*et._invLocalInertia12+et._transform._rotation12*et._invLocalInertia22,It=et._transform._rotation20*et._invLocalInertia00+et._transform._rotation21*et._invLocalInertia10+et._transform._rotation22*et._invLocalInertia20,yt=et._transform._rotation20*et._invLocalInertia01+et._transform._rotation21*et._invLocalInertia11+et._transform._rotation22*et._invLocalInertia21,dt=et._transform._rotation20*et._invLocalInertia02+et._transform._rotation21*et._invLocalInertia12+et._transform._rotation22*et._invLocalInertia22,et._invInertia00=xt,et._invInertia01=Xt,et._invInertia02=Mt,et._invInertia10=gt,et._invInertia11=Yt,et._invInertia12=Zt,et._invInertia20=It,et._invInertia21=yt,et._invInertia22=dt,Lt=et._invInertia00*et._transform._rotation00+et._invInertia01*et._transform._rotation01+et._invInertia02*et._transform._rotation02,zt=et._invInertia00*et._transform._rotation10+et._invInertia01*et._transform._rotation11+et._invInertia02*et._transform._rotation12,wt=et._invInertia00*et._transform._rotation20+et._invInertia01*et._transform._rotation21+et._invInertia02*et._transform._rotation22,Bt=et._invInertia10*et._transform._rotation00+et._invInertia11*et._transform._rotation01+et._invInertia12*et._transform._rotation02,At=et._invInertia10*et._transform._rotation10+et._invInertia11*et._transform._rotation11+et._invInertia12*et._transform._rotation12,Pt=et._invInertia10*et._transform._rotation20+et._invInertia11*et._transform._rotation21+et._invInertia12*et._transform._rotation22,Tt=et._invInertia20*et._transform._rotation00+et._invInertia21*et._transform._rotation01+et._invInertia22*et._transform._rotation02,St=et._invInertia20*et._transform._rotation10+et._invInertia21*et._transform._rotation11+et._invInertia22*et._transform._rotation12,Vt=et._invInertia20*et._transform._rotation20+et._invInertia21*et._transform._rotation21+et._invInertia22*et._transform._rotation22,et._invInertia00=Lt,et._invInertia01=zt,et._invInertia02=wt,et._invInertia10=Bt,et._invInertia11=At,et._invInertia12=Pt,et._invInertia20=Tt,et._invInertia21=St,et._invInertia22=Vt,et._invInertia00*=et._rotFactor.x,et._invInertia01*=et._rotFactor.x,et._invInertia02*=et._rotFactor.x,et._invInertia10*=et._rotFactor.y,et._invInertia11*=et._rotFactor.y,et._invInertia12*=et._rotFactor.y,et._invInertia20*=et._rotFactor.z,et._invInertia21*=et._rotFactor.z,et._invInertia22*=et._rotFactor.z;var Ut,Jt,Ht,Qt,Kt,$t,ti,ii,ai,ni,oi=this._b2,si=Math.sqrt(C*C+q*q+R*R),ri=.5*si;if(ri<.5){var _i=ri*ri;Ut=.5*(1-.16666666666666666*_i+_i*_i*.008333333333333333),Jt=1-.5*_i+_i*_i*.041666666666666664}else Ut=Math.sin(ri)/si,Jt=Math.cos(ri);Ht=C*Ut,Qt=q*Ut,Kt=R*Ut,$t=Jt;var ei,hi=oi._transform._rotation00,li=oi._transform._rotation11,vi=oi._transform._rotation22,ci=hi+li+vi;ci>0?(ni=.5*(ei=Math.sqrt(ci+1)),ei=.5/ei,ti=(oi._transform._rotation21-oi._transform._rotation12)*ei,ii=(oi._transform._rotation02-oi._transform._rotation20)*ei,ai=(oi._transform._rotation10-oi._transform._rotation01)*ei):hi>li?hi>vi?(ti=.5*(ei=Math.sqrt(hi-li-vi+1)),ei=.5/ei,ii=(oi._transform._rotation01+oi._transform._rotation10)*ei,ai=(oi._transform._rotation02+oi._transform._rotation20)*ei,ni=(oi._transform._rotation21-oi._transform._rotation12)*ei):(ai=.5*(ei=Math.sqrt(vi-hi-li+1)),ei=.5/ei,ti=(oi._transform._rotation02+oi._transform._rotation20)*ei,ii=(oi._transform._rotation12+oi._transform._rotation21)*ei,ni=(oi._transform._rotation10-oi._transform._rotation01)*ei):li>vi?(ii=.5*(ei=Math.sqrt(li-vi-hi+1)),ei=.5/ei,ti=(oi._transform._rotation01+oi._transform._rotation10)*ei,ai=(oi._transform._rotation12+oi._transform._rotation21)*ei,ni=(oi._transform._rotation02-oi._transform._rotation20)*ei):(ai=.5*(ei=Math.sqrt(vi-hi-li+1)),ei=.5/ei,ti=(oi._transform._rotation02+oi._transform._rotation20)*ei,ii=(oi._transform._rotation12+oi._transform._rotation21)*ei,ni=(oi._transform._rotation10-oi._transform._rotation01)*ei);var mi=(ti=$t*ti+Ht*ni+Qt*ai-Kt*ii)*ti+(ii=$t*ii-Ht*ai+Qt*ni+Kt*ti)*ii+(ai=$t*ai+Ht*ii-Qt*ti+Kt*ni)*ai+(ni=$t*ni-Ht*ti-Qt*ii-Kt*ai)*ni;mi>1e-32&&(mi=1/Math.sqrt(mi));ti*=mi,ii*=mi,ai*=mi,ni*=mi;var bi,fi,pi,ui,xi,Xi,Mi,gi,Yi,Zi,Ii,yi,di,Li,zi,wi,Bi,Ai,Pi=2*ti,Ti=2*ii,Si=2*ai,Vi=ti*Pi,ki=ii*Ti,Ci=ai*Si,qi=ti*Ti,Ri=ii*Si,ji=ti*Si,Oi=ni*Pi,Ei=ni*Ti,Fi=ni*Si;oi._transform._rotation00=1-ki-Ci,oi._transform._rotation01=qi-Fi,oi._transform._rotation02=ji+Ei,oi._transform._rotation10=qi+Fi,oi._transform._rotation11=1-Vi-Ci,oi._transform._rotation12=Ri-Oi,oi._transform._rotation20=ji-Ei,oi._transform._rotation21=Ri+Oi,oi._transform._rotation22=1-Vi-ki,bi=oi._transform._rotation00*oi._invLocalInertia00+oi._transform._rotation01*oi._invLocalInertia10+oi._transform._rotation02*oi._invLocalInertia20,fi=oi._transform._rotation00*oi._invLocalInertia01+oi._transform._rotation01*oi._invLocalInertia11+oi._transform._rotation02*oi._invLocalInertia21,pi=oi._transform._rotation00*oi._invLocalInertia02+oi._transform._rotation01*oi._invLocalInertia12+oi._transform._rotation02*oi._invLocalInertia22,ui=oi._transform._rotation10*oi._invLocalInertia00+oi._transform._rotation11*oi._invLocalInertia10+oi._transform._rotation12*oi._invLocalInertia20,xi=oi._transform._rotation10*oi._invLocalInertia01+oi._transform._rotation11*oi._invLocalInertia11+oi._transform._rotation12*oi._invLocalInertia21,Xi=oi._transform._rotation10*oi._invLocalInertia02+oi._transform._rotation11*oi._invLocalInertia12+oi._transform._rotation12*oi._invLocalInertia22,Mi=oi._transform._rotation20*oi._invLocalInertia00+oi._transform._rotation21*oi._invLocalInertia10+oi._transform._rotation22*oi._invLocalInertia20,gi=oi._transform._rotation20*oi._invLocalInertia01+oi._transform._rotation21*oi._invLocalInertia11+oi._transform._rotation22*oi._invLocalInertia21,Yi=oi._transform._rotation20*oi._invLocalInertia02+oi._transform._rotation21*oi._invLocalInertia12+oi._transform._rotation22*oi._invLocalInertia22,oi._invInertia00=bi,oi._invInertia01=fi,oi._invInertia02=pi,oi._invInertia10=ui,oi._invInertia11=xi,oi._invInertia12=Xi,oi._invInertia20=Mi,oi._invInertia21=gi,oi._invInertia22=Yi,Zi=oi._invInertia00*oi._transform._rotation00+oi._invInertia01*oi._transform._rotation01+oi._invInertia02*oi._transform._rotation02,Ii=oi._invInertia00*oi._transform._rotation10+oi._invInertia01*oi._transform._rotation11+oi._invInertia02*oi._transform._rotation12,yi=oi._invInertia00*oi._transform._rotation20+oi._invInertia01*oi._transform._rotation21+oi._invInertia02*oi._transform._rotation22,di=oi._invInertia10*oi._transform._rotation00+oi._invInertia11*oi._transform._rotation01+oi._invInertia12*oi._transform._rotation02,Li=oi._invInertia10*oi._transform._rotation10+oi._invInertia11*oi._transform._rotation11+oi._invInertia12*oi._transform._rotation12,zi=oi._invInertia10*oi._transform._rotation20+oi._invInertia11*oi._transform._rotation21+oi._invInertia12*oi._transform._rotation22,wi=oi._invInertia20*oi._transform._rotation00+oi._invInertia21*oi._transform._rotation01+oi._invInertia22*oi._transform._rotation02,Bi=oi._invInertia20*oi._transform._rotation10+oi._invInertia21*oi._transform._rotation11+oi._invInertia22*oi._transform._rotation12,Ai=oi._invInertia20*oi._transform._rotation20+oi._invInertia21*oi._transform._rotation21+oi._invInertia22*oi._transform._rotation22,oi._invInertia00=Zi,oi._invInertia01=Ii,oi._invInertia02=yi,oi._invInertia10=di,oi._invInertia11=Li,oi._invInertia12=zi,oi._invInertia20=wi,oi._invInertia21=Bi,oi._invInertia22=Ai,oi._invInertia00*=oi._rotFactor.x,oi._invInertia01*=oi._rotFactor.x,oi._invInertia02*=oi._rotFactor.x,oi._invInertia10*=oi._rotFactor.y,oi._invInertia11*=oi._rotFactor.y,oi._invInertia12*=oi._rotFactor.y,oi._invInertia20*=oi._rotFactor.z,oi._invInertia21*=oi._rotFactor.z,oi._invInertia22*=oi._rotFactor.z}for(var Di=this.posBoundarySelector,Ni=0;Di.indices[Ni]!=Y;)++Ni;for(;Ni>0;){var Wi=Di.indices[Ni];Di.indices[Ni]=Di.indices[Ni-1],Di.indices[Ni-1]=Wi,--Ni}x=!0;break}}x||console.log("DirectJointConstraintSolver.hx:506:","could not find solution. (NGS)")},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var Kt=function(t){this._size=t;var i=this._size,a=new Array(i);this.tmpMatrix=a;var n=this._size,o=new Array(n);this._invMass=o;var s=this._size,r=new Array(s);this._invMassWithoutCfm=r;for(var _=0,e=this._size;_<e;){var h=_++,l=this.tmpMatrix,v=this._size,c=new Array(v);l[h]=c;var m=this._invMass,b=this._size,f=new Array(b);m[h]=f;var p=this._invMassWithoutCfm,u=this._size,x=new Array(u);p[h]=x;for(var X=0,M=this._size;X<M;){var g=X++;this.tmpMatrix[h][g]=0,this._invMass[h][g]=0,this._invMassWithoutCfm[h][g]=0}}this._maxSubmatrixId=1<<this._size;var Y=this._maxSubmatrixId,Z=new Array(Y);this._cacheComputed=Z;var I=this._maxSubmatrixId,y=new Array(I);this._cachedSubmatrices=y;for(var d=0,L=this._maxSubmatrixId;d<L;){for(var z=d++,w=z,B=w=(15&(w=(51&(w=(85&w)+(w>>1&85)))+(w>>2&51)))+(w>>4&15),A=new Array(B),P=0,T=B;P<T;){var S=P++,V=new Array(B);A[S]=V;for(var k=0,C=B;k<C;){var q=k++;A[S][q]=0}}this._cacheComputed[z]=!1,this._cachedSubmatrices[z]=A}};Kt.prototype={computeSubmatrix:function(t,i,a){for(var n=0,o=a;n<o;)for(var s=n++,r=i[s],_=0,e=a;_<e;){var h=_++;this.tmpMatrix[s][h]=this._invMass[r][i[h]]}var l,v,c,m,b,f=this.tmpMatrix,p=this._cachedSubmatrices[t];switch(a){case 4:l=f[0],v=p[0],b=1/l[0],v[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,c=f[1],(m=p[1])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c=f[2],(m=p[2])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c=f[3],(m=p[3])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],l=f[1],v=p[1],b=1/l[1],v[1]=b,v[0]=v[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],l=f[2],v=p[2],b=1/l[2],v[2]=b,v[0]=v[0]*b,v[1]=v[1]*b,l[3]=l[3]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[2],c[3]=c[3]-l[3]*c[2],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],c[3]=c[3]-l[3]*c[2],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],l=f[3],v=p[3],b=1/l[3],v[3]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[3],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],v=p[1],p[0][1]=v[0],v=p[2],p[0][2]=v[0],p[1][2]=v[1],v=p[3],p[0][3]=v[0],p[1][3]=v[1],p[2][3]=v[2];break;case 5:l=f[0],v=p[0],b=1/l[0],v[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,c=f[1],(m=p[1])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c=f[2],(m=p[2])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c=f[3],(m=p[3])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c=f[4],(m=p[4])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],l=f[1],v=p[1],b=1/l[1],v[1]=b,v[0]=v[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],l=f[2],v=p[2],b=1/l[2],v[2]=b,v[0]=v[0]*b,v[1]=v[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],l=f[3],v=p[3],b=1/l[3],v[3]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,l[4]=l[4]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[3],c[4]=c[4]-l[4]*c[3],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],c[4]=c[4]-l[4]*c[3],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],c[4]=c[4]-l[4]*c[3],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],m[3]=-b*c[3],c[4]=c[4]-l[4]*c[3],l=f[4],v=p[4],b=1/l[4],v[4]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,v[3]=v[3]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[4],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],m[2]=m[2]-v[2]*c[4],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],m[2]=m[2]-v[2]*c[4],m[3]=m[3]-v[3]*c[4],v=p[1],p[0][1]=v[0],v=p[2],p[0][2]=v[0],p[1][2]=v[1],v=p[3],p[0][3]=v[0],p[1][3]=v[1],p[2][3]=v[2],v=p[4],p[0][4]=v[0],p[1][4]=v[1],p[2][4]=v[2],p[3][4]=v[3];break;case 6:l=f[0],v=p[0],b=1/l[0],v[0]=b,l[1]=l[1]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,c=f[1],(m=p[1])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c[5]=c[5]-l[5]*c[0],c=f[2],(m=p[2])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c[5]=c[5]-l[5]*c[0],c=f[3],(m=p[3])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c[5]=c[5]-l[5]*c[0],c=f[4],(m=p[4])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c[5]=c[5]-l[5]*c[0],c=f[5],(m=p[5])[0]=-b*c[0],c[1]=c[1]-l[1]*c[0],c[2]=c[2]-l[2]*c[0],c[3]=c[3]-l[3]*c[0],c[4]=c[4]-l[4]*c[0],c[5]=c[5]-l[5]*c[0],l=f[1],v=p[1],b=1/l[1],v[1]=b,v[0]=v[0]*b,l[2]=l[2]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c[5]=c[5]-l[5]*c[1],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c[5]=c[5]-l[5]*c[1],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c[5]=c[5]-l[5]*c[1],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c[5]=c[5]-l[5]*c[1],c=f[5],(m=p[5])[0]=m[0]-v[0]*c[1],m[1]=-b*c[1],c[2]=c[2]-l[2]*c[1],c[3]=c[3]-l[3]*c[1],c[4]=c[4]-l[4]*c[1],c[5]=c[5]-l[5]*c[1],l=f[2],v=p[2],b=1/l[2],v[2]=b,v[0]=v[0]*b,v[1]=v[1]*b,l[3]=l[3]*b,l[4]=l[4]*b,l[5]=l[5]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c[5]=c[5]-l[5]*c[2],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c[5]=c[5]-l[5]*c[2],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c[5]=c[5]-l[5]*c[2],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c[5]=c[5]-l[5]*c[2],c=f[5],(m=p[5])[0]=m[0]-v[0]*c[2],m[1]=m[1]-v[1]*c[2],m[2]=-b*c[2],c[3]=c[3]-l[3]*c[2],c[4]=c[4]-l[4]*c[2],c[5]=c[5]-l[5]*c[2],l=f[3],v=p[3],b=1/l[3],v[3]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,l[4]=l[4]*b,l[5]=l[5]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[3],c[4]=c[4]-l[4]*c[3],c[5]=c[5]-l[5]*c[3],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],c[4]=c[4]-l[4]*c[3],c[5]=c[5]-l[5]*c[3],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],c[4]=c[4]-l[4]*c[3],c[5]=c[5]-l[5]*c[3],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],m[3]=-b*c[3],c[4]=c[4]-l[4]*c[3],c[5]=c[5]-l[5]*c[3],c=f[5],(m=p[5])[0]=m[0]-v[0]*c[3],m[1]=m[1]-v[1]*c[3],m[2]=m[2]-v[2]*c[3],m[3]=-b*c[3],c[4]=c[4]-l[4]*c[3],c[5]=c[5]-l[5]*c[3],l=f[4],v=p[4],b=1/l[4],v[4]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,v[3]=v[3]*b,l[5]=l[5]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[4],c[5]=c[5]-l[5]*c[4],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],c[5]=c[5]-l[5]*c[4],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],m[2]=m[2]-v[2]*c[4],c[5]=c[5]-l[5]*c[4],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],m[2]=m[2]-v[2]*c[4],m[3]=m[3]-v[3]*c[4],c[5]=c[5]-l[5]*c[4],c=f[5],(m=p[5])[0]=m[0]-v[0]*c[4],m[1]=m[1]-v[1]*c[4],m[2]=m[2]-v[2]*c[4],m[3]=m[3]-v[3]*c[4],m[4]=-b*c[4],c[5]=c[5]-l[5]*c[4],l=f[5],v=p[5],b=1/l[5],v[5]=b,v[0]=v[0]*b,v[1]=v[1]*b,v[2]=v[2]*b,v[3]=v[3]*b,v[4]=v[4]*b,c=f[0],(m=p[0])[0]=m[0]-v[0]*c[5],c=f[1],(m=p[1])[0]=m[0]-v[0]*c[5],m[1]=m[1]-v[1]*c[5],c=f[2],(m=p[2])[0]=m[0]-v[0]*c[5],m[1]=m[1]-v[1]*c[5],m[2]=m[2]-v[2]*c[5],c=f[3],(m=p[3])[0]=m[0]-v[0]*c[5],m[1]=m[1]-v[1]*c[5],m[2]=m[2]-v[2]*c[5],m[3]=m[3]-v[3]*c[5],c=f[4],(m=p[4])[0]=m[0]-v[0]*c[5],m[1]=m[1]-v[1]*c[5],m[2]=m[2]-v[2]*c[5],m[3]=m[3]-v[3]*c[5],m[4]=m[4]-v[4]*c[5],v=p[1],p[0][1]=v[0],v=p[2],p[0][2]=v[0],p[1][2]=v[1],v=p[3],p[0][3]=v[0],p[1][3]=v[1],p[2][3]=v[2],v=p[4],p[0][4]=v[0],p[1][4]=v[1],p[2][4]=v[2],p[3][4]=v[3],v=p[5],p[0][5]=v[0],p[1][5]=v[1],p[2][5]=v[2],p[3][5]=v[3],p[4][5]=v[4];break;default:for(var u=0,x=a;u<x;){var X=u++;l=f[X],v=p[X];var M=1/l[X];v[X]=M;for(var g=0,Y=X;g<Y;){var Z=g++;v[Z]=v[Z]*M}for(var I=X+1,y=a;I<y;){var d=I++;l[d]=l[d]*M}for(var L=0,z=X;L<z;){var w=L++;c=f[w],m=p[w];for(var B=0,A=w+1;B<A;){var P=B++;m[P]=m[P]-v[P]*c[X]}for(var T=X+1,S=a;T<S;){var V=T++;c[V]=c[V]-l[V]*c[X]}}for(var k=X+1,C=a;k<C;){var q=k++;c=f[q],m=p[q];for(var R=0,j=X;R<j;){var O=R++;m[O]=m[O]-v[O]*c[X]}m[X]=-M*c[X];for(var E=X+1,F=a;E<F;){var D=E++;c[D]=c[D]-l[D]*c[X]}}}for(var N=1,W=a;N<W;){var G=N++;v=p[G];for(var U=0,J=G;U<J;){var H=U++;p[H][G]=v[H]}}}},computeInvMass:function(t,i){var a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M=this._invMass,g=this._invMassWithoutCfm,Y=t.numRows,Z=t.b1,I=t.b2,y=Z._invMass,d=I._invMass;a=Z._invInertia00,n=Z._invInertia01,o=Z._invInertia02,s=Z._invInertia10,r=Z._invInertia11,_=Z._invInertia12,e=Z._invInertia20,h=Z._invInertia21,l=Z._invInertia22,v=I._invInertia00,c=I._invInertia01,m=I._invInertia02,b=I._invInertia10,f=I._invInertia11,p=I._invInertia12,u=I._invInertia20,x=I._invInertia21,X=I._invInertia22;for(var L=0,z=Y;L<z;){var w,B,A,P,T,S,V=L++,k=t.rows[V].jacobian,C=i[V];if(k.updateSparsity(),0!=(1&k.flag)?(C.invMLin1X=k.lin1X*y,C.invMLin1Y=k.lin1Y*y,C.invMLin1Z=k.lin1Z*y,C.invMLin2X=k.lin2X*d,C.invMLin2Y=k.lin2Y*d,C.invMLin2Z=k.lin2Z*d):(C.invMLin1X=0,C.invMLin1Y=0,C.invMLin1Z=0,C.invMLin2X=0,C.invMLin2Y=0,C.invMLin2Z=0),0!=(2&k.flag))w=a*k.ang1X+n*k.ang1Y+o*k.ang1Z,B=s*k.ang1X+r*k.ang1Y+_*k.ang1Z,A=e*k.ang1X+h*k.ang1Y+l*k.ang1Z,C.invMAng1X=w,C.invMAng1Y=B,C.invMAng1Z=A,P=v*k.ang2X+c*k.ang2Y+m*k.ang2Z,T=b*k.ang2X+f*k.ang2Y+p*k.ang2Z,S=u*k.ang2X+x*k.ang2Y+X*k.ang2Z,C.invMAng2X=P,C.invMAng2Y=T,C.invMAng2Z=S;else C.invMAng1X=0,C.invMAng1Y=0,C.invMAng1Z=0,C.invMAng2X=0,C.invMAng2Y=0,C.invMAng2Z=0}for(var q=0,R=Y;q<R;)for(var j=q++,O=t.rows[j].jacobian,E=j,F=Y;E<F;){var D=E++,N=(t.rows[D].jacobian,i[D]),W=O.lin1X*N.invMLin1X+O.lin1Y*N.invMLin1Y+O.lin1Z*N.invMLin1Z+(O.ang1X*N.invMAng1X+O.ang1Y*N.invMAng1Y+O.ang1Z*N.invMAng1Z)+(O.lin2X*N.invMLin2X+O.lin2Y*N.invMLin2Y+O.lin2Z*N.invMLin2Z)+(O.ang2X*N.invMAng2X+O.ang2Y*N.invMAng2Y+O.ang2Z*N.invMAng2Z);j==D?(M[j][D]=W+t.rows[j].cfm,g[j][D]=W,N.mass=W+t.rows[j].cfm,N.massWithoutCfm=W,0!=N.mass&&(N.mass=1/N.mass),0!=N.massWithoutCfm&&(N.massWithoutCfm=1/N.massWithoutCfm)):(M[j][D]=W,M[D][j]=W,g[j][D]=W,g[D][j]=W)}for(var G=0,U=this._maxSubmatrixId;G<U;){var J=G++;this._cacheComputed[J]=!1}}};var $t=function(t){mt.call(this),this.constraint=t,this.info=new function(){this.b1=null,this.b2=null,this.numRows=0;var t=D.maxManifoldPoints,i=new Array(t);this.rows=i;for(var a=0,n=this.rows.length;a<n;){var o=a++;this.rows[o]=new gt}};var i=D.maxManifoldPoints,a=new Array(i);this.massData=a;for(var n=0,o=this.massData.length;n<o;){var s=n++;this.massData[s]=new Wt}};$t.__super__=mt,$t.prototype=t(mt.prototype,{preSolveVelocity:function(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,Y=this.info.numRows;g<Y;){var Z,I,y,d,L,z,w=g++,B=this.info.rows[w],A=this.massData[w],P=B.jacobianN;A.invMLinN1X=P.lin1X*X,A.invMLinN1Y=P.lin1Y*X,A.invMLinN1Z=P.lin1Z*X,A.invMLinN2X=P.lin2X*M,A.invMLinN2Y=P.lin2Y*M,A.invMLinN2Z=P.lin2Z*M,Z=i*P.ang1X+a*P.ang1Y+n*P.ang1Z,I=o*P.ang1X+s*P.ang1Y+r*P.ang1Z,y=_*P.ang1X+e*P.ang1Y+h*P.ang1Z,A.invMAngN1X=Z,A.invMAngN1Y=I,A.invMAngN1Z=y,d=l*P.ang2X+v*P.ang2Y+c*P.ang2Z,L=m*P.ang2X+b*P.ang2Y+f*P.ang2Z,z=p*P.ang2X+u*P.ang2Y+x*P.ang2Z,A.invMAngN2X=d,A.invMAngN2Y=L,A.invMAngN2Z=z,A.massN=X+M+(A.invMAngN1X*P.ang1X+A.invMAngN1Y*P.ang1Y+A.invMAngN1Z*P.ang1Z)+(A.invMAngN2X*P.ang2X+A.invMAngN2Y*P.ang2Y+A.invMAngN2Z*P.ang2Z),0!=A.massN&&(A.massN=1/A.massN);var T,S,V,k,C,q,R,j,O,E,F,D,N=B.jacobianT,W=B.jacobianB;A.invMLinT1X=N.lin1X*X,A.invMLinT1Y=N.lin1Y*X,A.invMLinT1Z=N.lin1Z*X,A.invMLinT2X=N.lin2X*M,A.invMLinT2Y=N.lin2Y*M,A.invMLinT2Z=N.lin2Z*M,A.invMLinB1X=W.lin1X*X,A.invMLinB1Y=W.lin1Y*X,A.invMLinB1Z=W.lin1Z*X,A.invMLinB2X=W.lin2X*M,A.invMLinB2Y=W.lin2Y*M,A.invMLinB2Z=W.lin2Z*M,T=i*N.ang1X+a*N.ang1Y+n*N.ang1Z,S=o*N.ang1X+s*N.ang1Y+r*N.ang1Z,V=_*N.ang1X+e*N.ang1Y+h*N.ang1Z,A.invMAngT1X=T,A.invMAngT1Y=S,A.invMAngT1Z=V,k=l*N.ang2X+v*N.ang2Y+c*N.ang2Z,C=m*N.ang2X+b*N.ang2Y+f*N.ang2Z,q=p*N.ang2X+u*N.ang2Y+x*N.ang2Z,A.invMAngT2X=k,A.invMAngT2Y=C,A.invMAngT2Z=q,R=i*W.ang1X+a*W.ang1Y+n*W.ang1Z,j=o*W.ang1X+s*W.ang1Y+r*W.ang1Z,O=_*W.ang1X+e*W.ang1Y+h*W.ang1Z,A.invMAngB1X=R,A.invMAngB1Y=j,A.invMAngB1Z=O,E=l*W.ang2X+v*W.ang2Y+c*W.ang2Z,F=m*W.ang2X+b*W.ang2Y+f*W.ang2Z,D=p*W.ang2X+u*W.ang2Y+x*W.ang2Z,A.invMAngB2X=E,A.invMAngB2Y=F,A.invMAngB2Z=D;var G=X+M+(A.invMAngT1X*N.ang1X+A.invMAngT1Y*N.ang1Y+A.invMAngT1Z*N.ang1Z)+(A.invMAngT2X*N.ang2X+A.invMAngT2Y*N.ang2Y+A.invMAngT2Z*N.ang2Z),U=A.invMAngT1X*W.ang1X+A.invMAngT1Y*W.ang1Y+A.invMAngT1Z*W.ang1Z+(A.invMAngT2X*W.ang2X+A.invMAngT2Y*W.ang2Y+A.invMAngT2Z*W.ang2Z),J=U,H=X+M+(A.invMAngB1X*W.ang1X+A.invMAngB1Y*W.ang1Y+A.invMAngB1Z*W.ang1Z)+(A.invMAngB2X*W.ang2X+A.invMAngB2Y*W.ang2Y+A.invMAngB2Z*W.ang2Z),Q=G*H-U*J;0!=Q&&(Q=1/Q),A.massTB00=H*Q,A.massTB01=-U*Q,A.massTB10=-J*Q,A.massTB11=G*Q}},warmStart:function(t){var i,a,n,o,s,r,_,e,h,l,v,c;i=this._b1._velX,a=this._b1._velY,n=this._b1._velZ,o=this._b2._velX,s=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,e=this._b1._angVelY,h=this._b1._angVelZ,l=this._b2._angVelX,v=this._b2._angVelY,c=this._b2._angVelZ;for(var m=0,b=this.info.numRows;m<b;){var f=m++,p=this.info.rows[f],u=p.impulse,x=this.massData[f],X=p.jacobianT,M=p.jacobianB,g=u.impulseN,Y=u.impulseLX*X.lin1X+u.impulseLY*X.lin1Y+u.impulseLZ*X.lin1Z,Z=u.impulseLX*M.lin1X+u.impulseLY*M.lin1Y+u.impulseLZ*M.lin1Z;u.impulseT=Y,u.impulseB=Z,u.impulseN*=t.dtRatio,u.impulseT*=t.dtRatio,u.impulseB*=t.dtRatio,i+=x.invMLinN1X*g,a+=x.invMLinN1Y*g,n+=x.invMLinN1Z*g,i+=x.invMLinT1X*Y,a+=x.invMLinT1Y*Y,n+=x.invMLinT1Z*Y,i+=x.invMLinB1X*Z,a+=x.invMLinB1Y*Z,n+=x.invMLinB1Z*Z,o+=x.invMLinN2X*-g,s+=x.invMLinN2Y*-g,r+=x.invMLinN2Z*-g,o+=x.invMLinT2X*-Y,s+=x.invMLinT2Y*-Y,r+=x.invMLinT2Z*-Y,o+=x.invMLinB2X*-Z,s+=x.invMLinB2Y*-Z,r+=x.invMLinB2Z*-Z,_+=x.invMAngN1X*g,e+=x.invMAngN1Y*g,h+=x.invMAngN1Z*g,_+=x.invMAngT1X*Y,e+=x.invMAngT1Y*Y,h+=x.invMAngT1Z*Y,_+=x.invMAngB1X*Z,e+=x.invMAngB1Y*Z,h+=x.invMAngB1Z*Z,l+=x.invMAngN2X*-g,v+=x.invMAngN2Y*-g,c+=x.invMAngN2Z*-g,l+=x.invMAngT2X*-Y,v+=x.invMAngT2Y*-Y,c+=x.invMAngT2Z*-Y,l+=x.invMAngB2X*-Z,v+=x.invMAngB2Y*-Z,c+=x.invMAngB2Z*-Z}this._b1._velX=i,this._b1._velY=a,this._b1._velZ=n,this._b2._velX=o,this._b2._velY=s,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=e,this._b1._angVelZ=h,this._b2._angVelX=l,this._b2._angVelY=v,this._b2._angVelZ=c},solveVelocity:function(){var t,i,a,n,o,s,r,_,e,h,l,v;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,v=this._b2._angVelZ;for(var c=0,m=this.info.numRows;c<m;){var b=c++,f=this.info.rows[b],p=this.massData[b],u=f.impulse,x=0,X=f.jacobianT;x+=t*X.lin1X+i*X.lin1Y+a*X.lin1Z,x-=n*X.lin2X+o*X.lin2Y+s*X.lin2Z,x+=r*X.ang1X+_*X.ang1Y+e*X.ang1Z,x-=h*X.ang2X+l*X.ang2Y+v*X.ang2Z;var M=0;M+=t*(X=f.jacobianB).lin1X+i*X.lin1Y+a*X.lin1Z,M-=n*X.lin2X+o*X.lin2Y+s*X.lin2Z,M+=r*X.ang1X+_*X.ang1Y+e*X.ang1Z,M-=h*X.ang2X+l*X.ang2Y+v*X.ang2Z;var g=-(x*p.massTB00+M*p.massTB01),Y=-(x*p.massTB10+M*p.massTB11),Z=u.impulseT,I=u.impulseB;u.impulseT+=g,u.impulseB+=Y;var y=f.friction*u.impulseN;if(0==y)u.impulseT=0,u.impulseB=0;else{var d=u.impulseT*u.impulseT+u.impulseB*u.impulseB;if(d>y*y){var L=y/Math.sqrt(d);u.impulseT*=L,u.impulseB*=L}}g=u.impulseT-Z,Y=u.impulseB-I,t+=p.invMLinT1X*g,i+=p.invMLinT1Y*g,a+=p.invMLinT1Z*g,t+=p.invMLinB1X*Y,i+=p.invMLinB1Y*Y,a+=p.invMLinB1Z*Y,n+=p.invMLinT2X*-g,o+=p.invMLinT2Y*-g,s+=p.invMLinT2Z*-g,n+=p.invMLinB2X*-Y,o+=p.invMLinB2Y*-Y,s+=p.invMLinB2Z*-Y,r+=p.invMAngT1X*g,_+=p.invMAngT1Y*g,e+=p.invMAngT1Z*g,r+=p.invMAngB1X*Y,_+=p.invMAngB1Y*Y,e+=p.invMAngB1Z*Y,h+=p.invMAngT2X*-g,l+=p.invMAngT2Y*-g,v+=p.invMAngT2Z*-g,h+=p.invMAngB2X*-Y,l+=p.invMAngB2Y*-Y,v+=p.invMAngB2Z*-Y}for(var z=0,w=this.info.numRows;z<w;){var B=z++,A=this.info.rows[B],P=this.massData[B],T=A.impulse,S=0,V=A.jacobianN;S+=t*V.lin1X+i*V.lin1Y+a*V.lin1Z,S-=n*V.lin2X+o*V.lin2Y+s*V.lin2Z,S+=r*V.ang1X+_*V.ang1Y+e*V.ang1Z,S-=h*V.ang2X+l*V.ang2Y+v*V.ang2Z;var k=(A.rhs-S)*P.massN,C=T.impulseN;T.impulseN+=k,T.impulseN<0&&(T.impulseN=0),k=T.impulseN-C,t+=P.invMLinN1X*k,i+=P.invMLinN1Y*k,a+=P.invMLinN1Z*k,n+=P.invMLinN2X*-k,o+=P.invMLinN2Y*-k,s+=P.invMLinN2Z*-k,r+=P.invMAngN1X*k,_+=P.invMAngN1Y*k,e+=P.invMAngN1Z*k,h+=P.invMAngN2X*-k,l+=P.invMAngN2Y*-k,v+=P.invMAngN2Z*-k}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=n,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=e,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=v},preSolvePosition:function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,Y=this.info.numRows;g<Y;){var Z,I,y,d,L,z,w=g++,B=this.info.rows[w],A=this.massData[w],P=B.jacobianN;A.invMLinN1X=P.lin1X*X,A.invMLinN1Y=P.lin1Y*X,A.invMLinN1Z=P.lin1Z*X,A.invMLinN2X=P.lin2X*M,A.invMLinN2Y=P.lin2Y*M,A.invMLinN2Z=P.lin2Z*M,Z=i*P.ang1X+a*P.ang1Y+n*P.ang1Z,I=o*P.ang1X+s*P.ang1Y+r*P.ang1Z,y=_*P.ang1X+e*P.ang1Y+h*P.ang1Z,A.invMAngN1X=Z,A.invMAngN1Y=I,A.invMAngN1Z=y,d=l*P.ang2X+v*P.ang2Y+c*P.ang2Z,L=m*P.ang2X+b*P.ang2Y+f*P.ang2Z,z=p*P.ang2X+u*P.ang2Y+x*P.ang2Z,A.invMAngN2X=d,A.invMAngN2Y=L,A.invMAngN2Z=z,A.massN=X+M+(A.invMAngN1X*P.ang1X+A.invMAngN1Y*P.ang1Y+A.invMAngN1Z*P.ang1Z)+(A.invMAngN2X*P.ang2X+A.invMAngN2Y*P.ang2Y+A.invMAngN2Z*P.ang2Z),0!=A.massN&&(A.massN=1/A.massN)}for(var T=0,S=this.info.numRows;T<S;){var V=T++;this.info.rows[V].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,n,o,s,r,_,e,h,l,v;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,v=this._b2._angPseudoVelZ;for(var c=0,m=this.info.numRows;c<m;){var b=c++,f=this.info.rows[b],p=this.massData[b],u=f.impulse,x=f.jacobianN,X=0;X+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,X-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,X+=r*x.ang1X+_*x.ang1Y+e*x.ang1Z,X-=h*x.ang2X+l*x.ang2Y+v*x.ang2Z;var M=(f.rhs-X)*p.massN*D.positionSplitImpulseBaumgarte,g=u.impulseP;u.impulseP+=M,u.impulseP<0&&(u.impulseP=0),M=u.impulseP-g,t+=p.invMLinN1X*M,i+=p.invMLinN1Y*M,a+=p.invMLinN1Z*M,n+=p.invMLinN2X*-M,o+=p.invMLinN2Y*-M,s+=p.invMLinN2Z*-M,r+=p.invMAngN1X*M,_+=p.invMAngN1Y*M,e+=p.invMAngN1Z*M,h+=p.invMAngN2X*-M,l+=p.invMAngN2Y*-M,v+=p.invMAngN2Z*-M}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=n,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=v},solvePositionNgs:function(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g,Y,Z,I,y,d,L,z,w,B,A,P,T=0,S=this.info.numRows;T<S;){var V,k,C,q,R,j,O=T++,E=this.info.rows[O],F=this.massData[O],N=E.jacobianN;F.invMLinN1X=N.lin1X*X,F.invMLinN1Y=N.lin1Y*X,F.invMLinN1Z=N.lin1Z*X,F.invMLinN2X=N.lin2X*M,F.invMLinN2Y=N.lin2Y*M,F.invMLinN2Z=N.lin2Z*M,V=i*N.ang1X+a*N.ang1Y+n*N.ang1Z,k=o*N.ang1X+s*N.ang1Y+r*N.ang1Z,C=_*N.ang1X+e*N.ang1Y+h*N.ang1Z,F.invMAngN1X=V,F.invMAngN1Y=k,F.invMAngN1Z=C,q=l*N.ang2X+v*N.ang2Y+c*N.ang2Z,R=m*N.ang2X+b*N.ang2Y+f*N.ang2Z,j=p*N.ang2X+u*N.ang2Y+x*N.ang2Z,F.invMAngN2X=q,F.invMAngN2Y=R,F.invMAngN2Z=j,F.massN=X+M+(F.invMAngN1X*N.ang1X+F.invMAngN1Y*N.ang1Y+F.invMAngN1Z*N.ang1Z)+(F.invMAngN2X*N.ang2X+F.invMAngN2Y*N.ang2Y+F.invMAngN2Z*N.ang2Z),0!=F.massN&&(F.massN=1/F.massN)}g=0,Y=0,Z=0,I=0,y=0,d=0,L=0,z=0,w=0,B=0,A=0,P=0;for(var W=0,G=this.info.numRows;W<G;){var U=W++,J=this.info.rows[U],H=this.massData[U],Q=J.impulse,K=J.jacobianN,$=0;$+=g*K.lin1X+Y*K.lin1Y+Z*K.lin1Z,$-=I*K.lin2X+y*K.lin2Y+d*K.lin2Z,$+=L*K.ang1X+z*K.ang1Y+w*K.ang1Z,$-=B*K.ang2X+A*K.ang2Y+P*K.ang2Z;var tt=(J.rhs-$)*H.massN*D.positionNgsBaumgarte,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<0&&(Q.impulseP=0),tt=Q.impulseP-it,g+=H.invMLinN1X*tt,Y+=H.invMLinN1Y*tt,Z+=H.invMLinN1Z*tt,I+=H.invMLinN2X*-tt,y+=H.invMLinN2Y*-tt,d+=H.invMLinN2Z*-tt,L+=H.invMAngN1X*tt,z+=H.invMAngN1Y*tt,w+=H.invMAngN1Z*tt,B+=H.invMAngN2X*-tt,A+=H.invMAngN2Y*-tt,P+=H.invMAngN2Z*-tt}var at=this._b1;at._transform._positionX+=g,at._transform._positionY+=Y,at._transform._positionZ+=Z;var nt=this._b2;nt._transform._positionX+=I,nt._transform._positionY+=y,nt._transform._positionZ+=d;var ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt=this._b1,ft=Math.sqrt(L*L+z*z+w*w),pt=.5*ft;if(pt<.5){var ut=pt*pt;ot=.5*(1-.16666666666666666*ut+ut*ut*.008333333333333333),st=1-.5*ut+ut*ut*.041666666666666664}else ot=Math.sin(pt)/ft,st=Math.cos(pt);rt=L*ot,_t=z*ot,et=w*ot,ht=st;var xt,Xt=bt._transform._rotation00,Mt=bt._transform._rotation11,gt=bt._transform._rotation22,Yt=Xt+Mt+gt;Yt>0?(mt=.5*(xt=Math.sqrt(Yt+1)),xt=.5/xt,lt=(bt._transform._rotation21-bt._transform._rotation12)*xt,vt=(bt._transform._rotation02-bt._transform._rotation20)*xt,ct=(bt._transform._rotation10-bt._transform._rotation01)*xt):Xt>Mt?Xt>gt?(lt=.5*(xt=Math.sqrt(Xt-Mt-gt+1)),xt=.5/xt,vt=(bt._transform._rotation01+bt._transform._rotation10)*xt,ct=(bt._transform._rotation02+bt._transform._rotation20)*xt,mt=(bt._transform._rotation21-bt._transform._rotation12)*xt):(ct=.5*(xt=Math.sqrt(gt-Xt-Mt+1)),xt=.5/xt,lt=(bt._transform._rotation02+bt._transform._rotation20)*xt,vt=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation10-bt._transform._rotation01)*xt):Mt>gt?(vt=.5*(xt=Math.sqrt(Mt-gt-Xt+1)),xt=.5/xt,lt=(bt._transform._rotation01+bt._transform._rotation10)*xt,ct=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation02-bt._transform._rotation20)*xt):(ct=.5*(xt=Math.sqrt(gt-Xt-Mt+1)),xt=.5/xt,lt=(bt._transform._rotation02+bt._transform._rotation20)*xt,vt=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation10-bt._transform._rotation01)*xt);var Zt=(lt=ht*lt+rt*mt+_t*ct-et*vt)*lt+(vt=ht*vt-rt*ct+_t*mt+et*lt)*vt+(ct=ht*ct+rt*vt-_t*lt+et*mt)*ct+(mt=ht*mt-rt*lt-_t*vt-et*ct)*mt;Zt>1e-32&&(Zt=1/Math.sqrt(Zt));lt*=Zt,vt*=Zt,ct*=Zt,mt*=Zt;var It,yt,dt,Lt,zt,wt,Bt,At,Pt,Tt,St,Vt,kt,Ct,qt,Rt,jt,Ot,Et=2*lt,Ft=2*vt,Dt=2*ct,Nt=lt*Et,Wt=vt*Ft,Gt=ct*Dt,Ut=lt*Ft,Jt=vt*Dt,Ht=lt*Dt,Qt=mt*Et,Kt=mt*Ft,$t=mt*Dt;bt._transform._rotation00=1-Wt-Gt,bt._transform._rotation01=Ut-$t,bt._transform._rotation02=Ht+Kt,bt._transform._rotation10=Ut+$t,bt._transform._rotation11=1-Nt-Gt,bt._transform._rotation12=Jt-Qt,bt._transform._rotation20=Ht-Kt,bt._transform._rotation21=Jt+Qt,bt._transform._rotation22=1-Nt-Wt,It=bt._transform._rotation00*bt._invLocalInertia00+bt._transform._rotation01*bt._invLocalInertia10+bt._transform._rotation02*bt._invLocalInertia20,yt=bt._transform._rotation00*bt._invLocalInertia01+bt._transform._rotation01*bt._invLocalInertia11+bt._transform._rotation02*bt._invLocalInertia21,dt=bt._transform._rotation00*bt._invLocalInertia02+bt._transform._rotation01*bt._invLocalInertia12+bt._transform._rotation02*bt._invLocalInertia22,Lt=bt._transform._rotation10*bt._invLocalInertia00+bt._transform._rotation11*bt._invLocalInertia10+bt._transform._rotation12*bt._invLocalInertia20,zt=bt._transform._rotation10*bt._invLocalInertia01+bt._transform._rotation11*bt._invLocalInertia11+bt._transform._rotation12*bt._invLocalInertia21,wt=bt._transform._rotation10*bt._invLocalInertia02+bt._transform._rotation11*bt._invLocalInertia12+bt._transform._rotation12*bt._invLocalInertia22,Bt=bt._transform._rotation20*bt._invLocalInertia00+bt._transform._rotation21*bt._invLocalInertia10+bt._transform._rotation22*bt._invLocalInertia20,At=bt._transform._rotation20*bt._invLocalInertia01+bt._transform._rotation21*bt._invLocalInertia11+bt._transform._rotation22*bt._invLocalInertia21,Pt=bt._transform._rotation20*bt._invLocalInertia02+bt._transform._rotation21*bt._invLocalInertia12+bt._transform._rotation22*bt._invLocalInertia22,bt._invInertia00=It,bt._invInertia01=yt,bt._invInertia02=dt,bt._invInertia10=Lt,bt._invInertia11=zt,bt._invInertia12=wt,bt._invInertia20=Bt,bt._invInertia21=At,bt._invInertia22=Pt,Tt=bt._invInertia00*bt._transform._rotation00+bt._invInertia01*bt._transform._rotation01+bt._invInertia02*bt._transform._rotation02,St=bt._invInertia00*bt._transform._rotation10+bt._invInertia01*bt._transform._rotation11+bt._invInertia02*bt._transform._rotation12,Vt=bt._invInertia00*bt._transform._rotation20+bt._invInertia01*bt._transform._rotation21+bt._invInertia02*bt._transform._rotation22,kt=bt._invInertia10*bt._transform._rotation00+bt._invInertia11*bt._transform._rotation01+bt._invInertia12*bt._transform._rotation02,Ct=bt._invInertia10*bt._transform._rotation10+bt._invInertia11*bt._transform._rotation11+bt._invInertia12*bt._transform._rotation12,qt=bt._invInertia10*bt._transform._rotation20+bt._invInertia11*bt._transform._rotation21+bt._invInertia12*bt._transform._rotation22,Rt=bt._invInertia20*bt._transform._rotation00+bt._invInertia21*bt._transform._rotation01+bt._invInertia22*bt._transform._rotation02,jt=bt._invInertia20*bt._transform._rotation10+bt._invInertia21*bt._transform._rotation11+bt._invInertia22*bt._transform._rotation12,Ot=bt._invInertia20*bt._transform._rotation20+bt._invInertia21*bt._transform._rotation21+bt._invInertia22*bt._transform._rotation22,bt._invInertia00=Tt,bt._invInertia01=St,bt._invInertia02=Vt,bt._invInertia10=kt,bt._invInertia11=Ct,bt._invInertia12=qt,bt._invInertia20=Rt,bt._invInertia21=jt,bt._invInertia22=Ot,bt._invInertia00*=bt._rotFactor.x,bt._invInertia01*=bt._rotFactor.x,bt._invInertia02*=bt._rotFactor.x,bt._invInertia10*=bt._rotFactor.y,bt._invInertia11*=bt._rotFactor.y,bt._invInertia12*=bt._rotFactor.y,bt._invInertia20*=bt._rotFactor.z,bt._invInertia21*=bt._rotFactor.z,bt._invInertia22*=bt._rotFactor.z;var ti,ii,ai,ni,oi,si,ri,_i,ei,hi,li=this._b2,vi=Math.sqrt(B*B+A*A+P*P),ci=.5*vi;if(ci<.5){var mi=ci*ci;ti=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ii=1-.5*mi+mi*mi*.041666666666666664}else ti=Math.sin(ci)/vi,ii=Math.cos(ci);ai=B*ti,ni=A*ti,oi=P*ti,si=ii;var bi,fi=li._transform._rotation00,pi=li._transform._rotation11,ui=li._transform._rotation22,xi=fi+pi+ui;xi>0?(hi=.5*(bi=Math.sqrt(xi+1)),bi=.5/bi,ri=(li._transform._rotation21-li._transform._rotation12)*bi,_i=(li._transform._rotation02-li._transform._rotation20)*bi,ei=(li._transform._rotation10-li._transform._rotation01)*bi):fi>pi?fi>ui?(ri=.5*(bi=Math.sqrt(fi-pi-ui+1)),bi=.5/bi,_i=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation02+li._transform._rotation20)*bi,hi=(li._transform._rotation21-li._transform._rotation12)*bi):(ei=.5*(bi=Math.sqrt(ui-fi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi):pi>ui?(_i=.5*(bi=Math.sqrt(pi-ui-fi+1)),bi=.5/bi,ri=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation02-li._transform._rotation20)*bi):(ei=.5*(bi=Math.sqrt(ui-fi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi);var Xi=(ri=si*ri+ai*hi+ni*ei-oi*_i)*ri+(_i=si*_i-ai*ei+ni*hi+oi*ri)*_i+(ei=si*ei+ai*_i-ni*ri+oi*hi)*ei+(hi=si*hi-ai*ri-ni*_i-oi*ei)*hi;Xi>1e-32&&(Xi=1/Math.sqrt(Xi));ri*=Xi,_i*=Xi,ei*=Xi,hi*=Xi;var Mi,gi,Yi,Zi,Ii,yi,di,Li,zi,wi,Bi,Ai,Pi,Ti,Si,Vi,ki,Ci,qi=2*ri,Ri=2*_i,ji=2*ei,Oi=ri*qi,Ei=_i*Ri,Fi=ei*ji,Di=ri*Ri,Ni=_i*ji,Wi=ri*ji,Gi=hi*qi,Ui=hi*Ri,Ji=hi*ji;li._transform._rotation00=1-Ei-Fi,li._transform._rotation01=Di-Ji,li._transform._rotation02=Wi+Ui,li._transform._rotation10=Di+Ji,li._transform._rotation11=1-Oi-Fi,li._transform._rotation12=Ni-Gi,li._transform._rotation20=Wi-Ui,li._transform._rotation21=Ni+Gi,li._transform._rotation22=1-Oi-Ei,Mi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,gi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,Yi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,Zi=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Ii=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,yi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,di=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Li=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,zi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=Mi,li._invInertia01=gi,li._invInertia02=Yi,li._invInertia10=Zi,li._invInertia11=Ii,li._invInertia12=yi,li._invInertia20=di,li._invInertia21=Li,li._invInertia22=zi,wi=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,Bi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,Ai=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,Pi=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Ti=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Si=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Vi=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,ki=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=wi,li._invInertia01=Bi,li._invInertia02=Ai,li._invInertia10=Pi,li._invInertia11=Ti,li._invInertia12=Si,li._invInertia20=Vi,li._invInertia21=ki,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z},postSolve:function(){for(var t=0,i=this.info.numRows;t<i;){var a,n,o,s=t++,r=this.info.rows[s],_=r.impulse,e=r.jacobianT,h=r.jacobianB;a=0,n=0,o=0,a+=e.lin1X*_.impulseT,n+=e.lin1Y*_.impulseT,o+=e.lin1Z*_.impulseT,a+=h.lin1X*_.impulseB,n+=h.lin1Y*_.impulseB,o+=h.lin1Z*_.impulseB,_.impulseLX=a,_.impulseLY=n,_.impulseLZ=o}this.constraint._syncManifold()}});var ti=function(t){mt.call(this),this.joint=t,this.info=new Yt;var i=D.maxJacobianRows,a=new Array(i);this.massData=a;for(var n=0,o=this.massData.length;n<o;){var s=n++;this.massData[s]=new Gt}};ti.__super__=mt,ti.prototype=t(mt.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,Y=this.info.numRows;g<Y;){var Z,I,y,d,L,z,w=g++,B=this.info.rows[w],A=this.massData[w],P=B.jacobian;if(P.updateSparsity(),0!=(1&P.flag)?(A.invMLin1X=P.lin1X*X,A.invMLin1Y=P.lin1Y*X,A.invMLin1Z=P.lin1Z*X,A.invMLin2X=P.lin2X*M,A.invMLin2Y=P.lin2Y*M,A.invMLin2Z=P.lin2Z*M):(A.invMLin1X=0,A.invMLin1Y=0,A.invMLin1Z=0,A.invMLin2X=0,A.invMLin2Y=0,A.invMLin2Z=0),0!=(2&P.flag))Z=i*P.ang1X+a*P.ang1Y+n*P.ang1Z,I=o*P.ang1X+s*P.ang1Y+r*P.ang1Z,y=_*P.ang1X+e*P.ang1Y+h*P.ang1Z,A.invMAng1X=Z,A.invMAng1Y=I,A.invMAng1Z=y,d=l*P.ang2X+v*P.ang2Y+c*P.ang2Z,L=m*P.ang2X+b*P.ang2Y+f*P.ang2Z,z=p*P.ang2X+u*P.ang2Y+x*P.ang2Z,A.invMAng2X=d,A.invMAng2Y=L,A.invMAng2Z=z;else A.invMAng1X=0,A.invMAng1Y=0,A.invMAng1Z=0,A.invMAng2X=0,A.invMAng2Y=0,A.invMAng2Z=0;A.massWithoutCfm=A.invMLin1X*P.lin1X+A.invMLin1Y*P.lin1Y+A.invMLin1Z*P.lin1Z+(A.invMLin2X*P.lin2X+A.invMLin2Y*P.lin2Y+A.invMLin2Z*P.lin2Z)+(A.invMAng1X*P.ang1X+A.invMAng1Y*P.ang1Y+A.invMAng1Z*P.ang1Z)+(A.invMAng2X*P.ang2X+A.invMAng2Y*P.ang2Y+A.invMAng2Z*P.ang2Z),A.mass=A.massWithoutCfm+B.cfm,0!=A.massWithoutCfm&&(A.massWithoutCfm=1/A.massWithoutCfm),0!=A.mass&&(A.mass=1/A.mass)}},warmStart:function(t){var i=this.joint._positionCorrectionAlgorithm==bt.BAUMGARTE?D.jointWarmStartingFactorForBaungarte:D.jointWarmStartingFactor;if((i*=t.dtRatio)<=0)for(var a=0,n=this.info.numRows;a<n;){var o=a++,s=this.info.rows[o].impulse;s.impulse=0,s.impulseM=0,s.impulseP=0}else{var r,_,e,h,l,v,c,m,b,f,p,u;r=this._b1._velX,_=this._b1._velY,e=this._b1._velZ,h=this._b2._velX,l=this._b2._velY,v=this._b2._velZ,c=this._b1._angVelX,m=this._b1._angVelY,b=this._b1._angVelZ,f=this._b2._angVelX,p=this._b2._angVelY,u=this._b2._angVelZ;for(var x=0,X=this.info.numRows;x<X;){var M=x++,g=this.info.rows[M],Y=this.massData[M],Z=g.impulse;g.jacobian;Z.impulse*=i,Z.impulseM*=i;var I=Z.impulse+Z.impulseM;r+=Y.invMLin1X*I,_+=Y.invMLin1Y*I,e+=Y.invMLin1Z*I,h+=Y.invMLin2X*-I,l+=Y.invMLin2Y*-I,v+=Y.invMLin2Z*-I,c+=Y.invMAng1X*I,m+=Y.invMAng1Y*I,b+=Y.invMAng1Z*I,f+=Y.invMAng2X*-I,p+=Y.invMAng2Y*-I,u+=Y.invMAng2Z*-I}this._b1._velX=r,this._b1._velY=_,this._b1._velZ=e,this._b2._velX=h,this._b2._velY=l,this._b2._velZ=v,this._b1._angVelX=c,this._b1._angVelY=m,this._b1._angVelZ=b,this._b2._angVelX=f,this._b2._angVelY=p,this._b2._angVelZ=u}},solveVelocity:function(){var t,i,a,n,o,s,r,_,e,h,l,v;t=this._b1._velX,i=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,o=this._b2._velY,s=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,e=this._b1._angVelZ,h=this._b2._angVelX,l=this._b2._angVelY,v=this._b2._angVelZ;for(var c=0,m=this.info.numRows;c<m;){var b=c++,f=this.info.rows[b],p=this.massData[b],u=f.impulse,x=f.jacobian;if(0!=f.motorMaxImpulse){var X=0;X+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,X-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,X+=r*x.ang1X+_*x.ang1Y+e*x.ang1Z,X-=h*x.ang2X+l*x.ang2Y+v*x.ang2Z;var M=(-f.motorSpeed-X)*p.massWithoutCfm,g=u.impulseM;u.impulseM+=M,u.impulseM<-f.motorMaxImpulse?u.impulseM=-f.motorMaxImpulse:u.impulseM>f.motorMaxImpulse&&(u.impulseM=f.motorMaxImpulse),M=u.impulseM-g,0!=(1&x.flag)&&(t+=p.invMLin1X*M,i+=p.invMLin1Y*M,a+=p.invMLin1Z*M,n+=p.invMLin2X*-M,o+=p.invMLin2Y*-M,s+=p.invMLin2Z*-M),0!=(2&x.flag)&&(r+=p.invMAng1X*M,_+=p.invMAng1Y*M,e+=p.invMAng1Z*M,h+=p.invMAng2X*-M,l+=p.invMAng2Y*-M,v+=p.invMAng2Z*-M)}}for(var Y=0,Z=this.info.numRows;Y<Z;){var I=Y++,y=this.info.rows[I],d=this.massData[I],L=y.impulse,z=y.jacobian,w=0;w+=t*z.lin1X+i*z.lin1Y+a*z.lin1Z,w-=n*z.lin2X+o*z.lin2Y+s*z.lin2Z,w+=r*z.ang1X+_*z.ang1Y+e*z.ang1Z,w-=h*z.ang2X+l*z.ang2Y+v*z.ang2Z;var B=(y.rhs-w-L.impulse*y.cfm)*d.mass,A=L.impulse;L.impulse+=B,L.impulse<y.minImpulse?L.impulse=y.minImpulse:L.impulse>y.maxImpulse&&(L.impulse=y.maxImpulse),B=L.impulse-A,0!=(1&z.flag)&&(t+=d.invMLin1X*B,i+=d.invMLin1Y*B,a+=d.invMLin1Z*B,n+=d.invMLin2X*-B,o+=d.invMLin2Y*-B,s+=d.invMLin2Z*-B),0!=(2&z.flag)&&(r+=d.invMAng1X*B,_+=d.invMAng1Y*B,e+=d.invMAng1Z*B,h+=d.invMAng2X*-B,l+=d.invMAng2Y*-B,v+=d.invMAng2Z*-B)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=a,this._b2._velX=n,this._b2._velY=o,this._b2._velZ=s,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=e,this._b2._angVelX=h,this._b2._angVelY=l,this._b2._angVelZ=v},postSolveVelocity:function(t){var i,a,n,o,s,r;i=0,a=0,n=0,o=0,s=0,r=0;for(var _=0,e=this.info.numRows;_<e;){var h=_++,l=this.info.rows[h],v=l.impulse,c=l.jacobian;0!=(1&c.flag)?(i+=c.lin1X*v.impulse,a+=c.lin1Y*v.impulse,n+=c.lin1Z*v.impulse):0!=(2&c.flag)&&(o+=c.ang1X*v.impulse,s+=c.ang1Y*v.impulse,r+=c.ang1Z*v.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=a*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=o*t.invDt,this.joint._appliedTorqueY=s*t.invDt,this.joint._appliedTorqueZ=r*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g=0,Y=this.info.numRows;g<Y;){var Z,I,y,d,L,z,w=g++,B=this.info.rows[w],A=this.massData[w],P=(B.impulse,B.jacobian);A.invMLin1X=P.lin1X*X,A.invMLin1Y=P.lin1Y*X,A.invMLin1Z=P.lin1Z*X,A.invMLin2X=P.lin2X*M,A.invMLin2Y=P.lin2Y*M,A.invMLin2Z=P.lin2Z*M,Z=i*P.ang1X+a*P.ang1Y+n*P.ang1Z,I=o*P.ang1X+s*P.ang1Y+r*P.ang1Z,y=_*P.ang1X+e*P.ang1Y+h*P.ang1Z,A.invMAng1X=Z,A.invMAng1Y=I,A.invMAng1Z=y,d=l*P.ang2X+v*P.ang2Y+c*P.ang2Z,L=m*P.ang2X+b*P.ang2Y+f*P.ang2Z,z=p*P.ang2X+u*P.ang2Y+x*P.ang2Z,A.invMAng2X=d,A.invMAng2Y=L,A.invMAng2Z=z,A.mass=A.invMLin1X*P.lin1X+A.invMLin1Y*P.lin1Y+A.invMLin1Z*P.lin1Z+(A.invMLin2X*P.lin2X+A.invMLin2Y*P.lin2Y+A.invMLin2Z*P.lin2Z)+(A.invMAng1X*P.ang1X+A.invMAng1Y*P.ang1Y+A.invMAng1Z*P.ang1Z)+(A.invMAng2X*P.ang2X+A.invMAng2Y*P.ang2Y+A.invMAng2Z*P.ang2Z),0!=A.mass&&(A.mass=1/A.mass)}for(var T=0,S=this.info.numRows;T<S;){var V=T++;this.info.rows[V].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t,i,a,n,o,s,r,_,e,h,l,v;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,o=this._b2._pseudoVelY,s=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,l=this._b2._angPseudoVelY,v=this._b2._angPseudoVelZ;for(var c=0,m=this.info.numRows;c<m;){var b=c++,f=this.info.rows[b],p=this.massData[b],u=f.impulse,x=f.jacobian,X=0;X+=t*x.lin1X+i*x.lin1Y+a*x.lin1Z,X-=n*x.lin2X+o*x.lin2Y+s*x.lin2Z,X+=r*x.ang1X+_*x.ang1Y+e*x.ang1Z,X-=h*x.ang2X+l*x.ang2Y+v*x.ang2Z;var M=(f.rhs*D.positionSplitImpulseBaumgarte-X)*p.mass,g=u.impulseP;u.impulseP+=M,u.impulseP<f.minImpulse?u.impulseP=f.minImpulse:u.impulseP>f.maxImpulse&&(u.impulseP=f.maxImpulse),M=u.impulseP-g,t+=p.invMLin1X*M,i+=p.invMLin1Y*M,a+=p.invMLin1Z*M,n+=p.invMLin2X*-M,o+=p.invMLin2Y*-M,s+=p.invMLin2Z*-M,r+=p.invMAng1X*M,_+=p.invMAng1Y*M,e+=p.invMAng1Z*M,h+=p.invMAng2X*-M,l+=p.invMAng2Y*-M,v+=p.invMAng2Z*-M}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=n,this._b2._pseudoVelY=o,this._b2._pseudoVelZ=s,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=h,this._b2._angPseudoVelY=l,this._b2._angPseudoVelZ=v},solvePositionNgs:function(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._b1._invMass,M=this._b2._invMass;i=this._b1._invInertia00,a=this._b1._invInertia01,n=this._b1._invInertia02,o=this._b1._invInertia10,s=this._b1._invInertia11,r=this._b1._invInertia12,_=this._b1._invInertia20,e=this._b1._invInertia21,h=this._b1._invInertia22,l=this._b2._invInertia00,v=this._b2._invInertia01,c=this._b2._invInertia02,m=this._b2._invInertia10,b=this._b2._invInertia11,f=this._b2._invInertia12,p=this._b2._invInertia20,u=this._b2._invInertia21,x=this._b2._invInertia22;for(var g,Y,Z,I,y,d,L,z,w,B,A,P,T=0,S=this.info.numRows;T<S;){var V,k,C,q,R,j,O=T++,E=this.info.rows[O],F=this.massData[O],N=(E.impulse,E.jacobian);F.invMLin1X=N.lin1X*X,F.invMLin1Y=N.lin1Y*X,F.invMLin1Z=N.lin1Z*X,F.invMLin2X=N.lin2X*M,F.invMLin2Y=N.lin2Y*M,F.invMLin2Z=N.lin2Z*M,V=i*N.ang1X+a*N.ang1Y+n*N.ang1Z,k=o*N.ang1X+s*N.ang1Y+r*N.ang1Z,C=_*N.ang1X+e*N.ang1Y+h*N.ang1Z,F.invMAng1X=V,F.invMAng1Y=k,F.invMAng1Z=C,q=l*N.ang2X+v*N.ang2Y+c*N.ang2Z,R=m*N.ang2X+b*N.ang2Y+f*N.ang2Z,j=p*N.ang2X+u*N.ang2Y+x*N.ang2Z,F.invMAng2X=q,F.invMAng2Y=R,F.invMAng2Z=j,F.mass=F.invMLin1X*N.lin1X+F.invMLin1Y*N.lin1Y+F.invMLin1Z*N.lin1Z+(F.invMLin2X*N.lin2X+F.invMLin2Y*N.lin2Y+F.invMLin2Z*N.lin2Z)+(F.invMAng1X*N.ang1X+F.invMAng1Y*N.ang1Y+F.invMAng1Z*N.ang1Z)+(F.invMAng2X*N.ang2X+F.invMAng2Y*N.ang2Y+F.invMAng2Z*N.ang2Z),0!=F.mass&&(F.mass=1/F.mass)}g=0,Y=0,Z=0,I=0,y=0,d=0,L=0,z=0,w=0,B=0,A=0,P=0;for(var W=0,G=this.info.numRows;W<G;){var U=W++,J=this.info.rows[U],H=this.massData[U],Q=J.impulse,K=J.jacobian,$=0;$+=g*K.lin1X+Y*K.lin1Y+Z*K.lin1Z,$-=I*K.lin2X+y*K.lin2Y+d*K.lin2Z,$+=L*K.ang1X+z*K.ang1Y+w*K.ang1Z,$-=B*K.ang2X+A*K.ang2Y+P*K.ang2Z;var tt=(J.rhs*D.positionNgsBaumgarte-$)*H.mass,it=Q.impulseP;Q.impulseP+=tt,Q.impulseP<J.minImpulse?Q.impulseP=J.minImpulse:Q.impulseP>J.maxImpulse&&(Q.impulseP=J.maxImpulse),tt=Q.impulseP-it,g+=H.invMLin1X*tt,Y+=H.invMLin1Y*tt,Z+=H.invMLin1Z*tt,I+=H.invMLin2X*-tt,y+=H.invMLin2Y*-tt,d+=H.invMLin2Z*-tt,L+=H.invMAng1X*tt,z+=H.invMAng1Y*tt,w+=H.invMAng1Z*tt,B+=H.invMAng2X*-tt,A+=H.invMAng2Y*-tt,P+=H.invMAng2Z*-tt}var at=this._b1;at._transform._positionX+=g,at._transform._positionY+=Y,at._transform._positionZ+=Z;var nt=this._b2;nt._transform._positionX+=I,nt._transform._positionY+=y,nt._transform._positionZ+=d;var ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt=this._b1,ft=Math.sqrt(L*L+z*z+w*w),pt=.5*ft;if(pt<.5){var ut=pt*pt;ot=.5*(1-.16666666666666666*ut+ut*ut*.008333333333333333),st=1-.5*ut+ut*ut*.041666666666666664}else ot=Math.sin(pt)/ft,st=Math.cos(pt);rt=L*ot,_t=z*ot,et=w*ot,ht=st;var xt,Xt=bt._transform._rotation00,Mt=bt._transform._rotation11,gt=bt._transform._rotation22,Yt=Xt+Mt+gt;Yt>0?(mt=.5*(xt=Math.sqrt(Yt+1)),xt=.5/xt,lt=(bt._transform._rotation21-bt._transform._rotation12)*xt,vt=(bt._transform._rotation02-bt._transform._rotation20)*xt,ct=(bt._transform._rotation10-bt._transform._rotation01)*xt):Xt>Mt?Xt>gt?(lt=.5*(xt=Math.sqrt(Xt-Mt-gt+1)),xt=.5/xt,vt=(bt._transform._rotation01+bt._transform._rotation10)*xt,ct=(bt._transform._rotation02+bt._transform._rotation20)*xt,mt=(bt._transform._rotation21-bt._transform._rotation12)*xt):(ct=.5*(xt=Math.sqrt(gt-Xt-Mt+1)),xt=.5/xt,lt=(bt._transform._rotation02+bt._transform._rotation20)*xt,vt=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation10-bt._transform._rotation01)*xt):Mt>gt?(vt=.5*(xt=Math.sqrt(Mt-gt-Xt+1)),xt=.5/xt,lt=(bt._transform._rotation01+bt._transform._rotation10)*xt,ct=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation02-bt._transform._rotation20)*xt):(ct=.5*(xt=Math.sqrt(gt-Xt-Mt+1)),xt=.5/xt,lt=(bt._transform._rotation02+bt._transform._rotation20)*xt,vt=(bt._transform._rotation12+bt._transform._rotation21)*xt,mt=(bt._transform._rotation10-bt._transform._rotation01)*xt);var Zt=(lt=ht*lt+rt*mt+_t*ct-et*vt)*lt+(vt=ht*vt-rt*ct+_t*mt+et*lt)*vt+(ct=ht*ct+rt*vt-_t*lt+et*mt)*ct+(mt=ht*mt-rt*lt-_t*vt-et*ct)*mt;Zt>1e-32&&(Zt=1/Math.sqrt(Zt));lt*=Zt,vt*=Zt,ct*=Zt,mt*=Zt;var It,yt,dt,Lt,zt,wt,Bt,At,Pt,Tt,St,Vt,kt,Ct,qt,Rt,jt,Ot,Et=2*lt,Ft=2*vt,Dt=2*ct,Nt=lt*Et,Wt=vt*Ft,Gt=ct*Dt,Ut=lt*Ft,Jt=vt*Dt,Ht=lt*Dt,Qt=mt*Et,Kt=mt*Ft,$t=mt*Dt;bt._transform._rotation00=1-Wt-Gt,bt._transform._rotation01=Ut-$t,bt._transform._rotation02=Ht+Kt,bt._transform._rotation10=Ut+$t,bt._transform._rotation11=1-Nt-Gt,bt._transform._rotation12=Jt-Qt,bt._transform._rotation20=Ht-Kt,bt._transform._rotation21=Jt+Qt,bt._transform._rotation22=1-Nt-Wt,It=bt._transform._rotation00*bt._invLocalInertia00+bt._transform._rotation01*bt._invLocalInertia10+bt._transform._rotation02*bt._invLocalInertia20,yt=bt._transform._rotation00*bt._invLocalInertia01+bt._transform._rotation01*bt._invLocalInertia11+bt._transform._rotation02*bt._invLocalInertia21,dt=bt._transform._rotation00*bt._invLocalInertia02+bt._transform._rotation01*bt._invLocalInertia12+bt._transform._rotation02*bt._invLocalInertia22,Lt=bt._transform._rotation10*bt._invLocalInertia00+bt._transform._rotation11*bt._invLocalInertia10+bt._transform._rotation12*bt._invLocalInertia20,zt=bt._transform._rotation10*bt._invLocalInertia01+bt._transform._rotation11*bt._invLocalInertia11+bt._transform._rotation12*bt._invLocalInertia21,wt=bt._transform._rotation10*bt._invLocalInertia02+bt._transform._rotation11*bt._invLocalInertia12+bt._transform._rotation12*bt._invLocalInertia22,Bt=bt._transform._rotation20*bt._invLocalInertia00+bt._transform._rotation21*bt._invLocalInertia10+bt._transform._rotation22*bt._invLocalInertia20,At=bt._transform._rotation20*bt._invLocalInertia01+bt._transform._rotation21*bt._invLocalInertia11+bt._transform._rotation22*bt._invLocalInertia21,Pt=bt._transform._rotation20*bt._invLocalInertia02+bt._transform._rotation21*bt._invLocalInertia12+bt._transform._rotation22*bt._invLocalInertia22,bt._invInertia00=It,bt._invInertia01=yt,bt._invInertia02=dt,bt._invInertia10=Lt,bt._invInertia11=zt,bt._invInertia12=wt,bt._invInertia20=Bt,bt._invInertia21=At,bt._invInertia22=Pt,Tt=bt._invInertia00*bt._transform._rotation00+bt._invInertia01*bt._transform._rotation01+bt._invInertia02*bt._transform._rotation02,St=bt._invInertia00*bt._transform._rotation10+bt._invInertia01*bt._transform._rotation11+bt._invInertia02*bt._transform._rotation12,Vt=bt._invInertia00*bt._transform._rotation20+bt._invInertia01*bt._transform._rotation21+bt._invInertia02*bt._transform._rotation22,kt=bt._invInertia10*bt._transform._rotation00+bt._invInertia11*bt._transform._rotation01+bt._invInertia12*bt._transform._rotation02,Ct=bt._invInertia10*bt._transform._rotation10+bt._invInertia11*bt._transform._rotation11+bt._invInertia12*bt._transform._rotation12,qt=bt._invInertia10*bt._transform._rotation20+bt._invInertia11*bt._transform._rotation21+bt._invInertia12*bt._transform._rotation22,Rt=bt._invInertia20*bt._transform._rotation00+bt._invInertia21*bt._transform._rotation01+bt._invInertia22*bt._transform._rotation02,jt=bt._invInertia20*bt._transform._rotation10+bt._invInertia21*bt._transform._rotation11+bt._invInertia22*bt._transform._rotation12,Ot=bt._invInertia20*bt._transform._rotation20+bt._invInertia21*bt._transform._rotation21+bt._invInertia22*bt._transform._rotation22,bt._invInertia00=Tt,bt._invInertia01=St,bt._invInertia02=Vt,bt._invInertia10=kt,bt._invInertia11=Ct,bt._invInertia12=qt,bt._invInertia20=Rt,bt._invInertia21=jt,bt._invInertia22=Ot,bt._invInertia00*=bt._rotFactor.x,bt._invInertia01*=bt._rotFactor.x,bt._invInertia02*=bt._rotFactor.x,bt._invInertia10*=bt._rotFactor.y,bt._invInertia11*=bt._rotFactor.y,bt._invInertia12*=bt._rotFactor.y,bt._invInertia20*=bt._rotFactor.z,bt._invInertia21*=bt._rotFactor.z,bt._invInertia22*=bt._rotFactor.z;var ti,ii,ai,ni,oi,si,ri,_i,ei,hi,li=this._b2,vi=Math.sqrt(B*B+A*A+P*P),ci=.5*vi;if(ci<.5){var mi=ci*ci;ti=.5*(1-.16666666666666666*mi+mi*mi*.008333333333333333),ii=1-.5*mi+mi*mi*.041666666666666664}else ti=Math.sin(ci)/vi,ii=Math.cos(ci);ai=B*ti,ni=A*ti,oi=P*ti,si=ii;var bi,fi=li._transform._rotation00,pi=li._transform._rotation11,ui=li._transform._rotation22,xi=fi+pi+ui;xi>0?(hi=.5*(bi=Math.sqrt(xi+1)),bi=.5/bi,ri=(li._transform._rotation21-li._transform._rotation12)*bi,_i=(li._transform._rotation02-li._transform._rotation20)*bi,ei=(li._transform._rotation10-li._transform._rotation01)*bi):fi>pi?fi>ui?(ri=.5*(bi=Math.sqrt(fi-pi-ui+1)),bi=.5/bi,_i=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation02+li._transform._rotation20)*bi,hi=(li._transform._rotation21-li._transform._rotation12)*bi):(ei=.5*(bi=Math.sqrt(ui-fi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi):pi>ui?(_i=.5*(bi=Math.sqrt(pi-ui-fi+1)),bi=.5/bi,ri=(li._transform._rotation01+li._transform._rotation10)*bi,ei=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation02-li._transform._rotation20)*bi):(ei=.5*(bi=Math.sqrt(ui-fi-pi+1)),bi=.5/bi,ri=(li._transform._rotation02+li._transform._rotation20)*bi,_i=(li._transform._rotation12+li._transform._rotation21)*bi,hi=(li._transform._rotation10-li._transform._rotation01)*bi);var Xi=(ri=si*ri+ai*hi+ni*ei-oi*_i)*ri+(_i=si*_i-ai*ei+ni*hi+oi*ri)*_i+(ei=si*ei+ai*_i-ni*ri+oi*hi)*ei+(hi=si*hi-ai*ri-ni*_i-oi*ei)*hi;Xi>1e-32&&(Xi=1/Math.sqrt(Xi));ri*=Xi,_i*=Xi,ei*=Xi,hi*=Xi;var Mi,gi,Yi,Zi,Ii,yi,di,Li,zi,wi,Bi,Ai,Pi,Ti,Si,Vi,ki,Ci,qi=2*ri,Ri=2*_i,ji=2*ei,Oi=ri*qi,Ei=_i*Ri,Fi=ei*ji,Di=ri*Ri,Ni=_i*ji,Wi=ri*ji,Gi=hi*qi,Ui=hi*Ri,Ji=hi*ji;li._transform._rotation00=1-Ei-Fi,li._transform._rotation01=Di-Ji,li._transform._rotation02=Wi+Ui,li._transform._rotation10=Di+Ji,li._transform._rotation11=1-Oi-Fi,li._transform._rotation12=Ni-Gi,li._transform._rotation20=Wi-Ui,li._transform._rotation21=Ni+Gi,li._transform._rotation22=1-Oi-Ei,Mi=li._transform._rotation00*li._invLocalInertia00+li._transform._rotation01*li._invLocalInertia10+li._transform._rotation02*li._invLocalInertia20,gi=li._transform._rotation00*li._invLocalInertia01+li._transform._rotation01*li._invLocalInertia11+li._transform._rotation02*li._invLocalInertia21,Yi=li._transform._rotation00*li._invLocalInertia02+li._transform._rotation01*li._invLocalInertia12+li._transform._rotation02*li._invLocalInertia22,Zi=li._transform._rotation10*li._invLocalInertia00+li._transform._rotation11*li._invLocalInertia10+li._transform._rotation12*li._invLocalInertia20,Ii=li._transform._rotation10*li._invLocalInertia01+li._transform._rotation11*li._invLocalInertia11+li._transform._rotation12*li._invLocalInertia21,yi=li._transform._rotation10*li._invLocalInertia02+li._transform._rotation11*li._invLocalInertia12+li._transform._rotation12*li._invLocalInertia22,di=li._transform._rotation20*li._invLocalInertia00+li._transform._rotation21*li._invLocalInertia10+li._transform._rotation22*li._invLocalInertia20,Li=li._transform._rotation20*li._invLocalInertia01+li._transform._rotation21*li._invLocalInertia11+li._transform._rotation22*li._invLocalInertia21,zi=li._transform._rotation20*li._invLocalInertia02+li._transform._rotation21*li._invLocalInertia12+li._transform._rotation22*li._invLocalInertia22,li._invInertia00=Mi,li._invInertia01=gi,li._invInertia02=Yi,li._invInertia10=Zi,li._invInertia11=Ii,li._invInertia12=yi,li._invInertia20=di,li._invInertia21=Li,li._invInertia22=zi,wi=li._invInertia00*li._transform._rotation00+li._invInertia01*li._transform._rotation01+li._invInertia02*li._transform._rotation02,Bi=li._invInertia00*li._transform._rotation10+li._invInertia01*li._transform._rotation11+li._invInertia02*li._transform._rotation12,Ai=li._invInertia00*li._transform._rotation20+li._invInertia01*li._transform._rotation21+li._invInertia02*li._transform._rotation22,Pi=li._invInertia10*li._transform._rotation00+li._invInertia11*li._transform._rotation01+li._invInertia12*li._transform._rotation02,Ti=li._invInertia10*li._transform._rotation10+li._invInertia11*li._transform._rotation11+li._invInertia12*li._transform._rotation12,Si=li._invInertia10*li._transform._rotation20+li._invInertia11*li._transform._rotation21+li._invInertia12*li._transform._rotation22,Vi=li._invInertia20*li._transform._rotation00+li._invInertia21*li._transform._rotation01+li._invInertia22*li._transform._rotation02,ki=li._invInertia20*li._transform._rotation10+li._invInertia21*li._transform._rotation11+li._invInertia22*li._transform._rotation12,Ci=li._invInertia20*li._transform._rotation20+li._invInertia21*li._transform._rotation21+li._invInertia22*li._transform._rotation22,li._invInertia00=wi,li._invInertia01=Bi,li._invInertia02=Ai,li._invInertia10=Pi,li._invInertia11=Ti,li._invInertia12=Si,li._invInertia20=Vi,li._invInertia21=ki,li._invInertia22=Ci,li._invInertia00*=li._rotFactor.x,li._invInertia01*=li._rotFactor.x,li._invInertia02*=li._rotFactor.x,li._invInertia10*=li._rotFactor.y,li._invInertia11*=li._rotFactor.y,li._invInertia12*=li._rotFactor.y,li._invInertia20*=li._rotFactor.z,li._invInertia21*=li._rotFactor.z,li._invInertia22*=li._rotFactor.z},postSolve:function(){this.joint._syncAnchors(),this.joint._checkDestruction()}});var ii=function(){this.mass=0,this.localInertia=new U},ai=function(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;var i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;var a=t.angularVelocity;this._angVelX=a.x,this._angVelY=a.y,this._angVelZ=a.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new F,this._transform=new F;var n=t.position;this._ptransform._positionX=n.x,this._ptransform._positionY=n.y,this._ptransform._positionZ=n.z;var o=t.rotation;this._ptransform._rotation00=o.e00,this._ptransform._rotation01=o.e01,this._ptransform._rotation02=o.e02,this._ptransform._rotation10=o.e10,this._ptransform._rotation11=o.e11,this._ptransform._rotation12=o.e12,this._ptransform._rotation20=o.e20,this._ptransform._rotation21=o.e21,this._ptransform._rotation22=o.e22;var s=this._transform,r=this._ptransform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._rotFactor=new E(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null};ai.prototype={_integrate:function(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var i,a,n,o,s,r,_=(i=this._velX*t)*i+(a=this._velY*t)*a+(n=this._velZ*t)*n,e=(o=this._angVelX*t)*o+(s=this._angVelY*t)*s+(r=this._angVelZ*t)*r;if(0==_&&0==e)return;if(_>D.maxTranslationPerStep*D.maxTranslationPerStep){var h=D.maxTranslationPerStep/Math.sqrt(_);this._velX*=h,this._velY*=h,this._velZ*=h,i*=h,a*=h,n*=h}if(e>D.maxRotationPerStep*D.maxRotationPerStep){var l=D.maxRotationPerStep/Math.sqrt(e);this._angVelX*=l,this._angVelY*=l,this._angVelZ*=l,o*=l,s*=l,r*=l}this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=n;var v,c,m,b,f,p,u,x,X,M,g=Math.sqrt(o*o+s*s+r*r),Y=.5*g;if(Y<.5){var Z=Y*Y;v=.5*(1-.16666666666666666*Z+Z*Z*.008333333333333333),c=1-.5*Z+Z*Z*.041666666666666664}else v=Math.sin(Y)/g,c=Math.cos(Y);m=o*v,b=s*v,f=r*v,p=c;var I,y=this._transform._rotation00,d=this._transform._rotation11,L=this._transform._rotation22,z=y+d+L;z>0?(M=.5*(I=Math.sqrt(z+1)),I=.5/I,u=(this._transform._rotation21-this._transform._rotation12)*I,x=(this._transform._rotation02-this._transform._rotation20)*I,X=(this._transform._rotation10-this._transform._rotation01)*I):y>d?y>L?(u=.5*(I=Math.sqrt(y-d-L+1)),I=.5/I,x=(this._transform._rotation01+this._transform._rotation10)*I,X=(this._transform._rotation02+this._transform._rotation20)*I,M=(this._transform._rotation21-this._transform._rotation12)*I):(X=.5*(I=Math.sqrt(L-y-d+1)),I=.5/I,u=(this._transform._rotation02+this._transform._rotation20)*I,x=(this._transform._rotation12+this._transform._rotation21)*I,M=(this._transform._rotation10-this._transform._rotation01)*I):d>L?(x=.5*(I=Math.sqrt(d-L-y+1)),I=.5/I,u=(this._transform._rotation01+this._transform._rotation10)*I,X=(this._transform._rotation12+this._transform._rotation21)*I,M=(this._transform._rotation02-this._transform._rotation20)*I):(X=.5*(I=Math.sqrt(L-y-d+1)),I=.5/I,u=(this._transform._rotation02+this._transform._rotation20)*I,x=(this._transform._rotation12+this._transform._rotation21)*I,M=(this._transform._rotation10-this._transform._rotation01)*I);var w=(u=p*u+m*M+b*X-f*x)*u+(x=p*x-m*X+b*M+f*u)*x+(X=p*X+m*x-b*u+f*M)*X+(M=p*M-m*u-b*x-f*X)*M;w>1e-32&&(w=1/Math.sqrt(w));u*=w,x*=w,X*=w,M*=w;var B,A,P,T,S,V,k,C,q,R,j,O,E,F,N,W,G,U,J=2*u,H=2*x,Q=2*X,K=u*J,$=x*H,tt=X*Q,it=u*H,at=x*Q,nt=u*Q,ot=M*J,st=M*H,rt=M*Q;this._transform._rotation00=1-$-tt,this._transform._rotation01=it-rt,this._transform._rotation02=nt+st,this._transform._rotation10=it+rt,this._transform._rotation11=1-K-tt,this._transform._rotation12=at-ot,this._transform._rotation20=nt-st,this._transform._rotation21=at+ot,this._transform._rotation22=1-K-$,B=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,P=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,T=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,V=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,k=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,q=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=B,this._invInertia01=A,this._invInertia02=P,this._invInertia10=T,this._invInertia11=S,this._invInertia12=V,this._invInertia20=k,this._invInertia21=C,this._invInertia22=q,R=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,j=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,O=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,E=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,N=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,W=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,G=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,U=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=R,this._invInertia01=j,this._invInertia02=O,this._invInertia10=E,this._invInertia11=F,this._invInertia12=N,this._invInertia20=W,this._invInertia21=G,this._invInertia22=U,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},_integratePseudoVelocity:function(){var t=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ,i=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(0!=t||0!=i)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:var a,n,o,s,r,_;a=this._pseudoVelX,n=this._pseudoVelY,o=this._pseudoVelZ,s=this._angPseudoVelX,r=this._angPseudoVelY,_=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=a,this._transform._positionY+=n,this._transform._positionZ+=o;var e,h,l,v,c,m,b,f,p,u,x=Math.sqrt(s*s+r*r+_*_),X=.5*x;if(X<.5){var M=X*X;e=.5*(1-.16666666666666666*M+M*M*.008333333333333333),h=1-.5*M+M*M*.041666666666666664}else e=Math.sin(X)/x,h=Math.cos(X);l=s*e,v=r*e,c=_*e,m=h;var g,Y=this._transform._rotation00,Z=this._transform._rotation11,I=this._transform._rotation22,y=Y+Z+I;y>0?(u=.5*(g=Math.sqrt(y+1)),g=.5/g,b=(this._transform._rotation21-this._transform._rotation12)*g,f=(this._transform._rotation02-this._transform._rotation20)*g,p=(this._transform._rotation10-this._transform._rotation01)*g):Y>Z?Y>I?(b=.5*(g=Math.sqrt(Y-Z-I+1)),g=.5/g,f=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation02+this._transform._rotation20)*g,u=(this._transform._rotation21-this._transform._rotation12)*g):(p=.5*(g=Math.sqrt(I-Y-Z+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,u=(this._transform._rotation10-this._transform._rotation01)*g):Z>I?(f=.5*(g=Math.sqrt(Z-I-Y+1)),g=.5/g,b=(this._transform._rotation01+this._transform._rotation10)*g,p=(this._transform._rotation12+this._transform._rotation21)*g,u=(this._transform._rotation02-this._transform._rotation20)*g):(p=.5*(g=Math.sqrt(I-Y-Z+1)),g=.5/g,b=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,u=(this._transform._rotation10-this._transform._rotation01)*g);var d=(b=m*b+l*u+v*p-c*f)*b+(f=m*f-l*p+v*u+c*b)*f+(p=m*p+l*f-v*b+c*u)*p+(u=m*u-l*b-v*f-c*p)*u;d>1e-32&&(d=1/Math.sqrt(d));b*=d,f*=d,p*=d,u*=d;var L,z,w,B,A,P,T,S,V,k,C,q,R,j,O,E,F,D,N=2*b,W=2*f,G=2*p,U=b*N,J=f*W,H=p*G,Q=b*W,K=f*G,$=b*G,tt=u*N,it=u*W,at=u*G;this._transform._rotation00=1-J-H,this._transform._rotation01=Q-at,this._transform._rotation02=$+it,this._transform._rotation10=Q+at,this._transform._rotation11=1-U-H,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-U-J,L=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,w=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,B=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,A=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,P=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,T=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,S=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=L,this._invInertia01=z,this._invInertia02=w,this._invInertia10=B,this._invInertia11=A,this._invInertia12=P,this._invInertia20=T,this._invInertia21=S,this._invInertia22=V,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,q=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,j=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,O=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,E=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,D=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=C,this._invInertia02=q,this._invInertia10=R,this._invInertia11=j,this._invInertia12=O,this._invInertia20=E,this._invInertia21=F,this._invInertia22=D,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}},updateMass:function(){var t,i,a,n,o,s,r,_,e;t=0,i=0,a=0,n=0,o=0,s=0,r=0,_=0,e=0;for(var h=0,l=this._shapeList;null!=l;){var v=l._next,c=l._geom;c._updateMass();var m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P=l._density*c._volume;Y=l._localTransform._rotation00*c._inertiaCoeff00+l._localTransform._rotation01*c._inertiaCoeff10+l._localTransform._rotation02*c._inertiaCoeff20,b=l._localTransform._rotation00*c._inertiaCoeff01+l._localTransform._rotation01*c._inertiaCoeff11+l._localTransform._rotation02*c._inertiaCoeff21,f=l._localTransform._rotation00*c._inertiaCoeff02+l._localTransform._rotation01*c._inertiaCoeff12+l._localTransform._rotation02*c._inertiaCoeff22,p=l._localTransform._rotation10*c._inertiaCoeff00+l._localTransform._rotation11*c._inertiaCoeff10+l._localTransform._rotation12*c._inertiaCoeff20,u=l._localTransform._rotation10*c._inertiaCoeff01+l._localTransform._rotation11*c._inertiaCoeff11+l._localTransform._rotation12*c._inertiaCoeff21,x=l._localTransform._rotation10*c._inertiaCoeff02+l._localTransform._rotation11*c._inertiaCoeff12+l._localTransform._rotation12*c._inertiaCoeff22,X=l._localTransform._rotation20*c._inertiaCoeff00+l._localTransform._rotation21*c._inertiaCoeff10+l._localTransform._rotation22*c._inertiaCoeff20,M=l._localTransform._rotation20*c._inertiaCoeff01+l._localTransform._rotation21*c._inertiaCoeff11+l._localTransform._rotation22*c._inertiaCoeff21,g=l._localTransform._rotation20*c._inertiaCoeff02+l._localTransform._rotation21*c._inertiaCoeff12+l._localTransform._rotation22*c._inertiaCoeff22,Z=(m=Y)*l._localTransform._rotation00+b*l._localTransform._rotation01+f*l._localTransform._rotation02,I=m*l._localTransform._rotation10+b*l._localTransform._rotation11+f*l._localTransform._rotation12,y=m*l._localTransform._rotation20+b*l._localTransform._rotation21+f*l._localTransform._rotation22,d=p*l._localTransform._rotation00+u*l._localTransform._rotation01+x*l._localTransform._rotation02,L=p*l._localTransform._rotation10+u*l._localTransform._rotation11+x*l._localTransform._rotation12,z=p*l._localTransform._rotation20+u*l._localTransform._rotation21+x*l._localTransform._rotation22,w=X*l._localTransform._rotation00+M*l._localTransform._rotation01+g*l._localTransform._rotation02,B=X*l._localTransform._rotation10+M*l._localTransform._rotation11+g*l._localTransform._rotation12,A=X*l._localTransform._rotation20+M*l._localTransform._rotation21+g*l._localTransform._rotation22,m=Z,b=I,f=y,p=d,u=L,x=z,X=w,M=B,g=A,m*=P,b*=P,f*=P,p*=P,u*=P,x*=P,X*=P,M*=P,g*=P;var T=l._localTransform._positionX*l._localTransform._positionX,S=l._localTransform._positionY*l._localTransform._positionY,V=l._localTransform._positionZ*l._localTransform._positionZ,k=-l._localTransform._positionX*l._localTransform._positionY,C=-l._localTransform._positionY*l._localTransform._positionZ,q=-l._localTransform._positionZ*l._localTransform._positionX;h+=P,t+=m+=(S+V)*P,i+=b+=k*P,a+=f+=q*P,n+=p+=k*P,o+=u+=(T+V)*P,s+=x+=C*P,r+=X+=q*P,_+=M+=C*P,e+=g+=(T+S)*P,l=v}this._mass=h,this._localInertia00=t,this._localInertia01=i,this._localInertia02=a,this._localInertia10=n,this._localInertia11=o,this._localInertia12=s,this._localInertia20=r,this._localInertia21=_,this._localInertia22=e;var R,j,O,E,F,D,N,W,G,U,J,H,Q,K,$,tt,it,at,nt=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,ot=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,st=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,rt=this._localInertia00*nt-this._localInertia01*ot+this._localInertia02*st;if(this._mass>0&&rt>0&&0==this._type){this._invMass=1/this._mass;var _t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,et=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,ht=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,lt=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,vt=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,ct=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,mt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,bt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,ft=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,pt=this._localInertia00*_t-this._localInertia01*et+this._localInertia02*ht;(pt<-1e-32||pt>1e-32)&&(pt=1/pt),this._invLocalInertia00=_t*pt,this._invLocalInertia01=-lt*pt,this._invLocalInertia02=mt*pt,this._invLocalInertia10=-et*pt,this._invLocalInertia11=vt*pt,this._invLocalInertia12=-bt*pt,this._invLocalInertia20=ht*pt,this._invLocalInertia21=-ct*pt,this._invLocalInertia22=ft*pt,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);R=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,j=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,O=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,E=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,F=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,D=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,N=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,W=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,G=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=R,this._invInertia01=j,this._invInertia02=O,this._invInertia10=E,this._invInertia11=F,this._invInertia12=D,this._invInertia20=N,this._invInertia21=W,this._invInertia22=G,U=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,J=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,H=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Q=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,K=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,$=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,tt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,it=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,at=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=U,this._invInertia01=J,this._invInertia02=H,this._invInertia10=Q,this._invInertia11=K,this._invInertia12=$,this._invInertia20=tt,this._invInertia21=it,this._invInertia22=at,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getPosition:function(){var t=new E,i=t;return i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ,t},getPositionTo:function(t){var i=t;i.x=this._transform._positionX,i.y=this._transform._positionY,i.z=this._transform._positionZ},setPosition:function(t){var i=t;this._transform._positionX=i.x,this._transform._positionY=i.y,this._transform._positionZ=i.z;var a=this._ptransform,n=this._transform;a._positionX=n._positionX,a._positionY=n._positionY,a._positionZ=n._positionZ,a._rotation00=n._rotation00,a._rotation01=n._rotation01,a._rotation02=n._rotation02,a._rotation10=n._rotation10,a._rotation11=n._rotation11,a._rotation12=n._rotation12,a._rotation20=n._rotation20,a._rotation21=n._rotation21,a._rotation22=n._rotation22;for(var o=this._shapeList;null!=o;){var s,r,_,e,h,l,v,c,m,b,f,p,u=o._next,x=o._ptransform,X=o._localTransform,M=this._ptransform;s=M._rotation00*X._rotation00+M._rotation01*X._rotation10+M._rotation02*X._rotation20,r=M._rotation00*X._rotation01+M._rotation01*X._rotation11+M._rotation02*X._rotation21,_=M._rotation00*X._rotation02+M._rotation01*X._rotation12+M._rotation02*X._rotation22,e=M._rotation10*X._rotation00+M._rotation11*X._rotation10+M._rotation12*X._rotation20,h=M._rotation10*X._rotation01+M._rotation11*X._rotation11+M._rotation12*X._rotation21,l=M._rotation10*X._rotation02+M._rotation11*X._rotation12+M._rotation12*X._rotation22,v=M._rotation20*X._rotation00+M._rotation21*X._rotation10+M._rotation22*X._rotation20,c=M._rotation20*X._rotation01+M._rotation21*X._rotation11+M._rotation22*X._rotation21,m=M._rotation20*X._rotation02+M._rotation21*X._rotation12+M._rotation22*X._rotation22,x._rotation00=s,x._rotation01=r,x._rotation02=_,x._rotation10=e,x._rotation11=h,x._rotation12=l,x._rotation20=v,x._rotation21=c,x._rotation22=m,b=M._rotation00*X._positionX+M._rotation01*X._positionY+M._rotation02*X._positionZ,f=M._rotation10*X._positionX+M._rotation11*X._positionY+M._rotation12*X._positionZ,p=M._rotation20*X._positionX+M._rotation21*X._positionY+M._rotation22*X._positionZ,x._positionX=b,x._positionY=f,x._positionZ=p,x._positionX+=M._positionX,x._positionY+=M._positionY,x._positionZ+=M._positionZ;var g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R=o._transform,j=o._localTransform,O=this._transform;if(g=O._rotation00*j._rotation00+O._rotation01*j._rotation10+O._rotation02*j._rotation20,Y=O._rotation00*j._rotation01+O._rotation01*j._rotation11+O._rotation02*j._rotation21,Z=O._rotation00*j._rotation02+O._rotation01*j._rotation12+O._rotation02*j._rotation22,I=O._rotation10*j._rotation00+O._rotation11*j._rotation10+O._rotation12*j._rotation20,y=O._rotation10*j._rotation01+O._rotation11*j._rotation11+O._rotation12*j._rotation21,d=O._rotation10*j._rotation02+O._rotation11*j._rotation12+O._rotation12*j._rotation22,L=O._rotation20*j._rotation00+O._rotation21*j._rotation10+O._rotation22*j._rotation20,z=O._rotation20*j._rotation01+O._rotation21*j._rotation11+O._rotation22*j._rotation21,w=O._rotation20*j._rotation02+O._rotation21*j._rotation12+O._rotation22*j._rotation22,R._rotation00=g,R._rotation01=Y,R._rotation02=Z,R._rotation10=I,R._rotation11=y,R._rotation12=d,R._rotation20=L,R._rotation21=z,R._rotation22=w,B=O._rotation00*j._positionX+O._rotation01*j._positionY+O._rotation02*j._positionZ,A=O._rotation10*j._positionX+O._rotation11*j._positionY+O._rotation12*j._positionZ,P=O._rotation20*j._positionX+O._rotation21*j._positionY+O._rotation22*j._positionZ,R._positionX=B,R._positionY=A,R._positionZ=P,R._positionX+=O._positionX,R._positionY+=O._positionY,R._positionZ+=O._positionZ,o._geom._computeAabb(o._aabb,o._ptransform),T=o._aabb._minX,S=o._aabb._minY,V=o._aabb._minZ,k=o._aabb._maxX,C=o._aabb._maxY,q=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=T<o._aabb._minX?T:o._aabb._minX,o._aabb._minY=S<o._aabb._minY?S:o._aabb._minY,o._aabb._minZ=V<o._aabb._minZ?V:o._aabb._minZ,o._aabb._maxX=k>o._aabb._maxX?k:o._aabb._maxX,o._aabb._maxY=C>o._aabb._maxY?C:o._aabb._maxY,o._aabb._maxZ=q>o._aabb._maxZ?q:o._aabb._maxZ,null!=o._proxy){var E,F,D;E=o._transform._positionX-o._ptransform._positionX,F=o._transform._positionY-o._ptransform._positionY,D=o._transform._positionZ-o._ptransform._positionZ;var N=o.displacement;N.x=E,N.y=F,N.z=D,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=u}this._sleeping=!1,this._sleepTime=0},translate:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._transform._positionX+=i,this._transform._positionY+=a,this._transform._positionZ+=n;var s=this._ptransform,r=this._transform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22;for(var _=this._shapeList;null!=_;){var e,h,l,v,c,m,b,f,p,u,x,X,M=_._next,g=_._ptransform,Y=_._localTransform,Z=this._ptransform;e=Z._rotation00*Y._rotation00+Z._rotation01*Y._rotation10+Z._rotation02*Y._rotation20,h=Z._rotation00*Y._rotation01+Z._rotation01*Y._rotation11+Z._rotation02*Y._rotation21,l=Z._rotation00*Y._rotation02+Z._rotation01*Y._rotation12+Z._rotation02*Y._rotation22,v=Z._rotation10*Y._rotation00+Z._rotation11*Y._rotation10+Z._rotation12*Y._rotation20,c=Z._rotation10*Y._rotation01+Z._rotation11*Y._rotation11+Z._rotation12*Y._rotation21,m=Z._rotation10*Y._rotation02+Z._rotation11*Y._rotation12+Z._rotation12*Y._rotation22,b=Z._rotation20*Y._rotation00+Z._rotation21*Y._rotation10+Z._rotation22*Y._rotation20,f=Z._rotation20*Y._rotation01+Z._rotation21*Y._rotation11+Z._rotation22*Y._rotation21,p=Z._rotation20*Y._rotation02+Z._rotation21*Y._rotation12+Z._rotation22*Y._rotation22,g._rotation00=e,g._rotation01=h,g._rotation02=l,g._rotation10=v,g._rotation11=c,g._rotation12=m,g._rotation20=b,g._rotation21=f,g._rotation22=p,u=Z._rotation00*Y._positionX+Z._rotation01*Y._positionY+Z._rotation02*Y._positionZ,x=Z._rotation10*Y._positionX+Z._rotation11*Y._positionY+Z._rotation12*Y._positionZ,X=Z._rotation20*Y._positionX+Z._rotation21*Y._positionY+Z._rotation22*Y._positionZ,g._positionX=u,g._positionY=x,g._positionZ=X,g._positionX+=Z._positionX,g._positionY+=Z._positionY,g._positionZ+=Z._positionZ;var I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R,j,O,E=_._transform,F=_._localTransform,D=this._transform;if(I=D._rotation00*F._rotation00+D._rotation01*F._rotation10+D._rotation02*F._rotation20,y=D._rotation00*F._rotation01+D._rotation01*F._rotation11+D._rotation02*F._rotation21,d=D._rotation00*F._rotation02+D._rotation01*F._rotation12+D._rotation02*F._rotation22,L=D._rotation10*F._rotation00+D._rotation11*F._rotation10+D._rotation12*F._rotation20,z=D._rotation10*F._rotation01+D._rotation11*F._rotation11+D._rotation12*F._rotation21,w=D._rotation10*F._rotation02+D._rotation11*F._rotation12+D._rotation12*F._rotation22,B=D._rotation20*F._rotation00+D._rotation21*F._rotation10+D._rotation22*F._rotation20,A=D._rotation20*F._rotation01+D._rotation21*F._rotation11+D._rotation22*F._rotation21,P=D._rotation20*F._rotation02+D._rotation21*F._rotation12+D._rotation22*F._rotation22,E._rotation00=I,E._rotation01=y,E._rotation02=d,E._rotation10=L,E._rotation11=z,E._rotation12=w,E._rotation20=B,E._rotation21=A,E._rotation22=P,T=D._rotation00*F._positionX+D._rotation01*F._positionY+D._rotation02*F._positionZ,S=D._rotation10*F._positionX+D._rotation11*F._positionY+D._rotation12*F._positionZ,V=D._rotation20*F._positionX+D._rotation21*F._positionY+D._rotation22*F._positionZ,E._positionX=T,E._positionY=S,E._positionZ=V,E._positionX+=D._positionX,E._positionY+=D._positionY,E._positionZ+=D._positionZ,_._geom._computeAabb(_._aabb,_._ptransform),k=_._aabb._minX,C=_._aabb._minY,q=_._aabb._minZ,R=_._aabb._maxX,j=_._aabb._maxY,O=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=k<_._aabb._minX?k:_._aabb._minX,_._aabb._minY=C<_._aabb._minY?C:_._aabb._minY,_._aabb._minZ=q<_._aabb._minZ?q:_._aabb._minZ,_._aabb._maxX=R>_._aabb._maxX?R:_._aabb._maxX,_._aabb._maxY=j>_._aabb._maxY?j:_._aabb._maxY,_._aabb._maxZ=O>_._aabb._maxZ?O:_._aabb._maxZ,null!=_._proxy){var N,W,G;N=_._transform._positionX-_._ptransform._positionX,W=_._transform._positionY-_._ptransform._positionY,G=_._transform._positionZ-_._ptransform._positionZ;var U=_.displacement;U.x=N,U.y=W,U.z=G,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=M}this._sleeping=!1,this._sleepTime=0},getRotation:function(){var t=new U,i=t;return i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22,t},getRotationTo:function(t){var i=t;i.e00=this._transform._rotation00,i.e01=this._transform._rotation01,i.e02=this._transform._rotation02,i.e10=this._transform._rotation10,i.e11=this._transform._rotation11,i.e12=this._transform._rotation12,i.e20=this._transform._rotation20,i.e21=this._transform._rotation21,i.e22=this._transform._rotation22},setRotation:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=t;this._transform._rotation00=X.e00,this._transform._rotation01=X.e01,this._transform._rotation02=X.e02,this._transform._rotation10=X.e10,this._transform._rotation11=X.e11,this._transform._rotation12=X.e12,this._transform._rotation20=X.e20,this._transform._rotation21=X.e21,this._transform._rotation22=X.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,v=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=v,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=f,this._invInertia20=p,this._invInertia21=u,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var M=this._ptransform,g=this._transform;M._positionX=g._positionX,M._positionY=g._positionY,M._positionZ=g._positionZ,M._rotation00=g._rotation00,M._rotation01=g._rotation01,M._rotation02=g._rotation02,M._rotation10=g._rotation10,M._rotation11=g._rotation11,M._rotation12=g._rotation12,M._rotation20=g._rotation20,M._rotation21=g._rotation21,M._rotation22=g._rotation22;for(var Y=this._shapeList;null!=Y;){var Z,I,y,d,L,z,w,B,A,P,T,S,V=Y._next,k=Y._ptransform,C=Y._localTransform,q=this._ptransform;Z=q._rotation00*C._rotation00+q._rotation01*C._rotation10+q._rotation02*C._rotation20,I=q._rotation00*C._rotation01+q._rotation01*C._rotation11+q._rotation02*C._rotation21,y=q._rotation00*C._rotation02+q._rotation01*C._rotation12+q._rotation02*C._rotation22,d=q._rotation10*C._rotation00+q._rotation11*C._rotation10+q._rotation12*C._rotation20,L=q._rotation10*C._rotation01+q._rotation11*C._rotation11+q._rotation12*C._rotation21,z=q._rotation10*C._rotation02+q._rotation11*C._rotation12+q._rotation12*C._rotation22,w=q._rotation20*C._rotation00+q._rotation21*C._rotation10+q._rotation22*C._rotation20,B=q._rotation20*C._rotation01+q._rotation21*C._rotation11+q._rotation22*C._rotation21,A=q._rotation20*C._rotation02+q._rotation21*C._rotation12+q._rotation22*C._rotation22,k._rotation00=Z,k._rotation01=I,k._rotation02=y,k._rotation10=d,k._rotation11=L,k._rotation12=z,k._rotation20=w,k._rotation21=B,k._rotation22=A,P=q._rotation00*C._positionX+q._rotation01*C._positionY+q._rotation02*C._positionZ,T=q._rotation10*C._positionX+q._rotation11*C._positionY+q._rotation12*C._positionZ,S=q._rotation20*C._positionX+q._rotation21*C._positionY+q._rotation22*C._positionZ,k._positionX=P,k._positionY=T,k._positionZ=S,k._positionX+=q._positionX,k._positionY+=q._positionY,k._positionZ+=q._positionZ;var R,j,O,E,F,D,N,W,G,U,J,H,Q,K,$,tt,it,at,nt=Y._transform,ot=Y._localTransform,st=this._transform;if(R=st._rotation00*ot._rotation00+st._rotation01*ot._rotation10+st._rotation02*ot._rotation20,j=st._rotation00*ot._rotation01+st._rotation01*ot._rotation11+st._rotation02*ot._rotation21,O=st._rotation00*ot._rotation02+st._rotation01*ot._rotation12+st._rotation02*ot._rotation22,E=st._rotation10*ot._rotation00+st._rotation11*ot._rotation10+st._rotation12*ot._rotation20,F=st._rotation10*ot._rotation01+st._rotation11*ot._rotation11+st._rotation12*ot._rotation21,D=st._rotation10*ot._rotation02+st._rotation11*ot._rotation12+st._rotation12*ot._rotation22,N=st._rotation20*ot._rotation00+st._rotation21*ot._rotation10+st._rotation22*ot._rotation20,W=st._rotation20*ot._rotation01+st._rotation21*ot._rotation11+st._rotation22*ot._rotation21,G=st._rotation20*ot._rotation02+st._rotation21*ot._rotation12+st._rotation22*ot._rotation22,nt._rotation00=R,nt._rotation01=j,nt._rotation02=O,nt._rotation10=E,nt._rotation11=F,nt._rotation12=D,nt._rotation20=N,nt._rotation21=W,nt._rotation22=G,U=st._rotation00*ot._positionX+st._rotation01*ot._positionY+st._rotation02*ot._positionZ,J=st._rotation10*ot._positionX+st._rotation11*ot._positionY+st._rotation12*ot._positionZ,H=st._rotation20*ot._positionX+st._rotation21*ot._positionY+st._rotation22*ot._positionZ,nt._positionX=U,nt._positionY=J,nt._positionZ=H,nt._positionX+=st._positionX,nt._positionY+=st._positionY,nt._positionZ+=st._positionZ,Y._geom._computeAabb(Y._aabb,Y._ptransform),Q=Y._aabb._minX,K=Y._aabb._minY,$=Y._aabb._minZ,tt=Y._aabb._maxX,it=Y._aabb._maxY,at=Y._aabb._maxZ,Y._geom._computeAabb(Y._aabb,Y._transform),Y._aabb._minX=Q<Y._aabb._minX?Q:Y._aabb._minX,Y._aabb._minY=K<Y._aabb._minY?K:Y._aabb._minY,Y._aabb._minZ=$<Y._aabb._minZ?$:Y._aabb._minZ,Y._aabb._maxX=tt>Y._aabb._maxX?tt:Y._aabb._maxX,Y._aabb._maxY=it>Y._aabb._maxY?it:Y._aabb._maxY,Y._aabb._maxZ=at>Y._aabb._maxZ?at:Y._aabb._maxZ,null!=Y._proxy){var rt,_t,et;rt=Y._transform._positionX-Y._ptransform._positionX,_t=Y._transform._positionY-Y._ptransform._positionY,et=Y._transform._positionZ-Y._ptransform._positionZ;var ht=Y.displacement;ht.x=rt,ht.y=_t,ht.z=et,Y._rigidBody._world._broadPhase.moveProxy(Y._proxy,Y._aabb,Y.displacement)}Y=V}this._sleeping=!1,this._sleepTime=0},setRotationXyz:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z;var s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=Math.sin(i),I=Math.sin(a),y=Math.sin(n),d=Math.cos(i),L=Math.cos(a),z=Math.cos(n);this._transform._rotation00=L*z,this._transform._rotation01=-L*y,this._transform._rotation02=I,this._transform._rotation10=d*y+z*Z*I,this._transform._rotation11=d*z-Z*I*y,this._transform._rotation12=-L*Z,this._transform._rotation20=Z*y-d*z*I,this._transform._rotation21=z*Z+d*I*y,this._transform._rotation22=d*L,s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=r,this._invInertia02=_,this._invInertia10=e,this._invInertia11=h,this._invInertia12=l,this._invInertia20=v,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,X=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,M=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=f,this._invInertia02=p,this._invInertia10=u,this._invInertia11=x,this._invInertia12=X,this._invInertia20=M,this._invInertia21=g,this._invInertia22=Y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var w=this._ptransform,B=this._transform;w._positionX=B._positionX,w._positionY=B._positionY,w._positionZ=B._positionZ,w._rotation00=B._rotation00,w._rotation01=B._rotation01,w._rotation02=B._rotation02,w._rotation10=B._rotation10,w._rotation11=B._rotation11,w._rotation12=B._rotation12,w._rotation20=B._rotation20,w._rotation21=B._rotation21,w._rotation22=B._rotation22;for(var A=this._shapeList;null!=A;){var P,T,S,V,k,C,q,R,j,O,E,F,D=A._next,N=A._ptransform,W=A._localTransform,G=this._ptransform;P=G._rotation00*W._rotation00+G._rotation01*W._rotation10+G._rotation02*W._rotation20,T=G._rotation00*W._rotation01+G._rotation01*W._rotation11+G._rotation02*W._rotation21,S=G._rotation00*W._rotation02+G._rotation01*W._rotation12+G._rotation02*W._rotation22,V=G._rotation10*W._rotation00+G._rotation11*W._rotation10+G._rotation12*W._rotation20,k=G._rotation10*W._rotation01+G._rotation11*W._rotation11+G._rotation12*W._rotation21,C=G._rotation10*W._rotation02+G._rotation11*W._rotation12+G._rotation12*W._rotation22,q=G._rotation20*W._rotation00+G._rotation21*W._rotation10+G._rotation22*W._rotation20,R=G._rotation20*W._rotation01+G._rotation21*W._rotation11+G._rotation22*W._rotation21,j=G._rotation20*W._rotation02+G._rotation21*W._rotation12+G._rotation22*W._rotation22,N._rotation00=P,N._rotation01=T,N._rotation02=S,N._rotation10=V,N._rotation11=k,N._rotation12=C,N._rotation20=q,N._rotation21=R,N._rotation22=j,O=G._rotation00*W._positionX+G._rotation01*W._positionY+G._rotation02*W._positionZ,E=G._rotation10*W._positionX+G._rotation11*W._positionY+G._rotation12*W._positionZ,F=G._rotation20*W._positionX+G._rotation21*W._positionY+G._rotation22*W._positionZ,N._positionX=O,N._positionY=E,N._positionZ=F,N._positionX+=G._positionX,N._positionY+=G._positionY,N._positionZ+=G._positionZ;var U,J,H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct=A._transform,mt=A._localTransform,bt=this._transform;if(U=bt._rotation00*mt._rotation00+bt._rotation01*mt._rotation10+bt._rotation02*mt._rotation20,J=bt._rotation00*mt._rotation01+bt._rotation01*mt._rotation11+bt._rotation02*mt._rotation21,H=bt._rotation00*mt._rotation02+bt._rotation01*mt._rotation12+bt._rotation02*mt._rotation22,Q=bt._rotation10*mt._rotation00+bt._rotation11*mt._rotation10+bt._rotation12*mt._rotation20,K=bt._rotation10*mt._rotation01+bt._rotation11*mt._rotation11+bt._rotation12*mt._rotation21,$=bt._rotation10*mt._rotation02+bt._rotation11*mt._rotation12+bt._rotation12*mt._rotation22,tt=bt._rotation20*mt._rotation00+bt._rotation21*mt._rotation10+bt._rotation22*mt._rotation20,it=bt._rotation20*mt._rotation01+bt._rotation21*mt._rotation11+bt._rotation22*mt._rotation21,at=bt._rotation20*mt._rotation02+bt._rotation21*mt._rotation12+bt._rotation22*mt._rotation22,ct._rotation00=U,ct._rotation01=J,ct._rotation02=H,ct._rotation10=Q,ct._rotation11=K,ct._rotation12=$,ct._rotation20=tt,ct._rotation21=it,ct._rotation22=at,nt=bt._rotation00*mt._positionX+bt._rotation01*mt._positionY+bt._rotation02*mt._positionZ,ot=bt._rotation10*mt._positionX+bt._rotation11*mt._positionY+bt._rotation12*mt._positionZ,st=bt._rotation20*mt._positionX+bt._rotation21*mt._positionY+bt._rotation22*mt._positionZ,ct._positionX=nt,ct._positionY=ot,ct._positionZ=st,ct._positionX+=bt._positionX,ct._positionY+=bt._positionY,ct._positionZ+=bt._positionZ,A._geom._computeAabb(A._aabb,A._ptransform),rt=A._aabb._minX,_t=A._aabb._minY,et=A._aabb._minZ,ht=A._aabb._maxX,lt=A._aabb._maxY,vt=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=rt<A._aabb._minX?rt:A._aabb._minX,A._aabb._minY=_t<A._aabb._minY?_t:A._aabb._minY,A._aabb._minZ=et<A._aabb._minZ?et:A._aabb._minZ,A._aabb._maxX=ht>A._aabb._maxX?ht:A._aabb._maxX,A._aabb._maxY=lt>A._aabb._maxY?lt:A._aabb._maxY,A._aabb._maxZ=vt>A._aabb._maxZ?vt:A._aabb._maxZ,null!=A._proxy){var ft,pt,ut;ft=A._transform._positionX-A._ptransform._positionX,pt=A._transform._positionY-A._ptransform._positionY,ut=A._transform._positionZ-A._ptransform._positionZ;var xt=A.displacement;xt.x=ft,xt.y=pt,xt.z=ut,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=D}this._sleeping=!1,this._sleepTime=0},rotate:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C=t;i=C.e00,a=C.e01,n=C.e02,o=C.e10,s=C.e11,r=C.e12,_=C.e20,e=C.e21,h=C.e22,l=i*this._transform._rotation00+a*this._transform._rotation10+n*this._transform._rotation20,v=i*this._transform._rotation01+a*this._transform._rotation11+n*this._transform._rotation21,c=i*this._transform._rotation02+a*this._transform._rotation12+n*this._transform._rotation22,m=o*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,b=o*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,f=o*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,p=_*this._transform._rotation00+e*this._transform._rotation10+h*this._transform._rotation20,u=_*this._transform._rotation01+e*this._transform._rotation11+h*this._transform._rotation21,x=_*this._transform._rotation02+e*this._transform._rotation12+h*this._transform._rotation22,this._transform._rotation00=l,this._transform._rotation01=v,this._transform._rotation02=c,this._transform._rotation10=m,this._transform._rotation11=b,this._transform._rotation12=f,this._transform._rotation20=p,this._transform._rotation21=u,this._transform._rotation22=x,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,M=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,y=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,d=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,L=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=M,this._invInertia02=g,this._invInertia10=Y,this._invInertia11=Z,this._invInertia12=I,this._invInertia20=y,this._invInertia21=d,this._invInertia22=L,z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,B=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,A=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,S=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,V=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,k=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=z,this._invInertia01=w,this._invInertia02=B,this._invInertia10=A,this._invInertia11=P,this._invInertia12=T,this._invInertia20=S,this._invInertia21=V,this._invInertia22=k,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var q=this._ptransform,R=this._transform;q._positionX=R._positionX,q._positionY=R._positionY,q._positionZ=R._positionZ,q._rotation00=R._rotation00,q._rotation01=R._rotation01,q._rotation02=R._rotation02,q._rotation10=R._rotation10,q._rotation11=R._rotation11,q._rotation12=R._rotation12,q._rotation20=R._rotation20,q._rotation21=R._rotation21,q._rotation22=R._rotation22;for(var j=this._shapeList;null!=j;){var O,E,F,D,N,W,G,U,J,H,Q,K,$=j._next,tt=j._ptransform,it=j._localTransform,at=this._ptransform;O=at._rotation00*it._rotation00+at._rotation01*it._rotation10+at._rotation02*it._rotation20,E=at._rotation00*it._rotation01+at._rotation01*it._rotation11+at._rotation02*it._rotation21,F=at._rotation00*it._rotation02+at._rotation01*it._rotation12+at._rotation02*it._rotation22,D=at._rotation10*it._rotation00+at._rotation11*it._rotation10+at._rotation12*it._rotation20,N=at._rotation10*it._rotation01+at._rotation11*it._rotation11+at._rotation12*it._rotation21,W=at._rotation10*it._rotation02+at._rotation11*it._rotation12+at._rotation12*it._rotation22,G=at._rotation20*it._rotation00+at._rotation21*it._rotation10+at._rotation22*it._rotation20,U=at._rotation20*it._rotation01+at._rotation21*it._rotation11+at._rotation22*it._rotation21,J=at._rotation20*it._rotation02+at._rotation21*it._rotation12+at._rotation22*it._rotation22,tt._rotation00=O,tt._rotation01=E,tt._rotation02=F,tt._rotation10=D,tt._rotation11=N,tt._rotation12=W,tt._rotation20=G,tt._rotation21=U,tt._rotation22=J,H=at._rotation00*it._positionX+at._rotation01*it._positionY+at._rotation02*it._positionZ,Q=at._rotation10*it._positionX+at._rotation11*it._positionY+at._rotation12*it._positionZ,K=at._rotation20*it._positionX+at._rotation21*it._positionY+at._rotation22*it._positionZ,tt._positionX=H,tt._positionY=Q,tt._positionZ=K,tt._positionX+=at._positionX,tt._positionY+=at._positionY,tt._positionZ+=at._positionZ;var nt,ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt,ft,pt,ut,xt,Xt,Mt,gt=j._transform,Yt=j._localTransform,Zt=this._transform;if(nt=Zt._rotation00*Yt._rotation00+Zt._rotation01*Yt._rotation10+Zt._rotation02*Yt._rotation20,ot=Zt._rotation00*Yt._rotation01+Zt._rotation01*Yt._rotation11+Zt._rotation02*Yt._rotation21,st=Zt._rotation00*Yt._rotation02+Zt._rotation01*Yt._rotation12+Zt._rotation02*Yt._rotation22,rt=Zt._rotation10*Yt._rotation00+Zt._rotation11*Yt._rotation10+Zt._rotation12*Yt._rotation20,_t=Zt._rotation10*Yt._rotation01+Zt._rotation11*Yt._rotation11+Zt._rotation12*Yt._rotation21,et=Zt._rotation10*Yt._rotation02+Zt._rotation11*Yt._rotation12+Zt._rotation12*Yt._rotation22,ht=Zt._rotation20*Yt._rotation00+Zt._rotation21*Yt._rotation10+Zt._rotation22*Yt._rotation20,lt=Zt._rotation20*Yt._rotation01+Zt._rotation21*Yt._rotation11+Zt._rotation22*Yt._rotation21,vt=Zt._rotation20*Yt._rotation02+Zt._rotation21*Yt._rotation12+Zt._rotation22*Yt._rotation22,gt._rotation00=nt,gt._rotation01=ot,gt._rotation02=st,gt._rotation10=rt,gt._rotation11=_t,gt._rotation12=et,gt._rotation20=ht,gt._rotation21=lt,gt._rotation22=vt,ct=Zt._rotation00*Yt._positionX+Zt._rotation01*Yt._positionY+Zt._rotation02*Yt._positionZ,mt=Zt._rotation10*Yt._positionX+Zt._rotation11*Yt._positionY+Zt._rotation12*Yt._positionZ,bt=Zt._rotation20*Yt._positionX+Zt._rotation21*Yt._positionY+Zt._rotation22*Yt._positionZ,gt._positionX=ct,gt._positionY=mt,gt._positionZ=bt,gt._positionX+=Zt._positionX,gt._positionY+=Zt._positionY,gt._positionZ+=Zt._positionZ,j._geom._computeAabb(j._aabb,j._ptransform),ft=j._aabb._minX,pt=j._aabb._minY,ut=j._aabb._minZ,xt=j._aabb._maxX,Xt=j._aabb._maxY,Mt=j._aabb._maxZ,j._geom._computeAabb(j._aabb,j._transform),j._aabb._minX=ft<j._aabb._minX?ft:j._aabb._minX,j._aabb._minY=pt<j._aabb._minY?pt:j._aabb._minY,j._aabb._minZ=ut<j._aabb._minZ?ut:j._aabb._minZ,j._aabb._maxX=xt>j._aabb._maxX?xt:j._aabb._maxX,j._aabb._maxY=Xt>j._aabb._maxY?Xt:j._aabb._maxY,j._aabb._maxZ=Mt>j._aabb._maxZ?Mt:j._aabb._maxZ,null!=j._proxy){var It,yt,dt;It=j._transform._positionX-j._ptransform._positionX,yt=j._transform._positionY-j._ptransform._positionY,dt=j._transform._positionZ-j._ptransform._positionZ;var Lt=j.displacement;Lt.x=It,Lt.y=yt,Lt.z=dt,j._rigidBody._world._broadPhase.moveProxy(j._proxy,j._aabb,j.displacement)}j=$}this._sleeping=!1,this._sleepTime=0},rotateXyz:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m=t;i=m.x,a=m.y,n=m.z;var b,f,p,u,x,X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q,R,j,O=Math.sin(i),E=Math.sin(a),F=Math.sin(n),D=Math.cos(i),N=Math.cos(a),W=Math.cos(n);s=-N*F,r=E,_=D*F+W*O*E,e=D*W-O*E*F,h=-N*O,l=O*F-D*W*E,v=W*O+D*E*F,c=D*N,b=(o=N*W)*this._transform._rotation00+s*this._transform._rotation10+r*this._transform._rotation20,f=o*this._transform._rotation01+s*this._transform._rotation11+r*this._transform._rotation21,p=o*this._transform._rotation02+s*this._transform._rotation12+r*this._transform._rotation22,u=_*this._transform._rotation00+e*this._transform._rotation10+h*this._transform._rotation20,x=_*this._transform._rotation01+e*this._transform._rotation11+h*this._transform._rotation21,X=_*this._transform._rotation02+e*this._transform._rotation12+h*this._transform._rotation22,M=l*this._transform._rotation00+v*this._transform._rotation10+c*this._transform._rotation20,g=l*this._transform._rotation01+v*this._transform._rotation11+c*this._transform._rotation21,Y=l*this._transform._rotation02+v*this._transform._rotation12+c*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=f,this._transform._rotation02=p,this._transform._rotation10=u,this._transform._rotation11=x,this._transform._rotation12=X,this._transform._rotation20=M,this._transform._rotation21=g,this._transform._rotation22=Y,Z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,y=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,L=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,w=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,B=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Z,this._invInertia01=I,this._invInertia02=y,this._invInertia10=d,this._invInertia11=L,this._invInertia12=z,this._invInertia20=w,this._invInertia21=B,this._invInertia22=A,P=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,T=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,S=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,V=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,k=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,q=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,j=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=P,this._invInertia01=T,this._invInertia02=S,this._invInertia10=V,this._invInertia11=k,this._invInertia12=C,this._invInertia20=q,this._invInertia21=R,this._invInertia22=j,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var G=this._ptransform,U=this._transform;G._positionX=U._positionX,G._positionY=U._positionY,G._positionZ=U._positionZ,G._rotation00=U._rotation00,G._rotation01=U._rotation01,G._rotation02=U._rotation02,G._rotation10=U._rotation10,G._rotation11=U._rotation11,G._rotation12=U._rotation12,G._rotation20=U._rotation20,G._rotation21=U._rotation21,G._rotation22=U._rotation22;for(var J=this._shapeList;null!=J;){var H,Q,K,$,tt,it,at,nt,ot,st,rt,_t,et=J._next,ht=J._ptransform,lt=J._localTransform,vt=this._ptransform;H=vt._rotation00*lt._rotation00+vt._rotation01*lt._rotation10+vt._rotation02*lt._rotation20,Q=vt._rotation00*lt._rotation01+vt._rotation01*lt._rotation11+vt._rotation02*lt._rotation21,K=vt._rotation00*lt._rotation02+vt._rotation01*lt._rotation12+vt._rotation02*lt._rotation22,$=vt._rotation10*lt._rotation00+vt._rotation11*lt._rotation10+vt._rotation12*lt._rotation20,tt=vt._rotation10*lt._rotation01+vt._rotation11*lt._rotation11+vt._rotation12*lt._rotation21,it=vt._rotation10*lt._rotation02+vt._rotation11*lt._rotation12+vt._rotation12*lt._rotation22,at=vt._rotation20*lt._rotation00+vt._rotation21*lt._rotation10+vt._rotation22*lt._rotation20,nt=vt._rotation20*lt._rotation01+vt._rotation21*lt._rotation11+vt._rotation22*lt._rotation21,ot=vt._rotation20*lt._rotation02+vt._rotation21*lt._rotation12+vt._rotation22*lt._rotation22,ht._rotation00=H,ht._rotation01=Q,ht._rotation02=K,ht._rotation10=$,ht._rotation11=tt,ht._rotation12=it,ht._rotation20=at,ht._rotation21=nt,ht._rotation22=ot,st=vt._rotation00*lt._positionX+vt._rotation01*lt._positionY+vt._rotation02*lt._positionZ,rt=vt._rotation10*lt._positionX+vt._rotation11*lt._positionY+vt._rotation12*lt._positionZ,_t=vt._rotation20*lt._positionX+vt._rotation21*lt._positionY+vt._rotation22*lt._positionZ,ht._positionX=st,ht._positionY=rt,ht._positionZ=_t,ht._positionX+=vt._positionX,ht._positionY+=vt._positionY,ht._positionZ+=vt._positionZ;var ct,mt,bt,ft,pt,ut,xt,Xt,Mt,gt,Yt,Zt,It,yt,dt,Lt,zt,wt,Bt=J._transform,At=J._localTransform,Pt=this._transform;if(ct=Pt._rotation00*At._rotation00+Pt._rotation01*At._rotation10+Pt._rotation02*At._rotation20,mt=Pt._rotation00*At._rotation01+Pt._rotation01*At._rotation11+Pt._rotation02*At._rotation21,bt=Pt._rotation00*At._rotation02+Pt._rotation01*At._rotation12+Pt._rotation02*At._rotation22,ft=Pt._rotation10*At._rotation00+Pt._rotation11*At._rotation10+Pt._rotation12*At._rotation20,pt=Pt._rotation10*At._rotation01+Pt._rotation11*At._rotation11+Pt._rotation12*At._rotation21,ut=Pt._rotation10*At._rotation02+Pt._rotation11*At._rotation12+Pt._rotation12*At._rotation22,xt=Pt._rotation20*At._rotation00+Pt._rotation21*At._rotation10+Pt._rotation22*At._rotation20,Xt=Pt._rotation20*At._rotation01+Pt._rotation21*At._rotation11+Pt._rotation22*At._rotation21,Mt=Pt._rotation20*At._rotation02+Pt._rotation21*At._rotation12+Pt._rotation22*At._rotation22,Bt._rotation00=ct,Bt._rotation01=mt,Bt._rotation02=bt,Bt._rotation10=ft,Bt._rotation11=pt,Bt._rotation12=ut,Bt._rotation20=xt,Bt._rotation21=Xt,Bt._rotation22=Mt,gt=Pt._rotation00*At._positionX+Pt._rotation01*At._positionY+Pt._rotation02*At._positionZ,Yt=Pt._rotation10*At._positionX+Pt._rotation11*At._positionY+Pt._rotation12*At._positionZ,Zt=Pt._rotation20*At._positionX+Pt._rotation21*At._positionY+Pt._rotation22*At._positionZ,Bt._positionX=gt,Bt._positionY=Yt,Bt._positionZ=Zt,Bt._positionX+=Pt._positionX,Bt._positionY+=Pt._positionY,Bt._positionZ+=Pt._positionZ,J._geom._computeAabb(J._aabb,J._ptransform),It=J._aabb._minX,yt=J._aabb._minY,dt=J._aabb._minZ,Lt=J._aabb._maxX,zt=J._aabb._maxY,wt=J._aabb._maxZ,J._geom._computeAabb(J._aabb,J._transform),J._aabb._minX=It<J._aabb._minX?It:J._aabb._minX,J._aabb._minY=yt<J._aabb._minY?yt:J._aabb._minY,J._aabb._minZ=dt<J._aabb._minZ?dt:J._aabb._minZ,J._aabb._maxX=Lt>J._aabb._maxX?Lt:J._aabb._maxX,J._aabb._maxY=zt>J._aabb._maxY?zt:J._aabb._maxY,J._aabb._maxZ=wt>J._aabb._maxZ?wt:J._aabb._maxZ,null!=J._proxy){var Tt,St,Vt;Tt=J._transform._positionX-J._ptransform._positionX,St=J._transform._positionY-J._ptransform._positionY,Vt=J._transform._positionZ-J._ptransform._positionZ;var kt=J.displacement;kt.x=Tt,kt.y=St,kt.z=Vt,J._rigidBody._world._broadPhase.moveProxy(J._proxy,J._aabb,J.displacement)}J=et}this._sleeping=!1,this._sleepTime=0},getOrientation:function(){var t,i,a,n,o,s=new K,r=this._transform._rotation00,_=this._transform._rotation11,e=this._transform._rotation22,h=r+_+e;h>0?(n=.5*(o=Math.sqrt(h+1)),o=.5/o,t=(this._transform._rotation21-this._transform._rotation12)*o,i=(this._transform._rotation02-this._transform._rotation20)*o,a=(this._transform._rotation10-this._transform._rotation01)*o):r>_?r>e?(t=.5*(o=Math.sqrt(r-_-e+1)),o=.5/o,i=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation02+this._transform._rotation20)*o,n=(this._transform._rotation21-this._transform._rotation12)*o):(a=.5*(o=Math.sqrt(e-r-_+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation10-this._transform._rotation01)*o):_>e?(i=.5*(o=Math.sqrt(_-e-r+1)),o=.5/o,t=(this._transform._rotation01+this._transform._rotation10)*o,a=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation02-this._transform._rotation20)*o):(a=.5*(o=Math.sqrt(e-r-_+1)),o=.5/o,t=(this._transform._rotation02+this._transform._rotation20)*o,i=(this._transform._rotation12+this._transform._rotation21)*o,n=(this._transform._rotation10-this._transform._rotation01)*o);var l=s;return l.x=t,l.y=i,l.z=a,l.w=n,s},getOrientationTo:function(t){var i,a,n,o,s,r=this._transform._rotation00,_=this._transform._rotation11,e=this._transform._rotation22,h=r+_+e;h>0?(o=.5*(s=Math.sqrt(h+1)),s=.5/s,i=(this._transform._rotation21-this._transform._rotation12)*s,a=(this._transform._rotation02-this._transform._rotation20)*s,n=(this._transform._rotation10-this._transform._rotation01)*s):r>_?r>e?(i=.5*(s=Math.sqrt(r-_-e+1)),s=.5/s,a=(this._transform._rotation01+this._transform._rotation10)*s,n=(this._transform._rotation02+this._transform._rotation20)*s,o=(this._transform._rotation21-this._transform._rotation12)*s):(n=.5*(s=Math.sqrt(e-r-_+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation10-this._transform._rotation01)*s):_>e?(a=.5*(s=Math.sqrt(_-e-r+1)),s=.5/s,i=(this._transform._rotation01+this._transform._rotation10)*s,n=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation02-this._transform._rotation20)*s):(n=.5*(s=Math.sqrt(e-r-_+1)),s=.5/s,i=(this._transform._rotation02+this._transform._rotation20)*s,a=(this._transform._rotation12+this._transform._rotation21)*s,o=(this._transform._rotation10-this._transform._rotation01)*s);var l=t;l.x=i,l.y=a,l.z=n,l.w=o},setOrientation:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M,g,Y,Z=t,I=(i=Z.x,a=Z.y,n=Z.z,o=Z.w,2*i),y=2*a,d=2*n,L=i*I,z=a*y,w=n*d,B=i*y,A=a*d,P=i*d,T=o*I,S=o*y,V=o*d;this._transform._rotation00=1-z-w,this._transform._rotation01=B-V,this._transform._rotation02=P+S,this._transform._rotation10=B+V,this._transform._rotation11=1-L-w,this._transform._rotation12=A-T,this._transform._rotation20=P-S,this._transform._rotation21=A+T,this._transform._rotation22=1-L-z,s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,_=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,e=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,h=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=r,this._invInertia02=_,this._invInertia10=e,this._invInertia11=h,this._invInertia12=l,this._invInertia20=v,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,X=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,M=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=f,this._invInertia02=p,this._invInertia10=u,this._invInertia11=x,this._invInertia12=X,this._invInertia20=M,this._invInertia21=g,this._invInertia22=Y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var k=this._ptransform,C=this._transform;k._positionX=C._positionX,k._positionY=C._positionY,k._positionZ=C._positionZ,k._rotation00=C._rotation00,k._rotation01=C._rotation01,k._rotation02=C._rotation02,k._rotation10=C._rotation10,k._rotation11=C._rotation11,k._rotation12=C._rotation12,k._rotation20=C._rotation20,k._rotation21=C._rotation21,k._rotation22=C._rotation22;for(var q=this._shapeList;null!=q;){var R,j,O,E,F,D,N,W,G,U,J,H,Q=q._next,K=q._ptransform,$=q._localTransform,tt=this._ptransform;R=tt._rotation00*$._rotation00+tt._rotation01*$._rotation10+tt._rotation02*$._rotation20,j=tt._rotation00*$._rotation01+tt._rotation01*$._rotation11+tt._rotation02*$._rotation21,O=tt._rotation00*$._rotation02+tt._rotation01*$._rotation12+tt._rotation02*$._rotation22,E=tt._rotation10*$._rotation00+tt._rotation11*$._rotation10+tt._rotation12*$._rotation20,F=tt._rotation10*$._rotation01+tt._rotation11*$._rotation11+tt._rotation12*$._rotation21,D=tt._rotation10*$._rotation02+tt._rotation11*$._rotation12+tt._rotation12*$._rotation22,N=tt._rotation20*$._rotation00+tt._rotation21*$._rotation10+tt._rotation22*$._rotation20,W=tt._rotation20*$._rotation01+tt._rotation21*$._rotation11+tt._rotation22*$._rotation21,G=tt._rotation20*$._rotation02+tt._rotation21*$._rotation12+tt._rotation22*$._rotation22,K._rotation00=R,K._rotation01=j,K._rotation02=O,K._rotation10=E,K._rotation11=F,K._rotation12=D,K._rotation20=N,K._rotation21=W,K._rotation22=G,U=tt._rotation00*$._positionX+tt._rotation01*$._positionY+tt._rotation02*$._positionZ,J=tt._rotation10*$._positionX+tt._rotation11*$._positionY+tt._rotation12*$._positionZ,H=tt._rotation20*$._positionX+tt._rotation21*$._positionY+tt._rotation22*$._positionZ,K._positionX=U,K._positionY=J,K._positionZ=H,K._positionX+=tt._positionX,K._positionY+=tt._positionY,K._positionZ+=tt._positionZ;var it,at,nt,ot,st,rt,_t,et,ht,lt,vt,ct,mt,bt,ft,pt,ut,xt,Xt=q._transform,Mt=q._localTransform,gt=this._transform;if(it=gt._rotation00*Mt._rotation00+gt._rotation01*Mt._rotation10+gt._rotation02*Mt._rotation20,at=gt._rotation00*Mt._rotation01+gt._rotation01*Mt._rotation11+gt._rotation02*Mt._rotation21,nt=gt._rotation00*Mt._rotation02+gt._rotation01*Mt._rotation12+gt._rotation02*Mt._rotation22,ot=gt._rotation10*Mt._rotation00+gt._rotation11*Mt._rotation10+gt._rotation12*Mt._rotation20,st=gt._rotation10*Mt._rotation01+gt._rotation11*Mt._rotation11+gt._rotation12*Mt._rotation21,rt=gt._rotation10*Mt._rotation02+gt._rotation11*Mt._rotation12+gt._rotation12*Mt._rotation22,_t=gt._rotation20*Mt._rotation00+gt._rotation21*Mt._rotation10+gt._rotation22*Mt._rotation20,et=gt._rotation20*Mt._rotation01+gt._rotation21*Mt._rotation11+gt._rotation22*Mt._rotation21,ht=gt._rotation20*Mt._rotation02+gt._rotation21*Mt._rotation12+gt._rotation22*Mt._rotation22,Xt._rotation00=it,Xt._rotation01=at,Xt._rotation02=nt,Xt._rotation10=ot,Xt._rotation11=st,Xt._rotation12=rt,Xt._rotation20=_t,Xt._rotation21=et,Xt._rotation22=ht,lt=gt._rotation00*Mt._positionX+gt._rotation01*Mt._positionY+gt._rotation02*Mt._positionZ,vt=gt._rotation10*Mt._positionX+gt._rotation11*Mt._positionY+gt._rotation12*Mt._positionZ,ct=gt._rotation20*Mt._positionX+gt._rotation21*Mt._positionY+gt._rotation22*Mt._positionZ,Xt._positionX=lt,Xt._positionY=vt,Xt._positionZ=ct,Xt._positionX+=gt._positionX,Xt._positionY+=gt._positionY,Xt._positionZ+=gt._positionZ,q._geom._computeAabb(q._aabb,q._ptransform),mt=q._aabb._minX,bt=q._aabb._minY,ft=q._aabb._minZ,pt=q._aabb._maxX,ut=q._aabb._maxY,xt=q._aabb._maxZ,q._geom._computeAabb(q._aabb,q._transform),q._aabb._minX=mt<q._aabb._minX?mt:q._aabb._minX,q._aabb._minY=bt<q._aabb._minY?bt:q._aabb._minY,q._aabb._minZ=ft<q._aabb._minZ?ft:q._aabb._minZ,q._aabb._maxX=pt>q._aabb._maxX?pt:q._aabb._maxX,q._aabb._maxY=ut>q._aabb._maxY?ut:q._aabb._maxY,q._aabb._maxZ=xt>q._aabb._maxZ?xt:q._aabb._maxZ,null!=q._proxy){var Yt,Zt,It;Yt=q._transform._positionX-q._ptransform._positionX,Zt=q._transform._positionY-q._ptransform._positionY,It=q._transform._positionZ-q._ptransform._positionZ;var yt=q.displacement;yt.x=Yt,yt.y=Zt,yt.z=It,q._rigidBody._world._broadPhase.moveProxy(q._proxy,q._aabb,q.displacement)}q=Q}this._sleeping=!1,this._sleepTime=0},getTransform:function(){var t=this._transform,i=new F;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getTransformTo:function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},setTransform:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,v=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=v,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=f,this._invInertia20=p,this._invInertia21=u,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;var X=this._ptransform,M=this._transform;X._positionX=M._positionX,X._positionY=M._positionY,X._positionZ=M._positionZ,X._rotation00=M._rotation00,X._rotation01=M._rotation01,X._rotation02=M._rotation02,X._rotation10=M._rotation10,X._rotation11=M._rotation11,X._rotation12=M._rotation12,X._rotation20=M._rotation20,X._rotation21=M._rotation21,X._rotation22=M._rotation22;for(var g=this._shapeList;null!=g;){var Y,Z,I,y,d,L,z,w,B,A,P,T,S=g._next,V=g._ptransform,k=g._localTransform,C=this._ptransform;Y=C._rotation00*k._rotation00+C._rotation01*k._rotation10+C._rotation02*k._rotation20,Z=C._rotation00*k._rotation01+C._rotation01*k._rotation11+C._rotation02*k._rotation21,I=C._rotation00*k._rotation02+C._rotation01*k._rotation12+C._rotation02*k._rotation22,y=C._rotation10*k._rotation00+C._rotation11*k._rotation10+C._rotation12*k._rotation20,d=C._rotation10*k._rotation01+C._rotation11*k._rotation11+C._rotation12*k._rotation21,L=C._rotation10*k._rotation02+C._rotation11*k._rotation12+C._rotation12*k._rotation22,z=C._rotation20*k._rotation00+C._rotation21*k._rotation10+C._rotation22*k._rotation20,w=C._rotation20*k._rotation01+C._rotation21*k._rotation11+C._rotation22*k._rotation21,B=C._rotation20*k._rotation02+C._rotation21*k._rotation12+C._rotation22*k._rotation22,V._rotation00=Y,V._rotation01=Z,V._rotation02=I,V._rotation10=y,V._rotation11=d,V._rotation12=L,V._rotation20=z,V._rotation21=w,V._rotation22=B,A=C._rotation00*k._positionX+C._rotation01*k._positionY+C._rotation02*k._positionZ,P=C._rotation10*k._positionX+C._rotation11*k._positionY+C._rotation12*k._positionZ,T=C._rotation20*k._positionX+C._rotation21*k._positionY+C._rotation22*k._positionZ,V._positionX=A,V._positionY=P,V._positionZ=T,V._positionX+=C._positionX,V._positionY+=C._positionY,V._positionZ+=C._positionZ;var q,R,j,O,E,F,D,N,W,G,U,J,H,Q,K,$,tt,it,at=g._transform,nt=g._localTransform,ot=this._transform;if(q=ot._rotation00*nt._rotation00+ot._rotation01*nt._rotation10+ot._rotation02*nt._rotation20,R=ot._rotation00*nt._rotation01+ot._rotation01*nt._rotation11+ot._rotation02*nt._rotation21,j=ot._rotation00*nt._rotation02+ot._rotation01*nt._rotation12+ot._rotation02*nt._rotation22,O=ot._rotation10*nt._rotation00+ot._rotation11*nt._rotation10+ot._rotation12*nt._rotation20,E=ot._rotation10*nt._rotation01+ot._rotation11*nt._rotation11+ot._rotation12*nt._rotation21,F=ot._rotation10*nt._rotation02+ot._rotation11*nt._rotation12+ot._rotation12*nt._rotation22,D=ot._rotation20*nt._rotation00+ot._rotation21*nt._rotation10+ot._rotation22*nt._rotation20,N=ot._rotation20*nt._rotation01+ot._rotation21*nt._rotation11+ot._rotation22*nt._rotation21,W=ot._rotation20*nt._rotation02+ot._rotation21*nt._rotation12+ot._rotation22*nt._rotation22,at._rotation00=q,at._rotation01=R,at._rotation02=j,at._rotation10=O,at._rotation11=E,at._rotation12=F,at._rotation20=D,at._rotation21=N,at._rotation22=W,G=ot._rotation00*nt._positionX+ot._rotation01*nt._positionY+ot._rotation02*nt._positionZ,U=ot._rotation10*nt._positionX+ot._rotation11*nt._positionY+ot._rotation12*nt._positionZ,J=ot._rotation20*nt._positionX+ot._rotation21*nt._positionY+ot._rotation22*nt._positionZ,at._positionX=G,at._positionY=U,at._positionZ=J,at._positionX+=ot._positionX,at._positionY+=ot._positionY,at._positionZ+=ot._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),H=g._aabb._minX,Q=g._aabb._minY,K=g._aabb._minZ,$=g._aabb._maxX,tt=g._aabb._maxY,it=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=H<g._aabb._minX?H:g._aabb._minX,g._aabb._minY=Q<g._aabb._minY?Q:g._aabb._minY,g._aabb._minZ=K<g._aabb._minZ?K:g._aabb._minZ,g._aabb._maxX=$>g._aabb._maxX?$:g._aabb._maxX,g._aabb._maxY=tt>g._aabb._maxY?tt:g._aabb._maxY,g._aabb._maxZ=it>g._aabb._maxZ?it:g._aabb._maxZ,null!=g._proxy){var st,rt,_t;st=g._transform._positionX-g._ptransform._positionX,rt=g._transform._positionY-g._ptransform._positionY,_t=g._transform._positionZ-g._ptransform._positionZ;var et=g.displacement;et.x=st,et.y=rt,et.z=_t,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=S}this._sleeping=!1,this._sleepTime=0},getMass:function(){return this._mass},getLocalInertia:function(){var t=new U,i=t;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t},getLocalInertiaTo:function(t){var i=t;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22},getMassData:function(){var t=new ii;t.mass=this._mass;var i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t},getMassDataTo:function(t){t.mass=this._mass;var i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22},setMassData:function(t){this._mass=t.mass;var i=t.localInertia;this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22;var a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X,M=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,g=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,Y=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,Z=this._localInertia00*M-this._localInertia01*g+this._localInertia02*Y;if(this._mass>0&&Z>0&&0==this._type){this._invMass=1/this._mass;var I=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,y=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,d=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,L=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21,z=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20,w=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20,B=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11,A=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10,P=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10,T=this._localInertia00*I-this._localInertia01*y+this._localInertia02*d;(T<-1e-32||T>1e-32)&&(T=1/T),this._invLocalInertia00=I*T,this._invLocalInertia01=-L*T,this._invLocalInertia02=B*T,this._invLocalInertia10=-y*T,this._invLocalInertia11=z*T,this._invLocalInertia12=-A*T,this._invLocalInertia20=d*T,this._invLocalInertia21=-w*T,this._invLocalInertia22=P*T,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,h=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=n,this._invInertia02=o,this._invInertia10=s,this._invInertia11=r,this._invInertia12=_,this._invInertia20=e,this._invInertia21=h,this._invInertia22=l,v=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,f=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,X=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=v,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=f,this._invInertia12=p,this._invInertia20=u,this._invInertia21=x,this._invInertia22=X,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getRotationFactor:function(){var t=this._rotFactor;return new E(t.x,t.y,t.z)},setRotationFactor:function(t){var i,a,n,o,s,r,_,e,h,l,v,c,m,b,f,p,u,x,X=this._rotFactor;X.x=t.x,X.y=t.y,X.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,a=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=a,this._invInertia02=n,this._invInertia10=o,this._invInertia11=s,this._invInertia12=r,this._invInertia20=_,this._invInertia21=e,this._invInertia22=h,l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,v=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,b=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,f=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,p=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=l,this._invInertia01=v,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=f,this._invInertia20=p,this._invInertia21=u,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0},getLinearVelocity:function(){var t=new E,i=t;return i.x=this._velX,i.y=this._velY,i.z=this._velZ,t},getLinearVelocityTo:function(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ},setLinearVelocity:function(t){if(1==this._type)this._velX=0,this._velY=0,this._velZ=0;else{var i=t;this._velX=i.x,this._velY=i.y,this._velZ=i.z}this._sleeping=!1,this._sleepTime=0},getAngularVelocity:function(){var t=new E,i=t;return i.x=this._angVelX,i.y=this._angVelY,i.z=this._angVelZ,t},getAngularVelocityTo:function(t){var i=t;i.x=this._velX,i.y=this._velY,i.z=this._velZ},setAngularVelocity:function(t){if(1==this._type)this._angVelX=0,this._angVelY=0,this._angVelZ=0;else{var i=t;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z}this._sleeping=!1,this._sleepTime=0},addLinearVelocity:function(t){if(1!=this._type){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._velX+=i,this._velY+=a,this._velZ+=n}this._sleeping=!1,this._sleepTime=0},addAngularVelocity:function(t){if(1!=this._type){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=n}this._sleeping=!1,this._sleepTime=0},applyImpulse:function(t,i){var a,n,o,s,r,_,e,h,l,v=t;a=v.x,n=v.y,o=v.z,this._velX+=a*this._invMass,this._velY+=n*this._invMass,this._velZ+=o*this._invMass;var c,m,b,f=i;e=f.x,h=f.y,l=f.z,e-=this._transform._positionX,s=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*n,r=l*a-e*o,_=e*n-h*a,c=this._invInertia00*s+this._invInertia01*r+this._invInertia02*_,m=this._invInertia10*s+this._invInertia11*r+this._invInertia12*_,b=this._invInertia20*s+this._invInertia21*r+this._invInertia22*_,s=c,r=m,_=b,this._angVelX+=s,this._angVelY+=r,this._angVelZ+=_,this._sleeping=!1,this._sleepTime=0},applyLinearImpulse:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._velX+=i*this._invMass,this._velY+=a*this._invMass,this._velZ+=n*this._invMass,this._sleeping=!1,this._sleepTime=0},applyAngularImpulse:function(t){var i,a,n,o,s,r,_=t;i=_.x,a=_.y,n=_.z,o=this._invInertia00*i+this._invInertia01*a+this._invInertia02*n,s=this._invInertia10*i+this._invInertia11*a+this._invInertia12*n,r=this._invInertia20*i+this._invInertia21*a+this._invInertia22*n,i=o,a=s,n=r,this._angVelX+=i,this._angVelY+=a,this._angVelZ+=n,this._sleeping=!1,this._sleepTime=0},applyForce:function(t,i){var a,n,o,s,r,_,e,h,l,v=t;a=v.x,n=v.y,o=v.z,this._forceX+=a,this._forceY+=n,this._forceZ+=o;var c=i;e=c.x,h=c.y,l=c.z,e-=this._transform._positionX,s=(h-=this._transform._positionY)*o-(l-=this._transform._positionZ)*n,r=l*a-e*o,_=e*n-h*a,this._torqueX+=s,this._torqueY+=r,this._torqueZ+=_,this._sleeping=!1,this._sleepTime=0},applyForceToCenter:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._forceX+=i,this._forceY+=a,this._forceZ+=n,this._sleeping=!1,this._sleepTime=0},applyTorque:function(t){var i,a,n,o=t;i=o.x,a=o.y,n=o.z,this._torqueX+=i,this._torqueY+=a,this._torqueZ+=n,this._sleeping=!1,this._sleepTime=0},getGravityScale:function(){return this._gravityScale},setGravityScale:function(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0},getLocalPoint:function(t){var i,a,n,o,s,r,_=t;i=_.x,a=_.y,n=_.z,i-=this._transform._positionX,a-=this._transform._positionY,n-=this._transform._positionZ,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*n,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*n,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*n,i=o,a=s,n=r;var e=new E,h=e;return h.x=i,h.y=a,h.z=n,e},getLocalPointTo:function(t,i){var a,n,o,s,r,_,e=t;a=e.x,n=e.y,o=e.z,a-=this._transform._positionX,n-=this._transform._positionY,o-=this._transform._positionZ,s=this._transform._rotation00*a+this._transform._rotation10*n+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*n+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*n+this._transform._rotation22*o,a=s,n=r,o=_;var h=i;h.x=a,h.y=n,h.z=o},getLocalVector:function(t){var i,a,n,o,s,r,_=t;i=_.x,a=_.y,n=_.z,o=this._transform._rotation00*i+this._transform._rotation10*a+this._transform._rotation20*n,s=this._transform._rotation01*i+this._transform._rotation11*a+this._transform._rotation21*n,r=this._transform._rotation02*i+this._transform._rotation12*a+this._transform._rotation22*n,i=o,a=s,n=r;var e=new E,h=e;return h.x=i,h.y=a,h.z=n,e},getLocalVectorTo:function(t,i){var a,n,o,s,r,_,e=t;a=e.x,n=e.y,o=e.z,s=this._transform._rotation00*a+this._transform._rotation10*n+this._transform._rotation20*o,r=this._transform._rotation01*a+this._transform._rotation11*n+this._transform._rotation21*o,_=this._transform._rotation02*a+this._transform._rotation12*n+this._transform._rotation22*o,a=s,n=r,o=_;var h=i;h.x=a,h.y=n,h.z=o},getWorldPoint:function(t){var i,a,n,o,s,r,_=t;i=_.x,a=_.y,n=_.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*n,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*n,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*n,i=o,a=s,n=r,i+=this._transform._positionX,a+=this._transform._positionY,n+=this._transform._positionZ;var e=new E,h=e;return h.x=i,h.y=a,h.z=n,e},getWorldPointTo:function(t,i){var a,n,o,s,r,_,e=t;a=e.x,n=e.y,o=e.z,s=this._transform._rotation00*a+this._transform._rotation01*n+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*n+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*n+this._transform._rotation22*o,a=s,n=r,o=_,a+=this._transform._positionX,n+=this._transform._positionY,o+=this._transform._positionZ;var h=i;h.x=a,h.y=n,h.z=o},getWorldVector:function(t){var i,a,n,o,s,r,_=t;i=_.x,a=_.y,n=_.z,o=this._transform._rotation00*i+this._transform._rotation01*a+this._transform._rotation02*n,s=this._transform._rotation10*i+this._transform._rotation11*a+this._transform._rotation12*n,r=this._transform._rotation20*i+this._transform._rotation21*a+this._transform._rotation22*n,i=o,a=s,n=r;var e=new E,h=e;return h.x=i,h.y=a,h.z=n,e},getWorldVectorTo:function(t,i){var a,n,o,s,r,_,e=t;a=e.x,n=e.y,o=e.z,s=this._transform._rotation00*a+this._transform._rotation01*n+this._transform._rotation02*o,r=this._transform._rotation10*a+this._transform._rotation11*n+this._transform._rotation12*o,_=this._transform._rotation20*a+this._transform._rotation21*n+this._transform._rotation22*o,a=s,n=r,o=_;var h=i;h.x=a,h.y=n,h.z=o},getNumShapes:function(){return this._numShapes},getShapeList:function(){return this._shapeList},getNumContectLinks:function(){return this._numContactLinks},getContactLinkList:function(){return this._contactLinkList},getNumJointLinks:function(){return this._numJointLinks},getJointLinkList:function(){return this._jointLinkList},addShape:function(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){var i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();for(var a=this._shapeList;null!=a;){var n,o,s,r,_,e,h,l,v,c,m,b,f=a._next,p=a._ptransform,u=a._localTransform,x=this._ptransform;n=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,o=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,s=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,r=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,_=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,e=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,h=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,l=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,v=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,p._rotation00=n,p._rotation01=o,p._rotation02=s,p._rotation10=r,p._rotation11=_,p._rotation12=e,p._rotation20=h,p._rotation21=l,p._rotation22=v,c=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,m=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,b=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,p._positionX=c,p._positionY=m,p._positionZ=b,p._positionX+=x._positionX,p._positionY+=x._positionY,p._positionZ+=x._positionZ;var X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C=a._transform,q=a._localTransform,R=this._transform;if(X=R._rotation00*q._rotation00+R._rotation01*q._rotation10+R._rotation02*q._rotation20,M=R._rotation00*q._rotation01+R._rotation01*q._rotation11+R._rotation02*q._rotation21,g=R._rotation00*q._rotation02+R._rotation01*q._rotation12+R._rotation02*q._rotation22,Y=R._rotation10*q._rotation00+R._rotation11*q._rotation10+R._rotation12*q._rotation20,Z=R._rotation10*q._rotation01+R._rotation11*q._rotation11+R._rotation12*q._rotation21,I=R._rotation10*q._rotation02+R._rotation11*q._rotation12+R._rotation12*q._rotation22,y=R._rotation20*q._rotation00+R._rotation21*q._rotation10+R._rotation22*q._rotation20,d=R._rotation20*q._rotation01+R._rotation21*q._rotation11+R._rotation22*q._rotation21,L=R._rotation20*q._rotation02+R._rotation21*q._rotation12+R._rotation22*q._rotation22,C._rotation00=X,C._rotation01=M,C._rotation02=g,C._rotation10=Y,C._rotation11=Z,C._rotation12=I,C._rotation20=y,C._rotation21=d,C._rotation22=L,z=R._rotation00*q._positionX+R._rotation01*q._positionY+R._rotation02*q._positionZ,w=R._rotation10*q._positionX+R._rotation11*q._positionY+R._rotation12*q._positionZ,B=R._rotation20*q._positionX+R._rotation21*q._positionY+R._rotation22*q._positionZ,C._positionX=z,C._positionY=w,C._positionZ=B,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),A=a._aabb._minX,P=a._aabb._minY,T=a._aabb._minZ,S=a._aabb._maxX,V=a._aabb._maxY,k=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=A<a._aabb._minX?A:a._aabb._minX,a._aabb._minY=P<a._aabb._minY?P:a._aabb._minY,a._aabb._minZ=T<a._aabb._minZ?T:a._aabb._minZ,a._aabb._maxX=S>a._aabb._maxX?S:a._aabb._maxX,a._aabb._maxY=V>a._aabb._maxY?V:a._aabb._maxY,a._aabb._maxZ=k>a._aabb._maxZ?k:a._aabb._maxZ,null!=a._proxy){var j,O,E;j=a._transform._positionX-a._ptransform._positionX,O=a._transform._positionY-a._ptransform._positionY,E=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=j,F.y=O,F.z=E,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=f}},removeShape:function(t){var i=t._prev,a=t._next;if(null!=i&&(i._next=a),null!=a&&(a._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){var n=this._world;n._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;for(var o=t._rigidBody._contactLinkList;null!=o;){var s=o._next,r=o._contact;if(r._s1==t||r._s2==t){var _=o._other;_._sleeping=!1,_._sleepTime=0;var e=n._contactManager,h=r._prev,l=r._next;if(null!=h&&(h._next=l),null!=l&&(l._prev=h),r==e._contactList&&(e._contactList=e._contactList._next),r==e._contactListLast&&(e._contactListLast=e._contactListLast._prev),r._next=null,r._prev=null,r._touching){var v=r._s1._contactCallback,c=r._s2._contactCallback;v==c&&(c=null),null!=v&&v.endContact(r),null!=c&&c.endContact(r)}var m=r._link1._prev,b=r._link1._next;null!=m&&(m._next=b),null!=b&&(b._prev=m),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;var f=r._link2._prev,p=r._link2._next;null!=f&&(f._next=p),null!=p&&(p._prev=f),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;var u=r._contactConstraint;u._s1=null,u._s2=null,u._b1=null,u._b2=null,u._tf1=null,u._tf2=null,r._next=e._contactPool,e._contactPool=r,e._numContacts--}o=s}n._numShapes--}this.updateMass();for(var x=this._shapeList;null!=x;){var X,M,g,Y,Z,I,y,d,L,z,w,B,A=x._next,P=x._ptransform,T=x._localTransform,S=this._ptransform;X=S._rotation00*T._rotation00+S._rotation01*T._rotation10+S._rotation02*T._rotation20,M=S._rotation00*T._rotation01+S._rotation01*T._rotation11+S._rotation02*T._rotation21,g=S._rotation00*T._rotation02+S._rotation01*T._rotation12+S._rotation02*T._rotation22,Y=S._rotation10*T._rotation00+S._rotation11*T._rotation10+S._rotation12*T._rotation20,Z=S._rotation10*T._rotation01+S._rotation11*T._rotation11+S._rotation12*T._rotation21,I=S._rotation10*T._rotation02+S._rotation11*T._rotation12+S._rotation12*T._rotation22,y=S._rotation20*T._rotation00+S._rotation21*T._rotation10+S._rotation22*T._rotation20,d=S._rotation20*T._rotation01+S._rotation21*T._rotation11+S._rotation22*T._rotation21,L=S._rotation20*T._rotation02+S._rotation21*T._rotation12+S._rotation22*T._rotation22,P._rotation00=X,P._rotation01=M,P._rotation02=g,P._rotation10=Y,P._rotation11=Z,P._rotation12=I,P._rotation20=y,P._rotation21=d,P._rotation22=L,z=S._rotation00*T._positionX+S._rotation01*T._positionY+S._rotation02*T._positionZ,w=S._rotation10*T._positionX+S._rotation11*T._positionY+S._rotation12*T._positionZ,B=S._rotation20*T._positionX+S._rotation21*T._positionY+S._rotation22*T._positionZ,P._positionX=z,P._positionY=w,P._positionZ=B,P._positionX+=S._positionX,P._positionY+=S._positionY,P._positionZ+=S._positionZ;var V,k,C,q,R,j,O,E,F,D,N,W,G,U,J,H,Q,K,$=x._transform,tt=x._localTransform,it=this._transform;if(V=it._rotation00*tt._rotation00+it._rotation01*tt._rotation10+it._rotation02*tt._rotation20,k=it._rotation00*tt._rotation01+it._rotation01*tt._rotation11+it._rotation02*tt._rotation21,C=it._rotation00*tt._rotation02+it._rotation01*tt._rotation12+it._rotation02*tt._rotation22,q=it._rotation10*tt._rotation00+it._rotation11*tt._rotation10+it._rotation12*tt._rotation20,R=it._rotation10*tt._rotation01+it._rotation11*tt._rotation11+it._rotation12*tt._rotation21,j=it._rotation10*tt._rotation02+it._rotation11*tt._rotation12+it._rotation12*tt._rotation22,O=it._rotation20*tt._rotation00+it._rotation21*tt._rotation10+it._rotation22*tt._rotation20,E=it._rotation20*tt._rotation01+it._rotation21*tt._rotation11+it._rotation22*tt._rotation21,F=it._rotation20*tt._rotation02+it._rotation21*tt._rotation12+it._rotation22*tt._rotation22,$._rotation00=V,$._rotation01=k,$._rotation02=C,$._rotation10=q,$._rotation11=R,$._rotation12=j,$._rotation20=O,$._rotation21=E,$._rotation22=F,D=it._rotation00*tt._positionX+it._rotation01*tt._positionY+it._rotation02*tt._positionZ,N=it._rotation10*tt._positionX+it._rotation11*tt._positionY+it._rotation12*tt._positionZ,W=it._rotation20*tt._positionX+it._rotation21*tt._positionY+it._rotation22*tt._positionZ,$._positionX=D,$._positionY=N,$._positionZ=W,$._positionX+=it._positionX,$._positionY+=it._positionY,$._positionZ+=it._positionZ,x._geom._computeAabb(x._aabb,x._ptransform),G=x._aabb._minX,U=x._aabb._minY,J=x._aabb._minZ,H=x._aabb._maxX,Q=x._aabb._maxY,K=x._aabb._maxZ,x._geom._computeAabb(x._aabb,x._transform),x._aabb._minX=G<x._aabb._minX?G:x._aabb._minX,x._aabb._minY=U<x._aabb._minY?U:x._aabb._minY,x._aabb._minZ=J<x._aabb._minZ?J:x._aabb._minZ,x._aabb._maxX=H>x._aabb._maxX?H:x._aabb._maxX,x._aabb._maxY=Q>x._aabb._maxY?Q:x._aabb._maxY,x._aabb._maxZ=K>x._aabb._maxZ?K:x._aabb._maxZ,null!=x._proxy){var at,nt,ot;at=x._transform._positionX-x._ptransform._positionX,nt=x._transform._positionY-x._ptransform._positionY,ot=x._transform._positionZ-x._ptransform._positionZ;var st=x.displacement;st.x=at,st.y=nt,st.z=ot,x._rigidBody._world._broadPhase.moveProxy(x._proxy,x._aabb,x.displacement)}x=A}},getType:function(){return this._type},setType:function(t){this._type=t,this.updateMass()},wakeUp:function(){this._sleeping=!1,this._sleepTime=0},sleep:function(){this._sleeping=!0,this._sleepTime=0},getSleepTime:function(){return this._sleepTime},setAutoSleep:function(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0},getLinearDamping:function(){return this._linearDamping},setLinearDamping:function(t){this._linearDamping=t},getAngularDamping:function(){return this._angularDamping},setAngularDamping:function(t){this._angularDamping=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};var ni=function(){},oi=function(t){this._id=-1,this._localTransform=new F,this._ptransform=new F,this._transform=new F;var i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;var a=t.rotation;this._localTransform._rotation00=a.e00,this._localTransform._rotation01=a.e01,this._localTransform._rotation02=a.e02,this._localTransform._rotation10=a.e10,this._localTransform._rotation11=a.e11,this._localTransform._rotation12=a.e12,this._localTransform._rotation20=a.e20,this._localTransform._rotation21=a.e21,this._localTransform._rotation22=a.e22;var n=this._ptransform,o=this._localTransform;n._positionX=o._positionX,n._positionY=o._positionY,n._positionZ=o._positionZ,n._rotation00=o._rotation00,n._rotation01=o._rotation01,n._rotation02=o._rotation02,n._rotation10=o._rotation10,n._rotation11=o._rotation11,n._rotation12=o._rotation12,n._rotation20=o._rotation20,n._rotation21=o._rotation21,n._rotation22=o._rotation22;var s=this._transform,r=this._localTransform;s._positionX=r._positionX,s._positionY=r._positionY,s._positionZ=r._positionZ,s._rotation00=r._rotation00,s._rotation01=r._rotation01,s._rotation02=r._rotation02,s._rotation10=r._rotation10,s._rotation11=r._rotation11,s._rotation12=r._rotation12,s._rotation20=r._rotation20,s._rotation21=r._rotation21,s._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new p,this._proxy=null,this.displacement=new E};oi.prototype={getFriction:function(){return this._friction},setFriction:function(t){this._friction=t},getRestitution:function(){return this._restitution},setRestitution:function(t){this._restitution=t},getLocalTransform:function(){var t=this._localTransform,i=new F;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getLocalTransformTo:function(t){var i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},getTransform:function(){var t=this._transform,i=new F;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i},getTransformTo:function(t){var i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22},setLocalTransform:function(t){var i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){var a=this._rigidBody;a.updateMass();for(var n=a._shapeList;null!=n;){var o,s,r,_,e,h,l,v,c,m,b,f,p=n._next,u=n._ptransform,x=n._localTransform,X=a._ptransform;o=X._rotation00*x._rotation00+X._rotation01*x._rotation10+X._rotation02*x._rotation20,s=X._rotation00*x._rotation01+X._rotation01*x._rotation11+X._rotation02*x._rotation21,r=X._rotation00*x._rotation02+X._rotation01*x._rotation12+X._rotation02*x._rotation22,_=X._rotation10*x._rotation00+X._rotation11*x._rotation10+X._rotation12*x._rotation20,e=X._rotation10*x._rotation01+X._rotation11*x._rotation11+X._rotation12*x._rotation21,h=X._rotation10*x._rotation02+X._rotation11*x._rotation12+X._rotation12*x._rotation22,l=X._rotation20*x._rotation00+X._rotation21*x._rotation10+X._rotation22*x._rotation20,v=X._rotation20*x._rotation01+X._rotation21*x._rotation11+X._rotation22*x._rotation21,c=X._rotation20*x._rotation02+X._rotation21*x._rotation12+X._rotation22*x._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=r,u._rotation10=_,u._rotation11=e,u._rotation12=h,u._rotation20=l,u._rotation21=v,u._rotation22=c,m=X._rotation00*x._positionX+X._rotation01*x._positionY+X._rotation02*x._positionZ,b=X._rotation10*x._positionX+X._rotation11*x._positionY+X._rotation12*x._positionZ,f=X._rotation20*x._positionX+X._rotation21*x._positionY+X._rotation22*x._positionZ,u._positionX=m,u._positionY=b,u._positionZ=f,u._positionX+=X._positionX,u._positionY+=X._positionY,u._positionZ+=X._positionZ;var M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C,q=n._transform,R=n._localTransform,j=a._transform;if(M=j._rotation00*R._rotation00+j._rotation01*R._rotation10+j._rotation02*R._rotation20,g=j._rotation00*R._rotation01+j._rotation01*R._rotation11+j._rotation02*R._rotation21,Y=j._rotation00*R._rotation02+j._rotation01*R._rotation12+j._rotation02*R._rotation22,Z=j._rotation10*R._rotation00+j._rotation11*R._rotation10+j._rotation12*R._rotation20,I=j._rotation10*R._rotation01+j._rotation11*R._rotation11+j._rotation12*R._rotation21,y=j._rotation10*R._rotation02+j._rotation11*R._rotation12+j._rotation12*R._rotation22,d=j._rotation20*R._rotation00+j._rotation21*R._rotation10+j._rotation22*R._rotation20,L=j._rotation20*R._rotation01+j._rotation21*R._rotation11+j._rotation22*R._rotation21,z=j._rotation20*R._rotation02+j._rotation21*R._rotation12+j._rotation22*R._rotation22,q._rotation00=M,q._rotation01=g,q._rotation02=Y,q._rotation10=Z,q._rotation11=I,q._rotation12=y,q._rotation20=d,q._rotation21=L,q._rotation22=z,w=j._rotation00*R._positionX+j._rotation01*R._positionY+j._rotation02*R._positionZ,B=j._rotation10*R._positionX+j._rotation11*R._positionY+j._rotation12*R._positionZ,A=j._rotation20*R._positionX+j._rotation21*R._positionY+j._rotation22*R._positionZ,q._positionX=w,q._positionY=B,q._positionZ=A,q._positionX+=j._positionX,q._positionY+=j._positionY,q._positionZ+=j._positionZ,n._geom._computeAabb(n._aabb,n._ptransform),P=n._aabb._minX,T=n._aabb._minY,S=n._aabb._minZ,V=n._aabb._maxX,k=n._aabb._maxY,C=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=P<n._aabb._minX?P:n._aabb._minX,n._aabb._minY=T<n._aabb._minY?T:n._aabb._minY,n._aabb._minZ=S<n._aabb._minZ?S:n._aabb._minZ,n._aabb._maxX=V>n._aabb._maxX?V:n._aabb._maxX,n._aabb._maxY=k>n._aabb._maxY?k:n._aabb._maxY,n._aabb._maxZ=C>n._aabb._maxZ?C:n._aabb._maxZ,null!=n._proxy){var O,E,F;O=n._transform._positionX-n._ptransform._positionX,E=n._transform._positionY-n._ptransform._positionY,F=n._transform._positionZ-n._ptransform._positionZ;var D=n.displacement;D.x=O,D.y=E,D.z=F,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=p}}},getDensity:function(){return this._density},setDensity:function(t){if(this._density=t,null!=this._rigidBody){var i=this._rigidBody;i.updateMass();for(var a=i._shapeList;null!=a;){var n,o,s,r,_,e,h,l,v,c,m,b,f=a._next,p=a._ptransform,u=a._localTransform,x=i._ptransform;n=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,o=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,s=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,r=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,_=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,e=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,h=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,l=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,v=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,p._rotation00=n,p._rotation01=o,p._rotation02=s,p._rotation10=r,p._rotation11=_,p._rotation12=e,p._rotation20=h,p._rotation21=l,p._rotation22=v,c=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,m=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,b=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,p._positionX=c,p._positionY=m,p._positionZ=b,p._positionX+=x._positionX,p._positionY+=x._positionY,p._positionZ+=x._positionZ;var X,M,g,Y,Z,I,y,d,L,z,w,B,A,P,T,S,V,k,C=a._transform,q=a._localTransform,R=i._transform;if(X=R._rotation00*q._rotation00+R._rotation01*q._rotation10+R._rotation02*q._rotation20,M=R._rotation00*q._rotation01+R._rotation01*q._rotation11+R._rotation02*q._rotation21,g=R._rotation00*q._rotation02+R._rotation01*q._rotation12+R._rotation02*q._rotation22,Y=R._rotation10*q._rotation00+R._rotation11*q._rotation10+R._rotation12*q._rotation20,Z=R._rotation10*q._rotation01+R._rotation11*q._rotation11+R._rotation12*q._rotation21,I=R._rotation10*q._rotation02+R._rotation11*q._rotation12+R._rotation12*q._rotation22,y=R._rotation20*q._rotation00+R._rotation21*q._rotation10+R._rotation22*q._rotation20,d=R._rotation20*q._rotation01+R._rotation21*q._rotation11+R._rotation22*q._rotation21,L=R._rotation20*q._rotation02+R._rotation21*q._rotation12+R._rotation22*q._rotation22,C._rotation00=X,C._rotation01=M,C._rotation02=g,C._rotation10=Y,C._rotation11=Z,C._rotation12=I,C._rotation20=y,C._rotation21=d,C._rotation22=L,z=R._rotation00*q._positionX+R._rotation01*q._positionY+R._rotation02*q._positionZ,w=R._rotation10*q._positionX+R._rotation11*q._positionY+R._rotation12*q._positionZ,B=R._rotation20*q._positionX+R._rotation21*q._positionY+R._rotation22*q._positionZ,C._positionX=z,C._positionY=w,C._positionZ=B,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ,a._geom._computeAabb(a._aabb,a._ptransform),A=a._aabb._minX,P=a._aabb._minY,T=a._aabb._minZ,S=a._aabb._maxX,V=a._aabb._maxY,k=a._aabb._maxZ,a._geom._computeAabb(a._aabb,a._transform),a._aabb._minX=A<a._aabb._minX?A:a._aabb._minX,a._aabb._minY=P<a._aabb._minY?P:a._aabb._minY,a._aabb._minZ=T<a._aabb._minZ?T:a._aabb._minZ,a._aabb._maxX=S>a._aabb._maxX?S:a._aabb._maxX,a._aabb._maxY=V>a._aabb._maxY?V:a._aabb._maxY,a._aabb._maxZ=k>a._aabb._maxZ?k:a._aabb._maxZ,null!=a._proxy){var j,O,E;j=a._transform._positionX-a._ptransform._positionX,O=a._transform._positionY-a._ptransform._positionY,E=a._transform._positionZ-a._ptransform._positionZ;var F=a.displacement;F.x=j,F.y=O,F.z=E,a._rigidBody._world._broadPhase.moveProxy(a._proxy,a._aabb,a.displacement)}a=f}}},getAabb:function(){return this._aabb.clone()},getAabbTo:function(t){t.copyFrom(this._aabb)},getGeometry:function(){return this._geom},getRigidBody:function(){return this._rigidBody},getCollisionGroup:function(){return this._collisionGroup},setCollisionGroup:function(t){this._collisionGroup=t},getCollisionMask:function(){return this._collisionMask},setCollisionMask:function(t){this._collisionMask=t},getContactCallback:function(){return this._contactCallback},setContactCallback:function(t){this._contactCallback=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};_._BRUTE_FORCE=1,_._BVH=2,_.BRUTE_FORCE=1,_.BVH=2,Y._SPHERE=0,Y._BOX=1,Y._CYLINDER=2,Y._CONE=3,Y._CAPSULE=4,Y._CONVEX_HULL=5,Y._CONVEX_MIN=0,Y._CONVEX_MAX=5,Y.SPHERE=0,Y.BOX=1,Y.CYLINDER=2,Y.CONE=3,Y.CAPSULE=4,Y.CONVEX_HULL=5,w.EDGE_BIAS_MULT=1,R.count=0,E.numCreations=0,D.defaultFriction=.2,D.defaultRestitution=.2,D.defaultDensity=1,D.defaultCollisionGroup=1,D.defaultCollisionMask=1,D.maxTranslationPerStep=20,D.maxRotationPerStep=3.14159265358979,D.bvhProxyPadding=.1,D.bvhIncrementalCollisionThreshold=.45,D.defaultGJKMargin=.05,D.enableGJKCaching=!0,D.maxEPAVertices=128,D.maxEPAPolyhedronFaces=128,D.contactEnableBounceThreshold=.5,D.velocityBaumgarte=.2,D.positionSplitImpulseBaumgarte=.4,D.positionNgsBaumgarte=1,D.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,D.defaultContactPositionCorrectionAlgorithm=0,D.alternativeContactPositionCorrectionAlgorithm=1,D.contactPersistenceThreshold=.05,D.maxManifoldPoints=4,D.defaultJointConstraintSolverType=0,D.defaultJointPositionCorrectionAlgorithm=0,D.jointWarmStartingFactorForBaungarte=.8,D.jointWarmStartingFactor=.95,D.minSpringDamperDampingRatio=1e-6,D.minRagdollMaxSwingAngle=1e-6,D.maxJacobianRows=6,D.directMlcpSolverEps=1e-9,D.islandInitialRigidBodyArraySize=128,D.islandInitialConstraintArraySize=128,D.sleepingVelocityThreshold=.2,D.sleepingAngularVelocityThreshold=.5,D.sleepingTimeThreshold=1,D.disableSleeping=!1,D.linearSlop=.005,D.angularSlop=.017453292519943278,N.instance=new N,W._SUCCEEDED=0,W._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,W._GJK_DID_NOT_CONVERGE=2,W._EPA_FAILED_TO_INIT=257,W._EPA_FAILED_TO_ADD_VERTEX=258,W._EPA_DID_NOT_CONVERGE=259,W.SUCCEEDED=0,W.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,W.GJK_DID_NOT_CONVERGE=2,W.EPA_FAILED_TO_INIT=257,W.EPA_FAILED_TO_ADD_VERTEX=258,W.EPA_DID_NOT_CONVERGE=259,U.numCreations=0,J.numCreations=0,K.numCreations=0,ct.broadPhaseCollisionTime=0,ct.narrowPhaseCollisionTime=0,ct.dynamicsTime=0,ct.totalTime=0,bt._BAUMGARTE=0,bt._SPLIT_IMPULSE=1,bt._NGS=2,bt.BAUMGARTE=0,bt.SPLIT_IMPULSE=1,bt.NGS=2,Mt.BIT_LINEAR_SET=1,Mt.BIT_ANGULAR_SET=2,At._SPHERICAL=0,At._REVOLUTE=1,At._CYLINDRICAL=2,At._PRISMATIC=3,At._UNIVERSAL=4,At._RAGDOLL=5,At.SPHERICAL=0,At.REVOLUTE=1,At.CYLINDRICAL=2,At.PRISMATIC=3,At.UNIVERSAL=4,At.RAGDOLL=5,Nt._ITERATIVE=0,Nt._DIRECT=1,Nt.ITERATIVE=0,Nt.DIRECT=1,ni._DYNAMIC=0,ni._STATIC=1,ni._KINEMATIC=2,ni.DYNAMIC=0,ni.STATIC=1,ni.KINEMATIC=2,self.OIMO={},self.OIMO.BroadPhase=i,self.OIMO.Geometry=a,self.OIMO.ConvexGeometry=n,self.OIMO.BroadPhaseProxyCallback=r,self.OIMO.BroadPhaseType=_,self.OIMO.Proxy=e,self.OIMO.ProxyPair=h,self.OIMO.BruteForceBroadPhase=l,self.OIMO.BvhBroadPhase=v,self.OIMO.Aabb=p,self.OIMO.BoxGeometry=u,self.OIMO.CapsuleGeometry=x,self.OIMO.ConeGeometry=X,self.OIMO.ConvexHullGeometry=M,self.OIMO.CylinderGeometry=g,self.OIMO.GeometryType=Y,self.OIMO.RayCastHit=Z,self.OIMO.SphereGeometry=I,self.OIMO.CollisionMatrix=y,self.OIMO.DetectorResult=d,self.OIMO.DetectorResultPoint=L,self.OIMO.Detector=z,self.OIMO.BoxBoxDetector=w,self.OIMO.CapsuleCapsuleDetector=T,self.OIMO.GjkEpaDetector=S,self.OIMO.SphereBoxDetector=V,self.OIMO.SphereCapsuleDetector=k,self.OIMO.SphereSphereDetector=C,self.OIMO.Vec3=E,self.OIMO.Transform=F,self.OIMO.Setting=D,self.OIMO.GjkEpa=N,self.OIMO.GjkEpaResultState=W,self.OIMO.SimplexUtil=G,self.OIMO.Mat3=U,self.OIMO.Mat4=J,self.OIMO.MathUtil=H,self.OIMO.Pool=Q,self.OIMO.Quat=K,self.OIMO.Contact=$,self.OIMO.ContactLink=tt,self.OIMO.ContactManager=it,self.OIMO.TimeStep=nt,self.OIMO.World=ot,self.OIMO.AabbTestCallback=et,self.OIMO.ContactCallback=ht,self.OIMO.RayCastCallback=lt,self.OIMO.RayCastClosest=vt,self.OIMO.Performance=ct,self.OIMO.ConstraintSolver=mt,self.OIMO.PositionCorrectionAlgorithm=bt,self.OIMO.ContactConstraint=ft,self.OIMO.Manifold=ut,self.OIMO.ManifoldPoint=xt,self.OIMO.Joint=It,self.OIMO.CylindricalJoint=yt,self.OIMO.JointConfig=dt,self.OIMO.CylindricalJointConfig=Lt,self.OIMO.JointLink=Bt,self.OIMO.JointType=At,self.OIMO.PrismaticJoint=Pt,self.OIMO.PrismaticJointConfig=Tt,self.OIMO.RagdollJoint=St,self.OIMO.RagdollJointConfig=Vt,self.OIMO.RevoluteJoint=kt,self.OIMO.RevoluteJointConfig=Ct,self.OIMO.RotationalLimitMotor=qt,self.OIMO.SphericalJoint=Rt,self.OIMO.SphericalJointConfig=jt,self.OIMO.SpringDamper=Ot,self.OIMO.TranslationalLimitMotor=Et,self.OIMO.UniversalJoint=Ft,self.OIMO.UniversalJointConfig=Dt,self.OIMO.ConstraintSolverType=Nt,self.OIMO.DirectJointConstraintSolver=Qt,self.OIMO.PgsContactConstraintSolver=$t,self.OIMO.PgsJointConstraintSolver=ti,self.OIMO.MassData=ii,self.OIMO.RigidBody=ai,self.OIMO.RigidBodyConfig=function(){this.position=new E,this.rotation=new U,this.linearVelocity=new E,this.angularVelocity=new E,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0},self.OIMO.RigidBodyType=ni,self.OIMO.Shape=oi,self.OIMO.ShapeConfig=function(){this.position=new E,this.rotation=new U,this.friction=D.defaultFriction,this.restitution=D.defaultRestitution,this.density=D.defaultDensity,this.collisionGroup=D.defaultCollisionGroup,this.collisionMask=D.defaultCollisionMask,this.geometry=null,this.contactCallback=null}}(),OIMO.ShapeConfig.prototype.clone=function(){var t=new OIMO.ShapeConfig;return t.position=this.position,t.rotation=this.rotation,t.density=this.density,t.friction=this.friction,t.restitution=this.restitution,t.collisionMask=this.collisionMask,t.collisionGroup=this.collisionGroup,t.contactCallback=this.callback,t},OIMO.RigidBody.prototype.getTrans=function(t,i){var a=this._transform;t.init(a._positionX,a._positionY,a._positionZ),i.setM3([a._rotation00,a._rotation10,a._rotation20,a._rotation01,a._rotation11,a._rotation21,a._rotation02,a._rotation12,a._rotation22])},OIMO.RigidBody.prototype.getSleeping=function(){return this._sleeping},OIMO.RigidBody.prototype.getType=function(){return this._type},OIMO.Vec3.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},OIMO.Quat.prototype.fromArray=function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3],this},OIMO.Quat.prototype.setM3=function(t){var i,a,n=t[0],o=t[3],s=t[6],r=t[1],_=t[4],e=t[7],h=t[2],l=t[5],v=t[8],c=n+_+v;c>0?(a=1/(i=.5/Math.sqrt(c+1)),this.w=.25*a,this.x=(l-e)*i,this.y=(s-h)*i,this.z=(r-o)*i):n>_&&n>v?(a=1/(i=2*Math.sqrt(1+n-_-v)),this.w=(l-e)*a,this.x=.25*i,this.y=(o+r)*a,this.z=(s+h)*a):_>v?(a=1/(i=2*Math.sqrt(1+_-n-v)),this.w=(s-h)*a,this.x=(o+r)*a,this.y=.25*i,this.z=(e+l)*a):(a=1/(i=2*Math.sqrt(1+v-n-_)),this.w=(r-o)*a,this.x=(s+h)*a,this.y=(e+l)*a,this.z=.25*i)},OIMO.Quat.prototype.setFromEuler=function(t){var i=t.x,a=t.y,n=t.z,o=Math.cos,s=Math.sin,r=o(i/2),_=o(a/2),e=o(n/2),h=s(i/2),l=s(a/2),v=s(n/2);return this.x=h*_*e+r*l*v,this.y=r*l*e-h*_*v,this.z=r*_*v+h*l*e,this.w=r*_*e-h*l*v,this},OIMO.World.prototype.add=function(t){var i,a=(t=t||{}).type||"box";a.constructor===String&&(a=[a]),t.Rpos=t.Rpos||[],t.Rrot=t.Rrot||[];var n=t.pos||[0,0,0],o=t.rot||[0,0,0];if(void 0!==t.quat?this.tmpQuat.fromArray(t.quat):(o=o.map(function(t){return t*OIMO.MathUtil.TO_RADIANS}),this.tmpQuat.setFromEuler({x:o[0],y:o[1],z:o[2]})),void 0===t.Rsize){var s=void 0===t.size?[1,1,1]:t.size;if(s[0].constructor!==Array)if(t.Rsize=[],1===(c=s.length))t.Rsize.push([s[0],s[0],s[0]]);else if(2===c)t.Rsize.push([s[0],s[1],s[0]]);else if(c>2){m=Math.floor(c/3);for(var r=0;r<m;r++)i=3*r,t.Rsize.push([s[i],s[i+1],s[i+2]])}}var _=new OIMO.ShapeConfig,e=void 0!==t.density?t.density:0;void 0!==t.density&&(_.density=t.density),void 0!==t.friction&&(_.friction=t.friction),void 0!==t.restitution&&(_.restitution=t.restitution),void 0!==t.mask&&(_.collisionMask=t.mask),void 0!==t.group&&(_.collisionGroup=t.group),t.callback&&(_.contactCallback=t.callback);var h=new OIMO.RigidBodyConfig;h.type=0===e?1:0,void 0!==t.kinematic&&(h.type=2),h.autoSleep=void 0===t.autoSleep||t.autoSleep,h.linearDamping=t.linearDamping||0,h.angularDamping=t.angularDamping||0,void 0!==t.linearVelocity&&h.linearVelocity.fromArray(t.linearVelocity),void 0!==t.angularVelocity&&h.angularVelocity.fromArray(t.angularVelocity),h.position.init(n[0],n[1],n[2]),h.rotation.fromQuat(this.tmpQuat);var l=new OIMO.RigidBody(h);void 0!==t.name&&(this.byName[t.name]=l);for(var v,c=a.length,m=0;m<c;m++){switch(m>0&&(_=_.clone()),v=t.Rsize[m],a[m]){case"sphere":_.geometry=new OIMO.SphereGeometry(v[0]);break;case"cylinder":_.geometry=new OIMO.CylinderGeometry(v[0],.5*v[1]);break;case"cone":_.geometry=new OIMO.ConeGeometry(v[0],.5*v[1]);break;case"box":_.geometry=new OIMO.BoxGeometry(new OIMO.Vec3(.5*v[0],.5*v[1],.5*v[2]));break;case"capsule":_.geometry=new OIMO.CapsuleGeometry(v[0],.5*v[1]);break;case"mesh":case"convex":case"plane":if(void 0===t.v)for(t.v=[],c=t.vertices.length/3,i=0,m=0;m<c;m++)i=3*m,t.v.push(new OIMO.Vec3(t.vertices[i],t.vertices[i+1],t.vertices[i+2]));_.geometry=new OIMO.ConvexHullGeometry(t.v),void 0!==t.margin&&_.geometry.setGjkMergin(t.margin)}void 0!==t.Rpos[m]&&_.position.fromArray(t.Rpos[m]),void 0!==t.Rrot[m]&&(o=(o=t.Rrot[m]).map(function(t){return t*OIMO.MathUtil.TO_RADIANS}),this.tmpQuat.setFromEuler({x:o[0],y:o[1],z:o[2]}),_.rotation.fromQuat(this.tmpQuat)),l.addShape(new OIMO.Shape(_))}return this.addRigidBody(l),l},OIMO.World.prototype.joint=function(t){var i,a=null,n=null,o=OIMO.MathUtil.TO_RADIANS;if(t.b1.constructor===String?a=this.byName[t.b1]:t.b1.constructor===OIMO.RigidBody&&(a=t.b1),t.b2.constructor===String?n=this.byName[t.b2]:t.b2.constructor===OIMO.RigidBody&&(n=t.b2),null===a||null===n)return console.log("World","Can't add joint attach rigidbodys not find !");switch(t.type){case"spherical":i=new OIMO.SphericalJointConfig;break;case"revolute":i=new OIMO.RevoluteJointConfig;break;case"cylindrical":i=new OIMO.CylindricalJointConfig;break;case"prismatic":i=new OIMO.PrismaticJointConfig;break;case"universal":i=new OIMO.UniversalJointConfig;break;case"ragdoll":i=new OIMO.RagdollJointConfig}i.rigidBody1=a,i.rigidBody2=n;var s,r=null;switch(void 0!==t.anchor&&(r=(new OIMO.Vec3).fromArray(t.anchor),a.getLocalPointTo(r,i.localAnchor1),n.getLocalPointTo(r,i.localAnchor2)),void 0!==t.pos1&&i.localAnchor1.fromArray(t.pos1),void 0!==t.pos2&&i.localAnchor2.fromArray(t.pos2),i.allowCollision=t.collision||!1,i.breakForce=t.breakForce||0,i.breakTorque=t.breakTorque||0,this.tmpAxis1.fromArray([1,0,0]),this.tmpAxis2.fromArray([1,0,0]),this.tmpAxis3.fromArray([0,1,0]),t.type){case"spherical":null!=t.sp1&&(i.springDamper.setSpring(t.sp1[0]||0,t.sp1[1]||0),i.springDamper.setSymplecticEuler(t.sp1[2]||!1));break;case"cylindrical":void 0!==t.axis1&&(this.tmpAxis1.fromArray(t.axis1),this.tmpAxis2.fromArray(t.axis1)),void 0!==t.axis2&&this.tmpAxis2.fromArray(t.axis2),a.getLocalVectorTo(this.tmpAxis1,i.localAxis1),n.getLocalVectorTo(this.tmpAxis2,i.localAxis2),null!=t.sp1&&(i.translationalSpringDamper.setSpring(t.sp1[0]||0,t.sp1[1]||0),i.translationalSpringDamper.setSymplecticEuler(t.sp1[2]||!1)),null!=t.sp2&&(i.rotationalSpringDamper.setSpring(t.sp2[0]||0,t.sp2[1]||0),i.rotationalSpringDamper.setSymplecticEuler(t.sp2[2]||!1)),t.lm1&&(i.translationalLimitMotor.setLimits(t.lm1[0],t.lm1[1]||0),i.translationalLimitMotor.setMotor(t.lm1[2]||0,t.lm1[3]||0)),t.lm2&&(i.rotationalLimitMotor.setLimits(t.lm2[0],t.lm2[1]||0),i.rotationalLimitMotor.setMotor(t.lm2[2]||0,t.lm2[3]||0));break;case"prismatic":case"revolute":void 0!==t.axis1&&(this.tmpAxis1.fromArray(t.axis1),this.tmpAxis2.fromArray(t.axis1)),void 0!==t.axis2&&this.tmpAxis2.fromArray(t.axis2),a.getLocalVectorTo(this.tmpAxis1,i.localAxis1),n.getLocalVectorTo(this.tmpAxis2,i.localAxis2),null!=t.sp1&&(i.springDamper.setSpring(t.sp1[0]||0,t.sp1[1]||0),i.springDamper.setSymplecticEuler(t.sp1[2]||!1)),t.lm1&&("revolute"===t.type?i.limitMotor.setLimits(t.lm1[0]*o,t.lm1[1]*o):i.limitMotor.setLimits(t.lm1[0],t.lm1[1]),t.lm1.length>2&&i.limitMotor.setMotor(t.lm1[2]||0,t.lm1[3]||0));break;case"universal":void 0!==t.axis1&&(this.tmpAxis1.fromArray(t.axis1),this.tmpAxis2.fromArray(t.axis1)),void 0!==t.axis2&&this.tmpAxis2.fromArray(t.axis2),a.getLocalVectorTo(this.tmpAxis1,i.localAxis1),n.getLocalVectorTo(this.tmpAxis2,i.localAxis2),null!=t.sp1&&(i.springDamper1.setSpring(t.sp1[0]||0,t.sp1[1]||0),i.springDamper1.setSymplecticEuler(t.sp1[2]||!1)),null!=t.sp2&&(i.springDamper2.setSpring(t.sp2[0]||0,t.sp2[1]||0),i.springDamper2.setSymplecticEuler(t.sp2[2]||!1)),t.lm1&&(i.limitMotor1.setLimits(t.lm1[0]*o,t.lm1[1]*o),i.limitMotor1.setMotor(t.lm1[2]||0,t.lm1[3]||0)),t.lm2&&(i.limitMotor2.setLimits(t.lm2[0]*o,t.lm2[1]*o),i.limitMotor2.setMotor(t.lm2[2]||0,t.lm2[3]||0));break;case"ragdoll":void 0!==t.axis1&&(this.tmpAxis1.fromArray(t.axis1),this.tmpAxis2.fromArray(t.axis1)),void 0!==t.axis2&&this.tmpAxis2.fromArray(t.axis2),void 0!==t.axis3&&this.tmpAxis3.fromArray(t.axis3),a.getLocalVectorTo(this.tmpAxis1,i.localTwistAxis1),n.getLocalVectorTo(this.tmpAxis2,i.localTwistAxis2),a.getLocalVectorTo(this.tmpAxis3,i.localSwingAxis1),null!=t.sp1&&(i.twistSpringDamper.setSpring(t.sp1[0]||0,t.sp1[1]||0),i.twistSpringDamper.setSymplecticEuler(t.sp1[2]||!1)),null!=t.sp2&&(i.swingSpringDamper.setSpring(t.sp2[0]||0,t.sp2[1]||0),i.swingSpringDamper.setSymplecticEuler(t.sp2[2]||!1)),t.lm1&&(i.twistLimitMotor.setLimits(t.lm1[0]*o,t.lm1[1]*o),i.twistLimitMotor.setMotor(t.lm1[2]||0,t.lm1[3]||0)),void 0!==t.ma1&&(i.maxSwingAngle1=t.ma1*o),void 0!==t.ma2&&(i.maxSwingAngle2=t.ma2*o)}switch(t.type){case"spherical":s=new OIMO.SphericalJoint(i);break;case"revolute":s=new OIMO.RevoluteJoint(i);break;case"cylindrical":s=new OIMO.CylindricalJoint(i);break;case"prismatic":s=new OIMO.PrismaticJoint(i);break;case"universal":s=new OIMO.UniversalJoint(i);break;case"ragdoll":s=new OIMO.RagdollJoint(i)}return s.name=t.name||"",this.addJoint(s),s},OIMO.World.prototype.reset=function(){for(var t,i=this.getRigidBodyList();null!=i;)t=i,i=i.getNext(),this.removeRigidBody(t),t=null;for(var a=this.getJointList();null!=a;)t=a,a=a.getNext(),this.removeJoint(t),t=null;this.byName={},this.tmpForce=[],this.tmpMatrix=[]},OIMO.World.prototype.getInfo=function(t){return void 0===this.temp&&(this.temp=[0,0,0]),t-1e3>this.temp[0]&&(this.temp[0]=t,this.temp[2]=this.temp[1],this.temp[1]=0),this.temp[1]++,["Rigidbody "+this.getNumRigidBodies()+"<br>","Joints "+this.getNumJoints()+"<br>","Shapes "+this.getNumShapes()+"<br>","Pairs "+this.getContactManager().getNumContacts()+"<br>","------------<br>","  Broad Phase  : "+Math.round(OIMO.Performance.broadPhaseCollisionTime)+"ms<br>","  Narrow Phase : "+Math.round(OIMO.Performance.narrowPhaseCollisionTime)+"ms<br>","  Dynamics     : "+Math.round(OIMO.Performance.dynamicsTime)+"ms<br>","  Physics Total: "+Math.round(OIMO.Performance.totalTime)+"ms<br>","------------<br>","  Oimo FPS   : "+this.temp[2]+"<br>"].join("\n")},OIMO.World.prototype.stepJoint=function(t,i){},OIMO.World.prototype.stepRigidBody=function(t,i){for(var a,n,o=this.getRigidBodyList(),s=0,r=new OIMO.Vec3,_=new OIMO.Quat;null!=o;)1!==o.getType()&&(n=i+8*s,a=o.getSleeping()?1:0,t[n]=a,0===a&&(o.getTrans(r,_),t[n+1]=r.x,t[n+2]=r.y,t[n+3]=r.z,t[n+4]=_.x,t[n+5]=_.y,t[n+6]=_.z,t[n+7]=_.w),s++),o=o.getNext()},OIMO.World.prototype.set=function(t){t=t||{},this.broadPhase=void 0!==t.broadPhase?t.broadPhase:2,this._broadPhase=2===this.broadPhase?new OIMO.BvhBroadPhase:new OIMO.BruteForceBroadPhase,this._contactManager=new OIMO.ContactManager(this._broadPhase),this.stepSize=void 0!==t.stepSize?t.stepSize:.016,this.g=void 0!==t.gravity?t.gravity:[0,-9.80665,0],this._gravity.fromArray(this.g),this.byName={},this.tmpForce=[],this.tmpMatrix=[],this.tmpAxis1||(this.tmpAxis1=new OIMO.Vec3),this.tmpAxis2||(this.tmpAxis2=new OIMO.Vec3),this.tmpAxis3||(this.tmpAxis3=new OIMO.Vec3),this.tmpPos||(this.tmpPos=new OIMO.Vec3),this.tmpPos2||(this.tmpPos2=new OIMO.Vec3),this.tmpZero||(this.tmpZero=new OIMO.Vec3),this.tmpMat||(this.tmpMat=new OIMO.Mat3),this.tmpQuat||(this.tmpQuat=new OIMO.Quat)},OIMO.World.prototype.updateMatrix=function(){for(;this.tmpMatrix.length>0;)this.applyMatrix(this.tmpMatrix.pop())},OIMO.World.prototype.applyMatrix=function(t){var i=this.byName[t[0]];if(void 0!==i){var a=i._type===OIMO.RigidBodyType._KINEMATIC,n=OIMO.MathUtil.TO_RADIANS;void 0!==t[1]&&(i.setPosition(this.tmpPos.fromArray(t[1])),a||i.setLinearVelocity(this.tmpZero)),void 0!==t[2]&&(3===t[2].length?this.tmpQuat.setFromEuler({x:t[2][0]*n,y:t[2][1]*n,z:t[2][2]*n}):this.tmpQuat.fromArray(t[2]),i.setRotation(this.tmpMat.fromQuat(this.tmpQuat)),a||i.setAngularVelocity(this.tmpZero))}},OIMO.World.prototype.updateForce=function(){for(;this.tmpForce.length>0;)this.applyForce(this.tmpForce.pop())},OIMO.World.prototype.applyForce=function(t){var i=this.byName[t[0]];if(void 0!==i){var a=this.tmpPos.fromArray(t[2]),n=void 0===t[3]?this.tmpZero:this.tmpPos2.fromArray(t[3]);switch(t[1]){case"force":void 0===t[3]?i.applyForceToCenter(a):i.applyForce(a,n);break;case"torque":i.applyTorque(a);break;case"impulse":i.applyImpulse(a,n);break;case"linearImpulse":i.applyLinearImpulse(a);break;case"angularImpulse":i.applyAngularImpulse(a)}}}});
