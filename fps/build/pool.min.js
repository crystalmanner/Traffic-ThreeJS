'use strict';var THREE,pool=function(){var w=[],A=null,p={},x={},B=window.URL||window.webkitURL;pool={del:function(d){delete p[d]},get:function(d){return p[d]},getResult:function(){return p},load:function(d,g){"string"==typeof d||d instanceof String?w.push(d):w=w.concat(d);A=g||function(){};this.loadOne()},next:function(){w.shift();0===w.length?A(p):this.loadOne()},loadOne:function(){var d=w[0],g=d.substring(d.lastIndexOf("/")+1,d.lastIndexOf(".")),h=d.substring(d.lastIndexOf(".")+1);if("jpg"===h||
"png"===h)this.loadImage(d,g);else this[h+"_load"](d,g)},loadImage:function(d,g){var h=new Image;h.onload=function(){p[g]=h;this.next()}.bind(this);h.src=d},sea_load:function(d,g){var h=new THREE.SEA3D;h.onComplete=function(d){d=h.meshes.length;for(var t,T=[],u={};d--;)t=h.meshes[d],u[t.name]=t,T.push(t.name);p[g]=u;this.next()}.bind(this);h.load(d)},z_load:function(d,g){var h=new XMLHttpRequest;h.overrideMimeType("text/plain; charset=x-user-defined");h.onload=function(){this.z_parse(g,h.responseText)}.bind(this);
h.open("GET",d,!0);h.send(null)},z_parse:function(d,g){for(var h=new Uint8Array(g.length),m=0,t=g.length;m<t;++m)h[m]=g.charCodeAt(m)&255;G.decompress(h,function(g){h=null;p[d]=g;this.next()}.bind(this))},toScript:function(d){var g=document.createElement("script");g.type="text/javascript";g.charset="utf-8";g.text=p[d];document.getElementsByTagName("head")[0].appendChild(g);this.del(d)},toURL:function(d){x[d]=B.createObjectURL(new Blob([p[d]],{type:"application/javascript"}));this.del(d);return x[d]},
delURL:function(d){B.revokeObjectURL(x[d])},json_load:function(d,g){var h=new XMLHttpRequest;h.overrideMimeType("application/json");h.onload=function(){p[g]=JSON.parse(h.responseText);this.next()}.bind(this);h.open("GET",d,!0);h.send(null)},glsl_load:function(d,g){var h=new XMLHttpRequest;h.onload=function(){p[g]=h.responseText;this.next()}.bind(this);h.open("GET",d,!0);h.send(null)},cube_load:function(d,g){function h(){if(d.length){var m=d.length-1,u=new Image;u.onload=function(){t[m]=u;h()};u.src=
d.pop()}else pool.cube_load_end(g,t)}var m=d.substring(0,d.lastIndexOf("."))+"/";d=[m+"posx.png",m+"negx.png",m+"posy.png",m+"negy.png",m+"posz.png",m+"negz.png"];var t=[];h()},cube_load_end:function(d,g){var h=new THREE.CubeTexture(g);h.format=THREE.RGBFormat;h.needsUpdate=!0;p[d]=h;this.next()}};var G=function(){function d(b){var a=[];return a[b-1]=void 0,a}function g(b,a){return m(b[0]+a[0],b[1]+a[1])}function h(b,a){var c,d;return b[0]==a[0]&&b[1]==a[1]?0:(c=0>b[1],d=0>a[1],c&&!d?-1:!c&&d?1:0>
m(b[0]-a[0],b[1]-a[1])[1]?-1:1)}function m(b,a){var c,d;a%=z;b%=z;c=a%n;d=Math.floor(b/n)*n;a=a-c+d;for(b=b-d+c;0>b;)b+=n,a-=n;for(;b>H;)b-=n,a+=n;for(a%=z;9223372032559808E3<a;)a-=z;for(;-z>a;)a+=z;return[b,a]}function t(b){return 0<=b?[b,0]:[b+n,-n]}function p(b){return b[0]>=C?~~Math.max(Math.min(b[0]-n,L),-C):~~Math.max(Math.min(b[0],L),-C)}function u(b){return b.cb>=b.O?-1:255&b.ab[b.cb++]}function w(b){var a=b.ab;return a.length=b.O,a}function x(b,a){var c;c={};c=(c.ab=d(32),c.O=0,c);b.S=c;
var y;c={};y=(c.ab=a,c.cb=0,c.O=a.length,c);var l=b.S,e,k,f,h="",g=[];for(e=0;5>e;++e){if(k=u(y),-1==k)throw Error("truncated input");g[e]=k<<24>>24}c={b:{},a:{}};c.q=d(192);c.E=d(12);c.s=d(12);c.u=d(12);c.r=d(12);c.n=d(192);c.j=d(4);c.J=d(114);c.t=D({},4);c.C=M({});c.o=M({});c.k={};for(e=0;4>e;++e)c.j[e]=D({},6);var v,m,p,s;if(5>g.length)e=0;else{e=255&g[0];m=e%9;e=~~(e/9);p=e%5;s=~~(e/5);for(v=e=0;4>v;++v)e+=(255&g[1+v])<<8*v;if(!(g=99999999<e)){if(8<m||4<p||4<s)s=0;else{g=c.k;if(null==g.F||g.g!=
m||g.y!=p)for(g.y=p,g.Y=(1<<p)-1,g.g=m,p=1<<g.g+g.y,g.F=d(p),m=0;p>m;++m){v=g.F;var r=m,n;n={};n=(n.v=d(768),n);v[r]=n}s=1<<s;s=(N(c.C,s),N(c.o,s),c.P=s-1,1)}g=!s}g?e=0:0>e?e=0:(c.z!=e&&(c.z=e,c.m=Math.max(c.z,1),e=c.b,s=Math.max(c.m,4096),null!=e.x&&e.c==s||(e.x=d(s)),e.c=s,e.D=0,e.w=0),e=1)}if(!e)throw Error("corrupted input");for(e=0;64>e;e+=8){if(k=u(y),-1==k)throw Error("truncated input");k=k.toString(16);1==k.length&&(k="0"+k);h=k+""+h}/^0+$|^f+$/i.test(h)?b.N=I:(f=parseInt(h,16),b.N=f>H?I:
t(f));k=b.N;c.a.K=y;f=c.b;E(f);f.V=null;c.b.V=l;c.b.w=0;c.b.D=0;q(c.q);q(c.n);q(c.E);q(c.s);q(c.u);q(c.r);q(c.J);f=c.k;y=1<<f.g+f.y;for(l=0;y>l;++l)q(f.F[l].v);for(f=0;4>f;++f)q(c.j[f].B);O(c.C);O(c.o);q(c.t.B);f=c.a;f.p=0;f.i=-1;for(l=0;5>l;++l)f.p=f.p<<8|u(f.K);c.f=0;c.l=0;c.T=0;c.R=0;c._=0;c.U=k;c.d=P;c.I=0;k={};c=(k.h=c,k.bb=null,k.X=1,k);b.Q=c;return b}function E(b){var a=b.D-b.w;if(a){for(var c=b.V,d=b.x,l=b.w,e=c.ab,k=c.O,f=0;a>f;++f)e[k+f]=d[l+f];c.O+=a;b.D>=b.c&&(b.D=0);b.w=b.D}}function A(b,
a){var c=b.D-a-1;return 0>c&&(c+=b.c),b.x[c]}function B(b){if(!b.X)throw Error("bad state");if(b.bb)throw Error("No encoding");var a;a:{a=b.h;var c,d,l,e,k;if(k=p(a.d)&a.P,r(a.a,a.q,(a.f<<4)+k)){if(r(a.a,a.E,a.f))l=0,r(a.a,a.s,a.f)?(r(a.a,a.u,a.f)?(r(a.a,a.r,a.f)?(d=a._,a._=a.R):d=a.R,a.R=a.T):d=a.T,a.T=a.l,a.l=d):r(a.a,a.n,(a.f<<4)+k)||(a.f=7>a.f?9:11,l=1),l||(l=Q(a.o,a.a,k)+2,a.f=7>a.f?8:11);else{a._=a.R;a.R=a.T;a.T=a.l;l=2+Q(a.C,a.a,k);a.f=7>a.f?7:10;var f=a.j;k=l;d=(k-=2,4>k?k:3);if(e=F(f[d],
a.a),4<=e)if(c=(e>>1)-1,a.l=(2|1&e)<<c,14>e){f=a.l;d=a.J;e=a.l-e-1;k=a.a;var m,n,v=1,q=0;for(n=0;c>n;++n)m=r(k,d,e+v),v<<=1,v+=m,q|=m<<n;a.l=f+q}else{e=a.l;f=a.a;d=0;for(c-=4;0!=c;--c)f.i>>>=1,k=f.p-f.i>>>31,f.p-=f.i&k-1,d=d<<1|1-k,-J&f.i||(f.p=f.p<<8|u(f.K),f.i<<=8);a.l=e+(d<<4);c=a.l;e=a.t;f=a.a;m=1;for(k=n=0;e.A>k;++k)d=r(f,e.B,m),m<<=1,m+=d,n|=d<<k;if(a.l=c+n,0>a.l){a=-1==a.l?1:-1;break a}}else a.l=e}if(0<=h(t(a.l),a.d)||a.l>=a.m){a=-1;break a}c=a.b;e=l;f=c.D-a.l-1;for(0>f&&(f+=c.c);0!=e;--e)f>=
c.c&&(f=0),c.x[c.D++]=c.x[f++],c.D>=c.c&&E(c);a.d=g(a.d,t(l));a.I=A(a.b,0)}else{c=a.k;e=p(a.d);c=c.F[((e&c.Y)<<c.g)+((255&a.I)>>>8-c.g)];if(7>a.f){l=a.a;e=1;do e=e<<1|r(l,c.v,e);while(256>e);l=e<<24>>24}else{e=a.a;d=A(a.b,a.l);k=1;do if(f=d>>7&1,d<<=1,l=r(e,c.v,(1+f<<8)+k),k=k<<1|l,f!=l){for(;256>k;)k=k<<1|r(e,c.v,k);break}while(256>k);l=k<<24>>24}a.I=l;l=a.b;c=a.I;l.x[l.D++]=c;l.D>=l.c&&E(l);l=a.f;a.f=4>l?0:10>l?l-3:l-6;a.d=g(a.d,G)}a=0}if(-1==a)throw Error("corrupted input");b.$=I;b.Z=b.h.d;if(a||
0<=h(b.h.U,P)&&0<=h(b.h.d,b.h.U))E(b.h.b),a=b.h.b,E(a),a.V=null,b.h.a.K=null,b.X=0;return b.X}function N(b,a){for(;a>b.e;++b.e)b.G[b.e]=D({},3),b.H[b.e]=D({},3)}function Q(b,a,c){return r(a,b.M,0)?8+(r(a,b.M,1)?8+F(b.L,a):F(b.H[c],a)):F(b.G[c],a)}function M(b){return b.M=d(2),b.G=d(16),b.H=d(16),b.L=D({},8),b.e=0,b}function O(b){q(b.M);for(var a=0;b.e>a;++a)q(b.G[a].B),q(b.H[a].B);q(b.L.B)}function D(b,a){return b.A=a,b.B=d(1<<a),b}function F(b,a){var c,d=1;for(c=b.A;0!=c;--c)d=(d<<1)+r(a,b.B,d);
return d-(1<<b.A)}function r(b,a,c){var d,l=a[c];return d=(b.i>>>11)*l,(-C^d)>(-C^b.p)?(b.i=d,a[c]=l+(2048-l>>>5)<<16>>16,-J&b.i||(b.p=b.p<<8|u(b.K),b.i<<=8),0):(b.i-=d,b.p-=d,a[c]=l-(l>>>5)<<16>>16,-J&b.i||(b.p=b.p<<8|u(b.K),b.i<<=8),1)}function q(b){for(var a=b.length-1;0<=a;--a)b[a]=1024}function R(b){for(var a,c,d,l=0,e=0,k=b.length,f=[],g=[];k>l;++l,++e){if(a=255&b[l],128&a)if(192==(224&a)){if(l+1>=k||(c=255&b[++l],128!=(192&c)))return b;g[e]=(31&a)<<6|63&c}else{if(224!=(240&a)||l+2>=k||(c=255&
b[++l],128!=(192&c))||(d=255&b[++l],128!=(192&d)))return b;g[e]=(15&a)<<12|(63&c)<<6|63&d}else{if(!a)return b;g[e]=a}16383==e&&(f.push(String.fromCharCode.apply(String,g)),e=-1)}return 0<e&&(g.length=e,f.push(String.fromCharCode.apply(String,g))),f.join("")}function S(b){return b[1]+b[0]}var z=1.8446744073709552E19,H=4294967295,L=2147483647,C=2147483648,J=16777216,K="function"==typeof setImmediate?setImmediate:setTimeout,n=4294967296,I=[H,-n],P=[0,0],G=[1,0];return{decompress:function(b,a,c){function d(){try{for(var b,
e=0,m=(new Date).getTime();B(h.d.Q);)if(0==++e%1E3&&200<(new Date).getTime()-m)return k&&(g=S(h.d.Q.h.d)/f,c(g)),K(d,0),0;c(1);b=R(w(h.d.S));K(a.bind(null,b),0)}catch(n){a(null,n)}}var g,e,k,f,h={};if("function"!=typeof a&&(e=a,a=c=0),c=c||function(a){void 0!==e&&(void 0)({action:3,cbn:e,result:k?a:-1})},a=a||function(a,b){return void 0!==e?(void 0)({action:2,cbn:e,result:a,error:b}):void 0},void 0===a&&void 0===c)for(h.d=x({},b);B(h.d.Q);)return R(w(h.d.S));try{h.d=x({},b),f=S(h.d.N),k=-1<f,c(0)}catch(m){return a(null,
m)}K(d,0)}}}();return pool}();
