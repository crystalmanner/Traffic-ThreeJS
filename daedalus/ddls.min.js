'use strict';var DDLS={SegmentID:0,ShapeID:0,EdgeID:0,FaceID:0,MeshID:0,ObjectID:0,VertexID:0,GraphID:0,GraphEdgeID:0,GraphNodeID:0,VERTEX:0,EDGE:1,FACE:2,NULL:3};DDLS.sqrt=Math.sqrt;DDLS.cos=Math.cos;DDLS.sin=Math.sin;DDLS.atan2=Math.atan2;DDLS.round=Math.round;DDLS.pow=Math.pow;DDLS.max=Math.max;DDLS.min=Math.min;DDLS.random=Math.random;DDLS.lerp=function(a,b,c){return a+(b-a)*c};DDLS.randInRange=function(a,b){return DDLS.lerp(a,b,DDLS.random())};
DDLS.randInt=function(a,b,c){return 1*DDLS.lerp(a,b,DDLS.random()).toFixed(c||0)};DDLS.EPSILON=0.01;DDLS.EPSILON_SQUARED=1E-4;DDLS.PI=3.141592653589793;DDLS.TwoPI=6.283185307179586;DDLS.PI90=1.570796326794896;DDLS.PI270=4.712388980384689;DDLS.NaN=Number.NaN;DDLS.NEGATIVE_INFINITY=-Infinity;DDLS.POSITIVE_INFINITY=Infinity;DDLS.isFinite=function(a){return isFinite(a)};DDLS.isNaN=function(a){return isNaN(a)};DDLS.int=function(a){return parseInt(a)};var DDLS_ARRAY_TYPE;
DDLS_ARRAY_TYPE||(DDLS_ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array);DDLS.Log=function(a){console.log(a)};DDLS.Fid=0;DDLS.Bind=function(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=DDLS.Fid++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c};DDLS.Timer=function(){};
DDLS.Timer.stamp=function(){return void 0!==self.performance&&void 0!==self.performance.now?0.001*self.performance.now():0.001*Date.now()};DDLS.Dictionary=function(a,b){this.type=a||0;0==this.type?(this.k=[],this.v=[]):this.h={}};
DDLS.Dictionary.prototype={set:function(a,b){2==this.type?this.h[a]=b:1==this.type?this.h[a.id]=b:(this.k.push(a),this.v.push(b))},get:function(a){if(2==this.type)return this.h[a];if(1==this.type)return this.h[a.id];a=this.k.indexOf(a);if(-1!=a)return this.v[a]},dispose:function(){if(0==this.type){for(;0<this.k.length;)this.k.pop();for(;0<this.v.length;)this.v.pop();this.v=this.k=null}else this.h=null}};DDLS.Point=function(a,b){this.x=a||0;this.y=b||0;return this};
DDLS.Point.prototype={constructor:DDLS.Point,transform:function(a){a.tranform(this);return this},set:function(a,b){this.x=a;this.y=b;return this},clone:function(){return new DDLS.Point(this.x,this.y)},sub:function(a){this.x-=a.x;this.y-=a.y;return this},mul:function(a){this.x*=a;this.y*=a;return this},add:function(a){this.x+=a.x;this.y+=a.y;return this},div:function(a){a=1/a;this.x*=a;this.y*=a;return this},get_length:function(){return DDLS.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=
this.get_length();this.x/=a;this.y/=a;return a},distanceTo:function(a){var b=this.x-a.x;a=this.y-a.y;return DDLS.sqrt(b*b+a*a)},distanceSquaredTo:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},equals:function(a){return this.x===a.x&&this.y===a.y}};DDLS.Matrix=function(a,b,c,d,e,f){this.a=a||0;this.b=b||0;this.c=c||0;this.d=d||0;this.e=e||0;this.f=f||0};
DDLS.Matrix.prototype={constructor:DDLS.Matrix,identity:function(){this.a=1;this.c=this.b=0;this.d=1;this.f=this.e=0;return this},translate:function(a,b){this.e+=a;this.f+=b;return this},scale:function(a,b){this.a*=a;this.b*=b;this.c*=a;this.d*=b;this.e*=a;this.f*=b;return this},rotate:function(a){var b=DDLS.cos(a);a=DDLS.sin(a);var c=this.a*a+this.b*b,d=this.c*b+this.d*-a,e=this.c*a+this.d*b,f=this.e*b+this.f*-a,g=this.e*a+this.f*b;this.a=this.a*b+this.b*-a;this.b=c;this.c=d;this.d=e;this.e=f;this.f=
g;return this},clone:function(){return new DDLS.Matrix(this.a,this.b,this.c,this.d,this.e,this.f)},tranform:function(a){var b=this.b*a.x+this.d*a.y+this.f;a.x=this.a*a.x+this.c*a.y+this.e;a.y=b},transformX:function(a,b){return this.a*a+this.c*b+this.e},transformY:function(a,b){return this.b*a+this.d*b+this.f},concat:function(a){var b=this.a*a.b+this.b*a.d,c=this.c*a.a+this.d*a.c,d=this.c*a.b+this.d*a.d,e=this.e*a.a+this.f*a.c+a.e,f=this.e*a.b+this.f*a.d+a.f;this.a=this.a*a.a+this.b*a.c;this.b=b;this.c=
c;this.d=d;this.e=e;this.f=f;return this}};DDLS.RandGenerator=function(a,b,c){this.rangeMin=b||0;this.rangeMax=c||1;this._originalSeed=this._currSeed=a||1234;this._numIter=0;Object.defineProperty(this,"seed",{get:function(){return this._originalSeed},set:function(a){this._originalSeed=this._currSeed=a}})};
DDLS.RandGenerator.prototype={constructor:DDLS.RandGenerator,reset:function(){this._currSeed=this._originalSeed;this._numIter=0},next:function(){var a=1*this._currSeed;for(this._tempString=(a*a).toString();8>this._tempString.length;)this._tempString="0"+this._tempString;this._currSeed=parseInt(this._tempString.substr(1,5));a=DDLS.round(this.rangeMin+this._currSeed/99999*(this.rangeMax-this.rangeMin));0==this._currSeed&&(this._currSeed=this._originalSeed+this._numIter);this._numIter++;200==this._numIter&&
this.reset();return a},nextInRange:function(a,b){this.rangeMin=a;this.rangeMax=b;return this.next()},shuffle:function(a){for(var b=a.length;0<b;){var c=this.nextInRange(0,b-1);b--;var d=a[b];a[b]=a[c];a[c]=d}}};DDLS.Edge=function(){this.type=DDLS.EDGE;this.id=DDLS.EdgeID;DDLS.EdgeID++;this.fromConstraintSegments=[];this.isReal=this.isConstrained=!1;this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null;Object.defineProperty(this,"destinationVertex",{get:function(){return this.oppositeEdge.originVertex}});Object.defineProperty(this,"nextRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.nextLeftEdge.oppositeEdge}});Object.defineProperty(this,"prevRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.oppositeEdge}});
Object.defineProperty(this,"prevLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge}});Object.defineProperty(this,"rotLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge.oppositeEdge}});Object.defineProperty(this,"rotRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge}});Object.defineProperty(this,"rightFace",{get:function(){return this.oppositeEdge.leftFace}})};
DDLS.Edge.prototype={constructor:DDLS.Edge,setDatas:function(a,b,c,d,e,f){this.isConstrained=void 0!==e?f:!1;this.isReal=void 0!==e?e:!0;this.originVertex=a;this.oppositeEdge=b;this.nextLeftEdge=c;this.leftFace=d},getDatas:function(){return[this.originVertex.pos.x,this.originVertex.pos.y,this.destinationVertex.pos.x,this.destinationVertex.pos.y,this.isConstrained?1:0]},addFromConstraintSegment:function(a){-1==this.fromConstraintSegments.indexOf(a)&&this.fromConstraintSegments.push(a)},removeFromConstraintSegment:function(a){a=
this.fromConstraintSegments.indexOf(a);-1!=a&&this.fromConstraintSegments.splice(a,1)},dispose:function(){this.fromConstraintSegments=this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null},toString:function(){return"edge "+this.originVertex.id+" - "+this.destinationVertex.id}};DDLS.Face=function(){this.type=DDLS.FACE;this.id=DDLS.FaceID;DDLS.FaceID++;this.isReal=!1;this.edge=null};DDLS.Face.prototype={constructor:DDLS.Face,setDatas:function(a,b){this.isReal=void 0!==b?b:!0;this.edge=a},dispose:function(){this.edge=null}};DDLS.Vertex=function(){this.type=DDLS.VERTEX;this.colorDebug=-1;this.id=DDLS.VertexID;DDLS.VertexID++;this.pos=new DDLS.Point;this.fromConstraintSegments=[];this.edge=null;this.isReal=!1};
DDLS.Vertex.prototype={constructor:DDLS.Vertex,setDatas:function(a,b){this.isReal=void 0!==b?b:!0;this.edge=a},addFromConstraintSegment:function(a){-1==this.fromConstraintSegments.indexOf(a)&&this.fromConstraintSegments.push(a)},removeFromConstraintSegment:function(a){a=this.fromConstraintSegments.indexOf(a);-1!=a&&this.fromConstraintSegments.splice(a,1)},dispose:function(){this.fromConstraintSegments=this.edge=this.pos=null},toString:function(){return"ver_id "+this.id}};DDLS.Object=function(){this.id=DDLS.ObjectID;DDLS.ObjectID++;this._pivotY=this._pivotX=0;this._matrix=new DDLS.Matrix;this._scaleY=this._scaleX=1;this._rotation=0;this._constraintShape=null;this._y=this._x=0;this._coordinates=[];this.hasChanged=!1;Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation!=a&&(this._rotation=a,this.hasChanged=!0)}});Object.defineProperty(this,"scaleX",{get:function(){return this._scaleX},set:function(a){this._scaleX!=
a&&(this._scaleX=a,this.hasChanged=!0)}});Object.defineProperty(this,"scaleY",{get:function(){return this._scaleY},set:function(a){this._scaleY!=a&&(this._scaleY=a,this.hasChanged=!0)}});Object.defineProperty(this,"x",{get:function(){return this._x},set:function(a){this._x!=a&&(this._x=a,this.hasChanged=!0)}});Object.defineProperty(this,"y",{get:function(){return this._y},set:function(a){this._y!=a&&(this._y=a,this.hasChanged=!0)}});Object.defineProperty(this,"matrix",{get:function(){return this._matrix},
set:function(a){this._matrix=a;this.hasChanged=!0}});Object.defineProperty(this,"coordinates",{get:function(){return this._coordinates},set:function(a){this._coordinates=a;this.hasChanged=!0}});Object.defineProperty(this,"constraintShape",{get:function(){return this._constraintShape},set:function(a){this._constraintShape=a;this.hasChanged=!0}});Object.defineProperty(this,"pivotX",{get:function(){return this._pivotX},set:function(a){this._pivotX=a;this.hasChanged=!0}});Object.defineProperty(this,"pivotY",
{get:function(){return this._pivotY},set:function(a){this._pivotY=a;this.hasChanged=!0}});Object.defineProperty(this,"edges",{get:function(){for(var a=[],b=this._constraintShape.segments,c=0,d=b.length;c<d;)for(var e=c++,f=0,g=b[e].edges.length;f<g;){var l=f++;a.push(b[e].edges[l])}return a}})};
DDLS.Object.prototype={constructor:DDLS.Object,dispose:function(){this._constraintShape=this._coordinates=this._matrix=null},updateValuesFromMatrix:function(){},updateMatrixFromValues:function(){this._matrix.identity().translate(-this._pivotX,-this._pivotY).scale(this._scaleX,this._scaleY).rotate(this._rotation).translate(this._x,this._y)}};DDLS.Segment=function(a,b){this.id=DDLS.SegmentID;DDLS.SegmentID++;this.edges=[];this.fromShape=null};DDLS.Segment.prototype={constructor:DDLS.Segment,addEdge:function(a){-1==this.edges.indexOf(a)&&-1==this.edges.indexOf(a.oppositeEdge)&&this.edges.push(a)},removeEdge:function(a){var b=this.edges.indexOf(a);-1==b&&(b=this.edges.indexOf(a.oppositeEdge));-1!=b&&this.edges.splice(b,1)},dispose:function(){this.fromShape=this.edges=null},toString:function(){return"seg_id "+this.id}};DDLS.Shape=function(){this.id=DDLS.ShapeID;DDLS.ShapeID++;this.segments=[]};DDLS.Shape.prototype={constructor:DDLS.Shape,dispose:function(){for(;0<this.segments.length;)this.segments.pop().dispose();this.segments=null}};DDLS.FromEdgeToRotatedEdges=function(){};DDLS.FromFaceToInnerVertices=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToInnerVertices.prototype={next:function(){null!=this._nextEdge?(this._resultVertex=this._nextEdge.originVertex,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge&&(this._nextEdge=null)):this._resultVertex=null;return this._resultVertex}};
DDLS.FromFaceToInnerEdges=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToInnerEdges.prototype={next:function(){null!=this._nextEdge?(this._resultEdge=this._nextEdge,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge&&(this._nextEdge=null)):this._resultEdge=null;return this._resultEdge}};
DDLS.FromFaceToNeighbourFaces=function(){Object.defineProperty(this,"fromFace",{set:function(a){this._fromFace=a;this._nextEdge=this._fromFace.edge}})};DDLS.FromFaceToNeighbourFaces.prototype={next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.rightFace,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge){this._nextEdge=null;this._resultFace.isReal||(this._resultFace=null);break}while(!this._resultFace.isReal)}else this._resultFace=null;return this._resultFace}};
DDLS.FromMeshToVertices=function(){Object.defineProperty(this,"fromMesh",{set:function(a){this._fromMesh=a;this._currIndex=0}})};DDLS.FromMeshToVertices.prototype={next:function(){do if(this._currIndex<this._fromMesh._vertices.length)this._resultVertex=this._fromMesh._vertices[this._currIndex],this._currIndex++;else{this._resultVertex=null;break}while(!this._resultVertex.isReal);return this._resultVertex}};
DDLS.FromMeshToFaces=function(){Object.defineProperty(this,"fromMesh",{set:function(a){this._fromMesh=a;this._currIndex=0}})};DDLS.FromMeshToFaces.prototype={next:function(){do if(this._currIndex<this._fromMesh._faces.length)this._resultFace=this._fromMesh._faces[this._currIndex],this._currIndex++;else{this._resultFace=null;break}while(!this._resultFace.isReal);return this._resultFace}};
DDLS.FromVertexToHoldingFaces=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge}})};
DDLS.FromVertexToHoldingFaces.prototype={next:function(){if(null!=this._nextEdge){do if(this._resultFace=this._nextEdge.leftFace,this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;this._resultFace.isReal||(this._resultFace=null);break}while(!this._resultFace.isReal)}else this._resultFace=null;return this._resultFace}};
DDLS.FromVertexToIncomingEdges=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;for(this._nextEdge=this._fromVertex.edge;!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};
DDLS.FromVertexToIncomingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge.oppositeEdge;do if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}while(!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};
DDLS.FromVertexToOutgoingEdges=function(){this.realEdgesOnly=!0;Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge;if(null!=this._nextEdge)for(;this.realEdgesOnly&&!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};
DDLS.FromVertexToOutgoingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge;do if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}while(this.realEdgesOnly&&!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};DDLS.FromVertexToNeighbourVertices=function(){Object.defineProperty(this,"fromVertex",{set:function(a){this._fromVertex=a;this._nextEdge=this._fromVertex.edge}})};
DDLS.FromVertexToNeighbourVertices.prototype={next:function(){if(null!=this._nextEdge){this._resultVertex=this._nextEdge.destinationVertex;do this._nextEdge=this._nextEdge.rotLeftEdge;while(!this._nextEdge.isReal);this._nextEdge==this._fromVertex.edge&&(this._nextEdge=null)}else this._resultVertex=null;return this._resultVertex}};DDLS.Squared=function(a,b){return a*a+b*b};DDLS.Geom2D={};DDLS.Geom2D.__samples=[];DDLS.Geom2D.__circumcenter=new DDLS.Point;
DDLS.Geom2D.locatePosition=function(a,b){null==DDLS.Geom2D._randGen&&(DDLS.Geom2D._randGen=new DDLS.RandGenerator);DDLS.Geom2D._randGen.seed=DDLS.int(10*a.x+4*a.y);var c;DDLS.Geom2D.__samples.splice(0,DDLS.Geom2D.__samples.length);var d=DDLS.int(DDLS.pow(b._vertices.length,0.3333333333333333));DDLS.Geom2D._randGen.rangeMin=0;DDLS.Geom2D._randGen.rangeMax=b._vertices.length-1;for(c=d;c--;)DDLS.Geom2D.__samples.push(b._vertices[DDLS.Geom2D._randGen.next()]);var e,f,g=DDLS.POSITIVE_INFINITY;c=null;var l=
0;for(e=0;l<d;)e=DDLS.Geom2D.__samples[e],f=e.pos,f=DDLS.Squared(f.x-a.x,f.y-a.y),f<g&&(g=f,c=e),e=l++;d=new DDLS.FromVertexToHoldingFaces;d.fromVertex=c;l=d.next();d=new DDLS.Dictionary(1);c=new DDLS.FromFaceToInnerEdges;g=0;for(e=DDLS.Geom2D.isInFace(a,l);d.get(l)||3===e.type;){d.set(l,!0);g++;50==g&&DDLS.Log("WALK TAKE MORE THAN 50 LOOP");if(1E3==g){DDLS.Log("WALK TAKE MORE THAN 1000 LOOP -> WE ESCAPE");e={type:DDLS.NULL};break}c.fromFace=l;do{l=c.next();if(null==l)return DDLS.Log("KILL PATH"),
null;e=DDLS.Geom2D.getRelativePosition(a,l)}while(1==e||0==e);l=l.rightFace;e=DDLS.Geom2D.isInFace(a,l)}d.dispose();return e};
DDLS.Geom2D.isCircleIntersectingAnyConstraint=function(a,b,c){if(0>=a.x||a.x>=c.width||0>=a.y||a.y>=c.height)return!0;c=DDLS.Geom2D.locatePosition(a,c);var d;switch(c.type){case 0:d=c.edge.leftFace;break;case 1:d=c.leftFace;break;case 2:d=c;break;case 3:d=null}c=b*b;var e;e=d.edge.originVertex.pos;e=DDLS.Squared(e.x-a.x,e.y-a.y);if(e<=c)return!0;e=d.edge.nextLeftEdge.originVertex.pos;e=DDLS.Squared(e.x-a.x,e.y-a.y);if(e<=c)return!0;e=d.edge.nextLeftEdge.nextLeftEdge.originVertex.pos;e=DDLS.Squared(e.x-
a.x,e.y-a.y);if(e<=c)return!0;c=[];c.push(d.edge);c.push(d.edge.nextLeftEdge);c.push(d.edge.nextLeftEdge.nextLeftEdge);var f,g;for(e=new DDLS.Dictionary(0);0<c.length;)if(d=c.pop(),e.set(d,!0),f=d.originVertex.pos,g=d.destinationVertex.pos,f=DDLS.Geom2D.intersectionsSegmentCircle(f,g,a,b)){if(d.isConstrained)return!0;d=d.oppositeEdge.nextLeftEdge;e.get(d)||e.get(d.oppositeEdge)||-1!=c.indexOf(d)||-1!=c.indexOf(d.oppositeEdge)||c.push(d);d=d.nextLeftEdge;e.get(d)||e.get(d.oppositeEdge)||-1!=c.indexOf(d)||
-1!=c.indexOf(d.oppositeEdge)||c.push(d)}return!1};DDLS.Geom2D.getDirection=function(a,b,c){a=(c.x-a.x)*(b.y-a.y)+(c.y-a.y)*(-b.x+a.x);return 0==a?0:0<a?1:-1};DDLS.Geom2D.Orient2d=function(a,b,c){a=(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x);return a>-DDLS.EPSILON_SQUARED&&a<DDLS.EPSILON_SQUARED?0:0<a?-1:1};DDLS.Geom2D.getRelativePosition=function(a,b){return DDLS.Geom2D.getDirection(b.originVertex.pos,b.destinationVertex.pos,a)};
DDLS.Geom2D.getRelativePosition2=function(a,b){return DDLS.Geom2D.Orient2d(b.originVertex.pos,b.destinationVertex.pos,a)};
DDLS.Geom2D.isInFace=function(a,b){var c={type:DDLS.NULL},d=b.edge,e=d.nextLeftEdge,f=e.nextLeftEdge;if(0<=DDLS.Geom2D.getRelativePosition(a,d)&&0<=DDLS.Geom2D.getRelativePosition(a,e)&&0<=DDLS.Geom2D.getRelativePosition(a,f))var c=d.originVertex,g=e.originVertex,l=f.originVertex,k=c.pos.x,m=c.pos.y,h=g.pos.x,n=g.pos.y,p=l.pos.x,r=l.pos.y,q=DDLS.Squared(k-a.x,m-a.y),s=DDLS.Squared(h-a.x,n-a.y),t=DDLS.Squared(p-a.x,r-a.y),v=1/DDLS.Squared(h-k,n-m),u=1/DDLS.Squared(p-h,r-n),w=1/DDLS.Squared(k-p,m-r),
x=(a.x-k)*(h-k)+(a.y-m)*(n-m),h=(a.x-h)*(p-h)+(a.y-n)*(r-n),k=(a.x-p)*(k-p)+(a.y-r)*(m-r),s=s-h*h*u<=DDLS.EPSILON_SQUARED?!0:!1,t=t-k*k*w<=DDLS.EPSILON_SQUARED?!0:!1,c=q-x*x*v<=DDLS.EPSILON_SQUARED?t?c:s?g:d:s?t?l:e:t?f:b;return c};
DDLS.Geom2D.clipSegmentByTriangle=function(a,b,c,d,e,f,g){var l=DDLS.Geom2D.getDirection(c,d,a),k=DDLS.Geom2D.getDirection(c,d,b);if(0>=l&&0>=k)return!1;var m=DDLS.Geom2D.getDirection(d,e,a),h=DDLS.Geom2D.getDirection(d,e,b);if(0>=m&&0>=h)return!1;var n=DDLS.Geom2D.getDirection(e,c,a),p=DDLS.Geom2D.getDirection(e,c,b);if(0>=n&&0>=p)return!1;if(0<=l&&0<=m&&0<=n&&0<=k&&0<=h&&0<=p)return a.clone(),b.clone(),!0;var r=0;DDLS.Geom2D.intersections2segments(a,b,c,d,f,null)&&r++;0==r?DDLS.Geom2D.intersections2segments(a,
b,d,e,f,null)&&r++:DDLS.Geom2D.intersections2segments(a,b,d,e,g,null)&&(-0.01>f.x-g.x||f.x-g.x>DDLS.EPSILON||-DDLS.EPSILON>f.y-g.y||f.y-g.y>DDLS.EPSILON)&&r++;0==r?DDLS.Geom2D.intersections2segments(a,b,e,c,f,null)&&r++:1==r&&DDLS.Geom2D.intersections2segments(a,b,e,c,g,null)&&(-DDLS.EPSILON>f.x-g.x||f.x-g.x>DDLS.EPSILON||-DDLS.EPSILON>f.y-g.y||f.y-g.y>DDLS.EPSILON)&&r++;1==r&&(0<=l&&0<=m&&0<=n?a.clone():0<=k&&0<=h&&0<=p?b.clone():r=0);return 0<r?!0:!1};
DDLS.Geom2D.isDelaunay=function(a){var b=a.nextLeftEdge.destinationVertex,c=a.nextRightEdge.destinationVertex;DDLS.Geom2D.getCircumcenter(b.pos,a.originVertex.pos,a.destinationVertex.pos,DDLS.Geom2D.__circumcenter);return(c.pos.x-DDLS.Geom2D.__circumcenter.x)*(c.pos.x-DDLS.Geom2D.__circumcenter.x)+(c.pos.y-DDLS.Geom2D.__circumcenter.y)*(c.pos.y-DDLS.Geom2D.__circumcenter.y)>=(b.pos.x-DDLS.Geom2D.__circumcenter.x)*(b.pos.x-DDLS.Geom2D.__circumcenter.x)+(b.pos.y-DDLS.Geom2D.__circumcenter.y)*(b.pos.y-
DDLS.Geom2D.__circumcenter.y)?!0:!1};DDLS.Geom2D.getCircumcenter=function(a,b,c,d){null==d&&(d=new DDLS.Point);var e=0.5*(a.x+b.x),f=0.5*(a.y+b.y);c=(e*(a.x-c.x)+(f-0.5*(a.y+c.y))*(a.y-c.y)+0.5*(a.x+c.x)*(c.x-a.x))/(a.x*(c.y-b.y)+b.x*(a.y-c.y)+c.x*(b.y-a.y));d.x=e+c*(b.y-a.y);d.y=f-c*(b.x-a.x);return d};
DDLS.Geom2D.intersections2segments=function(a,b,c,d,e,f,g){null==g&&(g=!1);var l=0,k=0,m,h=(a.x-b.x)*(c.y-d.y)+(b.y-a.y)*(c.x-d.x);0==h?m=!1:(m=!0,h=1/h,g&&null==e&&null==f||(l=(a.x*(c.y-d.y)+a.y*(d.x-c.x)+c.x*d.y-c.y*d.x)*h,k=(a.x*(c.y-b.y)+a.y*(b.x-c.x)-b.x*c.y+b.y*c.x)*h,g||0<=l&&1>=l&&0<=k&&1>=k||(m=!1)));m&&(null!=e&&(e.x=a.x+l*(b.x-a.x),e.y=a.y+l*(b.y-a.y)),null!=f&&f.push(l,k));return m};
DDLS.Geom2D.intersections2edges=function(a,b,c,d,e){null==e&&(e=!1);return DDLS.Geom2D.intersections2segments(a.originVertex.pos,a.destinationVertex.pos,b.originVertex.pos,b.destinationVertex.pos,c,d,e)};DDLS.Geom2D.isConvex=function(a){var b=!0,c,d;c=a.nextLeftEdge.oppositeEdge;d=a.nextRightEdge.destinationVertex;-1!=DDLS.Geom2D.getRelativePosition(d.pos,c)?b=!1:(c=a.prevRightEdge,d=a.prevLeftEdge.originVertex,-1!=DDLS.Geom2D.getRelativePosition(d.pos,c)&&(b=!1));return b};
DDLS.Geom2D.projectOrthogonaly=function(a,b){var c=b.originVertex.pos.x,d=b.originVertex.pos.y,e=b.destinationVertex.pos.x,f=b.destinationVertex.pos.y,g=a.x,l=a.y,g=(c*c-c*e-c*g+d*d-d*f-d*l+e*g+f*l)/(c*c-2*c*e+d*d-2*d*f+e*e+f*f);a.x=c+g*(e-c);a.y=d+g*(f-d)};
DDLS.Geom2D.intersections2Circles=function(a,b,c,d,e){var f,g;g=DDLS.Squared(c.x-a.x,c.y-a.y);f=1/(2*g);return(a.x!=c.x||a.y!=c.y)&&g<=(b+d)*(b+d)&&g>=(b-d)*(b-d)?(g=DDLS.sqrt(((b+d)*(b+d)-g)*(g-(d-b)*(d-b))),f=c.clone().sub(a).mul(f),a=a.clone().add(c).mul(0.5),b=f.clone().mul(b*b-d*d),b=a.clone().add(b),null!=e&&e.push(b.x+f.y*g,b.y-f.x*g,b.x-f.y*g,b.y+f.x*g),!0):!1};
DDLS.Geom2D.intersectionsSegmentCircle=function(a,b,c,d,e){var f=a.x*a.x,g=a.y*a.y,l=b.y*b.y-2*b.y*a.y+g+b.x*b.x-2*b.x*a.x+f,k=2*a.y*c.y-2*f+2*b.y*a.y-2*g+2*b.x*a.x-2*b.x*c.x+2*a.x*c.x-2*b.y*c.y;c=k*k-4*l*(g+c.y*c.y+c.x*c.x-2*a.y*c.y-2*a.x*c.x+f-d*d);if(0>c)return!1;if(0==c){c=-k/(2*l);if(0>c||1<c)return!1;null!=e&&e.push(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y),c);return!0}d=DDLS.sqrt(c);c=(-k+d)/(2*l);l=(-k-d)/(2*l);k=!1;0<=c&&1>=c&&(null!=e&&e.push(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y),c),k=!0);0<=l&&1>=l&&(null!=
e&&e.push(a.x+l*(b.x-a.x),a.y+l*(b.y-a.y),l),k=!0);return k};DDLS.Geom2D.tangentsPointToCircle=function(a,b,c,d){var e=a.clone().add(b).mul(0.5);a=0.5*DDLS.sqrt(DDLS.Squared(a.x-b.x,a.y-b.y));return DDLS.Geom2D.intersections2Circles(e,a,b,c,d)};
DDLS.Geom2D.tangentsCrossCircleToCircle=function(a,b,c,d){var e=DDLS.sqrt(DDLS.Squared(b.x-c.x,b.y-c.y)),f=0.25*e,g=c.clone().sub(b).mul(0.25).add(b);if(DDLS.Geom2D.intersections2Circles(b,a,g,f,d)){a=d[0];var f=d[1],g=d[2],l=d[3],k=b.clone().add(c).mul(0.5),m=((a-k.x)*(c.y-b.y)+(f-k.y)*(-c.x+b.x))/(e*e),e=2*(k.x+m*(c.y-b.y))-a;b=2*(k.y-m*(c.x-b.x))-f;d.push(e+g-a,l+b-f,e,b);return!0}return!1};
DDLS.Geom2D.tangentsParalCircleToCircle=function(a,b,c,d){var e=1/DDLS.sqrt(DDLS.Squared(b.x-c.x,b.y-c.y)),f=b.x+a*(c.y-b.y)*e;a=b.y+a*(-c.x+b.x)*e;var e=2*b.x-f,g=2*b.y-a;d.push(f,a,e,g,e+c.x-b.x,g+c.y-b.y,f+c.x-b.x,a+c.y-b.y)};DDLS.Geom2D.distanceSquaredPointToSegment=function(a,b,c){var d=DDLS.Squared(c.x-b.x,c.y-b.y),e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?DDLS.Squared(a.x-b.x,a.y-b.y):1>=e?DDLS.Squared(b.x-a.x,b.y-a.y)-e*e*d:DDLS.Squared(a.x-c.x,a.y-c.y)};
DDLS.Geom2D.distanceSquaredVertexToEdge=function(a,b){return DDLS.Geom2D.distanceSquaredPointToSegment(a.pos,b.originVertex.pos,b.destinationVertex.pos)};DDLS.Geom2D.pathLength=function(a){for(var b=0,c=a[0],d=a[1],e,f,g=2;g<a.length;)e=a[g],f=a[g+1],c=e-c,d=f-d,d=DDLS.sqrt(DDLS.Squared(c,d)),b+=d,c=e,d=f,g+=2;return b};DDLS.Mesh=function(a,b){this.id=DDLS.MeshID;DDLS.MeshID++;this.__objectsUpdateInProgress=!1;this.__centerVertex=null;this.width=a;this.height=b;this.clipping=!0;this._edges=[];this._faces=[];this._objects=[];this._vertices=[];this._constraintShapes=[];this.__edgesToCheck=[];this.AR_edge=this.AR_vertex=null};
DDLS.Mesh.prototype={constructor:DDLS.Mesh,clear:function(a){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=[];0<this._edges.length;)this._edges.pop().dispose();for(this._edges=[];0<this._faces.length;)this._faces.pop().dispose();for(this._faces=[];0<this._constraintShapes.length;)this._constraintShapes.pop().dispose();this._constraintShapes=[];if(!a)for(;0<this._objects.length;)this._objects.pop().dispose();this._objects=[];this.__edgesToCheck=[];this.__centerVertex=
[];this.AR_edge=this.AR_vertex=null},dispose:function(){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=null;0<this._edges.length;)this._edges.pop().dispose();for(this._edges=null;0<this._faces.length;)this._faces.pop().dispose();for(this._faces=null;0<this._constraintShapes.length;)this._constraintShapes.pop().dispose();for(this._constraintShapes=null;0<this._objects.length;)this._objects.pop().dispose();this.AR_edge=this.AR_vertex=this.__centerVertex=this.__edgesToCheck=
this._objects=null},get___constraintShapes:function(){return this._constraintShapes},buildFromRecord:function(a){a=a.split(";");for(var b=0;b<a.length;)this.insertConstraintSegment(parseFloat(a[b]),parseFloat(a[b+1]),parseFloat(a[b+2]),parseFloat(a[b+3])),b+=4},insertObject:function(a){null!=a.constraintShape&&this.deleteObject(a);var b=new DDLS.Shape,c,d=a.coordinates,e=a.matrix;a.updateMatrixFromValues();for(var f,g,l,k=0;k<d.length;)c=d[k],f=d[k+1],g=d[k+2],l=d[k+3],c=this.insertConstraintSegment(e.transformX(c,
f),e.transformY(c,f),e.transformX(g,l),e.transformY(g,l)),null!=c&&(c.fromShape=b,b.segments.push(c)),k+=4;this._constraintShapes.push(b);a.constraintShape=b;this.__objectsUpdateInProgress||this._objects.push(a)},deleteObject:function(a){null!=a.constraintShape&&(this.deleteConstraintShape(a.constraintShape),a.constraintShape=null,this.__objectsUpdateInProgress||(a=this._objects.indexOf(a),this._objects.splice(a,1)))},updateObjects:function(){this.__objectsUpdateInProgress=!0;for(var a=this._objects.length,
b;a--;)b=this._objects[a],b.hasChanged&&(this.deleteObject(b),this.insertObject(b),b.hasChanged=!1);this.__objectsUpdateInProgress=!1},insertConstraintShape:function(a){for(var b=new DDLS.Shape,c=null,d=0;d<a.length;)c=this.insertConstraintSegment(a[d],a[d+1],a[d+2],a[d+3]),null!=c&&(c.fromShape=b,b.segments.push(c)),d+=4;this._constraintShapes.push(b);return b},deleteConstraintShape:function(a){for(var b=0,c=a.segments.length;b<c;){var d=b++;this.deleteConstraintSegment(a.segments[d])}this._constraintShapes.splice(this._constraintShapes.indexOf(a),
1);a.dispose()},insertConstraintSegment:function(a,b,c,d){var e=a,f=b,g=c,l=d;if(a>this.width&&c>this.width||0>a&&0>c||b>this.height&&d>this.height||0>b&&0>d)return null;c-=a;d-=b;var k=DDLS.NEGATIVE_INFINITY,m=DDLS.POSITIVE_INFINITY;if(0!=c)var h=(0-a)/c,n=(this.width-a)/c,k=DDLS.max(k,DDLS.min(h,n)),m=DDLS.min(m,DDLS.max(h,n));0!=d&&(h=(0-b)/d,n=(this.height-b)/d,k=DDLS.max(k,DDLS.min(h,n)),m=DDLS.min(m,DDLS.max(h,n)));if(m>=k)1>m&&(g=c*m+a,l=d*m+b),0<k&&(e=c*k+a,f=d*k+b);else return null;a=this.insertVertex(e,
f);if(null==a)return null;g=this.insertVertex(g,l);if(null==g||a===g)return null;l=new DDLS.FromVertexToOutgoingEdges;b=new DDLS.Segment;e=new DDLS.Edge;f=new DDLS.Edge;e.setDatas(a,f,null,null,!0,!0);f.setDatas(g,e,null,null,!0,!0);f=[];c=[];d=[];for(var n={type:3},k=new DDLS.Point,p=!1,n=a;;)switch(p=!1,n.type){case 0:m=n;for(l.fromVertex=m;null!=(h=l.next());){if(h.destinationVertex==g)return h.isConstrained||(h.isConstrained=!0,h.oppositeEdge.isConstrained=!0),h.addFromConstraintSegment(b),h.oppositeEdge.fromConstraintSegments=
h.fromConstraintSegments,a.addFromConstraintSegment(b),g.addFromConstraintSegment(b),b.addEdge(h),b;if(DDLS.Geom2D.distanceSquaredVertexToEdge(h.destinationVertex,e)<=DDLS.EPSILON_SQUARED){h.isConstrained||(h.isConstrained=!0,h.oppositeEdge.isConstrained=!0);h.addFromConstraintSegment(b);h.oppositeEdge.fromConstraintSegments=h.fromConstraintSegments;a.addFromConstraintSegment(b);b.addEdge(h);a=h.destinationVertex;n=e.originVertex=a;p=!0;break}}if(p)continue;for(l.fromVertex=m;null!=(h=l.next());)if(h=
h.nextLeftEdge,DDLS.Geom2D.intersections2edges(h,e,k)){if(h.isConstrained){a=this.splitEdge(h,k.x,k.y);for(l.fromVertex=m;null!=(h=l.next());)if(h.destinationVertex==a){h.isConstrained=!0;h.oppositeEdge.isConstrained=!0;h.addFromConstraintSegment(b);h.oppositeEdge.fromConstraintSegments=h.fromConstraintSegments;b.addEdge(h);break}m.addFromConstraintSegment(b);n=e.originVertex=a}else f.push(h),c.unshift(h.nextLeftEdge),d.push(h.prevLeftEdge),n=h=h.oppositeEdge;break}break;case 1:h=n;m=h.nextLeftEdge;
if(m.destinationVertex==g)return c.unshift(m.nextLeftEdge),d.push(m),h=new DDLS.Edge,n=new DDLS.Edge,h.setDatas(a,n,null,null,!0,!0),n.setDatas(g,h,null,null,!0,!0),c.push(h),d.push(n),this.insertNewConstrainedEdge(b,h,f,c,d),b;if(DDLS.Geom2D.distanceSquaredVertexToEdge(m.destinationVertex,e)<=DDLS.EPSILON_SQUARED)c.unshift(m.nextLeftEdge),d.push(m),h=new DDLS.Edge,n=new DDLS.Edge,h.setDatas(a,n,null,null,!0,!0),n.setDatas(m.destinationVertex,h,null,null,!0,!0),c.push(h),d.push(n),this.insertNewConstrainedEdge(b,
h,f,c,d),f=[],c=[],d=[],a=m.destinationVertex,n=e.originVertex=a;else if(DDLS.Geom2D.intersections2edges(m,e,k))if(m.isConstrained){m=this.splitEdge(m,k.x,k.y);for(l.fromVertex=m;null!=(h=l.next());)h.destinationVertex===c[0].originVertex&&c.unshift(h),h.destinationVertex===d[d.length-1].destinationVertex&&d.push(h.oppositeEdge);h=new DDLS.Edge;n=new DDLS.Edge;h.setDatas(a,n,null,null,!0,!0);n.setDatas(m,h,null,null,!0,!0);c.push(h);d.push(n);this.insertNewConstrainedEdge(b,h,f,c,d);f=[];c=[];d=[];
a=m;n=e.originVertex=a}else f.push(m),c.unshift(m.nextLeftEdge),n=h=m.oppositeEdge;else if(m=m.nextLeftEdge,DDLS.Geom2D.intersections2edges(m,e,k),m.isConstrained){m=this.splitEdge(m,k.x,k.y);for(l.fromVertex=m;null!=(h=l.next());)h.destinationVertex==c[0].originVertex&&c.unshift(h),h.destinationVertex==d[d.length-1].destinationVertex&&d.push(h.oppositeEdge);h=new DDLS.Edge;n=new DDLS.Edge;h.setDatas(a,n,null,null,!0,!0);n.setDatas(m,h,null,null,!0,!0);c.push(h);d.push(n);this.insertNewConstrainedEdge(b,
h,f,c,d);f=[];c=[];d=[];a=m;n=e.originVertex=a}else f.push(m),d.push(m.prevLeftEdge),n=h=m.oppositeEdge}},insertNewConstrainedEdge:function(a,b,c,d,e){this._edges.push(b);this._edges.push(b.oppositeEdge);b.addFromConstraintSegment(a);b.oppositeEdge.fromConstraintSegments=b.fromConstraintSegments;a.addEdge(b);b.originVertex.addFromConstraintSegment(a);b.destinationVertex.addFromConstraintSegment(a);this.untriangulate(c);this.triangulate(d,!0);this.triangulate(e,!0)},deleteConstraintSegment:function(a){for(var b=
[],c=null,d,e=0,f=a.edges.length;e<f;)c=e++,c=a.edges[c],c.removeFromConstraintSegment(a),0==c.fromConstraintSegments.length&&(c.isConstrained=!1,c.oppositeEdge.isConstrained=!1),d=c.originVertex,d.removeFromConstraintSegment(a),b.push(d);d=c.destinationVertex;d.removeFromConstraintSegment(a);b.push(d);e=0;for(f=b.length;e<f;)c=e++,this.deleteVertex(b[c]);a.dispose()},check:function(){for(var a=0,b=this._edges.length;a<b;){var c=a++;if(null==this._edges[c].nextLeftEdge){DDLS.Log("!!! missing nextLeftEdge");
return}}DDLS.Log("check OK")},insertVertex:function(a,b){if(0>a||0>b||a>this.width||b>this.height)return null;this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var c=DDLS.Geom2D.locatePosition(new DDLS.Point(a,b),this),d=null;switch(c.type){case 0:d=c;break;case 1:d=this.splitEdge(c,a,b);break;case 2:d=this.splitFace(c,a,b)}this.restoreAsDelaunay();return d},flipEdge:function(a){var b=a.oppositeEdge,c=new DDLS.Edge,d=new DDLS.Edge,e=a.nextLeftEdge,f=e.nextLeftEdge,g=b.nextLeftEdge,l=g.nextLeftEdge,
k=a.originVertex,m=b.originVertex,h=f.originVertex,n=l.originVertex,p=a.leftFace,r=b.leftFace,q=new DDLS.Face,s=new DDLS.Face;this._edges.push(c);this._edges.push(d);this._faces.push(s);this._faces.push(q);c.setDatas(h,d,l,s,a.isReal,a.isConstrained);d.setDatas(n,c,f,q,a.isReal,a.isConstrained);s.setDatas(c);q.setDatas(d);m.edge===b&&m.setDatas(e);k.edge===a&&k.setDatas(g);e.nextLeftEdge=c;e.leftFace=s;f.nextLeftEdge=g;f.leftFace=q;g.nextLeftEdge=d;g.leftFace=q;l.nextLeftEdge=e;l.leftFace=s;this._edges.splice(this._edges.indexOf(a),
1);this._edges.splice(this._edges.indexOf(b),1);a.dispose();b.dispose();this._faces.splice(this._faces.indexOf(p),1);this._faces.splice(this._faces.indexOf(r),1);p.dispose();r.dispose();return d},splitEdge:function(a,b,c){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var d=a.oppositeEdge,e=a.nextLeftEdge,f=e.nextLeftEdge,g=d.nextLeftEdge,l=g.nextLeftEdge,k=f.originVertex,m=a.originVertex,h=l.originVertex,n=d.originVertex,p=a.leftFace,r=d.leftFace;if((m.pos.x-b)*(m.pos.x-b)+(m.pos.y-c)*
(m.pos.y-c)<=DDLS.EPSILON_SQUARED)return m;if((n.pos.x-b)*(n.pos.x-b)+(n.pos.y-c)*(n.pos.y-c)<=DDLS.EPSILON_SQUARED)return n;var q=new DDLS.Vertex,s=new DDLS.Edge,t=new DDLS.Edge,v=new DDLS.Edge,u=new DDLS.Edge,w=new DDLS.Edge,x=new DDLS.Edge,z=new DDLS.Edge,y=new DDLS.Edge,A=new DDLS.Face,B=new DDLS.Face,C=new DDLS.Face,D=new DDLS.Face;this._vertices.push(q);this._edges.push(t);this._edges.push(s);this._edges.push(x);this._edges.push(w);this._edges.push(u);this._edges.push(v);this._edges.push(y);
this._edges.push(z);this._faces.push(D);this._faces.push(C);this._faces.push(B);this._faces.push(A);q.setDatas(p.isReal?t:u);q.pos.x=b;q.pos.y=c;DDLS.Geom2D.projectOrthogonaly(q.pos,a);t.setDatas(q,s,f,A,p.isReal);s.setDatas(k,t,y,D,p.isReal);x.setDatas(q,w,g,B,a.isReal,a.isConstrained);w.setDatas(m,x,t,A,a.isReal,a.isConstrained);u.setDatas(q,v,l,C,r.isReal);v.setDatas(h,u,x,B,r.isReal);y.setDatas(q,z,e,D,a.isReal,a.isConstrained);z.setDatas(n,y,u,C,a.isReal,a.isConstrained);A.setDatas(t,p.isReal);
B.setDatas(x,r.isReal);C.setDatas(u,r.isReal);D.setDatas(y,p.isReal);m.edge===a&&m.setDatas(w);n.edge===d&&n.setDatas(z);f.nextLeftEdge=w;f.leftFace=A;g.nextLeftEdge=v;g.leftFace=B;l.nextLeftEdge=z;l.leftFace=C;e.nextLeftEdge=s;e.leftFace=D;if(a.isConstrained){b=a.fromConstraintSegments;w.fromConstraintSegments=b.slice(0);x.fromConstraintSegments=w.fromConstraintSegments;y.fromConstraintSegments=b.slice(0);z.fromConstraintSegments=y.fromConstraintSegments;c=0;for(k=a.fromConstraintSegments.length;c<
k;)m=c++,m=a.fromConstraintSegments[m].edges,h=m.indexOf(a),-1!=h?m.splice(h,1,w,y):m.splice(m.indexOf(d),1,z,x);q.fromConstraintSegments=b.slice(0)}this._edges.splice(this._edges.indexOf(a),1);this._edges.splice(this._edges.indexOf(d),1);a.dispose();d.dispose();this._faces.splice(this._faces.indexOf(p),1);this._faces.splice(this._faces.indexOf(r),1);p.dispose();r.dispose();this.__centerVertex=q;this.__edgesToCheck.push(f);this.__edgesToCheck.push(g);this.__edgesToCheck.push(l);this.__edgesToCheck.push(e);
return q},splitFace:function(a,b,c){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var d=a.edge,e=d.nextLeftEdge,f=e.nextLeftEdge,g=d.originVertex,l=e.originVertex,k=f.originVertex,m=new DDLS.Vertex,h=new DDLS.Edge,n=new DDLS.Edge,p=new DDLS.Edge,r=new DDLS.Edge,q=new DDLS.Edge,s=new DDLS.Edge,t=new DDLS.Face,v=new DDLS.Face,u=new DDLS.Face;this._vertices.push(m);this._edges.push(h);this._edges.push(n);this._edges.push(p);this._edges.push(r);this._edges.push(q);this._edges.push(s);this._faces.push(t);
this._faces.push(v);this._faces.push(u);m.setDatas(n);m.pos.x=b;m.pos.y=c;h.setDatas(g,n,s,u);n.setDatas(m,h,d,t);p.setDatas(l,r,n,t);r.setDatas(m,p,e,v);q.setDatas(k,s,r,v);s.setDatas(m,q,f,u);t.setDatas(n);v.setDatas(r);u.setDatas(s);d.nextLeftEdge=p;d.leftFace=t;e.nextLeftEdge=q;e.leftFace=v;f.nextLeftEdge=h;f.leftFace=u;this._faces.splice(this._faces.indexOf(a),1);a.dispose();this.__centerVertex=m;this.__edgesToCheck.push(d);this.__edgesToCheck.push(e);this.__edgesToCheck.push(f);return m},restoreAsDelaunay:function(){for(var a;0<
this.__edgesToCheck.length;)a=this.__edgesToCheck.shift(),!a.isReal||a.isConstrained||DDLS.Geom2D.isDelaunay(a)||(a.nextLeftEdge.destinationVertex==this.__centerVertex?(this.__edgesToCheck.push(a.nextRightEdge),this.__edgesToCheck.push(a.prevRightEdge)):(this.__edgesToCheck.push(a.nextLeftEdge),this.__edgesToCheck.push(a.prevLeftEdge)),this.flipEdge(a))},deleteVertex:function(a){var b,c=new DDLS.FromVertexToOutgoingEdges;c.fromVertex=a;c.realEdgesOnly=!1;var d,e=[];b=0==a.fromConstraintSegments.length;
var f=[],g=!1,l=!1,k=[],m=[];if(b)for(;null!=(d=c.next());)e.push(d),f.push(d.nextLeftEdge);else{k=0;for(m=a.fromConstraintSegments.length;k<m;)if(g=k++,d=a.fromConstraintSegments[g].edges,d[0].originVertex==a||d[d.length-1].destinationVertex==a)return!1;for(k=0;null!=(d=c.next());)if(e.push(d),d.isConstrained&&(k++,2<k))return!1;var k=[],m=[],h=c=null,n=new DDLS.Edge,p=new DDLS.Edge;this._edges.push(n);this._edges.push(p);g=0;for(l=e.length;g<l;)d=g++,d=e[d],d.isConstrained?null==c?(p.setDatas(d.destinationVertex,
n,null,null,!0,!0),k.push(n),k.push(d.nextLeftEdge),m.push(p),c=d):null==h&&(n.setDatas(d.destinationVertex,p,null,null,!0,!0),m.push(d.nextLeftEdge),h=d):null==c?m.push(d.nextLeftEdge):null==h?k.push(d.nextLeftEdge):m.push(d.nextLeftEdge);g=c.leftFace.isReal;l=h.leftFace.isReal;n.fromConstraintSegments=c.fromConstraintSegments.slice(0);p.fromConstraintSegments=n.fromConstraintSegments;for(var r,q=0,s=a.fromConstraintSegments.length;q<s;)d=q++,d=a.fromConstraintSegments[d].edges,r=d.indexOf(c),-1!=
r?d.splice(r-1,2,n):d.splice(d.indexOf(h)-1,2,p)}c=0;for(h=e.length;c<h;)n=c++,d=e[n],n=d.leftFace,this._faces.splice(this._faces.indexOf(n),1),n.dispose(),d.destinationVertex.edge=d.nextLeftEdge,this._edges.splice(this._edges.indexOf(d.oppositeEdge),1),d.oppositeEdge.dispose(),this._edges.splice(this._edges.indexOf(d),1),d.dispose();this._vertices.splice(this._vertices.indexOf(a),1);a.dispose();b?this.triangulate(f,!0):(this.triangulate(k,g),this.triangulate(m,l));return!0},untriangulate:function(a){for(var b=
new DDLS.Dictionary(1),c,d=0,e=a.length;d<e;){var f=d++;c=a[f];null==b.get(c.originVertex)&&(c.originVertex.edge=c.prevLeftEdge.oppositeEdge,b.set(c.originVertex,!0));null==b.get(c.destinationVertex)&&(c.destinationVertex.edge=c.nextLeftEdge,b.set(c.destinationVertex,!0));this._faces.splice(this._faces.indexOf(c.leftFace),1);c.leftFace.dispose();f==a.length-1&&(this._faces.splice(this._faces.indexOf(c.rightFace),1),c.rightFace.dispose())}b.dispose();b=0;for(d=a.length;b<d;)c=b++,c=a[c],this._edges.splice(this._edges.indexOf(c.oppositeEdge),
1),this._edges.splice(this._edges.indexOf(c),1),c.oppositeEdge.dispose(),c.dispose()},triangulate:function(a,b){if(2>a.length)DDLS.Log("BREAK ! the hole has less than 2 edges");else if(2==a.length)DDLS.Log("BREAK ! the hole has only 2 edges");else if(3==a.length){var c=new DDLS.Face;c.setDatas(a[0],b);this._faces.push(c);a[0].leftFace=c;a[1].leftFace=c;a[2].leftFace=c;a[0].nextLeftEdge=a[1];a[1].nextLeftEdge=a[2];a[2].nextLeftEdge=a[0]}else{for(var c=a[0],d=c.originVertex,e=c.destinationVertex,f,
g,l=new DDLS.Point,k=!1,m=0,h=2,n=a.length;h<n;){var p=h++;f=a[p].originVertex;if(1===DDLS.Geom2D.getRelativePosition2(f.pos,c)){m=p;k=!0;DDLS.Geom2D.getCircumcenter(d.pos,e.pos,f.pos,l);f=DDLS.Squared(d.pos.x-l.x,d.pos.y-l.y);f-=DDLS.EPSILON_SQUARED;for(var r=2,q=a.length;r<q;)if(g=r++,g!=p&&(g=a[g].originVertex,g=DDLS.Squared(g.pos.x-l.x,g.pos.y-l.y),g<f)){k=!1;break}if(k)break}}k||(DDLS.Log("NO DELAUNAY FOUND"),m=2);l=e=k=null;m<a.length-1&&(k=new DDLS.Edge,e=new DDLS.Edge,this._edges.push(k,e),
k.setDatas(d,e,null,null,b,!1),e.setDatas(a[m].originVertex,k,null,null,b,!1),d=a.slice(m),d.push(k),this.triangulate(d,b));2<m&&(l=new DDLS.Edge,d=new DDLS.Edge,this._edges.push(l,d),l.setDatas(a[1].originVertex,d,null,null,b,!1),d.setDatas(a[m].originVertex,l,null,null,b,!1),k=a.slice(1,m),k.push(d),this.triangulate(k,b));this.triangulate(2==m?[c,a[1],e]:m==a.length-1?[c,l,a[m]]:[c,l,e],b)}},findPositionFromBounds:function(a,b){return 0>=a?0>=b?1:b>=this.height?7:8:a>=this.width?0>=b?3:b>=this.height?
5:4:0>=b?2:b>=this.height?6:0},compute_Data:function(){var a=[],b=[],c,d;d=new DDLS.FromMeshToVertices;d.fromMesh=this;var e;e=new DDLS.FromVertexToIncomingEdges;for(var f=new DDLS.Dictionary(1);null!=(c=d.next());)if(f.set(c,!0),this.vertexIsInsideAABB(c,this))for(a.push(c.pos.x,c.pos.y),e.fromVertex=c;null!=(c=e.next());)f.get(c.originVertex)||(b=b.concat(c.getDatas()));f.dispose();this.AR_vertex=new DDLS_ARRAY_TYPE(a);this.AR_edge=new DDLS_ARRAY_TYPE(b);this.data_edges=this.data_vertex=null},vertexIsInsideAABB:function(a,
b){return 0>a.pos.x||a.pos.x>b.width||0>a.pos.y||a.pos.y>b.height?!1:!0}};DDLS.Graph=function(){this.id=DDLS.GraphID;DDLS.GraphID++;this.node=this.edge=null};
DDLS.Graph.prototype={dispose:function(){for(;null!=this.node;)this.deleteNode(this.node)},insertNode:function(){var a=new DDLS.GraphNode;null!=this.node&&(a.next=this.node,this.node.prev=a);return this.node=a},deleteNode:function(a){for(;null!=a.outgoingEdge;)null!=a.outgoingEdge.oppositeEdge&&this.deleteEdge(a.outgoingEdge.oppositeEdge),this.deleteEdge(a.outgoingEdge);for(var b=this.node,c;null!=b;)c=b.successorNodes.get(a),null!=c&&this.deleteEdge(c),b=b.next;this.node==a?null!=a.next?(a.next.prev=
null,this.node=a.next):this.node=null:null!=a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null;a.dispose()},insertEdge:function(a,b){if(null!=a.successorNodes.get(b))return null;var c=new DDLS.GraphEdge;null!=this.edge&&(this.edge.prev=c,c.next=this.edge);this.edge=c;c.sourceNode=a;c.destinationNode=b;a.successorNodes.set(b,c);null!=a.outgoingEdge&&(a.outgoingEdge.rotPrevEdge=c,c.rotNextEdge=a.outgoingEdge);a.outgoingEdge=c;var d=b.successorNodes.get(a);null!=d&&(c.oppositeEdge=d,d.oppositeEdge=
c);return c},deleteEdge:function(a){this.edge==a?null!=a.next?(a.next.prev=null,this.edge=a.next):this.edge=null:null!=a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null;a.sourceNode.outgoingEdge==a?null!=a.rotNextEdge?(a.rotNextEdge.rotPrevEdge=null,a.sourceNode.outgoingEdge=a.rotNextEdge):a.sourceNode.outgoingEdge=null:null!=a.rotNextEdge?(a.rotPrevEdge.rotNextEdge=a.rotNextEdge,a.rotNextEdge.rotPrevEdge=a.rotPrevEdge):a.rotPrevEdge.rotNextEdge=null;a.dispose()}};
DDLS.GraphEdge=function(){this.id=DDLS.GraphEdgeID;DDLS.GraphEdgeID++;this.data=this.destinationNode=this.sourceNode=this.oppositeEdge=this.rotNextEdge=this.rotPrevEdge=this.prev=this.next=null};DDLS.GraphEdge.prototype={dispose:function(){}};DDLS.GraphNode=function(){this.id=DDLS.GraphNodeID;DDLS.GraphNodeID++;this.successorNodes=new DDLS.Dictionary(1);this.data=this.outgoingEdge=this.next=this.prev=null};
DDLS.GraphNode.prototype={dispose:function(){this.successorNodes.dispose();this.data=this.successorNodes=this.outgoingEdge=this.next=this.prev=null}};DDLS.EdgeData=function(){};DDLS.NodeData=function(){};DDLS.Potrace={};DDLS.Potrace.MAX_INT=2147483647;DDLS.Potrace.maxDistance=1;
DDLS.Potrace.buildShapes=function(a,b,c){for(var d=[],e=new DDLS.Dictionary(2),f=1,g=a.height-1;f<g;)for(var l=f++,k=0,m=a.width-1;k<m;){var h=k++;16777215==function(b){b=l*a.width+h<<2;return a.bytes[b+1]<<16|a.bytes[b+2]<<8|a.bytes[b+3]}(this)&&16777215>function(b){b=l*a.width+(h+1)<<2;return a.bytes[b+1]<<16|a.bytes[b+2]<<8|a.bytes[b+3]}(this)&&(e.get(h+1+"_"+l)||d.push(DDLS.Potrace.buildShape(a,l,h+1,e,b,c)))}e.dispose();return d};
DDLS.Potrace.buildShape=function(a,b,c,d,e,f){var g=c,l=b,k=[g,l];d.set(g+"_"+l,!0);for(var m=new DDLS.Point(0,1),h=new DDLS.Point,n,p,r=-1;;){if(null!=e){var q=b*e.width+c<<2;e.bytes[q]=255;e.bytes[q+1]=255;e.bytes[q+2]=0;e.bytes[q+3]=0}n=b+m.x+m.y|0;p=c+m.x-m.y|0;16777215>function(b){b=n*a.width+p<<2;return a.bytes[b+1]<<16|a.bytes[b+2]<<8|a.bytes[b+3]}(this)?(h.x=-m.y,h.y=m.x):(n=b+m.y|0,p=c+m.x|0,16777215>function(b){b=n*a.width+p<<2;return a.bytes[b+1]<<16|a.bytes[b+2]<<8|a.bytes[b+3]}(this)?
(h.x=m.x,h.y=m.y):(n=b,p=c,h.x=m.y,h.y=-m.x));g+=m.x;l+=m.y;if(g==k[0]&&l==k[1])break;else k.push(g),k.push(l),d.set(g+"_"+l,!0),b=n,c=p,m.x=h.x,m.y=h.y;r--;if(0==r)break}if(null!=f){f.graphics.lineStyle(0.5,65280,1);f.graphics.moveTo(k[0],k[1]);for(b=2;b<k.length;)f.graphics.lineTo(k[b],k[b+1]),b+=2;f.graphics.lineTo(k[0],k[1])}return k};
DDLS.Potrace.buildGraph=function(a){var b,c=new DDLS.Graph,d;for(b=0;b<a.length;)d=c.insertNode(),d.data=new DDLS.NodeData,d.data.index=b,d.data.point=new DDLS.Point(a[b],a[b+1]),b+=2;var e,f,g,l;for(a=c.node;null!=a;){for(b=null!=a.next?a.next:c.node;b!=a;){l=!0;e=null!=a.next?a.next:c.node;g=2;for(d=0;e!=b;){f=DDLS.Geom2D.distanceSquaredPointToSegment(e.data.point,a.data.point,b.data.point);0>f&&(f=0);if(f>=DDLS.Potrace.maxDistance){l=!1;break}g++;d+=f;e=null!=e.next?e.next:c.node}if(!l)break;e=
c.insertEdge(a,b);f=new DDLS.EdgeData;f.sumDistancesSquared=d;f.length=a.data.point.distanceTo(b.data.point);f.nodesCount=g;e.data=f;b=null!=b.next?b.next:c.node}a=a.next}return c};
DDLS.Potrace.buildPolygon=function(a,b){var c=[],d,e=2147483647,f,g,l=null;for(d=a.node;d.data.index<e;){e=d.data.index;c.push(d.data.point.x);c.push(d.data.point.y);g=0;for(d=d.outgoingEdge;null!=d;)f=d.data.nodesCount-d.data.length*DDLS.sqrt(d.data.sumDistancesSquared/d.data.nodesCount),f>g&&(g=f,l=d),d=d.rotNextEdge;d=l.destinationNode}0==DDLS.Geom2D.getDirection(new DDLS.Point(c[c.length-2],c[c.length-1]),new DDLS.Point(c[0],c[1]),new DDLS.Point(c[2],c[3]))&&(c.shift(),c.shift());if(null!=b){b.graphics.lineStyle(0.5,
255);b.graphics.moveTo(c[0],c[1]);for(e=2;e<c.length;)b.graphics.lineTo(c[e],c[e+1]),e+=2;b.graphics.lineTo(c[0],c[1])}return c};DDLS.ShapeSimplifier=function(a,b){null==b&&(b=1);var c=a.length;if(4>=c)return[].concat(a);for(var d=a[0],e=a[1],f=a[c-2],g=a[c-1],l=-1,k=0,m=1,c=c>>1;m<c;){var h=m++,n=DDLS.Geom2D.distanceSquaredPointToSegment(new DDLS.Point(a[h<<1],a[(h<<1)+1]),new DDLS.Point(d,e),new DDLS.Point(f,g));n>k&&(k=n,l=h)}return k>b*b?(d=a.slice(0,(l<<1)+2),l=a.slice(l<<1),d=DDLS.ShapeSimplifier(d,b),l=DDLS.ShapeSimplifier(l,b),d.slice(0,d.length-2).concat(l)):[d,e,f,g]};DDLS.AStar=function(){this.iterEdge=new DDLS.FromFaceToInnerEdges;this.mesh=null;this.diameterSquared=this.diameter=this.radiusSquared=this._radius=0;Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.radiusSquared=this._radius*this._radius;this.diameter=2*this._radius;this.diameterSquared=this.diameter*this.diameter}})};
DDLS.AStar.prototype={dispose:function(){this.mesh=null;this.closedFaces.dispose();this.openedFaces.dispose();this.entryEdges.dispose();this.predecessor.dispose();this.entryX.dispose();this.entryY.dispose();this.scoreF.dispose();this.scoreG.dispose();this.scoreH.dispose();this.predecessor=this.scoreH=this.scoreG=this.scoreF=this.entryY=this.entryX=this.entryEdges=this.openedFaces=this.closedFaces=this.sortedOpenedFaces=null},findPath:function(a,b,c,d,e,f){this.sortedOpenedFaces=[];this.closedFaces=
new DDLS.Dictionary(1);this.openedFaces=new DDLS.Dictionary(1);this.entryEdges=new DDLS.Dictionary(1);this.predecessor=new DDLS.Dictionary(1);this.entryX=new DDLS.Dictionary(1);this.entryY=new DDLS.Dictionary(1);this.scoreF=new DDLS.Dictionary(1);this.scoreG=new DDLS.Dictionary(1);this.scoreH=new DDLS.Dictionary(1);var g;g=DDLS.Geom2D.locatePosition(new DDLS.Point(a,b),this.mesh);if(0!=g.type){if(1==g.type){if(g.isConstrained)return;this.fromFace=g.leftFace}else this.fromFace=g;g=DDLS.Geom2D.locatePosition(new DDLS.Point(c,
d),this.mesh);this.toFace=0==g.type?g.edge.leftFace:1==g.type?g.leftFace:g;this.sortedOpenedFaces.push(this.fromFace);this.entryEdges.set(this.fromFace,null);this.entryX.set(this.fromFace,a);this.entryY.set(this.fromFace,b);this.scoreG.set(this.fromFace,0);a=DDLS.sqrt(DDLS.Squared(c-a,d-b));this.scoreH.set(this.fromFace,a);this.scoreF.set(this.fromFace,a);for(var l,k,m=new DDLS.Point,h=new DDLS.Point,n=new DDLS.Point,p=!1;;){if(0==this.sortedOpenedFaces.length){DDLS.Log("AStar no path found");this.curFace=
null;break}this.curFace=this.sortedOpenedFaces.pop();if(this.curFace==this.toFace)break;for(this.iterEdge.fromFace=this.curFace;null!=(a=this.iterEdge.next());)a.isConstrained||(b=a.rightFace,this.closedFaces.get(b)||this.curFace!=this.fromFace&&0<this._radius&&!this.isWalkableByRadius(this.entryEdges.get(this.curFace),this.curFace,a)||(m.x=this.entryX.get(this.curFace),m.y=this.entryY.get(this.curFace),h.x=m.x,h.y=m.y,h.x=0.5*(a.originVertex.pos.x+a.destinationVertex.pos.x),h.y=0.5*(a.originVertex.pos.y+
a.destinationVertex.pos.y),n.x=h.x-c,n.y=h.y-d,k=n.get_length(),n.x=m.x-h.x,n.y=m.y-h.y,l=this.scoreG.get(this.curFace)+n.get_length(),g=k+l,p=!1,null!=this.openedFaces.get(b)&&this.openedFaces.get(b)?this.scoreF.get(b)>g&&(p=!0):(this.sortedOpenedFaces.push(b),this.openedFaces.set(b,!0),p=!0),p&&(this.entryEdges.set(b,a),this.entryX.set(b,h.x),this.entryY.set(b,h.y),this.scoreF.set(b,g),this.scoreG.set(b,l),this.scoreH.set(b,k),this.predecessor.set(b,this.curFace))));this.openedFaces.set(this.curFace,
!1);this.closedFaces.set(this.curFace,!0);this.sortedOpenedFaces.sort(DDLS.Bind(this,this.sortingFaces))}if(null!=this.curFace)for(e.push(this.curFace);this.curFace!=this.fromFace;)f.unshift(this.entryEdges.get(this.curFace)),this.curFace=this.predecessor.get(this.curFace),e.unshift(this.curFace)}},sortingFaces:function(a,b){return this.scoreF.get(a)==this.scoreF.get(b)?0:this.scoreF.get(a)<this.scoreF.get(b)?1:-1},isWalkableByRadius:function(a,b,c){var d=null,e=null,f=null;a.originVertex==c.originVertex?
(d=a.destinationVertex,e=c.destinationVertex,f=a.originVertex):a.destinationVertex==c.destinationVertex?(d=a.originVertex,e=c.originVertex,f=a.destinationVertex):a.originVertex==c.destinationVertex?(d=a.destinationVertex,e=c.originVertex,f=a.originVertex):a.destinationVertex==c.originVertex&&(d=a.originVertex,e=c.destinationVertex,f=a.destinationVertex);var g;g=(f.pos.x-d.pos.x)*(e.pos.x-d.pos.x)+(f.pos.y-d.pos.y)*(e.pos.y-d.pos.y);if(0>=g)return f=DDLS.Squared(f.pos.x-d.pos.x,f.pos.y-d.pos.y),f>=
this.diameterSquared?!0:!1;g=(f.pos.x-e.pos.x)*(d.pos.x-e.pos.x)+(f.pos.y-e.pos.y)*(d.pos.y-e.pos.y);if(0>=g)return f=DDLS.Squared(f.pos.x-e.pos.x,f.pos.y-e.pos.y),f>=this.diameterSquared?!0:!1;c=b.edge!=a&&b.edge.oppositeEdge!=a&&b.edge!=c&&b.edge.oppositeEdge!=c?b.edge:b.edge.nextLeftEdge!=a&&b.edge.nextLeftEdge.oppositeEdge!=a&&b.edge.nextLeftEdge!=c&&b.edge.nextLeftEdge.oppositeEdge!=c?b.edge.nextLeftEdge:b.edge.prevLeftEdge;if(c.isConstrained)return b=new DDLS.Point(f.pos.x,f.pos.y),DDLS.Geom2D.projectOrthogonaly(b,
c),f=DDLS.Squared(b.x-f.pos.x,b.y-f.pos.y),f>=this.diameterSquared?!0:!1;d=DDLS.Squared(f.pos.x-d.pos.x,f.pos.y-d.pos.y);e=DDLS.Squared(f.pos.x-e.pos.x,f.pos.y-e.pos.y);if(d<this.diameterSquared||e<this.diameterSquared)return!1;e=[];d=[];a=new DDLS.Dictionary(1);d.push(c);c.leftFace==b?(e.push(c.rightFace),a.set(c.rightFace,!0)):(e.push(c.leftFace),a.set(c.leftFace,!0));for(var l;0<e.length;){b=e.shift();c=d.shift();b.edge==c||b.edge==c.oppositeEdge?(c=b.edge.nextLeftEdge,l=b.edge.nextLeftEdge.nextLeftEdge):
b.edge.nextLeftEdge==c||b.edge.nextLeftEdge==c.oppositeEdge?(c=b.edge,l=b.edge.nextLeftEdge.nextLeftEdge):(c=b.edge,l=b.edge.nextLeftEdge);g=c.leftFace==b?c.rightFace:c.leftFace;b=l.leftFace==b?l.rightFace:l.leftFace;if(!a.get(g)&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,c)<this.diameterSquared){if(c.isConstrained)return!1;e.push(g);d.push(c);a.set(g,!0)}if(!a.get(b)&&DDLS.Geom2D.distanceSquaredVertexToEdge(f,l)<this.diameterSquared){if(l.isConstrained)return!1;e.push(b);d.push(l);a.set(b,!0)}}a.dispose();
return!0}};DDLS.EntityAI=function(){this._radius=10;this.radiusSquared=100;this.x=this.y=0;this.dirNormX=1;this.dirNormY=0;this.angleFOV=60;this._radiusSquaredFOV=this._radiusFOV=0;Object.defineProperty(this,"radiusFOV",{get:function(){return this._radiusFOV},set:function(a){this._radiusFOV=a;this._radiusSquaredFOV=this._radiusFOV*this._radiusFOV}});Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=a;this.radiusSquared=this._radius*this._radius}});Object.defineProperty(this,
"approximateObject",{get:function(){this._approximateObject.matrix.identity().translate(this.x,this.y);return this._approximateObject}})};
DDLS.EntityAI.prototype={buildApproximation:function(){this._approximateObject=new DDLS.Object;this._approximateObject.matrix.translate(this.x,this.y);var a=[];this._approximateObject.coordinates=a;if(0!=this._radius)for(var b=DDLS.EntityAI.NUM_SEGMENTS,c=1/b,d=0;d<b;){var e=d++;a.push(this._radius*DDLS.cos(DDLS.TwoPI*e*c));a.push(this._radius*DDLS.sin(DDLS.TwoPI*e*c));a.push(this._radius*DDLS.cos(DDLS.TwoPI*(e+1)*c));a.push(this._radius*DDLS.sin(DDLS.TwoPI*(e+1)*c))}},get_approximateObject:function(){this._approximateObject.matrix.identity().translate(this.x,
this.y);return this._approximateObject}};DDLS.EntityAI.NUM_SEGMENTS=6;DDLS.Funnel=function(){this._currPoolPointsIndex=0;this._poolPointsSize=3E3;this._numSamplesCircle=16;this._radius=this._radiusSquared=0;this._poolPoints=[];for(var a=0,b=this._poolPointsSize;a<b;)a++,this._poolPoints.push(new DDLS.Point);Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(a){this._radius=DDLS.max(0,a);this._radiusSquared=this._radius*this._radius;this._sampleCircle=[];if(0!=this._radius){a=0;for(var b=this._numSamplesCircle;a<b;){var e=a++;this._sampleCircle.push(new DDLS.Point(this._radius*
DDLS.cos(-DDLS.TwoPI*e/this._numSamplesCircle),this._radius*DDLS.sin(-DDLS.TwoPI*e/this._numSamplesCircle)))}this._sampleCircleDistanceSquared=DDLS.Squared(this._sampleCircle[0].x-this._sampleCircle[1].x,this._sampleCircle[0].y-this._sampleCircle[1].y)}}})};
DDLS.Funnel.prototype={dispose:function(){this._sampleCircle=null},getPoint:function(a,b){this.__point=this._poolPoints[this._currPoolPointsIndex];this.__point.set(a||0,b||0);this._currPoolPointsIndex++;this._currPoolPointsIndex==this._poolPointsSize&&(this._poolPoints.push(new DDLS.Point),this._poolPointsSize++);return this.__point},getCopyPoint:function(a){return this.getPoint(a.x,a.y)},findPath:function(a,b,c,d,e,f,g){var l=new DDLS.Point(a,b);d=new DDLS.Point(c,d);c=1.01*this._radius;this._currPoolPointsIndex=
0;if(0<this._radius){var k=e[0],m;a=k.edge.originVertex.pos;b=k.edge.destinationVertex.pos;k=k.edge.nextLeftEdge.destinationVertex.pos;m=DDLS.Squared(a.x-l.x,a.y-l.y);m<=this._radiusSquared?(m=DDLS.sqrt(m),l.sub(a).div(m).mul(c).add(a)):(m=DDLS.Squared(b.x-l.x,b.y-l.y),m<=this._radiusSquared?(m=DDLS.sqrt(m),l.sub(b).div(m).mul(c).add(b)):(m=DDLS.Squared(k.x-l.x,k.y-l.y),m<=this._radiusSquared&&(m=DDLS.sqrt(m),l.sub(k).div(m).mul(c).add(k))));k=e[e.length-1];a=k.edge.originVertex.pos;b=k.edge.destinationVertex.pos;
k=k.edge.nextLeftEdge.destinationVertex.pos;m=DDLS.Squared(a.x-d.x,a.y-d.y);m<=this._radiusSquared?(m=DDLS.sqrt(m),d.sub(a).div(m).mul(c).add(a)):(m=DDLS.Squared(b.x-d.x,b.y-d.y),m<=this._radiusSquared?(m=DDLS.sqrt(m),d.sub(b).div(m).mul(c).add(b)):(m=DDLS.Squared(k.x-d.x,k.y-d.y),m<=this._radiusSquared&&(m=DDLS.sqrt(m),d.sub(k).div(m).mul(c).add(k))))}var h;h=l.clone();c=d.clone();if(1==e.length)g.push(h.x),g.push(h.y),g.push(c.x),g.push(c.y);else{var n=null,p=null;f[0]==DDLS.Geom2D.isInFace(l,e[0])&&
(f.shift(),e.shift());b=[];k=[];b.push(h);k.push(h);var r=new DDLS.Dictionary(1);m=[];e=new DDLS.Dictionary(0);a=new DDLS.Dictionary(0);e.set(h,0);var n=f[0],l=DDLS.Geom2D.getRelativePosition2(l,n),q,s,t;s=this.getCopyPoint(n.destinationVertex.pos);t=this.getCopyPoint(n.originVertex.pos);m.push(s);m.push(t);a.set(h,s);a.set(s,t);q=t;1==l?(e.set(s,1),e.set(t,-1),r.set(n.destinationVertex,1),r.set(n.originVertex,-1)):-1==l&&(e.set(s,-1),e.set(t,1),r.set(n.destinationVertex,-1),r.set(n.originVertex,
1));t=f[0].originVertex;for(var l=f[0].destinationVertex,v=1,u=f.length;v<u;)n=v++,n=f[n],n.originVertex==t?p=n.destinationVertex:n.destinationVertex==t?p=n.originVertex:n.originVertex==l?(p=n.destinationVertex,t=l):n.destinationVertex==l?(p=n.originVertex,t=l):DDLS.Log("IMPOSSIBLE TO IDENTIFY THE VERTEX !!!"),s=this.getCopyPoint(p.pos),m.push(s),l=-r.get(t),e.set(s,l),a.set(q,s),r.set(p,l),q=s,l=t,t=p;a.set(q,c);e.set(c,0);f=[];p=new DDLS.Dictionary(1);f.push(h);p.set(h,0);r=0;for(n=m.length;r<n;)if(h=
r++,q=m[h],-1==e.get(q)){for(h=b.length-2;0<=h;){l=DDLS.Geom2D.getDirection(b[h],b[h+1],q);if(-1!=l){b.shift();for(l=0;l<h;)l++,f.push(b[0]),p.set(b[0],1),b.shift();f.push(b[0]);p.set(b[0],1);k.splice(0,k.length);k.push(b[0]);k.push(q);break}h--}k.push(q);for(h=k.length-3;0<=h;){l=DDLS.Geom2D.getDirection(k[h],k[h+1],q);if(-1==l)break;else k.splice(h+1,1);h--}}else{for(h=k.length-2;0<=h;){l=DDLS.Geom2D.getDirection(k[h],k[h+1],q);if(1!=l){k.shift();for(l=0;l<h;)l++,f.push(k[0]),p.set(k[0],-1),k.shift();
f.push(k[0]);p.set(k[0],-1);b.splice(0,b.length);b.push(k[0]);b.push(q);break}h--}b.push(q);for(h=b.length-3;0<=h;){l=DDLS.Geom2D.getDirection(b[h],b[h+1],q);if(1==l)break;else b.splice(h+1,1);h--}}m=!1;for(h=k.length-2;0<=h;){l=DDLS.Geom2D.getDirection(k[h],k[h+1],d);if(1!=l){k.shift();m=0;for(h+=1;m<h;)m++,f.push(k[0]),p.set(k[0],-1),k.shift();f.push(c);p.set(c,0);m=!0;break}h--}if(!m)for(h=b.length-2;0<=h;){l=DDLS.Geom2D.getDirection(b[h],b[h+1],d);if(-1!=l){b.shift();d=0;for(k=h+1;d<k;)d++,f.push(b[0]),
p.set(b[0],1),b.shift();f.push(c);p.set(c,0);m=!0;break}h--}m||(f.push(c),p.set(c,0));d=[];if(0<this._radius){b=[];if(2==f.length)this.adjustWithTangents(f[0],!1,f[1],!1,e,a,b,d);else if(2<f.length){this.adjustWithTangents(f[0],!1,f[1],!0,e,a,b,d);if(3<f.length)for(k=1,m=f.length-3+1;k<m;)h=k++,this.adjustWithTangents(f[h],!0,f[h+1],!0,e,a,b,d);k=f.length;this.adjustWithTangents(f[k-2],!0,f[k-1],!1,e,a,b,d)}b.push(c);this.checkAdjustedPath(b,d,e);a=[];for(c=b.length-2;1<=c;){for(this.smoothAngle(d[2*
c-1],b[c],d[2*c],e.get(b[c]),a);0!=a.length;)d.splice(2*c,0,a.pop());c--}}else d=f;e=0;for(c=d.length;e<c;)a=e++,g.push(d[a].x),g.push(d[a].y)}},adjustWithTangents:function(a,b,c,d,e,f,g,l){var k=[],m=e.get(a),h=e.get(c),n=null,p=null;if(b||d)if(b)if(d)if(1==m&&1==h)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a,c,k),n=this.getPoint(k[2],k[3]),p=this.getPoint(k[4],k[5]);else if(-1==m&&-1==h)DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,a,c,k),n=this.getPoint(k[0],k[1]),p=this.getPoint(k[6],
k[7]);else if(1==m&&-1==h)if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,a,c,k))n=this.getPoint(k[2],k[3]),p=this.getPoint(k[6],k[7]);else{DDLS.Log("NO TANGENT, points are too close for radius");return}else if(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,a,c,k))n=this.getPoint(k[0],k[1]),p=this.getPoint(k[4],k[5]);else{DDLS.Log("NO TANGENT, points are too close for radius");return}else if(DDLS.Geom2D.tangentsPointToCircle(c,a,this._radius,k))0<k.length&&(n=1==m?this.getPoint(k[0],
k[1]):this.getPoint(k[2],k[3]),p=c);else{DDLS.Log("NO TANGENT");return}else if(DDLS.Geom2D.tangentsPointToCircle(a,c,this._radius,k))1==h?(n=a,p=this.getPoint(k[2],k[3])):(n=a,p=this.getPoint(k[0],k[1]));else{DDLS.Log("NO TANGENT");return}else n=a,p=c;for(k=f.get(a);k!=c;){m=DDLS.Geom2D.distanceSquaredPointToSegment(k,n,p);if(m<this._radiusSquared){this.adjustWithTangents(a,b,k,!0,e,f,g,l);this.adjustWithTangents(k,!0,c,d,e,f,g,l);return}k=f.get(k)}l.push(n);l.push(p);g.push(a)},checkAdjustedPath:function(a,
b,c){for(var d=!0,e,f,g,l,k,m,h,n=[],p=null,r=null;d;)for(var d=!1,q=2;q<a.length;)l=a[q],k=c.get(l),e=a[q-1],g=c.get(e),e=a[q-2],f=c.get(e),g==k&&(g=b[2*(q-2)],m=b[2*(q-1)-1],h=b[2*(q-1)],g=(g.x-m.x)*(h.x-m.x)+(g.y-m.y)*(h.y-m.y),0<g&&(2==q?(DDLS.Geom2D.tangentsPointToCircle(e,l,this._radius,n),1==k?(p=e,r=this.getPoint(n[2],n[3])):(p=e,r=this.getPoint(n[0],n[1]))):q==a.length-1?(DDLS.Geom2D.tangentsPointToCircle(l,e,this._radius,n),p=1==f?this.getPoint(n[0],n[1]):this.getPoint(n[2],n[3]),r=l):1==
f&&-1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e,l,n),p=this.getPoint(n[2],n[3]),r=this.getPoint(n[6],n[7])):-1==f&&1==k?(DDLS.Geom2D.tangentsCrossCircleToCircle(this._radius,e,l,n),p=this.getPoint(n[0],n[1]),r=this.getPoint(n[4],n[5])):1==f&&1==k?(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e,l,n),p=this.getPoint(n[2],n[3]),r=this.getPoint(n[4],n[5])):-1==f&&-1==k&&(DDLS.Geom2D.tangentsParalCircleToCircle(this._radius,e,l,n),p=this.getPoint(n[0],n[1]),r=this.getPoint(n[6],
n[7])),b.splice(2*(q-2),1,p),b.splice(2*q-1,1,r),a.splice(q-1,1),b.splice(2*(q-1)-1,2),n.splice(0,n.length),q--)),q++},smoothAngle:function(a,b,c,d,e){var f=DDLS.Geom2D.getDirection(a,b,c);if(!(DDLS.Squared(a.x-c.x,a.y-c.y)<=this._sampleCircleDistanceSquared)){for(var g=0,l,k,m,h,n=0,p=this._numSamplesCircle;n<p;){l=n++;m=!1;h=b.clone().add(this._sampleCircle[l]);l=DDLS.Geom2D.getDirection(a,b,h);k=DDLS.Geom2D.getDirection(b,c,h);if(1==d)if(-1==f)-1==l&&-1==k&&(m=!0);else{if(-1==l||-1==k)m=!0}else if(1==
f)1==l&&1==k&&(m=!0);else if(1==l||1==k)m=!0;m?(e.splice(g,0,h),g++):g=0}-1==d&&e.reverse()}}};DDLS.PathFinder=function(){this.astar=new DDLS.AStar;this.funnel=new DDLS.Funnel;this.listFaces=[];this.listEdges=[];this.entity=this._mesh=null;Object.defineProperty(this,"mesh",{get:function(){return this._mesh},set:function(a){this._mesh=a;this.astar.mesh=a}})};
DDLS.PathFinder.prototype={dispose:function(){this._mesh=null;this.astar.dispose();this.astar=null;this.funnel.dispose();this.listFaces=this.listEdges=this.funnel=null},findPath:function(a,b,c){c.splice(0,c.length);DDLS.Geom2D.isCircleIntersectingAnyConstraint(new DDLS.Point(a,b),this.entity.radius,this._mesh)||(this.astar.radius=this.entity.radius,this.funnel.radius=this.entity.radius,this.listFaces.splice(0,this.listFaces.length),this.listEdges.splice(0,this.listEdges.length),this.astar.findPath(this.entity.x,
this.entity.y,a,b,this.listFaces,this.listEdges),0==this.listFaces.length?DDLS.Log("PathFinder listFaces.length == 0"):this.funnel.findPath(this.entity.x,this.entity.y,a,b,this.listFaces,this.listEdges,c))}};DDLS.FieldOfView=function(){this._mesh=this._fromEntity=null;this._debug=!1;Object.defineProperty(this,"fromEntity",{get:function(){return this._fromEntity},set:function(a){this._fromEntity=a}});Object.defineProperty(this,"mesh",{get:function(){return this._mesh}})};
DDLS.FieldOfView.prototype={isInField:function(a){if(this._mesh&&this._fromEntity){var b=new DDLS.Point(this._fromEntity.x,this._fromEntity.y),c=new DDLS.Point(this._fromEntity.dirNormX,this._fromEntity.dirNormY),d=new DDLS.Point(a.x,a.y),e=this._fromEntity.radiusFOV,f=this._fromEntity.angleFOV,g=a.radius;a=DDLS.Squared(b.x-d.x,b.y-d.y);if(a>=(e+g)*(e+g))return!1;if(a<g*g)return!0;a=new DDLS.Point;var l=new DDLS.Point,k=[];DDLS.Geom2D.intersections2Circles(b,e,d,g,k)&&(a.x=k[0],a.y=k[1],l.x=k[2],
l.y=k[3]);e=b.clone().add(d).mul(0.5);if(0==k.length||DDLS.Squared(e.x-d.x,e.y-d.y)<DDLS.Squared(e.x-a.x,e.y-a.y))k.splice(0,k.length),DDLS.Geom2D.tangentsPointToCircle(b,d,g,k),a.x=k[0],a.y=k[1],l.x=k[2],l.y=k[3];e=DDLS.cos(0.5*this._fromEntity.angleFOV);d=a.clone().sub(b);g=DDLS.sqrt(d.x*d.x+d.y*d.y);d=d.x/g*c.x+d.y/g*c.y>e?!0:!1;g=l.clone().sub(b);k=DDLS.sqrt(g.x*g.x+g.y*g.y);e=g.x/k*c.x+g.y/k*c.y>e?!0:!1;if(!d&&!e&&(g=b.clone().add(c),1!=DDLS.Geom2D.getDirection(b,g,a)||-1!=DDLS.Geom2D.getDirection(b,
g,l)))return!1;d&&e||(g=new DDLS.Point,c=DDLS.atan2(c.y,c.x),d||(d=(new DDLS.Point(DDLS.cos(c-0.5*f),DDLS.sin(c-0.5*f))).add(b),DDLS.Geom2D.intersections2segments(b,d,a,l,g,null,!0),a=g.clone()),e||(f=(new DDLS.Point(DDLS.cos(c+0.5*f),DDLS.sin(c+0.5*f))).add(b),DDLS.Geom2D.intersections2segments(b,f,a,l,g,null,!0),l=g.clone()));var f=new DDLS.Dictionary,c=new DDLS.Dictionary,d=[],e=DDLS.Geom2D.locatePosition(b,this._mesh),m;2==e.type?m=e:1==e.type?m=e.leftFace:0==e.type&&(m=e.edge.leftFace);e=[];
g=new DDLS.Dictionary;e.push(m);g[m]=!0;var h,n,p;m=new DDLS.Point;for(var k=new DDLS.Point,r,q,s=[],t=[];0<e.length;)for(h=e.shift(),g.set(h,null),f.set(h,!0),h=h.edge,c.get(h)||c.get(h.oppositeEdge)||(t.push(h),c.set(h,!0)),h=h.nextLeftEdge,c.get(h)||c.get(h.oppositeEdge)||(t.push(h),c.set(h,!0)),h=h.nextLeftEdge,c.get(h)||c.get(h.oppositeEdge)||(t.push(h),c.set(h,!0));0<t.length;)if(h=t.pop(),n=h.originVertex.pos,p=h.destinationVertex.pos,DDLS.Geom2D.clipSegmentByTriangle(n.x,n.y,p.x,p.y,b.x,b.y,
l.x,l.y,a.x,a.y,m,k)){if(h.isConstrained){s.splice(0,s.length);DDLS.Geom2D.intersections2segments(b,m,a,l,null,s,!0);DDLS.Geom2D.intersections2segments(b,k,a,l,null,s,!0);n=s[1];r=s[3];r<n&&(n=r,r=s[1]);for(q=d.length-1;0<=q&&!(r>=d[q]);q--);p=q+1;0==p%2&&d.splice(p,0,r);for(q=0;q<d.length&&!(n<=d[q]);q++);r=q;0==r%2?(d.splice(r,0,n),p++):r--;d.splice(r+1,p-r-1);if(2==d.length&&-DDLS.EPSILON<d[0]&&d[0]<DDLS.EPSILON&&1-DDLS.EPSILON<d[1]&&d[1]<1+DDLS.EPSILON)return!1}h=h.rightFace;g.get(h)||f.get(h)||
(e.push(h),g.set(h,!0))}return!0}}};DDLS.LinearPathSampler=function(){this.entity=null;this._samplingDistance=this._samplingDistanceSquared=1;this._preCompX=[];this._preCompY=[];this._path=null;this._currentY=this._currentX=0;this.hasNext=this.hasPrev=!1;this._count=0;Object.defineProperty(this,"x",{get:function(){return this._currentX}});Object.defineProperty(this,"y",{get:function(){return this._currentY}});Object.defineProperty(this,"countMax",{get:function(){return this._preCompX.length-1}});Object.defineProperty(this,"count",{get:function(){return this._count},
set:function(a){this._count=a;0>this._count&&(this._count=0);this._count>this.countMax-1&&(this._count=this.countMax-1);this.hasPrev=0==this._count?!1:!0;this.hasNext=this._count==this.countMax-1?!1:!0;this._currentX=this._preCompX[this._count];this._currentY=this._preCompY[this._count];this.updateEntity()}});Object.defineProperty(this,"samplingDistance",{get:function(){return this._samplingDistance},set:function(a){this._samplingDistance=a;this._samplingDistanceSquared=this._samplingDistance*this._samplingDistance}});
Object.defineProperty(this,"path",{get:function(){return this._path},set:function(a){this._path=a;this._preComputed=!1;this.reset()}})};DDLS.LinearPathSampler.pythag=function(a,b){return DDLS.sqrt(a*a+b*b)};
DDLS.LinearPathSampler.prototype={dispose:function(){this._preCompY=this._preCompX=this._path=this.entity=null},reset:function(){0<this._path.length?(this._currentX=this._path[0],this._currentY=this._path[1],this._iPrev=0,this._iNext=2,this.hasPrev=!1,this.hasNext=!0,this._count=0,this.updateEntity()):(this.hasNext=this.hasPrev=!1,this._count=0)},preCompute:function(){this._preCompX.splice(0,this._preCompX.length);this._preCompY.splice(0,this._preCompY.length);this._count=0;this._preCompX.push(this._currentX);
this._preCompY.push(this._currentY);for(this._preComputed=!1;this.next();)this._preCompX.push(this._currentX),this._preCompY.push(this._currentY);this.reset();this._preComputed=!0},prev:function(){if(!this.hasPrev)return!1;this.hasNext=!0;if(this._preComputed)return this._count--,0==this._count&&(this.hasPrev=!1),this._currentX=this._preCompX[this._count],this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-
this._path[this._iPrev],this._currentY-this._path[this._iPrev+1]),b<a){if(a-=b,this._iPrev-=2,this._iNext-=2,0==this._iNext)break}else break;0==this._iNext?(this._currentX=this._path[0],this._currentY=this._path[1],this.hasPrev=!1,this._iNext=2,this._iPrev=0):(this._currentX+=(this._path[this._iPrev]-this._currentX)*a/b,this._currentY+=(this._path[this._iPrev+1]-this._currentY)*a/b);this.updateEntity();return!0},next:function(){if(!this.hasNext)return!1;this.hasPrev=!0;if(this._preComputed)return this._count++,
this._count==this._preCompX.length-1&&(this.hasNext=!1),this._currentX=this._preCompX[this._count],this._currentY=this._preCompY[this._count],this.updateEntity(),!0;var a,b;for(a=this._samplingDistance;;)if(b=DDLS.LinearPathSampler.pythag(this._currentX-this._path[this._iNext],this._currentY-this._path[this._iNext+1]),b<a){if(a-=b,this._currentX=this._path[this._iNext],this._currentY=this._path[this._iNext+1],this._iPrev+=2,this._iNext+=2,this._iNext==this._path.length)break}else break;this._iNext==
this._path.length?(this._currentX=this._path[this._iPrev],this._currentY=this._path[this._iPrev+1],this.hasNext=!1,this._iNext=this._path.length-2,this._iPrev=this._iNext-2):(this._currentX+=(this._path[this._iNext]-this._currentX)*a/b,this._currentY+=(this._path[this._iNext+1]-this._currentY)*a/b);this.updateEntity();return!0},updateEntity:function(){null!=this.entity&&(this.entity.x=this._currentX,this.entity.y=this._currentY)}};DDLS.PathIterator=function(){this.entity=null;this.hasNext=this.hasPrev=!1;this._currentY=this._currentX=this.count=this.countMax=0;this._path=[];Object.defineProperty(this,"x",{get:function(){return this._currentX}});Object.defineProperty(this,"y",{get:function(){return this._currentY}});Object.defineProperty(this,"path",{get:function(){return this._path},set:function(a){this._path=a;this.countMax=0.5*this._path.length;this.reset()}})};
DDLS.PathIterator.prototype={reset:function(){this.count=0;this._currentX=this._path[this.count];this._currentY=this._path[this.count+1];this.updateEntity();this.hasPrev=!1;this.hasNext=2<this._path.length?!0:!1},prev:function(){if(!this.hasPrev)return!1;this.hasNext=!0;this.count--;this._currentX=this._path[2*this.count];this._currentY=this._path[2*this.count+1];this.updateEntity();0==this.count&&(this.hasPrev=!1);return!0},next:function(){if(!this.hasNext)return!1;this.hasPrev=!0;this.count++;this._currentX=
this._path[2*this.count];this._currentY=this._path[2*this.count+1];this.updateEntity();2*(this.count+1)==this._path.length&&(this.hasNext=!1);return!0},updateEntity:function(){this.entity&&(this.entity.x=this._currentX,this.entity.y=this._currentY)}};DDLS.RectMesh={};
DDLS.RectMesh=function(a,b,c){var d=c||null;c=[];for(var e=[],f=[],g=[],l=4;l--;)f.push(new DDLS.Face),c.push(new DDLS.Vertex),g.push(new DDLS.Segment);for(l=12;l--;)e.push(new DDLS.Edge);l=new DDLS.Shape;c[0].pos.set(-10,-10);c[1].pos.set(a+10,-10);c[2].pos.set(a+10,b+10);c[3].pos.set(-10,b+10);c[0].setDatas(e[0]);c[1].setDatas(e[2]);c[2].setDatas(e[4]);c[3].setDatas(e[6]);e[0].setDatas(c[0],e[1],e[2],f[3],!0,!0);e[1].setDatas(c[1],e[0],e[7],f[0],!0,!0);e[2].setDatas(c[1],e[3],e[11],f[3],!0,!0);
e[3].setDatas(c[2],e[2],e[8],f[1],!0,!0);e[4].setDatas(c[2],e[5],e[6],f[2],!0,!0);e[5].setDatas(c[3],e[4],e[3],f[1],!0,!0);e[6].setDatas(c[3],e[7],e[10],f[2],!0,!0);e[7].setDatas(c[0],e[6],e[9],f[0],!0,!0);e[8].setDatas(c[1],e[9],e[5],f[1],!0,!1);e[9].setDatas(c[3],e[8],e[1],f[0],!0,!1);e[10].setDatas(c[0],e[11],e[4],f[2],!1,!1);e[11].setDatas(c[2],e[10],e[0],f[3],!1,!1);f[0].setDatas(e[9]);f[1].setDatas(e[8]);f[2].setDatas(e[4],!1);f[3].setDatas(e[2],!1);c[0].fromConstraintSegments=[g[0],g[3]];c[1].fromConstraintSegments=
[g[0],g[1]];c[2].fromConstraintSegments=[g[1],g[2]];c[3].fromConstraintSegments=[g[2],g[3]];e[0].fromConstraintSegments.push(g[0]);e[1].fromConstraintSegments.push(g[0]);e[2].fromConstraintSegments.push(g[1]);e[3].fromConstraintSegments.push(g[1]);e[4].fromConstraintSegments.push(g[2]);e[5].fromConstraintSegments.push(g[2]);e[6].fromConstraintSegments.push(g[3]);e[7].fromConstraintSegments.push(g[3]);g[0].edges.push(e[0]);g[1].edges.push(e[2]);g[2].edges.push(e[4]);g[3].edges.push(e[6]);g[0].fromShape=
l;g[1].fromShape=l;g[2].fromShape=l;g[3].fromShape=l;l.segments.push(g[0],g[1],g[2],g[3]);d=null==d?new DDLS.Mesh(a,b):d;d._vertices=c;d._edges=e;d._faces=f;d.get___constraintShapes().push(l);a=[0,0,a,0,a,0,a,b,a,b,0,b,0,b,0,0];d.clipping=!1;d.insertConstraintShape(a);d.clipping=!0;return d};DDLS.BitmapObject={};
DDLS.BitmapObject.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);a=DDLS.Potrace.buildShapes(a,c,d);if(1<=b){c=0;for(var e=a.length;c<e;){var f=c++;a[f]=DDLS.ShapeSimplifier(a[f],b)}}b=[];c=0;for(e=a.length;c<e;)f=c++,b.push(DDLS.Potrace.buildGraph(a[f]));a=[];c=0;for(e=b.length;c<e;)f=c++,a.push(DDLS.Potrace.buildPolygon(b[f],d));b=new DDLS.Object;c=0;for(e=a.length;c<e;){f=c++;for(d=0;d<a[f].length-2;)b.coordinates.push(a[f][d]),b.coordinates.push(a[f][d+1]),b.coordinates.push(a[f][d+2]),b.coordinates.push(a[f][d+
3]),d+=2;b.coordinates.push(a[f][0]);b.coordinates.push(a[f][1]);b.coordinates.push(a[f][d]);b.coordinates.push(a[f][d+1])}return b};DDLS.BitmapMesh={};
DDLS.BitmapMesh.buildFromBmpData=function(a,b,c,d){null==b&&(b=1);c=DDLS.Potrace.buildShapes(a,c,d);if(1<=b)for(var e=0,f=c.length;e<f;){var g=e++;c[g]=DDLS.ShapeSimplifier(c[g],b)}b=[];e=0;for(f=c.length;e<f;)g=e++,b.push(DDLS.Potrace.buildGraph(c[g]));c=[];e=0;for(f=b.length;e<f;)g=e++,c.push(DDLS.Potrace.buildPolygon(b[g],d));d=DDLS.RectMesh(a.width,a.height);b=0;for(e=c.length;b<e;){f=b++;for(a=0;a<c[f].length-2;)d.insertConstraintSegment(c[f][a],c[f][a+1],c[f][a+2],c[f][a+3]),a+=2;d.insertConstraintSegment(c[f][a],
c[f][a+1],c[f][a+2],c[f][a+3])}return d};DDLS.BasicCanvas=function(a,b,c,d){this.canvas=window.document.createElement("canvas");this.canvas.width=a||200;this.canvas.height=b||200;this.ctx=this.canvas.getContext("2d");this.canvas.style.position="absolute";this.canvas.style.backgroundColor=c||"#000000";this.ctx.fillStyle=c||"#000000";this.image=this.canvas;this.loop(d||60);window.document.body.appendChild(this.canvas)};
DDLS.BasicCanvas.prototype={loop:function(a){window.requestAnimationFrame(DDLS.Bind(this,this.loop));if(null!=this.onEnterFrame)this.onEnterFrame();return!0},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},drawCircle:function(a,b,c){this.ctx.beginPath();this.ctx.arc(a,b,c,0,DDLS.TwoPI,!1);this.ctx.stroke();this.ctx.closePath()},drawRect:function(a,b,c,d){this.ctx.beginPath();this.ctx.moveTo(a,b);this.ctx.lineTo(a+c,b);this.ctx.lineTo(a+c,b+d);this.ctx.lineTo(a,b+d);
this.ctx.stroke();this.ctx.closePath()},lineStyle:function(a,b){this.ctx.lineWidth=a;this.ctx.strokeStyle="rgba("+b.r+","+b.g+","+b.b+","+b.a+")"},moveTo:function(a,b){this.ctx.beginPath();this.ctx.moveTo(a,b)},lineTo:function(a,b){this.ctx.lineTo(a,b);this.ctx.closePath();this.ctx.stroke()},beginFill:function(a){this.ctx.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")";this.ctx.beginPath()},endFill:function(){this.ctx.stroke();this.ctx.closePath();this.ctx.fill()}};DDLS.SimpleView=function(a){this.entitiesWidth=1;this.entitiesColor={r:0,g:255,b:0,a:0.75};this.pathsWidth=1.5;this.pathsColor={r:255,g:255,b:0,a:0.75};this.verticesRadius=1;this.verticesColor={r:255,g:120,b:0,a:0.5};this.constraintsWidth=2;this.constraintsColor={r:255,g:0,b:0,a:1};this.edgesWidth=1;this.edgesColor={r:190,g:190,b:190,a:0.25};this.graphics=new DDLS.DrawContext(a);this.g=this.graphics.g;this.mesh_data=null};
DDLS.SimpleView.prototype={drawMesh:function(a,b){null==b&&(b=!1);b&&this.g.clear();a.compute_Data();for(var c=a.AR_edge,d=a.AR_vertex,e=c.length,f=0;e--;)f=5*e,c[f+4]?this.g.lineStyle(this.constraintsWidth,this.constraintsColor):this.g.lineStyle(this.edgesWidth,this.edgesColor),this.g.moveTo(c[f],c[f+1]),this.g.lineTo(c[f+2],c[f+3]);this.g.lineStyle(this.verticesRadius,this.verticesColor);for(e=d.length;e--;)f=2*e,this.g.beginFill(this.verticesColor,this.verticesAlpha),this.g.drawCircle(d[f],d[f+
1],this.verticesRadius),this.g.endFill()},drawEntity:function(a,b){null==b&&(b=!1);b&&this.g.clear();this.g.lineStyle(this.entitiesWidth,this.entitiesColor);this.g.beginFill(this.entitiesColor);this.g.drawCircle(a.x,a.y,a.radius);this.g.endFill()},drawEntities:function(a,b){null==b&&(b=!1);b&&this.g.clear();for(var c=0,d=a.length;c<d;){var e=c++;this.drawEntity(a[e],!1)}},drawPath:function(a,b){null==b&&(b=!1);b&&this.g.clear();if(0!=a.length){this.g.lineStyle(this.pathsWidth,this.pathsColor);this.g.moveTo(a[0],
a[1]);for(var c=2;c<a.length;)this.g.lineTo(a[c],a[c+1]),this.g.moveTo(a[c],a[c+1]),c+=2}}};DDLS.DrawContext=function(a){this.g=a};
DDLS.DrawContext.prototype={clear:function(){this.g.clear()},lineStyle:function(a,b){this.g.lineStyle(a,b)},beginFill:function(a){this.g.beginFill(a)},endFill:function(){this.g.endFill()},moveTo:function(a,b){this.g.moveTo(a,b)},lineTo:function(a,b){this.g.lineTo(a,b)},drawCircle:function(a,b,c){this.g.drawCircle(a,b,c)},drawRect:function(a,b,c,d){this.g.drawRect(a,b,c,d)}};DDLS.fromImageData=function(a){var b=new DDLS.PixelsData(a.width,a.height);a=a.data;for(var c=0,d=a.byteLength;c<d;){var e=c++;b.bytes[e]=a[e]&255}return b};DDLS.PixelsData=function(a,b){this.length=a*b;this.bytes=new DDLS_ARRAY_TYPE(this.length<<2);this.width=a;this.height=b};DDLS.ImageLoader=function(a,b){this.images=new DDLS.Dictionary(2);this.loaded=b;this.count=a.length;for(var c=0;c<a.length;){var d=a[c];++c;this.load(d)}};
DDLS.ImageLoader.prototype={load:function(a){var b;b=window.document.createElement("img");var c=b.style;c.left="0px";c.top="0px";c.paddingLeft="0px";c.paddingTop="0px";b.onload=function(a,b,c){return function(g){return a(b,c,g)}}(DDLS.Bind(this,this.store),b,a.split("/").pop());c.position="absolute";b.src=a},store:function(a,b,c){this.count--;DDLS.Log("store "+b+" "+this.count);this.images.set(b,a);0==this.count&&this.loaded()}};
